SET session_replication_role = replica;

--
-- PostgreSQL database dump
--

-- \restrict rtDnOtghYQfEwRXYa7OMtUJuJBRzfJuV82Gh3JqOM3BLqPYb0lvbhYisdo9xrK4

-- Dumped from database version 17.6
-- Dumped by pg_dump version 17.6

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Data for Name: audit_log_entries; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."audit_log_entries" ("instance_id", "id", "payload", "created_at", "ip_address") FROM stdin;
\.


--
-- Data for Name: flow_state; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."flow_state" ("id", "user_id", "auth_code", "code_challenge_method", "code_challenge", "provider_type", "provider_access_token", "provider_refresh_token", "created_at", "updated_at", "authentication_method", "auth_code_issued_at") FROM stdin;
\.


--
-- Data for Name: users; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."users" ("instance_id", "id", "aud", "role", "email", "encrypted_password", "email_confirmed_at", "invited_at", "confirmation_token", "confirmation_sent_at", "recovery_token", "recovery_sent_at", "email_change_token_new", "email_change", "email_change_sent_at", "last_sign_in_at", "raw_app_meta_data", "raw_user_meta_data", "is_super_admin", "created_at", "updated_at", "phone", "phone_confirmed_at", "phone_change", "phone_change_token", "phone_change_sent_at", "email_change_token_current", "email_change_confirm_status", "banned_until", "reauthentication_token", "reauthentication_sent_at", "is_sso_user", "deleted_at", "is_anonymous") FROM stdin;
00000000-0000-0000-0000-000000000000	50668840-6376-4411-9dc4-b7606ead34ef	authenticated	authenticated	manager@dietneta.com	$2a$10$O3Q2KKot5B/PAy/GndjfhOdEm4JhkxVu77zDKbjnMMkP0b9LQGcPG	2026-01-14 01:43:34.364123+00	\N		\N		\N			\N	2026-01-29 22:00:10.710401+00	{"provider": "email", "providers": ["email"]}	{"role": "admin", "full_name": "מנהל מערכת", "email_verified": true}	\N	2026-01-14 01:43:34.347792+00	2026-01-31 10:00:34.317779+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	600a932a-370e-4ed7-9078-5612a0167468	authenticated	authenticated	andreyshokin1@gmail.com	$2a$10$S3stiguewN6FayFwvHRCFOnv0aTm.xrS0pUS5zrSHy6xmKWWeddzG	2026-01-28 15:33:27.197526+00	\N		\N		\N			\N	\N	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "email_verified": true}	\N	2026-01-28 15:33:27.176556+00	2026-01-28 15:33:27.198671+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	authenticated	authenticated	nadav@dietneta.com	$2a$10$MLGmWb.GCYni6ljou37b3.L64fpnNrHL2R74XT8yqsOvmGiepBujG	2026-01-14 02:24:37.290667+00	\N		\N		\N			\N	2026-01-14 02:24:57.900176+00	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "email_verified": true}	\N	2026-01-14 02:24:37.284441+00	2026-01-15 15:55:40.038514+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	9a34c459-379d-44e7-9fbb-aafefbf45649	authenticated	authenticated	galits49@gmail.com	$2a$10$5MA0Uf.1cUuwPKOSJmGLH..gjxMIKjMHVGhkMDkK1TvgctsvO5tqO	2026-01-29 22:57:03.047669+00	\N		\N		\N			\N	2026-01-30 14:22:23.94797+00	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "email_verified": true}	\N	2026-01-29 22:57:03.03496+00	2026-01-30 14:22:23.953022+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	fe090720-f100-4977-ba2e-3702fa207e1e	authenticated	authenticated	info@easyflow.co.il	$2a$10$cPv0LB4SBSsKDu24EqnghetmNC1/abg0Pu4KO6nFh6Oalf6AGFfjG	2026-01-14 02:18:28.739353+00	\N		\N		\N			\N	\N	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "email_verified": true}	\N	2026-01-14 02:18:28.734362+00	2026-01-14 02:23:45.870895+00	\N	\N			\N		0	\N		\N	f	\N	f
\.


--
-- Data for Name: identities; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."identities" ("provider_id", "user_id", "identity_data", "provider", "last_sign_in_at", "created_at", "updated_at", "id") FROM stdin;
50668840-6376-4411-9dc4-b7606ead34ef	50668840-6376-4411-9dc4-b7606ead34ef	{"sub": "50668840-6376-4411-9dc4-b7606ead34ef", "email": "manager@dietneta.com", "email_verified": false, "phone_verified": false}	email	2026-01-14 01:43:34.361633+00	2026-01-14 01:43:34.361693+00	2026-01-14 01:43:34.361693+00	d537aa14-5352-49a2-9518-0c4739d1f563
fe090720-f100-4977-ba2e-3702fa207e1e	fe090720-f100-4977-ba2e-3702fa207e1e	{"sub": "fe090720-f100-4977-ba2e-3702fa207e1e", "email": "info@easyflow.co.il", "email_verified": false, "phone_verified": false}	email	2026-01-14 02:18:28.737384+00	2026-01-14 02:18:28.737448+00	2026-01-14 02:18:28.737448+00	48ca58c0-7923-41cb-9013-00cef6b2a103
6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	{"sub": "6a718dbd-0fa3-4e93-bc64-f2ad3116bc63", "email": "nadav@dietneta.com", "email_verified": false, "phone_verified": false}	email	2026-01-14 02:24:37.288363+00	2026-01-14 02:24:37.288427+00	2026-01-14 02:24:37.288427+00	db57d209-579e-4d58-906e-b23f271bfaa8
600a932a-370e-4ed7-9078-5612a0167468	600a932a-370e-4ed7-9078-5612a0167468	{"sub": "600a932a-370e-4ed7-9078-5612a0167468", "email": "andreyshokin1@gmail.com", "email_verified": false, "phone_verified": false}	email	2026-01-28 15:33:27.192671+00	2026-01-28 15:33:27.192737+00	2026-01-28 15:33:27.192737+00	0e8b8711-c87c-4e23-b292-b9628a54f84b
9a34c459-379d-44e7-9fbb-aafefbf45649	9a34c459-379d-44e7-9fbb-aafefbf45649	{"sub": "9a34c459-379d-44e7-9fbb-aafefbf45649", "email": "galits49@gmail.com", "email_verified": false, "phone_verified": false}	email	2026-01-29 22:57:03.044517+00	2026-01-29 22:57:03.04458+00	2026-01-29 22:57:03.04458+00	8bcb00f9-83c7-40d6-b34c-095005e9d91f
\.


--
-- Data for Name: instances; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."instances" ("id", "uuid", "raw_base_config", "created_at", "updated_at") FROM stdin;
\.


--
-- Data for Name: oauth_clients; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."oauth_clients" ("id", "client_secret_hash", "registration_type", "redirect_uris", "grant_types", "client_name", "client_uri", "logo_uri", "created_at", "updated_at", "deleted_at", "client_type") FROM stdin;
\.


--
-- Data for Name: sessions; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."sessions" ("id", "user_id", "created_at", "updated_at", "factor_id", "aal", "not_after", "refreshed_at", "user_agent", "ip", "tag", "oauth_client_id", "refresh_token_hmac_key", "refresh_token_counter", "scopes") FROM stdin;
e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-29 16:07:59.349389+00	2026-01-30 06:28:45.140907+00	\N	aal1	\N	2026-01-30 06:28:45.140791	Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36	87.68.203.20	\N	\N	\N	\N	\N
40aa7261-cf57-4fac-adba-d239dae778c5	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-29 15:22:17.176397+00	2026-01-30 21:09:18.175365+00	\N	aal1	\N	2026-01-30 21:09:18.175247	Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36	147.235.208.138	\N	\N	\N	\N	\N
cb17d80c-da53-40e0-8b97-441d1bd4b78b	9a34c459-379d-44e7-9fbb-aafefbf45649	2026-01-30 05:54:26.496498+00	2026-01-30 12:39:40.622627+00	\N	aal1	\N	2026-01-30 12:39:40.622528	Mozilla/5.0 (iPhone; CPU iPhone OS 26_2_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/144.0.7559.95 Mobile/15E148 Safari/604.1	84.228.230.168	\N	\N	\N	\N	\N
0fee191b-03fb-41a7-aed9-a7edb769a97c	9a34c459-379d-44e7-9fbb-aafefbf45649	2026-01-30 12:39:56.460065+00	2026-01-30 12:39:56.460065+00	\N	aal1	\N	\N	Mozilla/5.0 (iPhone; CPU iPhone OS 26_2_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/144.0.7559.95 Mobile/15E148 Safari/604.1	84.228.230.168	\N	\N	\N	\N	\N
21009861-62d6-4b98-a247-bb4fc51dd3ac	9a34c459-379d-44e7-9fbb-aafefbf45649	2026-01-30 12:42:01.674756+00	2026-01-30 14:22:12.927843+00	\N	aal1	\N	2026-01-30 14:22:12.927733	Mozilla/5.0 (iPhone; CPU iPhone OS 26_2_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/144.0.7559.95 Mobile/15E148 Safari/604.1	84.228.230.168	\N	\N	\N	\N	\N
a9b9bb75-d970-4d15-bceb-fe4ff3185a31	9a34c459-379d-44e7-9fbb-aafefbf45649	2026-01-30 14:22:23.94832+00	2026-01-30 14:22:23.94832+00	\N	aal1	\N	\N	Mozilla/5.0 (iPhone; CPU iPhone OS 26_2_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/144.0.7559.95 Mobile/15E148 Safari/604.1	84.228.230.168	\N	\N	\N	\N	\N
0dd41237-2368-45bb-92c5-2e3a5ad45dfa	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-29 15:12:04.850838+00	2026-01-29 16:10:09.553108+00	\N	aal1	\N	2026-01-29 16:10:09.55301	Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36	147.235.208.138	\N	\N	\N	\N	\N
6f3a2571-ccd8-402c-a045-6be53972aa46	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-29 22:00:10.710501+00	2026-01-31 10:00:34.318937+00	\N	aal1	\N	2026-01-31 10:00:34.318835	Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36	70.177.81.111	\N	\N	\N	\N	\N
\.


--
-- Data for Name: mfa_amr_claims; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."mfa_amr_claims" ("session_id", "created_at", "updated_at", "authentication_method", "id") FROM stdin;
0dd41237-2368-45bb-92c5-2e3a5ad45dfa	2026-01-29 15:12:04.860438+00	2026-01-29 15:12:04.860438+00	password	d581d63d-e6fb-465e-8e14-1b03c8213c99
40aa7261-cf57-4fac-adba-d239dae778c5	2026-01-29 15:22:17.180236+00	2026-01-29 15:22:17.180236+00	password	6610372b-28f7-4e40-9f3e-c50f5cef0f40
e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6	2026-01-29 16:07:59.353056+00	2026-01-29 16:07:59.353056+00	password	ff21a905-69eb-4bee-97e1-a9bfa0b6404e
6f3a2571-ccd8-402c-a045-6be53972aa46	2026-01-29 22:00:10.71324+00	2026-01-29 22:00:10.71324+00	password	b02003d7-e66f-46f2-8d80-5b70c2bbfde8
cb17d80c-da53-40e0-8b97-441d1bd4b78b	2026-01-30 05:54:26.500757+00	2026-01-30 05:54:26.500757+00	password	a4005536-ef97-4a97-a5f8-394ff0ab7857
0fee191b-03fb-41a7-aed9-a7edb769a97c	2026-01-30 12:39:56.473205+00	2026-01-30 12:39:56.473205+00	password	984210b7-1011-4b37-abc4-a71a976141e9
21009861-62d6-4b98-a247-bb4fc51dd3ac	2026-01-30 12:42:01.678688+00	2026-01-30 12:42:01.678688+00	password	5af23b7a-86dc-4041-b3b0-b145b17a2b47
a9b9bb75-d970-4d15-bceb-fe4ff3185a31	2026-01-30 14:22:23.95343+00	2026-01-30 14:22:23.95343+00	password	76e43ba3-f3c9-4441-a1dc-e4b6d77eaa2e
\.


--
-- Data for Name: mfa_factors; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."mfa_factors" ("id", "user_id", "friendly_name", "factor_type", "status", "created_at", "updated_at", "secret", "phone", "last_challenged_at", "web_authn_credential", "web_authn_aaguid", "last_webauthn_challenge_data") FROM stdin;
\.


--
-- Data for Name: mfa_challenges; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."mfa_challenges" ("id", "factor_id", "created_at", "verified_at", "ip_address", "otp_code", "web_authn_session_data") FROM stdin;
\.


--
-- Data for Name: oauth_authorizations; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."oauth_authorizations" ("id", "authorization_id", "client_id", "user_id", "redirect_uri", "scope", "state", "resource", "code_challenge", "code_challenge_method", "response_type", "status", "authorization_code", "created_at", "expires_at", "approved_at", "nonce") FROM stdin;
\.


--
-- Data for Name: oauth_client_states; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."oauth_client_states" ("id", "provider_type", "code_verifier", "created_at") FROM stdin;
\.


--
-- Data for Name: oauth_consents; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."oauth_consents" ("id", "user_id", "client_id", "scopes", "granted_at", "revoked_at") FROM stdin;
\.


--
-- Data for Name: one_time_tokens; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."one_time_tokens" ("id", "user_id", "token_type", "token_hash", "relates_to", "created_at", "updated_at") FROM stdin;
\.


--
-- Data for Name: refresh_tokens; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."refresh_tokens" ("instance_id", "id", "token", "user_id", "revoked", "created_at", "updated_at", "parent", "session_id") FROM stdin;
00000000-0000-0000-0000-000000000000	172	chguzmnbdjfb	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 15:12:04.858664+00	2026-01-29 16:10:09.550197+00	\N	0dd41237-2368-45bb-92c5-2e3a5ad45dfa
00000000-0000-0000-0000-000000000000	175	zusmu4l2xawt	50668840-6376-4411-9dc4-b7606ead34ef	f	2026-01-29 16:10:09.550889+00	2026-01-29 16:10:09.550889+00	chguzmnbdjfb	0dd41237-2368-45bb-92c5-2e3a5ad45dfa
00000000-0000-0000-0000-000000000000	173	o623hsrb6evp	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 15:22:17.178831+00	2026-01-29 16:20:50.27484+00	\N	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	176	zx3wwge7kyad	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 16:20:50.275629+00	2026-01-29 17:22:43.031989+00	o623hsrb6evp	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	174	yye5wogy4mng	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 16:07:59.350938+00	2026-01-29 17:23:55.193673+00	\N	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	178	iwjf6knxap5u	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 17:23:55.194923+00	2026-01-29 18:22:30.380507+00	yye5wogy4mng	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	177	43kw56hydu75	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 17:22:43.03279+00	2026-01-29 18:23:18.314972+00	zx3wwge7kyad	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	179	vmvlzwfeu5q3	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 18:22:30.381489+00	2026-01-29 19:21:26.366151+00	iwjf6knxap5u	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	180	oqkxmsnxsod7	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 18:23:18.315398+00	2026-01-29 19:21:53.656655+00	43kw56hydu75	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	182	l6ucbhyki7ee	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 19:21:53.657168+00	2026-01-29 20:22:00.68448+00	oqkxmsnxsod7	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	181	mnrpyshrtim5	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 19:21:26.36658+00	2026-01-29 20:41:01.653456+00	vmvlzwfeu5q3	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	183	xlict7dyhvx4	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 20:22:00.68533+00	2026-01-29 21:24:13.267452+00	l6ucbhyki7ee	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	184	j53ri6pxsqjo	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 20:41:01.654355+00	2026-01-29 21:39:38.655391+00	mnrpyshrtim5	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	185	wshmkldheeu7	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 21:24:13.268414+00	2026-01-29 22:23:06.422098+00	xlict7dyhvx4	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	186	tfe2nes3a22h	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 21:39:38.656282+00	2026-01-29 22:39:49.047345+00	j53ri6pxsqjo	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	187	fiydcck2n4w4	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 22:00:10.71177+00	2026-01-29 22:58:24.182725+00	\N	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	188	zl5nnd43tbbb	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 22:23:06.422507+00	2026-01-29 23:22:40.586571+00	wshmkldheeu7	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	190	hpwhzzwu7xje	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 22:58:24.183128+00	2026-01-29 23:56:46.13382+00	fiydcck2n4w4	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	189	72wmpd4fd5oz	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 22:39:49.047757+00	2026-01-30 00:07:17.367481+00	tfe2nes3a22h	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	191	istkmh3uhecc	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 23:22:40.587019+00	2026-01-30 00:21:22.142975+00	zl5nnd43tbbb	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	192	3inebx5okl4i	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-29 23:56:46.134207+00	2026-01-30 00:55:16.61001+00	hpwhzzwu7xje	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	193	ms35a556isrt	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 00:07:17.367831+00	2026-01-30 01:08:08.579457+00	72wmpd4fd5oz	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	194	fztavrvd7met	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 00:21:22.14331+00	2026-01-30 01:20:31.410747+00	istkmh3uhecc	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	195	uz2mkjsoykq6	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 00:55:16.610335+00	2026-01-30 01:53:29.051257+00	3inebx5okl4i	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	196	vgflz26xsfhe	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 01:08:08.579811+00	2026-01-30 02:09:05.330606+00	ms35a556isrt	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	197	wu2n4iucib7p	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 01:20:31.411515+00	2026-01-30 02:20:07.819384+00	fztavrvd7met	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	198	xvyqbe6w5dnf	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 01:53:29.051931+00	2026-01-30 02:51:59.024665+00	uz2mkjsoykq6	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	199	ny2a646pxk7m	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 02:09:05.330952+00	2026-01-30 03:10:11.382726+00	vgflz26xsfhe	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	200	itgliyr5xc5w	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 02:20:07.819987+00	2026-01-30 03:18:54.279161+00	wu2n4iucib7p	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	203	ceieilodjnr6	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 03:18:54.280057+00	2026-01-30 04:18:55.320124+00	itgliyr5xc5w	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	202	b4zzx67yxtbx	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 03:10:11.383072+00	2026-01-30 04:28:31.985646+00	ny2a646pxk7m	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	204	d74k2ab6ot5z	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 04:18:55.320981+00	2026-01-30 05:17:53.368937+00	ceieilodjnr6	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	205	m7ai2oww3psr	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 04:28:31.98646+00	2026-01-30 05:29:59.703472+00	b4zzx67yxtbx	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	206	7sxryq4ei7dc	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 05:17:53.369828+00	2026-01-30 06:18:42.843187+00	d74k2ab6ot5z	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	207	qtlfshhkvvfs	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 05:29:59.704379+00	2026-01-30 06:28:45.136839+00	m7ai2oww3psr	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	210	hi5jckykxb2n	50668840-6376-4411-9dc4-b7606ead34ef	f	2026-01-30 06:28:45.137741+00	2026-01-30 06:28:45.137741+00	qtlfshhkvvfs	e2882f90-0a5c-4ade-bf4b-fe9e455c3fa6
00000000-0000-0000-0000-000000000000	209	jnd6x4xqbeoh	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 06:18:42.844596+00	2026-01-30 07:17:27.489203+00	7sxryq4ei7dc	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	201	fonis3gpneov	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 02:51:59.02537+00	2026-01-30 07:29:38.220481+00	xvyqbe6w5dnf	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	211	r525xysw7kyg	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 07:17:27.490107+00	2026-01-30 08:16:10.867655+00	jnd6x4xqbeoh	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	212	kuqs4i5ixgcm	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 07:29:38.221233+00	2026-01-30 08:28:13.028655+00	fonis3gpneov	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	208	yf42zjcp3iaf	9a34c459-379d-44e7-9fbb-aafefbf45649	t	2026-01-30 05:54:26.498176+00	2026-01-30 09:02:05.733793+00	\N	cb17d80c-da53-40e0-8b97-441d1bd4b78b
00000000-0000-0000-0000-000000000000	213	5hrkbdqq4ypn	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 08:16:10.868091+00	2026-01-30 09:14:55.209557+00	r525xysw7kyg	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	216	mggenp25hlv4	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 09:14:55.210415+00	2026-01-30 10:14:26.865867+00	5hrkbdqq4ypn	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	217	uh3tcasul7lv	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 10:14:26.867303+00	2026-01-30 11:15:02.644787+00	mggenp25hlv4	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	218	65tzfaaeze3b	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 11:15:02.646074+00	2026-01-30 12:16:22.615969+00	uh3tcasul7lv	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	215	qyrun5zhtow7	9a34c459-379d-44e7-9fbb-aafefbf45649	t	2026-01-30 09:02:05.735128+00	2026-01-30 12:39:40.618196+00	yf42zjcp3iaf	cb17d80c-da53-40e0-8b97-441d1bd4b78b
00000000-0000-0000-0000-000000000000	220	fx7m7pd2hdcq	9a34c459-379d-44e7-9fbb-aafefbf45649	f	2026-01-30 12:39:40.619188+00	2026-01-30 12:39:40.619188+00	qyrun5zhtow7	cb17d80c-da53-40e0-8b97-441d1bd4b78b
00000000-0000-0000-0000-000000000000	221	trqoz7n4ktbv	9a34c459-379d-44e7-9fbb-aafefbf45649	f	2026-01-30 12:39:56.471721+00	2026-01-30 12:39:56.471721+00	\N	0fee191b-03fb-41a7-aed9-a7edb769a97c
00000000-0000-0000-0000-000000000000	219	25yv442hebvm	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 12:16:22.616751+00	2026-01-30 13:15:09.030423+00	65tzfaaeze3b	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	214	3cfbghfd2vv7	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 08:28:13.029172+00	2026-01-30 13:28:35.97894+00	kuqs4i5ixgcm	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	240	glyjsyvwdpux	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 20:19:00.427198+00	2026-01-30 21:17:37.388633+00	kubbfugvvppb	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	242	ivhohoyz2bwh	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 21:17:37.389107+00	2026-01-30 22:16:25.341261+00	glyjsyvwdpux	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	223	njf7epwgjcvi	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 13:15:09.031314+00	2026-01-30 14:13:44.6221+00	25yv442hebvm	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	243	h2cppknnsiiz	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 22:16:25.341901+00	2026-01-30 23:15:12.443405+00	ivhohoyz2bwh	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	222	ojrwqzavhsnn	9a34c459-379d-44e7-9fbb-aafefbf45649	t	2026-01-30 12:42:01.676189+00	2026-01-30 14:22:12.925009+00	\N	21009861-62d6-4b98-a247-bb4fc51dd3ac
00000000-0000-0000-0000-000000000000	226	j6yxvfrliifk	9a34c459-379d-44e7-9fbb-aafefbf45649	f	2026-01-30 14:22:12.925488+00	2026-01-30 14:22:12.925488+00	ojrwqzavhsnn	21009861-62d6-4b98-a247-bb4fc51dd3ac
00000000-0000-0000-0000-000000000000	227	7kc47gbm3agp	9a34c459-379d-44e7-9fbb-aafefbf45649	f	2026-01-30 14:22:23.951456+00	2026-01-30 14:22:23.951456+00	\N	a9b9bb75-d970-4d15-bceb-fe4ff3185a31
00000000-0000-0000-0000-000000000000	224	uevsh7pziaeo	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 13:28:35.979485+00	2026-01-30 14:27:12.443719+00	3cfbghfd2vv7	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	225	d22oalrptnvv	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 14:13:44.622563+00	2026-01-30 15:12:18.68206+00	njf7epwgjcvi	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	244	ul3kxk5ukczo	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 23:15:12.443799+00	2026-01-31 00:13:43.323854+00	h2cppknnsiiz	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	228	ftnrf45z3wtq	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 14:27:12.444124+00	2026-01-30 15:25:45.426736+00	uevsh7pziaeo	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	229	s26rrjc2qyen	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 15:12:18.68257+00	2026-01-30 16:11:19.980855+00	d22oalrptnvv	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	245	77quw3lqn274	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 00:13:43.324628+00	2026-01-31 01:12:22.315735+00	ul3kxk5ukczo	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	230	kcftjcsu7c57	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 15:25:45.427617+00	2026-01-30 16:24:22.362759+00	ftnrf45z3wtq	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	231	rwxjb4vinuks	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 16:11:19.981308+00	2026-01-30 17:09:51.400982+00	s26rrjc2qyen	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	246	oiwjgl5tvsha	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 01:12:22.31615+00	2026-01-31 02:10:58.32913+00	77quw3lqn274	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	232	pkzsmwajj4vx	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 16:24:22.363089+00	2026-01-30 17:23:03.423452+00	kcftjcsu7c57	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	233	aytkznap43qd	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 17:09:51.401447+00	2026-01-30 18:08:27.708532+00	rwxjb4vinuks	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	247	iclavviju5zv	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 02:10:58.329518+00	2026-01-31 03:09:34.262962+00	oiwjgl5tvsha	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	234	qo6vomxsi3d5	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 17:23:03.423857+00	2026-01-30 18:21:38.348819+00	pkzsmwajj4vx	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	235	dnzktdmifj2n	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 18:08:27.70891+00	2026-01-30 19:09:48.079763+00	aytkznap43qd	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	248	w5msqzjuj327	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 03:09:34.263646+00	2026-01-31 04:08:04.300565+00	iclavviju5zv	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	236	vfdckm2ld57m	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 18:21:38.349595+00	2026-01-30 19:20:22.391961+00	qo6vomxsi3d5	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	237	7e7unwwvbuvf	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 19:09:48.080747+00	2026-01-30 20:08:48.838705+00	dnzktdmifj2n	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	249	fibslnjmnrxy	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 04:08:04.300889+00	2026-01-31 05:06:34.244961+00	w5msqzjuj327	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	238	kubbfugvvppb	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 19:20:22.392623+00	2026-01-30 20:19:00.425989+00	vfdckm2ld57m	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	239	ksotebb2vhnc	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-30 20:08:48.839062+00	2026-01-30 21:09:18.172842+00	7e7unwwvbuvf	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	241	gd5k2bsgt243	50668840-6376-4411-9dc4-b7606ead34ef	f	2026-01-30 21:09:18.173227+00	2026-01-30 21:09:18.173227+00	ksotebb2vhnc	40aa7261-cf57-4fac-adba-d239dae778c5
00000000-0000-0000-0000-000000000000	250	4ljazml5w7oq	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 05:06:34.245346+00	2026-01-31 06:05:07.251606+00	fibslnjmnrxy	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	251	m45gb6obkctm	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 06:05:07.252262+00	2026-01-31 07:04:03.297492+00	4ljazml5w7oq	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	252	v6nk7ljklhlu	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 07:04:03.297872+00	2026-01-31 08:02:36.643141+00	m45gb6obkctm	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	253	vehsahh2ahqo	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 08:02:36.644022+00	2026-01-31 09:01:36.219083+00	v6nk7ljklhlu	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	254	756leq566jtj	50668840-6376-4411-9dc4-b7606ead34ef	t	2026-01-31 09:01:36.219427+00	2026-01-31 10:00:34.316422+00	vehsahh2ahqo	6f3a2571-ccd8-402c-a045-6be53972aa46
00000000-0000-0000-0000-000000000000	255	r5r42fhbvo2t	50668840-6376-4411-9dc4-b7606ead34ef	f	2026-01-31 10:00:34.316769+00	2026-01-31 10:00:34.316769+00	756leq566jtj	6f3a2571-ccd8-402c-a045-6be53972aa46
\.


--
-- Data for Name: sso_providers; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."sso_providers" ("id", "resource_id", "created_at", "updated_at", "disabled") FROM stdin;
\.


--
-- Data for Name: saml_providers; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."saml_providers" ("id", "sso_provider_id", "entity_id", "metadata_xml", "metadata_url", "attribute_mapping", "created_at", "updated_at", "name_id_format") FROM stdin;
\.


--
-- Data for Name: saml_relay_states; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."saml_relay_states" ("id", "sso_provider_id", "request_id", "for_email", "redirect_to", "created_at", "updated_at", "flow_state_id") FROM stdin;
\.


--
-- Data for Name: sso_domains; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."sso_domains" ("id", "sso_provider_id", "domain", "created_at", "updated_at") FROM stdin;
\.


--
-- Data for Name: customers; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."customers" ("id", "full_name", "phone", "email", "created_at", "updated_at", "daily_protocol", "workout_history", "steps_history", "avatar_url", "total_spent", "membership_tier", "user_id") FROM stdin;
d6f1839c-69ba-485c-a2c8-94ab813608b8	נטע -בדיקה	972545496861	netasway@gmail.com	2026-01-14 20:12:33.415829+00	2026-01-14 20:12:33.415829+00	{}	[]	[]	\N	0.00	New	\N
1bb66d54-a424-493c-98ee-068a879afcb6	ליטל אסיף	972504233707	litalaseef@gmail.com	2026-01-15 15:50:11.975544+00	2026-01-15 15:50:11.975544+00	{}	[]	[]	\N	0.00	New	\N
f379a13d-19c9-4338-a0fd-df07cb597f5e	נטע הירש	13058077747	\N	2026-01-21 18:42:34.542653+00	2026-01-21 18:45:20.532737+00	{}	[]	[]	\N	0.00	New	\N
96d78f57-0a52-4d89-bcdf-d24e2795f24f	אנדרי שצוקין	972526861485	\N	2026-01-29 15:12:47.56176+00	2026-01-29 15:12:47.56176+00	{}	[]	[]	\N	0.00	New	\N
af7bdb9d-65aa-45b0-be2b-007ea60ae134	נדב	972528393372	\N	2026-01-19 14:14:01.305835+00	2026-01-29 17:24:37.00111+00	{}	[]	[]	\N	0.00	New	fe090720-f100-4977-ba2e-3702fa207e1e
708c5b1a-6611-45df-8a85-f2f04909f4ae	גלית סמובסקי	972504078913	Galits49@gmail.com	2026-01-29 22:18:14.796256+00	2026-01-29 22:57:03.321014+00	{}	[]	[]	\N	0.00	New	9a34c459-379d-44e7-9fbb-aafefbf45649
2383134b-057a-4a45-a2e1-53c50a9655ee	אורלי ברק	972504048157	orly.barak@gmail.com	2026-01-29 23:42:34.617327+00	2026-01-29 23:42:34.617327+00	{}	[]	[]	\N	0.00	New	\N
\.


--
-- Data for Name: profiles; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."profiles" ("id", "email", "full_name", "role", "created_at", "updated_at", "is_active", "customer_id", "avatar_url") FROM stdin;
50668840-6376-4411-9dc4-b7606ead34ef	manager@dietneta.com	מנהל מערכת	admin	2026-01-14 01:43:34.347427+00	2026-01-14 01:43:34.528323+00	t	\N	\N
fe090720-f100-4977-ba2e-3702fa207e1e	info@easyflow.co.il		trainee	2026-01-14 02:18:28.734001+00	2026-01-14 02:24:10.792503+00	t	\N	\N
6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	nadav@dietneta.com		trainee	2026-01-14 02:24:37.284111+00	2026-01-14 02:24:37.284111+00	t	\N	\N
600a932a-370e-4ed7-9078-5612a0167468	andreyshokin1@gmail.com		trainee	2026-01-28 15:33:27.176219+00	2026-01-28 15:33:27.176219+00	t	\N	\N
9a34c459-379d-44e7-9fbb-aafefbf45649	galits49@gmail.com		trainee	2026-01-29 22:57:03.03463+00	2026-01-29 22:57:03.03463+00	t	\N	\N
\.


--
-- Data for Name: leads; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."leads" ("id", "created_at", "updated_at", "assigned_to", "city", "birth_date", "gender", "status_main", "status_sub", "height", "weight", "bmi", "join_date", "subscription_data", "daily_protocol", "workout_history", "steps_history", "source", "fitness_goal", "activity_level", "preferred_time", "notes", "customer_id", "nutrition_history", "supplements_history", "age", "period") FROM stdin;
f1a1105a-9d98-49a3-ad87-c7ced89bc73a	2026-01-29 17:24:37.146035+00	2026-01-29 17:24:37.146035+00	\N	\N	\N	female	\N	\N	\N	\N	\N	\N	{}	{}	[]	[]	\N	\N	\N	\N	\N	af7bdb9d-65aa-45b0-be2b-007ea60ae134	[]	[]	\N	\N
014c0a33-d0c8-4af7-a0d7-806f6169a153	2026-01-15 15:50:12.199708+00	2026-01-29 22:06:50.673052+00	\N	חיפה	\N	female	פעיל	\N	165.00	61.90	22.74	\N	{"status": "פעיל", "initialPrice": 450}	{}	[]	[]	אינסטגרם	חיטוב	בינוני	בוקר	\N	1bb66d54-a424-493c-98ee-068a879afcb6	[]	[]	49	t
278533bb-a303-4447-92a8-3fa1ba4a8114	2026-01-29 22:18:15.246766+00	2026-01-29 22:19:30.836898+00	\N	אביחיל	\N	female	פעיל	\N	170.00	78.50	27.16	2026-01-29 00:00:00+00	{"months": 1, "status": "פעיל", "currency": "ILS", "initialPrice": 900, "renewalPrice": 0, "duration_unit": "months", "expirationDate": "2026-03-01", "subscription_type_id": "8382c4a9-77cb-4890-ae1c-c46f9f4c67f7", "subscription_type_name": "חופשי חודשי (ישן)"}	{}	[]	[]	אינסטגרם	חיטוב	מתקדם	\N	\N	708c5b1a-6611-45df-8a85-f2f04909f4ae	[]	[]	52	f
8150211c-7e1c-4e7c-ae47-a80330c6e502	2026-01-29 23:42:35.173841+00	2026-01-29 23:44:14.018361+00	\N	תל אביב	\N	female	פעיל	\N	160.00	75.50	29.49	2026-01-29 00:00:00+00	{"months": 1, "status": "פעיל", "currency": "ILS", "initialPrice": 1250, "renewalPrice": 0, "duration_unit": "months", "expirationDate": "2026-03-01", "future_subscription": null, "subscription_type_id": "f583c9f6-04d4-4e62-9c41-d552ef8efb2a", "subscription_type_name": "חופשי חודשי"}	{}	[]	[]	אינסטגרם	חיטוב	מתקדם	\N	\N	2383134b-057a-4a45-a2e1-53c50a9655ee	[]	[]	45	t
\.


--
-- Data for Name: blood_tests; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."blood_tests" ("id", "lead_id", "file_url", "file_name", "upload_date", "created_at", "updated_at", "uploaded_by") FROM stdin;
\.


--
-- Data for Name: nutrition_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."nutrition_templates" ("id", "name", "description", "targets", "is_public", "created_at", "updated_at", "created_by", "manual_override", "manual_fields", "activity_entries") FROM stdin;
\.


--
-- Data for Name: supplement_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."supplement_templates" ("id", "name", "description", "supplements", "is_public", "created_at", "updated_at", "created_by") FROM stdin;
fa12d517-fed2-4f93-b4ec-643a40bbb381	ברברין	\N	[{"name": "ברברין", "link1": "https://iherb.co/1mmrKqvZ", "link2": "https://amzn.to/46QKpvu", "dosage": "2 כדורים ביום", "timing": "רבע שעה לפני ארוחה עשירה בפחמימות"}]	f	2026-01-29 22:23:01.567654+00	2026-01-29 22:23:01.567654+00	50668840-6376-4411-9dc4-b7606ead34ef
0bdaee5b-a66d-4c72-84b2-a5731341ac90	קולגן (THRONE)	\N	[{"name": "קולגן (THRONE)", "link1": "https://iherb.co/VVQZKNa3", "link2": "https://www.amazon.com/dp/B0B7K9Y1FD/?coliid=I1KQAC9HSU2ATH&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_93V78YPRF2TWBK4DHKFD", "dosage": "סקופ", "timing": ""}]	f	2026-01-29 22:28:33.863844+00	2026-01-29 22:28:33.863844+00	50668840-6376-4411-9dc4-b7606ead34ef
b4e5ceb4-a062-4fc9-a487-8fed0d616b56	קולגן (לעצמות ומפרקים)	\N	[{"name": "קולגן (לעצמות ומפרקים)", "link1": "https://iherb.co/cdeyDSJ", "link2": "https://amzn.to/49AhddJ", "dosage": "סקופ", "timing": ""}]	f	2026-01-29 22:31:09.959382+00	2026-01-29 22:31:09.959382+00	50668840-6376-4411-9dc4-b7606ead34ef
9f4ab284-f35e-4a99-adad-2923f405e678	ויטמין D	\N	[{"name": "ויטמין D", "link1": "https://iherb.co/4Lzfkpz3", "link2": "https://www.amazon.com/dp/B003CF7TOA/?coliid=ICG2XPPNG6XAN&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_5KRCKHZTF4GT1RGYBV3S", "dosage": "1 כדור", "timing": "בבוקר עם מאכל שומני"}]	f	2026-01-29 22:32:00.340442+00	2026-01-29 22:32:00.340442+00	50668840-6376-4411-9dc4-b7606ead34ef
a1dd7953-cae2-4b44-9d84-a1f9df7a7ccc	תוסף סיבים	\N	[{"name": "תוסף סיבים", "link1": "https://iherb.co/9GWRUJpQ", "link2": "https://amzn.to/3LgaJ9H", "dosage": "1 סקופ", "timing": ""}]	f	2026-01-29 22:33:10.612759+00	2026-01-29 22:33:10.612759+00	50668840-6376-4411-9dc4-b7606ead34ef
05d8a2bc-3f39-489c-be6f-756a822451ba	מגנזיום (אבקה-לשינה)	\N	[{"name": "מגנזיום (אבקה-לשינה)", "link1": "https://iherb.co/VD2VdjMU", "link2": "https://amzn.to/49C7MKL", "dosage": "1-2 סקופ", "timing": "בכוס מים בלילה לפני השינה"}]	f	2026-01-29 22:34:50.372616+00	2026-01-29 22:34:50.372616+00	50668840-6376-4411-9dc4-b7606ead34ef
7b03f560-fc9b-42f2-9015-8f078e76361e	מגנזיום גליצינט (לילה)	\N	[{"name": "מגנזיום גליצינט (לילה)", "link1": "https://iherb.co/xRAxVcwz", "link2": "https://amzn.to/4k7WYqZ", "dosage": "3 כדורים", "timing": "בלילה"}]	f	2026-01-29 22:36:09.918775+00	2026-01-29 22:36:09.918775+00	50668840-6376-4411-9dc4-b7606ead34ef
4fdf5a2d-698d-4d3c-af9d-9af1d94e5eea	מגנזיום גליצינט+טריונט) לילה AMAZON	\N	[{"name": "מגנזיום גליצינט+טריונט) לילה AMAZON", "link1": "https://amzn.to/47ubbtO", "dosage": "3 כדורים", "timing": ""}]	f	2026-01-29 22:38:20.865586+00	2026-01-29 22:38:20.865586+00	50668840-6376-4411-9dc4-b7606ead34ef
6a2080af-1912-4217-a67c-80d52c2c9c54	קריאטין	\N	[{"name": "קריאטין", "link1": "https://iherb.co/SuDXikfb", "link2": "https://amzn.to/491joH6", "dosage": "1-3 סקופ ביום", "timing": "במים"}]	f	2026-01-29 22:40:02.420142+00	2026-01-29 22:40:02.420142+00	50668840-6376-4411-9dc4-b7606ead34ef
dde961b1-e0c5-4050-8748-79294bfdfbdf	פרוביוטיקה	\N	[{"name": "פרוביוטיקה", "link1": "https://amzn.to/4n5G2kP", "link2": "https://iherb.co/wKEPjXvx", "dosage": "", "timing": ""}]	f	2026-01-29 22:41:16.39857+00	2026-01-29 22:41:16.39857+00	50668840-6376-4411-9dc4-b7606ead34ef
\.


--
-- Data for Name: workout_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."workout_templates" ("id", "name", "description", "goal_tags", "routine_data", "is_public", "created_at", "updated_at", "created_by") FROM stdin;
6e717bed-c709-47d3-9688-fdd3f137f0e7	תבנית ללא שם	\N	{}	{"weeklyWorkout": {"days": {"friday": {"day": "friday", "isActive": false, "exercises": []}, "monday": {"day": "monday", "isActive": false, "exercises": []}, "sunday": {"day": "sunday", "isActive": true, "exercises": [{"id": "1768946436759-0.28402187621147057", "name": "גדכדג", "reps": 10, "sets": 3}, {"id": "1768946454713-0.4004387696292534", "name": "ספסל לחיצה", "reps": 8, "sets": 4}, {"id": "1768946454713-0.9199210131944925", "name": "לחיצת כתפיים", "reps": 10, "sets": 3}, {"id": "1768946454713-0.6136195738413109", "name": "דיפים", "reps": 12, "sets": 3}, {"id": "1768946454713-0.1684890227843283", "name": "טריצפס", "reps": 12, "sets": 3}, {"id": "1768946458321-0.6911141340853347", "name": "ספסל לחיצה", "reps": 8, "sets": 4}, {"id": "1768946458321-0.5306429205092226", "name": "לחיצת כתפיים", "reps": 10, "sets": 3}, {"id": "1768946458321-0.6038593862366576", "name": "דיפים", "reps": 12, "sets": 3}, {"id": "1768946458321-0.480898070299403", "name": "טריצפס", "reps": 12, "sets": 3}]}, "tuesday": {"day": "tuesday", "isActive": false, "exercises": []}, "saturday": {"day": "saturday", "isActive": false, "exercises": []}, "thursday": {"day": "thursday", "isActive": false, "exercises": []}, "wednesday": {"day": "wednesday", "isActive": false, "exercises": []}}, "startDate": "2026-01-21", "stepsGoal": 0, "description": "", "generalGoals": ""}}	f	2026-01-20 22:01:17.71368+00	2026-01-20 22:01:17.71368+00	50668840-6376-4411-9dc4-b7606ead34ef
\.


--
-- Data for Name: budgets; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."budgets" ("id", "name", "description", "nutrition_template_id", "nutrition_targets", "steps_goal", "steps_instructions", "workout_template_id", "supplements", "eating_order", "eating_rules", "is_public", "created_at", "updated_at", "created_by", "supplement_template_id", "cardio_training", "interval_training") FROM stdin;
32998caa-d8b3-4f00-95b6-5b204282e487	ריברס	\N	\N	{"fat": 0, "carbs": 0, "protein": 0, "calories": 0, "fiber_min": 20}	10000	\N	\N	[{"name": "ברברין", "link1": "https://iherb.co/1mmrKqvZ", "link2": "https://amzn.to/46QKpvu", "dosage": "2 כדורים ביום", "timing": "רבע שעה לפני ארוחה עשירה בפחמימות"}, {"name": "קולגן (THRONE)", "link1": "https://iherb.co/VVQZKNa3", "link2": "https://www.amazon.com/dp/B0B7K9Y1FD/?coliid=I1KQAC9HSU2ATH&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_93V78YPRF2TWBK4DHKFD", "dosage": "סקופ", "timing": ""}, {"name": "קולגן (לעצמות ומפרקים)", "link1": "https://iherb.co/cdeyDSJ", "link2": "https://amzn.to/49AhddJ", "dosage": "סקופ", "timing": ""}, {"name": "ויטמין D", "link1": "https://iherb.co/4Lzfkpz3", "link2": "https://www.amazon.com/dp/B003CF7TOA/?coliid=ICG2XPPNG6XAN&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_5KRCKHZTF4GT1RGYBV3S", "dosage": "1 כדור", "timing": "בבוקר עם מאכל שומני"}, {"name": "תוסף סיבים", "link1": "https://iherb.co/9GWRUJpQ", "link2": "https://amzn.to/3LgaJ9H", "dosage": "1 סקופ", "timing": ""}, {"name": "מגנזיום (אבקה-לשינה)", "link1": "https://iherb.co/VD2VdjMU", "link2": "https://amzn.to/49C7MKL", "dosage": "1-2 סקופ", "timing": "בכוס מים בלילה לפני השינה"}, {"name": "מגנזיום גליצינט (לילה) BIO OPTIMIZERS", "link1": "https://iherb.co/xRAxVcwz", "link2": "https://amzn.to/4k7WYqZ", "dosage": "3 כדורים", "timing": "בלילה"}, {"name": "מגנזיום גליצינט+טריונט) לילה AMAZON", "link1": "https://amzn.to/47ubbtO", "dosage": "3 כדורים", "timing": ""}, {"name": "קריאטין", "link1": "https://iherb.co/SuDXikfb", "link2": "https://amzn.to/491joH6", "dosage": "1-3 סקופ ביום", "timing": "במים"}, {"name": "פרוביוטיקה", "link1": "https://amzn.to/4n5G2kP", "link2": "https://iherb.co/wKEPjXvx", "dosage": "", "timing": ""}]	דגשים לסוכר (סיבים, חלבון ואז פחמימה, הקפאת לחם, לא תאכלי פחמימה לבדה 	\N	f	2026-01-29 22:52:39.052261+00	2026-01-29 22:52:39.052261+00	50668840-6376-4411-9dc4-b7606ead34ef	\N	\N	\N
\.


--
-- Data for Name: budget_assignments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."budget_assignments" ("id", "budget_id", "lead_id", "customer_id", "assigned_at", "assigned_by", "is_active", "notes", "created_at", "updated_at") FROM stdin;
987c1c6a-e3de-45c4-af95-9ee801b0a0fb	32998caa-d8b3-4f00-95b6-5b204282e487	278533bb-a303-4447-92a8-3fa1ba4a8114	\N	2026-01-29 22:52:44.479081+00	50668840-6376-4411-9dc4-b7606ead34ef	t	\N	2026-01-29 22:52:44.479081+00	2026-01-29 22:52:44.479081+00
\.


--
-- Data for Name: budget_history; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."budget_history" ("id", "budget_id", "changed_at", "changed_by", "change_type", "changes", "snapshot", "lead_id") FROM stdin;
70b8f87c-e6b9-4cef-bbad-38a7724929cd	32998caa-d8b3-4f00-95b6-5b204282e487	2026-01-29 22:52:39.052261+00	50668840-6376-4411-9dc4-b7606ead34ef	create	{}	{"id": "32998caa-d8b3-4f00-95b6-5b204282e487", "name": "ריברס", "is_public": false, "created_at": "2026-01-29T22:52:39.052261+00:00", "created_by": "50668840-6376-4411-9dc4-b7606ead34ef", "steps_goal": 10000, "updated_at": "2026-01-29T22:52:39.052261+00:00", "description": null, "supplements": [{"name": "ברברין", "link1": "https://iherb.co/1mmrKqvZ", "link2": "https://amzn.to/46QKpvu", "dosage": "2 כדורים ביום", "timing": "רבע שעה לפני ארוחה עשירה בפחמימות"}, {"name": "קולגן (THRONE)", "link1": "https://iherb.co/VVQZKNa3", "link2": "https://www.amazon.com/dp/B0B7K9Y1FD/?coliid=I1KQAC9HSU2ATH&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_93V78YPRF2TWBK4DHKFD", "dosage": "סקופ", "timing": ""}, {"name": "קולגן (לעצמות ומפרקים)", "link1": "https://iherb.co/cdeyDSJ", "link2": "https://amzn.to/49AhddJ", "dosage": "סקופ", "timing": ""}, {"name": "ויטמין D", "link1": "https://iherb.co/4Lzfkpz3", "link2": "https://www.amazon.com/dp/B003CF7TOA/?coliid=ICG2XPPNG6XAN&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_5KRCKHZTF4GT1RGYBV3S", "dosage": "1 כדור", "timing": "בבוקר עם מאכל שומני"}, {"name": "תוסף סיבים", "link1": "https://iherb.co/9GWRUJpQ", "link2": "https://amzn.to/3LgaJ9H", "dosage": "1 סקופ", "timing": ""}, {"name": "מגנזיום (אבקה-לשינה)", "link1": "https://iherb.co/VD2VdjMU", "link2": "https://amzn.to/49C7MKL", "dosage": "1-2 סקופ", "timing": "בכוס מים בלילה לפני השינה"}, {"name": "מגנזיום גליצינט (לילה) BIO OPTIMIZERS", "link1": "https://iherb.co/xRAxVcwz", "link2": "https://amzn.to/4k7WYqZ", "dosage": "3 כדורים", "timing": "בלילה"}, {"name": "מגנזיום גליצינט+טריונט) לילה AMAZON", "link1": "https://amzn.to/47ubbtO", "dosage": "3 כדורים", "timing": ""}, {"name": "קריאטין", "link1": "https://iherb.co/SuDXikfb", "link2": "https://amzn.to/491joH6", "dosage": "1-3 סקופ ביום", "timing": "במים"}, {"name": "פרוביוטיקה", "link1": "https://amzn.to/4n5G2kP", "link2": "https://iherb.co/wKEPjXvx", "dosage": "", "timing": ""}], "eating_order": "דגשים לסוכר (סיבים, חלבון ואז פחמימה, הקפאת לחם, לא תאכלי פחמימה לבדה ", "eating_rules": null, "cardio_training": null, "interval_training": null, "nutrition_targets": {"fat": 0, "carbs": 0, "protein": 0, "calories": 0, "fiber_min": 20}, "steps_instructions": null, "workout_template_id": null, "nutrition_template_id": null, "supplement_template_id": null}	\N
7f50ab8d-6175-4b47-9e3c-bd66252fc01a	32998caa-d8b3-4f00-95b6-5b204282e487	2026-01-29 22:52:45.309456+00	50668840-6376-4411-9dc4-b7606ead34ef	nutrition_create	{"entity": "nutrition_plan"}	{"id": "cea9e26c-96e3-4e5d-9232-6127478aeb99", "name": null, "lead_id": "278533bb-a303-4447-92a8-3fa1ba4a8114", "targets": {"fat": 0, "carbs": 0, "protein": 0, "calories": 0, "fiber_min": 20}, "user_id": "50668840-6376-4411-9dc4-b7606ead34ef", "budget_id": "32998caa-d8b3-4f00-95b6-5b204282e487", "is_active": true, "created_at": "2026-01-29T22:52:45.309456+00:00", "created_by": "50668840-6376-4411-9dc4-b7606ead34ef", "deleted_at": null, "start_date": "2026-01-29", "updated_at": "2026-01-29T22:52:45.189+00:00", "customer_id": "708c5b1a-6611-45df-8a85-f2f04909f4ae", "description": "תוכנית תזונה מתכנית פעולה: ריברס", "template_id": null}	278533bb-a303-4447-92a8-3fa1ba4a8114
e585e037-e637-48d7-857c-4a8811d838a8	32998caa-d8b3-4f00-95b6-5b204282e487	2026-01-29 22:52:45.916761+00	50668840-6376-4411-9dc4-b7606ead34ef	steps_create	{"entity": "steps_plan"}	{"id": "2ce8b384-457d-4a70-b105-5821050ecc6f", "lead_id": "278533bb-a303-4447-92a8-3fa1ba4a8114", "user_id": "50668840-6376-4411-9dc4-b7606ead34ef", "end_date": null, "budget_id": "32998caa-d8b3-4f00-95b6-5b204282e487", "is_active": true, "created_at": "2026-01-29T22:52:45.916761+00:00", "created_by": "50668840-6376-4411-9dc4-b7606ead34ef", "start_date": "2026-01-29", "steps_goal": 10000, "updated_at": "2026-01-29T22:52:45.802+00:00", "customer_id": "708c5b1a-6611-45df-8a85-f2f04909f4ae", "description": "תוכנית צעדים מתכנית פעולה: ריברס", "template_id": null, "steps_instructions": null}	278533bb-a303-4447-92a8-3fa1ba4a8114
7a356cba-34ea-46af-9c0d-320f569a0ace	32998caa-d8b3-4f00-95b6-5b204282e487	2026-01-29 22:52:46.530109+00	50668840-6376-4411-9dc4-b7606ead34ef	supplement_create	{"entity": "supplement_plan"}	{"id": "7f398e47-c6be-4c72-ad73-64052ab0c9d1", "lead_id": "278533bb-a303-4447-92a8-3fa1ba4a8114", "user_id": "50668840-6376-4411-9dc4-b7606ead34ef", "end_date": null, "budget_id": "32998caa-d8b3-4f00-95b6-5b204282e487", "is_active": true, "created_at": "2026-01-29T22:52:46.530109+00:00", "created_by": "50668840-6376-4411-9dc4-b7606ead34ef", "start_date": "2026-01-29", "updated_at": "2026-01-29T22:52:46.412+00:00", "customer_id": "708c5b1a-6611-45df-8a85-f2f04909f4ae", "description": "תוכנית תוספים מתכנית פעולה: ריברס", "supplements": [{"name": "ברברין", "link1": "https://iherb.co/1mmrKqvZ", "link2": "https://amzn.to/46QKpvu", "dosage": "2 כדורים ביום", "timing": "רבע שעה לפני ארוחה עשירה בפחמימות"}, {"name": "קולגן (THRONE)", "link1": "https://iherb.co/VVQZKNa3", "link2": "https://www.amazon.com/dp/B0B7K9Y1FD/?coliid=I1KQAC9HSU2ATH&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_93V78YPRF2TWBK4DHKFD", "dosage": "סקופ", "timing": ""}, {"name": "קולגן (לעצמות ומפרקים)", "link1": "https://iherb.co/cdeyDSJ", "link2": "https://amzn.to/49AhddJ", "dosage": "סקופ", "timing": ""}, {"name": "ויטמין D", "link1": "https://iherb.co/4Lzfkpz3", "link2": "https://www.amazon.com/dp/B003CF7TOA/?coliid=ICG2XPPNG6XAN&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_5KRCKHZTF4GT1RGYBV3S", "dosage": "1 כדור", "timing": "בבוקר עם מאכל שומני"}, {"name": "תוסף סיבים", "link1": "https://iherb.co/9GWRUJpQ", "link2": "https://amzn.to/3LgaJ9H", "dosage": "1 סקופ", "timing": ""}, {"name": "מגנזיום (אבקה-לשינה)", "link1": "https://iherb.co/VD2VdjMU", "link2": "https://amzn.to/49C7MKL", "dosage": "1-2 סקופ", "timing": "בכוס מים בלילה לפני השינה"}, {"name": "מגנזיום גליצינט (לילה) BIO OPTIMIZERS", "link1": "https://iherb.co/xRAxVcwz", "link2": "https://amzn.to/4k7WYqZ", "dosage": "3 כדורים", "timing": "בלילה"}, {"name": "מגנזיום גליצינט+טריונט) לילה AMAZON", "link1": "https://amzn.to/47ubbtO", "dosage": "3 כדורים", "timing": ""}, {"name": "קריאטין", "link1": "https://iherb.co/SuDXikfb", "link2": "https://amzn.to/491joH6", "dosage": "1-3 סקופ ביום", "timing": "במים"}, {"name": "פרוביוטיקה", "link1": "https://amzn.to/4n5G2kP", "link2": "https://iherb.co/wKEPjXvx", "dosage": "", "timing": ""}], "template_id": null}	278533bb-a303-4447-92a8-3fa1ba4a8114
\.


--
-- Data for Name: check_in_field_configurations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."check_in_field_configurations" ("id", "customer_id", "configuration", "created_at", "updated_at", "created_by") FROM stdin;
5c68344d-c4c8-4d00-8498-ed4a20eda3a5	\N	{"fields": {"weight": {"unit": "ק״ג", "label": "משקל", "section": "body", "visible": true}, "fiberDaily": {"unit": "גרם", "label": "סיבים יומי", "section": "nutrition", "visible": true}, "sleepHours": {"unit": "שעות", "label": "כמה שעות ישנת", "section": "wellness", "visible": true}, "energyLevel": {"unit": "1-10", "label": "רמת האנרגיה שלך", "section": "wellness", "visible": true}, "hungerLevel": {"unit": "1-10", "label": "רמת הרעב שלך", "section": "wellness", "visible": true}, "stepsActual": {"unit": "צעדים", "label": "מס' צעדים יומי", "section": "activity", "visible": true}, "stressLevel": {"unit": "1-10", "label": "רמת הלחץ היומי", "section": "wellness", "visible": true}, "waterAmount": {"unit": "ליטר", "label": "כמה מים שתית", "section": "nutrition", "visible": true}, "cardioAmount": {"unit": "דקות", "label": "כמה אירובי עשית", "section": "activity", "visible": true}, "proteinDaily": {"unit": "גרם", "label": "חלבון יומי", "section": "nutrition", "visible": true}, "caloriesDaily": {"unit": "קק״ל", "label": "קלוריות יומי", "section": "nutrition", "visible": true}, "exercisesCount": {"unit": "תרגילים", "label": "כמה תרגילים עשית", "section": "activity", "visible": true}, "intervalsCount": {"unit": "אינטרוולים", "label": "כמה אינטרוולים", "section": "activity", "visible": true}, "armCircumference": {"unit": "ס״מ", "label": "היקף יד", "section": "body", "visible": true}, "neckCircumference": {"unit": "ס״מ", "label": "היקף צוואר", "section": "body", "visible": true}, "bellyCircumference": {"unit": "ס״מ", "label": "היקף בטן (הכי רחב)", "section": "body", "visible": true}, "thighCircumference": {"unit": "ס״מ", "label": "היקף ירכיים", "section": "body", "visible": true}, "waistCircumference": {"unit": "ס״מ", "label": "היקף מותן (הכי צר)", "section": "body", "visible": true}, "custom_1768485465873_4xp6v7g5j": {"id": "custom_1768485465873_4xp6v7g5j", "unit": "ק״ג", "label": "היקף ישבן ", "section": "body", "visible": true}}, "sections": {"body": {"label": "מדדי גוף", "visible": true}, "activity": {"label": "פעילות", "visible": true}, "wellness": {"label": "בריאות", "visible": true}, "nutrition": {"label": "תזונה", "visible": true}}}	2026-01-15 13:58:03.252625+00	2026-01-15 13:58:02.408+00	50668840-6376-4411-9dc4-b7606ead34ef
\.


--
-- Data for Name: collections; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."collections" ("id", "lead_id", "customer_id", "total_amount", "due_date", "status", "description", "notes", "created_at", "updated_at", "created_by") FROM stdin;
\.


--
-- Data for Name: customer_notes; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."customer_notes" ("id", "customer_id", "content", "created_at", "updated_at", "created_by", "lead_id", "attachment_url") FROM stdin;
1f71496e-b290-4f47-8636-802889ba0dc7	f379a13d-19c9-4338-a0fd-df07cb597f5e	שגדכגשדכ\nדגכ	2026-01-21 18:47:49.713546+00	2026-01-29 22:14:25.291153+00	\N	\N	\N
\.


--
-- Data for Name: daily_check_ins; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."daily_check_ins" ("id", "customer_id", "lead_id", "check_in_date", "workout_completed", "steps_goal_met", "steps_actual", "nutrition_goal_met", "supplements_taken", "notes", "created_at", "updated_at", "created_by", "weight", "belly_circumference", "waist_circumference", "thigh_circumference", "arm_circumference", "neck_circumference", "exercises_count", "cardio_amount", "intervals_count", "calories_daily", "protein_daily", "fiber_daily", "water_amount", "stress_level", "hunger_level", "energy_level", "sleep_hours") FROM stdin;
3d8770a6-16f4-4079-9b9c-edb51b08fe9e	af7bdb9d-65aa-45b0-be2b-007ea60ae134	\N	2026-01-19	f	f	\N	f	[]	\N	2026-01-19 15:16:56.729137+00	2026-01-20 21:54:28.972687+00	\N	60.00	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N
e9a79e68-e565-4909-ba32-e63e1dea91e5	af7bdb9d-65aa-45b0-be2b-007ea60ae134	\N	2026-01-21	f	f	\N	f	[]	\N	2026-01-19 15:17:02.14401+00	2026-01-20 21:54:28.972687+00	\N	\N	\N	\N	50	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N
0822d595-2de1-4782-b70d-67894157dbf7	708c5b1a-6611-45df-8a85-f2f04909f4ae	278533bb-a303-4447-92a8-3fa1ba4a8114	2026-01-30	f	f	\N	f	[]	\N	2026-01-30 14:25:39.219601+00	2026-01-30 14:25:39.219601+00	\N	\N	\N	\N	\N	\N	\N	1	\N	\N	2400	\N	\N	\N	3	2	4	7.00
\.


--
-- Data for Name: exercises; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."exercises" ("id", "name", "repetitions", "weight", "image", "video_link", "created_at", "updated_at", "created_by") FROM stdin;
45c201f7-dc39-401e-ba0d-6009d1d270cb	farmers walk	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769730757552/images/1769730757552.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMDc1NzU1Mi9pbWFnZXMvMTc2OTczMDc1NzU1Mi5qcGciLCJpYXQiOjE3Njk3MzA3NTgsImV4cCI6MTgwMTI2Njc1OH0.Mz6jEuPGLDFtHwwZqOXU9B3rPdMPHFdvp-MpMXBgaNs	https://vimeo.com/1132242085?share=copy&fl=sv&fe=ci	2026-01-29 23:52:48.401983+00	2026-01-29 23:55:13.346058+00	50668840-6376-4411-9dc4-b7606ead34ef
aa7db085-fac6-4468-9c7d-6de075c7fda2	SUITCASE WALK	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769731098036/images/1769731098036.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMTA5ODAzNi9pbWFnZXMvMTc2OTczMTA5ODAzNi5qcGciLCJpYXQiOjE3Njk3MzEwOTgsImV4cCI6MTgwMTI2NzA5OH0.BVXVBVWLIqE-Asd8qy2Qp-3HO3YvX5y3ooL7a1CaPzg	https://vimeo.com/1132242086?share=copy&fl=sv&fe=ci	2026-01-29 23:58:22.198461+00	2026-01-29 23:58:22.198461+00	50668840-6376-4411-9dc4-b7606ead34ef
95b2964c-52c8-4c05-ac2b-8bb43d08c12d	Plank shoulder tap	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769731234137/images/1769731234137.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMTIzNDEzNy9pbWFnZXMvMTc2OTczMTIzNDEzNy5qcGciLCJpYXQiOjE3Njk3MzEyMzUsImV4cCI6MTgwMTI2NzIzNX0.Axyo78kBBpymHpusgcGXp0T9MVAxChNrNZtlv2yVbk8	https://vimeo.com/1152061420?share=copy&fl=sv&fe=ci	2026-01-30 00:00:38.617078+00	2026-01-30 00:00:38.617078+00	50668840-6376-4411-9dc4-b7606ead34ef
07c172f7-7c7c-4a53-9de2-8a7a83d16518	Plank With a Dumbbell Pull-Through	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769731361807/images/1769731361807.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMTM2MTgwNy9pbWFnZXMvMTc2OTczMTM2MTgwNy5qcGciLCJpYXQiOjE3Njk3MzEzNjIsImV4cCI6MTgwMTI2NzM2Mn0.9mcA60EcFM-m9r1jkwpaqZjE-dX-Agp7QZ2qt19y_NI	https://vimeo.com/1145083818?share=copy&fl=sv&fe=ci	2026-01-30 00:02:54.732064+00	2026-01-30 00:02:54.732064+00	50668840-6376-4411-9dc4-b7606ead34ef
4d0dc267-9695-4d3c-b886-a9dcc9486e58	plank stir the pot	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769731549917/images/1769731549917.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMTU0OTkxNy9pbWFnZXMvMTc2OTczMTU0OTkxNy5qcGciLCJpYXQiOjE3Njk3MzE1NTAsImV4cCI6MTgwMTI2NzU1MH0.5D3iIqD5ffeL-S3BuW-t8N2_sDW2_TM5bBvej4MEgdw	https://vimeo.com/1141676277?share=copy&fl=sv&fe=ci	2026-01-30 00:06:00.763528+00	2026-01-30 00:06:00.763528+00	50668840-6376-4411-9dc4-b7606ead34ef
48310582-54a3-4186-bbbc-392d8fba1052	Ankle Tap Push Ups	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769731673304/images/1769731673304.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMTY3MzMwNC9pbWFnZXMvMTc2OTczMTY3MzMwNC5qcGciLCJpYXQiOjE3Njk3MzE2NzQsImV4cCI6MTgwMTI2NzY3NH0.v-Ct0zt7L0E99_Gkr3CwNdKwbxVMuc6vCDuMpPSDIDE	https://vimeo.com/1140891829?share=copy&fl=sv&fe=ci	2026-01-30 00:08:06.064516+00	2026-01-30 00:08:06.064516+00	50668840-6376-4411-9dc4-b7606ead34ef
fe6c5738-9aa6-44c9-80b6-b5cd2533ae5b	Incline abs crunches	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769731789431/images/1769731789431.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMTc4OTQzMS9pbWFnZXMvMTc2OTczMTc4OTQzMS5qcGciLCJpYXQiOjE3Njk3MzE3OTAsImV4cCI6MTgwMTI2Nzc5MH0.ol6NZ2Hc8svBiBKEYkspVtqJO63UqN6dCAmRKJ7oGlA	https://vimeo.com/1138583893?share=copy&fl=sv&fe=ci	2026-01-30 00:10:01.111703+00	2026-01-30 00:10:01.111703+00	50668840-6376-4411-9dc4-b7606ead34ef
1017a78d-8624-4b6a-8b0e-bf335467702a	Side plank	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769731959434/images/1769731959434.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMTk1OTQzNC9pbWFnZXMvMTc2OTczMTk1OTQzNC5qcGciLCJpYXQiOjE3Njk3MzE5NjAsImV4cCI6MTgwMTI2Nzk2MH0.PXilSTHsgo7zzJsMXyUnEVMVzbNua3q6hVmA98MVCVM	https://vimeo.com/1137692105?share=copy&fl=sv&fe=ci	2026-01-30 00:12:50.130649+00	2026-01-30 00:12:50.130649+00	50668840-6376-4411-9dc4-b7606ead34ef
eb1f1a31-266b-4361-b9e8-9f4876e5a3dd	Plank	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732029607/images/1769732029607.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjAyOTYwNy9pbWFnZXMvMTc2OTczMjAyOTYwNy5qcGciLCJpYXQiOjE3Njk3MzIwMzAsImV4cCI6MTgwMTI2ODAzMH0.A2zY3Zm5FIDwg3gLOmOLNkC5Vq7CannEG-feUDoKesM	https://vimeo.com/1137692249?share=copy&fl=sv&fe=ci	2026-01-30 00:13:51.345363+00	2026-01-30 00:13:51.345363+00	50668840-6376-4411-9dc4-b7606ead34ef
40e1073a-2981-4c81-af93-391c0cbed4a7	Banded Bridge hold	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732153100/images/1769732153100.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjE1MzEwMC9pbWFnZXMvMTc2OTczMjE1MzEwMC5qcGciLCJpYXQiOjE3Njk3MzIxNTQsImV4cCI6MTgwMTI2ODE1NH0.dnvi9_7HDf8bz7tUCbS4dlV4DGhu7kVUCZHRizNBvg0	https://vimeo.com/1132252403?share=copy&fl=sv&fe=ci	2026-01-30 00:16:02.65548+00	2026-01-30 00:16:02.65548+00	50668840-6376-4411-9dc4-b7606ead34ef
065f31ea-a562-4011-a7da-875bf042e15e	Bird-dog	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732255438/images/1769732255438.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjI1NTQzOC9pbWFnZXMvMTc2OTczMjI1NTQzOC5qcGciLCJpYXQiOjE3Njk3MzIyNTYsImV4cCI6MTgwMTI2ODI1Nn0.pd8xJapioZ2IBp_qcyxtThFO0-u_dawHCXQifOKtfGs	https://vimeo.com/1132242073	2026-01-30 00:17:38.834951+00	2026-01-30 00:17:38.834951+00	50668840-6376-4411-9dc4-b7606ead34ef
f28432ed-d174-4e78-becc-619473f0e25d	Russian twist	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732419211/images/1769732419211.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjQxOTIxMS9pbWFnZXMvMTc2OTczMjQxOTIxMS5qcGciLCJpYXQiOjE3Njk3MzI0MjAsImV4cCI6MTgwMTI2ODQyMH0.lJjN24zNMj0IFY3qdXVK8LzDagq4gZpz3i6yy2rvSTE	https://vimeo.com/1130027948?share=copy&fl=sv&fe=ci	2026-01-30 00:20:30.190147+00	2026-01-30 00:20:30.190147+00	50668840-6376-4411-9dc4-b7606ead34ef
c5dc0a34-1fbd-40f6-b967-bc8530b27c14	dead bug	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732493227/images/1769732493227.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjQ5MzIyNy9pbWFnZXMvMTc2OTczMjQ5MzIyNy5qcGciLCJpYXQiOjE3Njk3MzI0OTQsImV4cCI6MTgwMTI2ODQ5NH0.0zIr8RV4Migvkc-H0-53k12Wzr-4eHgapjkucyRXY88	https://vimeo.com/1132242827?share=copy&fl=sv&fe=ci	2026-01-30 00:21:41.099995+00	2026-01-30 00:21:41.099995+00	50668840-6376-4411-9dc4-b7606ead34ef
dbb40edd-7067-474d-87f0-38984350cd16	Reverse Plank	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732575238/images/1769732575238.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjU3NTIzOC9pbWFnZXMvMTc2OTczMjU3NTIzOC5qcGciLCJpYXQiOjE3Njk3MzI1NzYsImV4cCI6MTgwMTI2ODU3Nn0.rwnHD_kzx2FBzASiA89krGqU1I4m3XBjIznwyKbkssg	https://vimeo.com/1130027946?share=copy&fl=sv&fe=ci	2026-01-30 00:23:01.603055+00	2026-01-30 00:23:01.603055+00	50668840-6376-4411-9dc4-b7606ead34ef
77d88644-ae18-40b0-b5c2-e88ba2946c4a	ab wheel rollouts	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732642327/images/1769732642327.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjY0MjMyNy9pbWFnZXMvMTc2OTczMjY0MjMyNy5qcGciLCJpYXQiOjE3Njk3MzI2NDMsImV4cCI6MTgwMTI2ODY0M30.CAE_4wSYQsoBF54NNwyqsiamIRi54Cbl0ss-Nf2jyTw	https://vimeo.com/1130007107?share=copy&fl=sv&fe=ci	2026-01-30 00:24:08.613388+00	2026-01-30 00:24:08.613388+00	50668840-6376-4411-9dc4-b7606ead34ef
b6284491-38da-4d73-966d-c95c2094c887	Seated crunch	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732737920/images/1769732737920.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjczNzkyMC9pbWFnZXMvMTc2OTczMjczNzkyMC5qcGciLCJpYXQiOjE3Njk3MzI3MzgsImV4cCI6MTgwMTI2ODczOH0.4U3TAWEZRd_-Z_nQYHBTHe1OpBS6d0B2-U-gE7N-qb4	https://vimeo.com/1140891819?share=copy&fl=sv&fe=ci	2026-01-30 00:25:45.732727+00	2026-01-30 00:25:45.732727+00	50668840-6376-4411-9dc4-b7606ead34ef
79fb64ec-49b1-4ea3-938e-b42d067a4d47	Plank dips	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732827906/images/1769732827906.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjgyNzkwNi9pbWFnZXMvMTc2OTczMjgyNzkwNi5qcGciLCJpYXQiOjE3Njk3MzI4MjgsImV4cCI6MTgwMTI2ODgyOH0.NUHLfdftnBi-efumtwboI774PDKkINP55o3nxowSZi4	https://vimeo.com/1141676276?share=copy&fl=sv&fe=ci	2026-01-30 00:27:15.262904+00	2026-01-30 00:27:15.262904+00	50668840-6376-4411-9dc4-b7606ead34ef
42f2a0ad-dbf1-4ef9-b149-f6437c4b1443	Reverse Crunch	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732903801/images/1769732903801.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjkwMzgwMS9pbWFnZXMvMTc2OTczMjkwMzgwMS5qcGciLCJpYXQiOjE3Njk3MzI5MDQsImV4cCI6MTgwMTI2ODkwNH0.1Sc92JMlY6rFwL5xX-UG7mIv_G25b_7Jv5ivirUlEr4	https://vimeo.com/1138981653?share=copy&fl=sv&fe=ci	2026-01-30 00:28:31.235753+00	2026-01-30 00:28:31.235753+00	50668840-6376-4411-9dc4-b7606ead34ef
0e157f73-d288-48a3-a5c8-ab6ed1171ae1	Rope crunches	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769732959149/images/1769732959149.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMjk1OTE0OS9pbWFnZXMvMTc2OTczMjk1OTE0OS5qcGciLCJpYXQiOjE3Njk3MzI5NjAsImV4cCI6MTgwMTI2ODk2MH0.dQR6dfU9CQ3q0PgY77AXANfFas8UL8eK8F5YSkaSWPg	https://vimeo.com/1130025178?share=copy&fl=sv&fe=ci	2026-01-30 00:29:25.998331+00	2026-01-30 00:29:25.998331+00	50668840-6376-4411-9dc4-b7606ead34ef
217ca089-8cc1-4116-a738-eadf571855c2	Hyperextension for glues	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769733075508/images/1769733075508.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMzA3NTUwOC9pbWFnZXMvMTc2OTczMzA3NTUwOC5qcGciLCJpYXQiOjE3Njk3MzMwNzYsImV4cCI6MTgwMTI2OTA3Nn0.ftmgI0FSeG1Ts0DBUyAxXRyQGUPBFx_wbXUMw4TbuXg	https://vimeo.com/1152073251?share=copy&fl=sv&fe=ci	2026-01-30 00:31:30.837996+00	2026-01-30 00:31:30.837996+00	50668840-6376-4411-9dc4-b7606ead34ef
9353045a-5a2a-4fa1-aabb-42fb9229bf46	dumbbell step up knee up	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769733215843/images/1769733215843.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMzIxNTg0My9pbWFnZXMvMTc2OTczMzIxNTg0My5qcGciLCJpYXQiOjE3Njk3MzMyMTYsImV4cCI6MTgwMTI2OTIxNn0.juMUYfIaZr7QNNNDsnOH_Q5jxrSnZV4XjFLEis-HKC8	https://vimeo.com/1130007080?share=copy&fl=sv&fe=ci	2026-01-30 00:33:39.622145+00	2026-01-30 00:33:39.622145+00	50668840-6376-4411-9dc4-b7606ead34ef
e096ecbe-a6df-4c4c-a62c-79fd4cb18e62	Smith squat to a box	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769733307088/images/1769733307088.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMzMwNzA4OC9pbWFnZXMvMTc2OTczMzMwNzA4OC5qcGciLCJpYXQiOjE3Njk3MzMzMDgsImV4cCI6MTgwMTI2OTMwOH0.G7uCOT0wtb4mTKbn8aekLuPQlm67eLe0JsIknW9dNaA	https://vimeo.com/1149347143?share=copy&fl=sv&fe=ci	2026-01-30 00:35:20.547415+00	2026-01-30 00:35:20.547415+00	50668840-6376-4411-9dc4-b7606ead34ef
ce1fd629-ee63-4fdc-9b6f-3b18d089eaa6	Donkey smith press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769733438515/images/1769733438515.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMzQzODUxNS9pbWFnZXMvMTc2OTczMzQzODUxNS5qcGciLCJpYXQiOjE3Njk3MzM0MzksImV4cCI6MTgwMTI2OTQzOX0.5luLL_S9Y2yhLUc1wrWu92Jetw9C-StudfacBOY3Qwg	https://vimeo.com/1149346599?share=copy&fl=sv&fe=ci	2026-01-30 00:37:27.443328+00	2026-01-30 00:37:27.443328+00	50668840-6376-4411-9dc4-b7606ead34ef
92cf4616-4c04-4756-885b-2f6f68a7ef2d	TRX SPLIT SQUAT	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769733536883/images/1769733536883.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMzUzNjg4My9pbWFnZXMvMTc2OTczMzUzNjg4My5qcGciLCJpYXQiOjE3Njk3MzM1MzcsImV4cCI6MTgwMTI2OTUzN30._pKF5G1kSYoBDko2XIVRRvcp2ZEnfW8G_fK8jSvrPTs	https://vimeo.com/1145083814?share=copy&fl=sv&fe=ci	2026-01-30 00:39:06.892601+00	2026-01-30 00:39:06.892601+00	50668840-6376-4411-9dc4-b7606ead34ef
87cadedf-42a5-44da-8fe8-cd41267133c2	Step up- no weight	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769733613518/images/1769733613518.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMzYxMzUxOC9pbWFnZXMvMTc2OTczMzYxMzUxOC5qcGciLCJpYXQiOjE3Njk3MzM2MTQsImV4cCI6MTgwMTI2OTYxNH0.WhFBeI9ghNC-xGa4DW1I-nsxqH9j-Lrf7zyRDn7jr0Y	https://vimeo.com/1141676272?share=copy&fl=sv&fe=ci	2026-01-30 00:40:19.790468+00	2026-01-30 00:40:19.790468+00	50668840-6376-4411-9dc4-b7606ead34ef
e414eb2f-539f-415b-a522-bfce1c9559e5	HIP THRUST - HOME VERSION	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769733669929/images/1769733669929.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMzY2OTkyOS9pbWFnZXMvMTc2OTczMzY2OTkyOS5qcGciLCJpYXQiOjE3Njk3MzM2NzEsImV4cCI6MTgwMTI2OTY3MX0.w4msr6mWrUCapKddUt0ILRKTXQb87l0Ca4VzNHvlVpk	https://vimeo.com/1141676275?share=copy&fl=sv&fe=ci	2026-01-30 00:41:15.621754+00	2026-01-30 00:41:15.621754+00	50668840-6376-4411-9dc4-b7606ead34ef
8cc2486f-a500-428d-84ba-61fb4cc00bfc	Romanian dead lift - bar	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769735198268/images/1769735198268.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNTE5ODI2OC9pbWFnZXMvMTc2OTczNTE5ODI2OC5qcGciLCJpYXQiOjE3Njk3MzUxOTksImV4cCI6MTgwMTI3MTE5OX0.gk6QBC8wz0kSq8qxF4k55FZZMB4Ozz4AezMk-TCfVVM	https://vimeo.com/1138583964?share=copy&fl=sv&fe=ci	2026-01-30 01:06:44.555582+00	2026-01-30 01:06:44.555582+00	50668840-6376-4411-9dc4-b7606ead34ef
98e27014-9171-4254-8ca3-6c59ab0b2a34	Glute kickback- angle	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769733756402/images/1769733756402.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMzc1NjQwMi9pbWFnZXMvMTc2OTczMzc1NjQwMi5qcGciLCJpYXQiOjE3Njk3MzM3NTYsImV4cCI6MTgwMTI2OTc1Nn0.6rJ_AGMi3-yzx3jyjp3Ay6fcJxuIf_bftL9QB2czxnk	https://vimeo.com/1139009033	2026-01-30 00:42:54.467146+00	2026-01-30 00:43:27.120241+00	50668840-6376-4411-9dc4-b7606ead34ef
eff2fa0a-0136-4e3c-b5a7-250f2f774acf	Walking Barbell Lunges	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769733850918/images/1769733850918.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczMzg1MDkxOC9pbWFnZXMvMTc2OTczMzg1MDkxOC5qcGciLCJpYXQiOjE3Njk3MzM4NTEsImV4cCI6MTgwMTI2OTg1MX0.tHGY3XuPAFlH3O7RQ2uMh1ZFQ9XKgPnzKPDRex5XKTQ	https://vimeo.com/1130007055?share=copy&fl=sv&fe=ci	2026-01-30 00:44:17.465264+00	2026-01-30 00:44:17.465264+00	50668840-6376-4411-9dc4-b7606ead34ef
730a0c96-b4d1-4ab1-844f-5bdb4b013f15	Hip thrusts	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769734365720/images/1769734365720.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNDM2NTcyMC9pbWFnZXMvMTc2OTczNDM2NTcyMC5qcGciLCJpYXQiOjE3Njk3MzQzNjYsImV4cCI6MTgwMTI3MDM2Nn0.JZPf6hvavD8ITyopDbaoHU59dGLOCC3VPvepmot9gTk	https://vimeo.com/1139008941?share=copy&fl=sv&fe=ci	2026-01-30 00:52:54.693991+00	2026-01-30 00:52:54.693991+00	50668840-6376-4411-9dc4-b7606ead34ef
12a88527-7009-4fed-8de7-f3da8ccab63d	Goblet squat	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769734449948/images/1769734449948.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNDQ0OTk0OC9pbWFnZXMvMTc2OTczNDQ0OTk0OC5qcGciLCJpYXQiOjE3Njk3MzQ0NTAsImV4cCI6MTgwMTI3MDQ1MH0.ux8rsh9dAiBiR4WZkoJzM9IEP7im9vRdsBcfZwwsBP8	https://vimeo.com/1139013685?share=copy&fl=sv&fe=ci	2026-01-30 00:54:13.568868+00	2026-01-30 00:54:13.568868+00	50668840-6376-4411-9dc4-b7606ead34ef
6fa3b882-2293-4788-acb6-d676f0b5cc83	Bulgarian splits	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769734516472/images/1769734516472.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNDUxNjQ3Mi9pbWFnZXMvMTc2OTczNDUxNjQ3Mi5qcGciLCJpYXQiOjE3Njk3MzQ1MTcsImV4cCI6MTgwMTI3MDUxN30.K8U_SQ4aSAzmsHOCbZCbFNT-4ApsI4TuhVz2DdraBc4	https://vimeo.com/1139012695?share=copy&fl=sv&fe=ci	2026-01-30 00:55:23.420988+00	2026-01-30 00:55:23.420988+00	50668840-6376-4411-9dc4-b7606ead34ef
a422fabb-2c64-420c-b6f7-79a47e64d44d	Sumo DB Squat	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769734593683/images/1769734593683.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNDU5MzY4My9pbWFnZXMvMTc2OTczNDU5MzY4My5qcGciLCJpYXQiOjE3Njk3MzQ1OTQsImV4cCI6MTgwMTI3MDU5NH0.Y-ahJ8zU_0AvQ2woCPUA5Ts0AHKJyf2Dl2u-z_6ZgA8	https://vimeo.com/1139008974?share=copy&fl=sv&fe=ci	2026-01-30 00:56:40.323356+00	2026-01-30 00:56:40.323356+00	50668840-6376-4411-9dc4-b7606ead34ef
733c6b4f-95bd-4f56-a549-351288d832d6	side back lunges	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769734708959/images/1769734708959.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNDcwODk1OS9pbWFnZXMvMTc2OTczNDcwODk1OS5qcGciLCJpYXQiOjE3Njk3MzQ3MDksImV4cCI6MTgwMTI3MDcwOX0.WPFXljd9NZ-2tCQwiztvAu6Ki33bieddUM4WS9zb2Z4	https://vimeo.com/1137684185?share=copy&fl=sv&fe=ci	2026-01-30 00:58:34.809114+00	2026-01-30 00:58:34.809114+00	50668840-6376-4411-9dc4-b7606ead34ef
fa785962-d517-42e2-b597-fe84efb3db8c	Machine ABDuctors	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769734853279/images/1769734853279.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNDg1MzI3OS9pbWFnZXMvMTc2OTczNDg1MzI3OS5qcGciLCJpYXQiOjE3Njk3MzQ4NTQsImV4cCI6MTgwMTI3MDg1NH0.1_JVjpHeY4AVisl3owf0LOThx0lOhlesPfZJRPUSF8o	https://vimeo.com/1138583430?share=copy&fl=sv&fe=ci	2026-01-30 01:01:01.611822+00	2026-01-30 01:01:01.611822+00	50668840-6376-4411-9dc4-b7606ead34ef
0f063d2b-a894-4a01-afe3-e84298361a53	Leg curls - no machine	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769734993198/images/1769734993198.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNDk5MzE5OC9pbWFnZXMvMTc2OTczNDk5MzE5OC5qcGciLCJpYXQiOjE3Njk3MzQ5OTQsImV4cCI6MTgwMTI3MDk5NH0.UA13vfXYQUrSOYmE-ULwe9QcKZGdEr2CzcrWE85U7aM	https://vimeo.com/1138584099?share=copy&fl=sv&fe=ci	2026-01-30 01:03:22.173564+00	2026-01-30 01:03:22.173564+00	50668840-6376-4411-9dc4-b7606ead34ef
3925e58a-b11f-4773-a9f1-4e2260d0f021	banded side walk	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769735400583/images/1769735400583.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNTQwMDU4My9pbWFnZXMvMTc2OTczNTQwMDU4My5qcGciLCJpYXQiOjE3Njk3MzU0MDEsImV4cCI6MTgwMTI3MTQwMX0.Ibk1bzYqlzOEX_YXMGSH9e9xjkP3ozjzhA3DOhGa-m8	https://vimeo.com/1137752885?share=copy&fl=sv&fe=ci	2026-01-30 01:10:11.026748+00	2026-01-30 01:10:11.026748+00	50668840-6376-4411-9dc4-b7606ead34ef
5252a34b-a6af-4a51-a8da-87f9dcd1b399	סקוואט	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769735473647/images/1769735473647.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNTQ3MzY0Ny9pbWFnZXMvMTc2OTczNTQ3MzY0Ny5qcGciLCJpYXQiOjE3Njk3MzU0NzQsImV4cCI6MTgwMTI3MTQ3NH0.QJCnTlxrNHTPiyo3ruV34HmOB4RglDu0MvSHsy3Viic	https://vimeo.com/1137684992?share=copy&fl=sv&fe=ci	2026-01-30 01:11:16.135229+00	2026-01-30 01:11:16.135229+00	50668840-6376-4411-9dc4-b7606ead34ef
d407349d-6165-4deb-af63-12368958ab08	BD REVERSE LOUNGE	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769735725922/images/1769735725922.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNTcyNTkyMi9pbWFnZXMvMTc2OTczNTcyNTkyMi5qcGciLCJpYXQiOjE3Njk3MzU3MjYsImV4cCI6MTgwMTI3MTcyNn0.XHqCF-lMCI_e4mbVciPJg_QjImPXuaEkkOtWbtMprbY	https://vimeo.com/1132242829?share=copy&fl=sv&fe=ci	2026-01-30 01:15:36.448857+00	2026-01-30 01:15:36.448857+00	50668840-6376-4411-9dc4-b7606ead34ef
1804ed2c-95f4-476e-9e86-fa7f8840cc22	single leg banded bridge	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769735941326/images/1769735941326.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNTk0MTMyNi9pbWFnZXMvMTc2OTczNTk0MTMyNi5qcGciLCJpYXQiOjE3Njk3MzU5NDIsImV4cCI6MTgwMTI3MTk0Mn0.zCmjGtAAslx9nuRnCDk0YZI6SWmiDpgrHxEu9te34io	https://vimeo.com/1132242830?share=copy&fl=sv&fe=ci	2026-01-30 01:19:09.343211+00	2026-01-30 01:19:09.343211+00	50668840-6376-4411-9dc4-b7606ead34ef
1e766adc-224b-48d9-8068-336adc2e7ba0	Dumbbell Deficit Reverse Lunges	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736020939/images/1769736020939.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjAyMDkzOS9pbWFnZXMvMTc2OTczNjAyMDkzOS5qcGciLCJpYXQiOjE3Njk3MzYwMjEsImV4cCI6MTgwMTI3MjAyMX0.gOj0Xf_0NkLUyVRFPIXOD9FVJQTC-iubXq0zvGqNQP8	https://vimeo.com/1130007119?share=copy&fl=sv&fe=ci	2026-01-30 01:20:27.92015+00	2026-01-30 01:20:27.92015+00	50668840-6376-4411-9dc4-b7606ead34ef
d9a33986-33cc-4ee2-b5c7-eb1c6fb2da7b	barbell lounge	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736085179/images/1769736085179.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjA4NTE3OS9pbWFnZXMvMTc2OTczNjA4NTE3OS5qcGciLCJpYXQiOjE3Njk3MzYwODYsImV4cCI6MTgwMTI3MjA4Nn0.iLMcPVO9EW05_c9nFTzl2JQfHE2k3MPO-IwyFY-zbTc	https://vimeo.com/1130007019?share=copy&fl=sv&fe=ci	2026-01-30 01:21:30.051456+00	2026-01-30 01:21:30.051456+00	50668840-6376-4411-9dc4-b7606ead34ef
10df6b75-bc07-4a70-bb35-814fec2aed2c	HEX BAR SQUAT	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736167083/images/1769736167083.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjE2NzA4My9pbWFnZXMvMTc2OTczNjE2NzA4My5qcGciLCJpYXQiOjE3Njk3MzYxNjgsImV4cCI6MTgwMTI3MjE2OH0.UQzWiWhaF09ip1FlEpBJvrURJAkjqjHduT41WCfhMFk	https://vimeo.com/1130007079?share=copy&fl=sv&fe=ci	2026-01-30 01:22:50.0989+00	2026-01-30 01:22:50.0989+00	50668840-6376-4411-9dc4-b7606ead34ef
d3d460a8-aaf4-4269-89ba-afa1c00fdd81	Dumbbell Romanian deadlift	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736240169/images/1769736240169.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjI0MDE2OS9pbWFnZXMvMTc2OTczNjI0MDE2OS5qcGciLCJpYXQiOjE3Njk3MzYyNDEsImV4cCI6MTgwMTI3MjI0MX0.fFDHHgPhSarIudkEoW1Krt2SCBgytSb1S97gnbj1P5I	https://vimeo.com/1130025165?share=copy&fl=sv&fe=ci	2026-01-30 01:24:05.882484+00	2026-01-30 01:24:05.882484+00	50668840-6376-4411-9dc4-b7606ead34ef
15bd38fc-dbd5-4ede-8725-c6953034294b	Barbell Back Squat	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736299498/images/1769736299498.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjI5OTQ5OC9pbWFnZXMvMTc2OTczNjI5OTQ5OC5qcGciLCJpYXQiOjE3Njk3MzYzMDAsImV4cCI6MTgwMTI3MjMwMH0.ZcBK0Px8K0l7V9OgiZvMQMHHzdsQORrMFexkBl8efNA	https://vimeo.com/1130025194?share=copy&fl=sv&fe=ci	2026-01-30 01:25:05.245419+00	2026-01-30 01:25:05.245419+00	50668840-6376-4411-9dc4-b7606ead34ef
91665672-0e8e-45c1-990d-d179cc92ccef	LEG PRESS	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736535708/images/1769736535708.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjUzNTcwOC9pbWFnZXMvMTc2OTczNjUzNTcwOC5qcGciLCJpYXQiOjE3Njk3MzY1MzYsImV4cCI6MTgwMTI3MjUzNn0.DttorRaW4D9jbBO8dWWNzoL1I2q8ic6caRK9TayurMk	https://vimeo.com/1130017819?share=copy&fl=sv&fe=ci	2026-01-30 01:29:02.433739+00	2026-01-30 01:29:02.433739+00	50668840-6376-4411-9dc4-b7606ead34ef
7b04e8ec-8989-4a8b-8ac6-cdddb4e4776f	sumo deadlift	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769735092959/images/1769735092959.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNTA5Mjk1OS9pbWFnZXMvMTc2OTczNTA5Mjk1OS5qcGciLCJpYXQiOjE3Njk3MzUwOTMsImV4cCI6MTgwMTI3MTA5M30.IvBRDOWpdPphYvDrSULQWYU0hAu9SileBi1UJZYvNew	https://vimeo.com/1130007028?share=copy&fl=sv&fe=ci	2026-01-30 01:04:59.804985+00	2026-01-30 01:29:23.64168+00	50668840-6376-4411-9dc4-b7606ead34ef
ca844dae-03df-4af4-9900-bfb8fe56fbd2	WALKING LOUNGES	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736583968/images/1769736583968.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjU4Mzk2OC9pbWFnZXMvMTc2OTczNjU4Mzk2OC5qcGciLCJpYXQiOjE3Njk3MzY1ODQsImV4cCI6MTgwMTI3MjU4NH0.cTyL1GC_nV1aH01P4QF9eB9gBogmUF1WWBUWESuFEqE	https://vimeo.com/1130007146?share=copy&fl=sv&fe=ci	2026-01-30 01:29:51.672952+00	2026-01-30 01:29:51.672952+00	50668840-6376-4411-9dc4-b7606ead34ef
b055cc83-a36f-491a-bdad-43d71f923bd1	smith squat	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736652447/images/1769736652447.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjY1MjQ0Ny9pbWFnZXMvMTc2OTczNjY1MjQ0Ny5qcGciLCJpYXQiOjE3Njk3MzY2NTMsImV4cCI6MTgwMTI3MjY1M30.RGe11owtsZZk2HIKfENLYkPB93_ffWoBXUu2Nni_fPs	https://vimeo.com/1130007065?share=copy&fl=sv&fe=ci	2026-01-30 01:31:04.209223+00	2026-01-30 01:31:04.209223+00	50668840-6376-4411-9dc4-b7606ead34ef
efa82db0-c383-49f5-a385-774aafff42c4	seated leg extension	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736717203/images/1769736717203.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjcxNzIwMy9pbWFnZXMvMTc2OTczNjcxNzIwMy5qcGciLCJpYXQiOjE3Njk3MzY3MTgsImV4cCI6MTgwMTI3MjcxOH0.cVS2svKUAwRhwkia-mvUTK_FXIPyX7ftnC-fGBaKhSM	https://vimeo.com/1130003591?share=copy&fl=sv&fe=ci	2026-01-30 01:32:02.746745+00	2026-01-30 01:32:02.746745+00	50668840-6376-4411-9dc4-b7606ead34ef
66c599e1-b4ee-4513-8ddb-95f3e6158483	SMITH CALF RAISES	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736784235/images/1769736784235.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjc4NDIzNS9pbWFnZXMvMTc2OTczNjc4NDIzNS5qcGciLCJpYXQiOjE3Njk3MzY3ODUsImV4cCI6MTgwMTI3Mjc4NX0.wohUjNVu3ZhGD9rAw0bFkktA3sKB4gDhPu8RfzVS98g	https://vimeo.com/1130007137?share=copy&fl=sv&fe=ci	2026-01-30 01:33:10.08316+00	2026-01-30 01:33:10.08316+00	50668840-6376-4411-9dc4-b7606ead34ef
76838985-8491-4140-adc8-d8d281ef6411	goblet squat with stability ball	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736890945/images/1769736890945.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjg5MDk0NS9pbWFnZXMvMTc2OTczNjg5MDk0NS5qcGciLCJpYXQiOjE3Njk3MzY4OTEsImV4cCI6MTgwMTI3Mjg5MX0.JGMqGDYzOoT0EKXfvn5W3fQ5LfXjKrQqH6U8IEm402M	https://vimeo.com/1130007667?share=copy&fl=sv&fe=ci	2026-01-30 01:34:56.115666+00	2026-01-30 01:34:56.115666+00	50668840-6376-4411-9dc4-b7606ead34ef
16f7e855-2001-4a72-a863-bfa560c97d75	SINGEL CALF RAISES	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769736943049/images/1769736943049.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNjk0MzA0OS9pbWFnZXMvMTc2OTczNjk0MzA0OS5qcGciLCJpYXQiOjE3Njk3MzY5NDMsImV4cCI6MTgwMTI3Mjk0M30.5h1TzB6wWa4dQfIBVVie30pC6QIXp0SqZD6spxW44YQ	https://vimeo.com/1130007056?share=copy&fl=sv&fe=ci	2026-01-30 01:35:48.017349+00	2026-01-30 01:35:48.017349+00	50668840-6376-4411-9dc4-b7606ead34ef
e6746126-58ed-475d-aaa3-e53aa8fdd7e9	step up with dumbbell	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769737009623/images/1769737009623.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNzAwOTYyMy9pbWFnZXMvMTc2OTczNzAwOTYyMy5qcGciLCJpYXQiOjE3Njk3MzcwMTAsImV4cCI6MTgwMTI3MzAxMH0.aGlcWhM8p3i_6QffsW3fW4kAmWXL1AcPI78Qv65lzZ0	https://vimeo.com/1130007140?share=copy&fl=sv&fe=ci	2026-01-30 01:36:56.635815+00	2026-01-30 01:36:56.635815+00	50668840-6376-4411-9dc4-b7606ead34ef
6bee69d5-bc16-42d6-8eb3-c93fdb143e62	Seated leg curls	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769737058950/images/1769737058950.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNzA1ODk1MC9pbWFnZXMvMTc2OTczNzA1ODk1MC5qcGciLCJpYXQiOjE3Njk3MzcwNTksImV4cCI6MTgwMTI3MzA1OX0.8B4Qd_7cEzf_kCbS9uo8o74KahvGzbgs_omh9DBc2Cs	https://vimeo.com/1130003590?share=copy&fl=sv&fe=ci	2026-01-30 01:37:43.79294+00	2026-01-30 01:37:43.79294+00	50668840-6376-4411-9dc4-b7606ead34ef
e7e92bb7-6ce1-4663-9e24-e457a59b3eb8	Smith good morning	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769737129028/images/1769737129028.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTczNzEyOTAyOC9pbWFnZXMvMTc2OTczNzEyOTAyOC5qcGciLCJpYXQiOjE3Njk3MzcxMjksImV4cCI6MTgwMTI3MzEyOX0.w_t6hY0QLVCJL_XyoKURlD6gOQbMiE7HBwnCWytKeLY	https://vimeo.com/1130027951?share=copy&fl=sv&fe=ci	2026-01-30 01:38:53.850025+00	2026-01-30 01:38:53.850025+00	50668840-6376-4411-9dc4-b7606ead34ef
4776fbf1-d737-4223-ba8b-4348b9e2b305	Machine/band ADDuctors	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769780250911/images/1769780250911.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MDI1MDkxMS9pbWFnZXMvMTc2OTc4MDI1MDkxMS5qcGciLCJpYXQiOjE3Njk3ODAyNTMsImV4cCI6MTgwMTMxNjI1M30._7jYCDrHwzlRTnE6p2ORe59WVqE4v3s5yQYyb8ca0dY	https://vimeo.com/1137706016?share=copy&fl=sv&fe=ci	2026-01-30 13:37:41.555813+00	2026-01-30 13:37:41.555813+00	50668840-6376-4411-9dc4-b7606ead34ef
639daac6-bb5a-41b0-9f32-57d964acb586	SWITCH SIDE PLANK (SUNSHINE)	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769780427030/images/1769780427030.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MDQyNzAzMC9pbWFnZXMvMTc2OTc4MDQyNzAzMC5qcGciLCJpYXQiOjE3Njk3ODA0MjgsImV4cCI6MTgwMTMxNjQyOH0.-0a4wQsIYrCHVb8Z6Q9mIa41RgahFxrvWekNazr7Rro	https://vimeo.com/1137691992?share=copy&fl=sv&fe=ci	2026-01-30 13:40:41.27052+00	2026-01-30 13:40:41.27052+00	50668840-6376-4411-9dc4-b7606ead34ef
9e739b50-a31f-4ba2-8816-9985f66b8643	SEATING BAND ABDUCTORS	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769780516477/images/1769780516477.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MDUxNjQ3Ny9pbWFnZXMvMTc2OTc4MDUxNjQ3Ny5qcGciLCJpYXQiOjE3Njk3ODA1MTgsImV4cCI6MTgwMTMxNjUxOH0.a7XTSGI0RE3sHK8Nu7CvSzca7N1jyYppdky8x_4y5zk	https://vimeo.com/1138583670?share=copy&fl=sv&fe=ci	2026-01-30 13:42:19.550058+00	2026-01-30 13:42:19.550058+00	50668840-6376-4411-9dc4-b7606ead34ef
b20e2258-9c50-49a8-b860-51a2cb8fb41e	Intervals (Running)	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769780725833/images/1769780725833.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MDcyNTgzMy9pbWFnZXMvMTc2OTc4MDcyNTgzMy5qcGciLCJpYXQiOjE3Njk3ODA3MjcsImV4cCI6MTgwMTMxNjcyN30.tney52qf_UL3rzMpthoqiCc3RVecXKDJRluyStHPPyc	https://vimeo.com/1132237475?share=copy&fl=sv&fe=ci	2026-01-30 13:45:34.421494+00	2026-01-30 13:45:34.421494+00	50668840-6376-4411-9dc4-b7606ead34ef
3ecda8ce-78fe-4c17-be29-b0ea67c06b66	Upright rows	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769780741340/images/1769780741340.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MDc0MTM0MC9pbWFnZXMvMTc2OTc4MDc0MTM0MC5qcGciLCJpYXQiOjE3Njk3ODA3NDMsImV4cCI6MTgwMTMxNjc0M30.1Oo2IxC_f6bEMPl-oxMItYH7Ud92rAbUuMp2z-EcDfw	https://vimeo.com/1159770908?share=copy&fl=sv&fe=ci	2026-01-30 13:45:49.166108+00	2026-01-30 13:45:49.166108+00	50668840-6376-4411-9dc4-b7606ead34ef
80cecd8d-a753-4b40-8bd6-3f0c0ef0c500	single arm cable row	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769780831960/images/1769780831960.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MDgzMTk2MC9pbWFnZXMvMTc2OTc4MDgzMTk2MC5qcGciLCJpYXQiOjE3Njk3ODA4MzMsImV4cCI6MTgwMTMxNjgzM30.JEbhK86aSGJ0l4RMN2t3dN1cZSS7qbgdLz456NPdAoI	https://vimeo.com/1152061423?share=copy&fl=sv&fe=ci	2026-01-30 13:47:20.721627+00	2026-01-30 13:47:20.721627+00	50668840-6376-4411-9dc4-b7606ead34ef
7237d6aa-5f6f-4abd-9340-baae17752b9a	Banded pull ups	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769780919764/images/1769780919764.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MDkxOTc2NC9pbWFnZXMvMTc2OTc4MDkxOTc2NC5qcGciLCJpYXQiOjE3Njk3ODA5MjEsImV4cCI6MTgwMTMxNjkyMX0.bjh3K1zjfqMlxMVjl1I-BBswqHc8upc_m0MszrkcfdA	https://vimeo.com/1149348214?share=copy&fl=sv&fe=ci	2026-01-30 13:48:48.548103+00	2026-01-30 13:48:48.548103+00	50668840-6376-4411-9dc4-b7606ead34ef
0a928af8-663f-4f10-bf26-889c28afbd05	Wide grip lat pull down	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769781034926/images/1769781034926.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MTAzNDkyNi9pbWFnZXMvMTc2OTc4MTAzNDkyNi5qcGciLCJpYXQiOjE3Njk3ODEwMzYsImV4cCI6MTgwMTMxNzAzNn0.R7hN-SfW2sY7X0g0uqx0C6WGUKhj92WJ_5Z9_7L8cEM	https://vimeo.com/1149348385?share=copy&fl=sv&fe=ci	2026-01-30 13:50:44.391897+00	2026-01-30 13:50:44.391897+00	50668840-6376-4411-9dc4-b7606ead34ef
c9753822-0618-4cdf-bb37-7f2ac4c16f57	biceps cable curls	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769781114497/images/1769781114497.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MTExNDQ5Ny9pbWFnZXMvMTc2OTc4MTExNDQ5Ny5qcGciLCJpYXQiOjE3Njk3ODExMTYsImV4cCI6MTgwMTMxNzExNn0.cFMuPDzXz720UoOGj6sWLkEFy-8GZ879r27DGmGrZZs	https://vimeo.com/1149348578?share=copy&fl=sv&fe=ci	2026-01-30 13:52:03.348354+00	2026-01-30 13:52:03.348354+00	50668840-6376-4411-9dc4-b7606ead34ef
8aeee195-89eb-4b9a-888a-87ee9fb7634f	Around the world incline raises FACE DOWN	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769781320654/images/1769781320654.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4MTMyMDY1NC9pbWFnZXMvMTc2OTc4MTMyMDY1NC5qcGciLCJpYXQiOjE3Njk3ODEzMjIsImV4cCI6MTgwMTMxNzMyMn0.TY94x-S0dZnPZs1jdAt6BXDE8poNCA5CXXGPalDx_a8	https://vimeo.com/1152061410?share=copy&fl=sv&fe=ci	2026-01-30 13:55:27.174545+00	2026-01-30 13:55:27.174545+00	50668840-6376-4411-9dc4-b7606ead34ef
840c9f1f-9675-4851-91be-9c9b3cee01cc	Y incline raises	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/840c9f1f-9675-4851-91be-9c9b3cee01cc/images/1769781398407.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzLzg0MGM5ZjFmLTk2NzUtNDg1MS05MWJlLTljOWIzY2VlMDFjYy9pbWFnZXMvMTc2OTc4MTM5ODQwNy5qcGciLCJpYXQiOjE3Njk3ODE0MDAsImV4cCI6MTgwMTMxNzQwMH0.rgNev8CdyAvY8Ry8FFMSl0wHVpwExV9y6xsn7P9IfmA	https://vimeo.com/1152061418?share=copy&fl=sv&fe=ci	2026-01-30 13:56:34.102491+00	2026-01-30 13:56:42.356551+00	50668840-6376-4411-9dc4-b7606ead34ef
bea895de-2c58-4d72-a12d-bd45744ac13f	seated single DB closed grip front press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769784187000/images/1769784187000.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4NDE4NzAwMC9pbWFnZXMvMTc2OTc4NDE4NzAwMC5qcGciLCJpYXQiOjE3Njk3ODQxODgsImV4cCI6MTgwMTMyMDE4OH0.R1ciUHZZGYxzprXJZsvUIkozmK4qAGozG5vobvFzgx4	https://vimeo.com/1152061428?share=copy&fl=sv&fe=ci	2026-01-30 14:43:12.307243+00	2026-01-30 14:43:12.307243+00	50668840-6376-4411-9dc4-b7606ead34ef
9625a986-d21c-4528-a465-1e15724fa17e	Single arm cable shoulder extension	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769784272371/images/1769784272371.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4NDI3MjM3MS9pbWFnZXMvMTc2OTc4NDI3MjM3MS5qcGciLCJpYXQiOjE3Njk3ODQyNzMsImV4cCI6MTgwMTMyMDI3M30.PGlOL8pEBdn9tvyNwOJEn_n4esKjZA09LsWZ2y6ixJk	https://vimeo.com/1152064186?share=copy&fl=sv&fe=ci	2026-01-30 14:44:38.907975+00	2026-01-30 14:44:38.907975+00	50668840-6376-4411-9dc4-b7606ead34ef
55d8d06e-d58d-4d4b-a5ff-b0d738ba80e8	Single arm lat pull down	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769784336532/images/1769784336532.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4NDMzNjUzMi9pbWFnZXMvMTc2OTc4NDMzNjUzMi5qcGciLCJpYXQiOjE3Njk3ODQzMzcsImV4cCI6MTgwMTMyMDMzN30.bTjqeVWOEi5SwV29Jtc4ABJ6Z4uGWLMM7KWAgnWejbc	https://vimeo.com/1152061417?share=copy&fl=sv&fe=ci	2026-01-30 14:45:42.699675+00	2026-01-30 14:45:42.699675+00	50668840-6376-4411-9dc4-b7606ead34ef
fef0bf15-ae20-41e8-9ec3-437b84316ec8	Side Lying Lateral Raise	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769784891700/images/1769784891700.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTc4NDg5MTcwMC9pbWFnZXMvMTc2OTc4NDg5MTcwMC5qcGciLCJpYXQiOjE3Njk3ODQ4OTIsImV4cCI6MTgwMTMyMDg5Mn0.cA-8X7V-kBVojaJpIHtIPi27rHwb_64t64pMOtp4CHM	https://vimeo.com/1138927066?share=copy&fl=sv&fe=ci	2026-01-30 14:54:59.083799+00	2026-01-30 14:54:59.083799+00	50668840-6376-4411-9dc4-b7606ead34ef
3bd0de86-23cb-429a-b93f-dac571609252	Powell Raise on Flat Bench	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769808749857/images/1769808749857.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgwODc0OTg1Ny9pbWFnZXMvMTc2OTgwODc0OTg1Ny5qcGciLCJpYXQiOjE3Njk4MDg3NTAsImV4cCI6MTgwMTM0NDc1MH0.2vBr61KHCPu1gJxhZu8wdfz7WMJX-wn1BK2HcUC8Ab0	https://vimeo.com/1130007116?share=copy&fl=sv&fe=ci	2026-01-30 21:32:31.945452+00	2026-01-30 21:32:31.945452+00	50668840-6376-4411-9dc4-b7606ead34ef
ec16d08e-0719-4c0c-b679-892e1c8ad865	Triceps Bench Dip	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769808810466/images/1769808810466.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgwODgxMDQ2Ni9pbWFnZXMvMTc2OTgwODgxMDQ2Ni5qcGciLCJpYXQiOjE3Njk4MDg4MTEsImV4cCI6MTgwMTM0NDgxMX0.lVGTZKlUDf0TWThykv9F7Xy4R8mW9HvnXxgWAD5gOqo	https://vimeo.com/1139013002?share=copy&fl=sv&fe=ci	2026-01-30 21:33:36.583507+00	2026-01-30 21:33:36.583507+00	50668840-6376-4411-9dc4-b7606ead34ef
d8fdab72-6523-4dca-8d6c-b3feaff6736f	Dumbbell front raise palms pronated (palms up)	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/d8fdab72-6523-4dca-8d6c-b3feaff6736f/images/1769809733809.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL2Q4ZmRhYjcyLTY1MjMtNGRjYS04ZDZjLWIzZmVhZmY2NzM2Zi9pbWFnZXMvMTc2OTgwOTczMzgwOS5qcGciLCJpYXQiOjE3Njk4MDk3MzQsImV4cCI6MTgwMTM0NTczNH0.kmpRr4zZHAwJivk6TBHBX0fdmUEpfY-d-5DxYRP8kpM	https://vimeo.com/1138926792	2026-01-30 21:43:21.908197+00	2026-01-30 21:48:56.977217+00	50668840-6376-4411-9dc4-b7606ead34ef
4a7ab964-b0e2-48b2-9cf7-52c604c07cbd	Dumbbell Front Raise	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769809216240/images/1769809216240.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgwOTIxNjI0MC9pbWFnZXMvMTc2OTgwOTIxNjI0MC5qcGciLCJpYXQiOjE3Njk4MDkyMTcsImV4cCI6MTgwMTM0NTIxN30.3LyDNDoGiA9UAVW2CXzXuSVd1n2vi66u2T4voFh5sSQ	https://vimeo.com/1138926850?share=copy&fl=sv&fe=ci	2026-01-30 21:40:19.240814+00	2026-01-30 21:43:31.201067+00	50668840-6376-4411-9dc4-b7606ead34ef
6e5c139c-378d-4ec4-9dff-d7bff42eb943	lying dumbbell extensions (skull crushers)	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769809601374/images/1769809601374.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgwOTYwMTM3NC9pbWFnZXMvMTc2OTgwOTYwMTM3NC5qcGciLCJpYXQiOjE3Njk4MDk2MDIsImV4cCI6MTgwMTM0NTYwMn0.sIuKeqn7pzHjf3uF74L0DKdV3z-9wwX056GiwbtFl2I	https://vimeo.com/1139013214?share=copy&fl=sv&fe=ci	2026-01-30 21:46:47.052737+00	2026-01-30 21:46:47.052737+00	50668840-6376-4411-9dc4-b7606ead34ef
cecc3bdc-f278-4933-8f8c-3f8cc9e5a67d	45 bend forwards, triceps extension	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769809680748/images/1769809680748.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgwOTY4MDc0OC9pbWFnZXMvMTc2OTgwOTY4MDc0OC5qcGciLCJpYXQiOjE3Njk4MDk2ODEsImV4cCI6MTgwMTM0NTY4MX0.P_FJN9RIFUDT2wvnZSiv7ICDLqmhPxDjqfbVOCm-y6M	https://vimeo.com/1140891828?share=copy&fl=sv&fe=ci	2026-01-30 21:48:08.249497+00	2026-01-30 21:48:08.249497+00	50668840-6376-4411-9dc4-b7606ead34ef
12b54e14-19af-4f94-8d2b-ed82599deb36	One Dumbbell Pullover	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769809826389/images/1769809826389.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgwOTgyNjM4OS9pbWFnZXMvMTc2OTgwOTgyNjM4OS5qcGciLCJpYXQiOjE3Njk4MDk4MjcsImV4cCI6MTgwMTM0NTgyN30.3RMc4H5sng-WVKFyfPDiYpqzWdgWuQCPjb6_pd_TPOs	https://vimeo.com/1139008878?share=copy&fl=sv&fe=ci	2026-01-30 21:50:34.315539+00	2026-01-30 21:50:34.315539+00	50668840-6376-4411-9dc4-b7606ead34ef
68a5d3dc-81c2-4152-b8ab-7a3021989dc1	Deficit push up	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769809884681/images/1769809884681.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgwOTg4NDY4MS9pbWFnZXMvMTc2OTgwOTg4NDY4MS5qcGciLCJpYXQiOjE3Njk4MDk4ODUsImV4cCI6MTgwMTM0NTg4NX0.12h5emPIxBXW-CbXwQvln7czTUSc0DQLG8lfwCveMRw	https://vimeo.com/1149345895?share=copy&fl=sv&fe=ci	2026-01-30 21:51:31.392544+00	2026-01-30 21:51:31.392544+00	50668840-6376-4411-9dc4-b7606ead34ef
88892172-9a24-4858-b0a8-1fa7c4eabec8	Laying leg curls	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769810211018/images/1769810211018.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMDIxMTAxOC9pbWFnZXMvMTc2OTgxMDIxMTAxOC5qcGciLCJpYXQiOjE3Njk4MTAyMTEsImV4cCI6MTgwMTM0NjIxMX0.CuXv_WrCqckqRp11I-PzV9lsK1uiYCmUD0C5VAwQSwc	https://vimeo.com/1139013854?share=copy&fl=sv&fe=ci	2026-01-30 21:57:10.039877+00	2026-01-30 21:57:10.039877+00	50668840-6376-4411-9dc4-b7606ead34ef
70225d08-9bab-4a04-94fe-15136f5304d3	Standing/incline pushup	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769810312302/images/1769810312302.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMDMxMjMwMi9pbWFnZXMvMTc2OTgxMDMxMjMwMi5qcGciLCJpYXQiOjE3Njk4MTAzMTMsImV4cCI6MTgwMTM0NjMxM30.pcnQn6bmqzKIW7JVZQD1K3cPLxsvFB69l4mXpfITRg8	https://vimeo.com/1139009152?share=copy&fl=sv&fe=ci	2026-01-30 21:58:39.447019+00	2026-01-30 21:58:39.447019+00	50668840-6376-4411-9dc4-b7606ead34ef
2209102e-003f-4839-9c57-278aaa777d28	Cross Cable Rear Delt Fly	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/2209102e-003f-4839-9c57-278aaa777d28/images/1769784784538.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzLzIyMDkxMDJlLTAwM2YtNDgzOS05YzU3LTI3OGFhYTc3N2QyOC9pbWFnZXMvMTc2OTc4NDc4NDUzOC5qcGciLCJpYXQiOjE3Njk3ODQ3ODUsImV4cCI6MTgwMTMyMDc4NX0.U3f1oNyc47AIu0z3MlssuQvCw5VRcIzsux4N_62Mg0k	https://vimeo.com/1139013529?share=copy&fl=sv&fe=ci	2026-01-30 13:53:52.005434+00	2026-01-30 22:00:45.064807+00	50668840-6376-4411-9dc4-b7606ead34ef
2452ec99-a801-40d9-acde-576951c3242e	Standing Rope Pullover	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769810549176/images/1769810549176.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMDU0OTE3Ni9pbWFnZXMvMTc2OTgxMDU0OTE3Ni5qcGciLCJpYXQiOjE3Njk4MTA1NDksImV4cCI6MTgwMTM0NjU0OX0.URU_KA67b23Pj1rOutWu7IofwgKadNvSy6e7-hAB8N8	https://vimeo.com/1139013462?share=copy&fl=sv&fe=ci	2026-01-30 22:02:38.490179+00	2026-01-30 22:02:38.490179+00	50668840-6376-4411-9dc4-b7606ead34ef
ff23f6e9-a14d-4c34-93c8-af8c75677e9f	Low Rope Hammer Curl	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769810622736/images/1769810622736.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMDYyMjczNi9pbWFnZXMvMTc2OTgxMDYyMjczNi5qcGciLCJpYXQiOjE3Njk4MTA2MjMsImV4cCI6MTgwMTM0NjYyM30._6TaNEtOiU2GhOtQfn8wI7TWzc08CegZvhKAeTtwhUE	https://vimeo.com/1130025176?share=copy&fl=sv&fe=ci	2026-01-30 22:03:51.193625+00	2026-01-30 22:03:51.193625+00	50668840-6376-4411-9dc4-b7606ead34ef
db808f65-b127-49d6-b109-a29d70b72862	Side Lying Dumbbell Lat Raises	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769810738324/images/1769810738324.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMDczODMyNC9pbWFnZXMvMTc2OTgxMDczODMyNC5qcGciLCJpYXQiOjE3Njk4MTA3MzksImV4cCI6MTgwMTM0NjczOX0.MSotvMZeY4HdKP2ji1vkm9ZVZjw7wzI0Qy7BxRcvvx4	https://vimeo.com/1139013395?share=copy&fl=sv&fe=ci	2026-01-30 22:05:48.567859+00	2026-01-30 22:05:48.567859+00	50668840-6376-4411-9dc4-b7606ead34ef
8085b43e-9b3e-4f51-8a67-7f193f55d5cb	Incline Dumbbell Lat Raises	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769810789659/images/1769810789659.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMDc4OTY1OS9pbWFnZXMvMTc2OTgxMDc4OTY1OS5qcGciLCJpYXQiOjE3Njk4MTA3OTAsImV4cCI6MTgwMTM0Njc5MH0.QanmEF7fOKYE1bm_nkYOHJEyz6inqzBig7U_DrSdsE8	https://vimeo.com/1130025168?share=copy&fl=sv&fe=ci	2026-01-30 22:06:39.008576+00	2026-01-30 22:06:39.008576+00	50668840-6376-4411-9dc4-b7606ead34ef
1a51a195-dc47-45d7-8307-0125f2c84aee	Pulley Overhead Triceps Extensions	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769810857487/images/1769810857487.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMDg1NzQ4Ny9pbWFnZXMvMTc2OTgxMDg1NzQ4Ny5qcGciLCJpYXQiOjE3Njk4MTA4NTgsImV4cCI6MTgwMTM0Njg1OH0.RgDKdavxi-xY5c-ZUeLVKE8IUOXi5MOvyjfYo0N0Z4M	https://vimeo.com/1130025175?share=copy&fl=sv&fe=ci	2026-01-30 22:07:45.257943+00	2026-01-30 22:07:45.257943+00	50668840-6376-4411-9dc4-b7606ead34ef
0cb7ca10-61bd-47bb-99d5-465f5eb535af	seated pull up	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769810923953/images/1769810923953.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMDkyMzk1My9pbWFnZXMvMTc2OTgxMDkyMzk1My5qcGciLCJpYXQiOjE3Njk4MTA5MjQsImV4cCI6MTgwMTM0NjkyNH0.oMahbupJUOtT_l6EULJ2ZPT1H5F6bzY0CcgTLmdsuCk	https://vimeo.com/1139013079?share=copy&fl=sv&fe=ci	2026-01-30 22:08:50.310921+00	2026-01-30 22:08:50.310921+00	50668840-6376-4411-9dc4-b7606ead34ef
7e628677-2bbd-4839-b5e3-f8565e78c7a5	Closed grip lat pull down	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769810969827/images/1769810969827.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMDk2OTgyNy9pbWFnZXMvMTc2OTgxMDk2OTgyNy5qcGciLCJpYXQiOjE3Njk4MTA5NzAsImV4cCI6MTgwMTM0Njk3MH0.MrtX0ZwA37DnT7_2obqf3tSB5rudEhboRpaEGv81qhY	https://vimeo.com/1139009316?share=copy&fl=sv&fe=ci	2026-01-30 22:09:34.820923+00	2026-01-30 22:09:34.820923+00	50668840-6376-4411-9dc4-b7606ead34ef
fe219f28-8a12-45b8-9201-f82e90fbc73f	Rope Triceps extension	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769811044379/images/1769811044379.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMTA0NDM3OS9pbWFnZXMvMTc2OTgxMTA0NDM3OS5qcGciLCJpYXQiOjE3Njk4MTEwNDUsImV4cCI6MTgwMTM0NzA0NX0.Izx_t15dqYsltKAaVdUpfH0pcInsg99MLvKSiofIxhc	https://vimeo.com/1127007925?share=copy&fl=sv&fe=ci	2026-01-30 22:11:12.190926+00	2026-01-30 22:11:12.190926+00	50668840-6376-4411-9dc4-b7606ead34ef
b514b6ec-8538-4ed4-b1d5-1f4e95ff9938	Pushups	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769811183399/images/1769811183399.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMTE4MzM5OS9pbWFnZXMvMTc2OTgxMTE4MzM5OS5qcGciLCJpYXQiOjE3Njk4MTExODQsImV4cCI6MTgwMTM0NzE4NH0.F2010o2tETXKcBBWqBt9jPOu5FRfzJvTA76Os5y5Z1o	https://vimeo.com/1139013636?share=copy&fl=sv&fe=ci	2026-01-30 22:13:09.818124+00	2026-01-30 22:13:09.818124+00	50668840-6376-4411-9dc4-b7606ead34ef
b71e8830-9f03-4c2a-b536-d5e54da1b702	incline db press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769811296162/images/1769811296162.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMTI5NjE2Mi9pbWFnZXMvMTc2OTgxMTI5NjE2Mi5qcGciLCJpYXQiOjE3Njk4MTEyOTcsImV4cCI6MTgwMTM0NzI5N30.DuarhWkP1iJS7JWNCI49TF-5vVeZqoyTmgqhnP_uKeQ	https://vimeo.com/1139013274?share=copy&fl=sv&fe=ci	2026-01-30 22:15:08.563131+00	2026-01-30 22:15:08.563131+00	50668840-6376-4411-9dc4-b7606ead34ef
ded49344-fe21-4c28-a788-0d67f0bed84d	Inverted Row	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769811353662/images/1769811353662.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMTM1MzY2Mi9pbWFnZXMvMTc2OTgxMTM1MzY2Mi5qcGciLCJpYXQiOjE3Njk4MTEzNTQsImV4cCI6MTgwMTM0NzM1NH0.oLJJiK_vaLAgBmlKiy1savaZP-_WKEs5HwFOHpMD4VE	https://vimeo.com/1137691808?share=copy&fl=sv&fe=ci	2026-01-30 22:16:01.951003+00	2026-01-30 22:16:01.951003+00	50668840-6376-4411-9dc4-b7606ead34ef
52119878-d24c-4573-adfd-b2df3e6c1579	Face pull - machine	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769811421287/images/1769811421287.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMTQyMTI4Ny9pbWFnZXMvMTc2OTgxMTQyMTI4Ny5qcGciLCJpYXQiOjE3Njk4MTE0MjIsImV4cCI6MTgwMTM0NzQyMn0.VOSy2zS5Zg-ANl3CeGzZoooIFFy51XAt6LTrmjpCWR4	https://vimeo.com/1138583117?share=copy&fl=sv&fe=ci	2026-01-30 22:17:08.699053+00	2026-01-30 22:17:08.699053+00	50668840-6376-4411-9dc4-b7606ead34ef
8bb8fc51-b3f8-4c4a-a7d7-028e9f62ba56	Around the world weight plate	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/8bb8fc51-b3f8-4c4a-a7d7-028e9f62ba56/images/1769811717123.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzLzhiYjhmYzUxLWIzZjgtNGM0YS1hN2Q3LTAyOGU5ZjYyYmE1Ni9pbWFnZXMvMTc2OTgxMTcxNzEyMy5qcGciLCJpYXQiOjE3Njk4MTE3MTcsImV4cCI6MTgwMTM0NzcxN30.BKIWLZzmlTtI-w44iMgRm0wyZyJw3b48Dt-akkLP9rI	https://vimeo.com/1137754980?share=copy&fl=sv&fe=ci	2026-01-30 22:21:01.044626+00	2026-01-30 22:21:59.506789+00	50668840-6376-4411-9dc4-b7606ead34ef
f3180010-2e1b-4644-aeac-81338d5827e6	SHOULDER PRESS weight plate	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769811768422/images/1769811768422.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMTc2ODQyMi9pbWFnZXMvMTc2OTgxMTc2ODQyMi5qcGciLCJpYXQiOjE3Njk4MTE3NjksImV4cCI6MTgwMTM0Nzc2OX0.grgIhZOrDCDNUyLq_niHSWY5h6vMJUAykUdH6Zlx4Cc	https://vimeo.com/1137754763?share=copy&fl=sv&fe=ci	2026-01-30 22:22:58.566965+00	2026-01-30 22:22:58.566965+00	50668840-6376-4411-9dc4-b7606ead34ef
02ee9867-8314-4f9d-bdbb-fa4de15b418a	SEATED DB PRESS	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769811852534/images/1769811852534.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMTg1MjUzNC9pbWFnZXMvMTc2OTgxMTg1MjUzNC5qcGciLCJpYXQiOjE3Njk4MTE4NTMsImV4cCI6MTgwMTM0Nzg1M30._bDSUijkB--QVMyhWFiNqr9_tDTr3DZptwYIWSHhVBc	https://vimeo.com/1132242831?share=copy&fl=sv&fe=ci	2026-01-30 22:24:18.593768+00	2026-01-30 22:24:18.593768+00	50668840-6376-4411-9dc4-b7606ead34ef
7cd7b9d7-f672-4e8c-8972-6b116099d3d1	SEATED ROW MACHINE	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769811932813/images/1769811932813.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMTkzMjgxMy9pbWFnZXMvMTc2OTgxMTkzMjgxMy5qcGciLCJpYXQiOjE3Njk4MTE5MzMsImV4cCI6MTgwMTM0NzkzM30.boiwUrViNjaEaI2cbMeCw2FuIqQGzAXgatYydIYoo18	https://vimeo.com/1137687935?share=copy&fl=sv&fe=ci	2026-01-30 22:25:38.475949+00	2026-01-30 22:25:38.475949+00	50668840-6376-4411-9dc4-b7606ead34ef
9e2c6f9c-4816-4906-bb30-e6a893ea0f79	laying barbell press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769812032653/images/1769812032653.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMjAzMjY1My9pbWFnZXMvMTc2OTgxMjAzMjY1My5qcGciLCJpYXQiOjE3Njk4MTIwMzMsImV4cCI6MTgwMTM0ODAzM30.7OxzJo1ZV2JonWBC_hNZp6dHCFFqzhrsA2hbnz3BL8g	https://vimeo.com/1130007081?share=copy&fl=sv&fe=ci	2026-01-30 22:27:28.480661+00	2026-01-30 22:27:28.480661+00	50668840-6376-4411-9dc4-b7606ead34ef
2f8fd726-28a8-43c2-8edb-8e9c45ea201e	Lying DB press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769812172672/images/1769812172672.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMjE3MjY3Mi9pbWFnZXMvMTc2OTgxMjE3MjY3Mi5qcGciLCJpYXQiOjE3Njk4MTIxNzMsImV4cCI6MTgwMTM0ODE3M30.zWjPq3hsm1UC6Wm8K-OqHX2NpqBhFlX4XqFUvFL11uY	https://vimeo.com/1130007099?share=copy&fl=sv&fe=ci	2026-01-30 22:29:41.515843+00	2026-01-30 22:29:41.515843+00	50668840-6376-4411-9dc4-b7606ead34ef
57dbfff6-d969-4935-9493-d7b926a1298b	lying Smith shoulder press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769812413038/images/1769812413038.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMjQxMzAzOC9pbWFnZXMvMTc2OTgxMjQxMzAzOC5qcGciLCJpYXQiOjE3Njk4MTI0MTMsImV4cCI6MTgwMTM0ODQxM30.xVTjR_HmuK0EPkDcDmfPEoqihoTv3wPTJLKjEW7ctBo	https://vimeo.com/1130007093?share=copy&fl=sv&fe=ci	2026-01-30 22:33:48.105029+00	2026-01-30 22:33:48.105029+00	50668840-6376-4411-9dc4-b7606ead34ef
8052a0e4-8ceb-4487-a505-0f0ade31ca7d	seated straight barbell shoulder press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769812559437/images/1769812559437.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMjU1OTQzNy9pbWFnZXMvMTc2OTgxMjU1OTQzNy5qcGciLCJpYXQiOjE3Njk4MTI1NjAsImV4cCI6MTgwMTM0ODU2MH0.aN-k9Ejd3PdMqAYycMV5gUeto9ZX1Tp4TK9RMtyEt6g	https://vimeo.com/1130007076?share=copy&fl=sv&fe=ci	2026-01-30 22:36:14.084778+00	2026-01-30 22:36:14.084778+00	50668840-6376-4411-9dc4-b7606ead34ef
5c9f578d-497d-43aa-ae88-30fc4c416034	Arnold press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769812672125/images/1769812672125.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMjY3MjEyNS9pbWFnZXMvMTc2OTgxMjY3MjEyNS5qcGciLCJpYXQiOjE3Njk4MTI2NzIsImV4cCI6MTgwMTM0ODY3Mn0.3Q9fLzpTRSPuaE380iau5APl9I_hM36R9j-CBj-p5r4	https://vimeo.com/1130007125?share=copy&fl=sv&fe=ci	2026-01-30 22:37:54.512134+00	2026-01-30 22:37:54.512134+00	50668840-6376-4411-9dc4-b7606ead34ef
298481b2-db52-40d7-b6b1-f3a404cb4b8f	Standing Barbell Shoulder Press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769812727396/images/1769812727396.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMjcyNzM5Ni9pbWFnZXMvMTc2OTgxMjcyNzM5Ni5qcGciLCJpYXQiOjE3Njk4MTI3MjgsImV4cCI6MTgwMTM0ODcyOH0.iIc98PfXnKySAJZR3in4KHeXsCLj7o-k0YXmslXeb_Y	https://vimeo.com/1130027949?share=copy&fl=sv&fe=ci	2026-01-30 22:38:56.449419+00	2026-01-30 22:38:56.449419+00	50668840-6376-4411-9dc4-b7606ead34ef
3a03ab58-6e7a-4ccf-bb29-f7d1c91ec9a0	Dumbbell Y Raise	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769812784491/images/1769812784491.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMjc4NDQ5MS9pbWFnZXMvMTc2OTgxMjc4NDQ5MS5qcGciLCJpYXQiOjE3Njk4MTI3ODQsImV4cCI6MTgwMTM0ODc4NH0.EsxiJyvqhZk-juLohIg7qbW9fJwqIiByvEvXGk15JDE	https://vimeo.com/1130007029?share=copy&fl=sv&fe=ci	2026-01-30 22:39:45.993521+00	2026-01-30 22:39:45.993521+00	50668840-6376-4411-9dc4-b7606ead34ef
810c56f4-19da-4389-9297-5b4a3250383d	LAT PULL DOWN	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769812860266/images/1769812860266.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMjg2MDI2Ni9pbWFnZXMvMTc2OTgxMjg2MDI2Ni5qcGciLCJpYXQiOjE3Njk4MTI4NjEsImV4cCI6MTgwMTM0ODg2MX0.VDUH90_FL2Gzczc8V0zL_tHErAgbshIgSHalRVeVF40	https://vimeo.com/1127007924/e1ad69c91d?share=copy&fl=sv&fe=ci	2026-01-30 22:41:07.477397+00	2026-01-30 22:41:07.477397+00	50668840-6376-4411-9dc4-b7606ead34ef
b93cf9db-654f-4f85-8926-99c76f42e758	DB BICEPS CURLS	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769812913433/images/1769812913433.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMjkxMzQzMy9pbWFnZXMvMTc2OTgxMjkxMzQzMy5qcGciLCJpYXQiOjE3Njk4MTI5MTQsImV4cCI6MTgwMTM0ODkxNH0.B7SxkMKoUxp6O_MLRKas-Li3oQugUsfdVtcitGP0FHk	https://vimeo.com/1127007936/1589bc3b75?share=copy&fl=sv&fe=ci	2026-01-30 22:42:00.983492+00	2026-01-30 22:42:00.983492+00	50668840-6376-4411-9dc4-b7606ead34ef
4e57952a-7072-4883-9789-553ded3b01f5	DB Lateral raises	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769813908781/images/1769813908781.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxMzkwODc4MS9pbWFnZXMvMTc2OTgxMzkwODc4MS5qcGciLCJpYXQiOjE3Njk4MTM5MDksImV4cCI6MTgwMTM0OTkwOX0.EBzKv6NUuDNjZ4Darw_hrZLmXB6zA1Y5lT0hlnd2WSY	https://vimeo.com/1127007921/1d0e59ac70?share=copy&fl=sv&fe=ci	2026-01-30 22:59:26.583661+00	2026-01-30 22:59:26.583661+00	50668840-6376-4411-9dc4-b7606ead34ef
ed2d82cc-d5d6-4148-9739-064b2487b88f	DB Floor Chest Press	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769814018744/images/1769814018744.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxNDAxODc0NC9pbWFnZXMvMTc2OTgxNDAxODc0NC5qcGciLCJpYXQiOjE3Njk4MTQwMTksImV4cCI6MTgwMTM1MDAxOX0.-aR6ULe0qEFzo_0xIutyh6VGwwhm1lwRokyceHR2Gcg	https://vimeo.com/1127007923/ff27ab54bb?share=copy&fl=sv&fe=ci	2026-01-30 23:00:28.483535+00	2026-01-30 23:00:28.483535+00	50668840-6376-4411-9dc4-b7606ead34ef
d51d4c62-0edc-42e4-aaf5-45c9f796e148	One-Arm Dumbbell Row	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769814179991/images/1769814179991.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxNDE3OTk5MS9pbWFnZXMvMTc2OTgxNDE3OTk5MS5qcGciLCJpYXQiOjE3Njk4MTQxODAsImV4cCI6MTgwMTM1MDE4MH0.GgieIbAR97w1tEVwOiJzFZkCH-tE0cjoRmDxx1yH4uo	https://vimeo.com/1127007912/20c9431429?share=copy&fl=sv&fe=ci	2026-01-30 23:03:08.255615+00	2026-01-30 23:03:08.255615+00	50668840-6376-4411-9dc4-b7606ead34ef
bf0891c9-7ba1-4321-8d54-4037f0e80f1b	Front Dumbbell Raise	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769814274230/images/1769814274230.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxNDI3NDIzMC9pbWFnZXMvMTc2OTgxNDI3NDIzMC5qcGciLCJpYXQiOjE3Njk4MTQyNzUsImV4cCI6MTgwMTM1MDI3NX0.A0Hzglmrpf9626R8avfJ19ehMHzEHwgtzKaJWoTo9X4	https://vimeo.com/1127007937/e4eabccd7a?share=copy&fl=sv&fe=ci	2026-01-30 23:04:40.236976+00	2026-01-30 23:04:40.236976+00	50668840-6376-4411-9dc4-b7606ead34ef
545e702e-244e-4cea-ae41-e6c320e8940d	Straight Bar Triceps Pushdown	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769814513017/images/1769814513017.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxNDUxMzAxNy9pbWFnZXMvMTc2OTgxNDUxMzAxNy5qcGciLCJpYXQiOjE3Njk4MTQ1MTMsImV4cCI6MTgwMTM1MDUxM30.qqstIW5lAkBFMWadPcK2vbGDSvTX4hq66COpKLdn3NM	https://vimeo.com/1127007927/0c7fbe54b9?share=copy&fl=sv&fe=ci	2026-01-30 23:08:39.638763+00	2026-01-30 23:08:39.638763+00	50668840-6376-4411-9dc4-b7606ead34ef
aa276eb2-683f-4bae-bab0-3232ba3f3154	חימום מתיחות ידיים	\N	\N	\N	https://vimeo.com/1127002951/eff4f6d15a	2026-01-30 23:09:23.841357+00	2026-01-30 23:09:23.841357+00	50668840-6376-4411-9dc4-b7606ead34ef
dbafac7c-c002-4ab8-b76c-e1678467a4e4	pulling band to the side ab exercises	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769815290667/images/1769815290667.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxNTI5MDY2Ny9pbWFnZXMvMTc2OTgxNTI5MDY2Ny5qcGciLCJpYXQiOjE3Njk4MTUyOTEsImV4cCI6MTgwMTM1MTI5MX0.TjMLFImdvUBr2tMW9--G0f7rqvZUpLwPyq3fD8Bq-Eg	https://vimeo.com/1138926980?share=copy&fl=sv&fe=ci	2026-01-30 23:21:48.532944+00	2026-01-30 23:21:48.532944+00	50668840-6376-4411-9dc4-b7606ead34ef
8aee2d29-1fce-4500-9b9d-3b1459c30928	banded side external rotation	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769815461062/images/1769815461062.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxNTQ2MTA2Mi9pbWFnZXMvMTc2OTgxNTQ2MTA2Mi5qcGciLCJpYXQiOjE3Njk4MTU0NjEsImV4cCI6MTgwMTM1MTQ2MX0.d632ZnzZIO6zO7V9OJAwO5StRgGateDbil99ANJV0FE	https://vimeo.com/1130007104?share=copy&fl=sv&fe=ci	2026-01-30 23:24:27.883459+00	2026-01-30 23:24:27.883459+00	50668840-6376-4411-9dc4-b7606ead34ef
c5dc211e-278c-4c81-b73a-437bfae6e725	LYING DB EXTERNAL ROTATION	\N	\N	https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/workout-exercises/temp-1769815523922/images/1769815523922.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzL3RlbXAtMTc2OTgxNTUyMzkyMi9pbWFnZXMvMTc2OTgxNTUyMzkyMi5qcGciLCJpYXQiOjE3Njk4MTU1MjQsImV4cCI6MTgwMTM1MTUyNH0.tyiK5M2x6YwUTFlak3B2w_u1EQsgqN3czgATFAklfxc	https://vimeo.com/1130007073?share=copy&fl=sv&fe=ci	2026-01-30 23:25:31.142441+00	2026-01-30 23:25:31.142441+00	50668840-6376-4411-9dc4-b7606ead34ef
\.


--
-- Data for Name: external_knowledge_base; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."external_knowledge_base" ("id", "title", "content", "images", "videos", "status", "created_at", "updated_at", "created_by", "cover_image") FROM stdin;
593bc099-8995-4b07-99df-8dfd3638fce5	כותרת	{"blocks": [{"type": "text", "content": "<p>זה מרמק נדיר ביותר</p><p><br></p><p><br></p><p><br></p><p><img src=\\"https://uklxejsaenqoxujcjkba.supabase.co/storage/v1/object/sign/client-assets/knowledge-base/images/inline-1769022705937-ki4rxe.jpeg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9jMGRhYTJhMC03YmRlLTQxMTMtYWJlYy1lYzA4ZTZiMDliNjEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL2tub3dsZWRnZS1iYXNlL2ltYWdlcy9pbmxpbmUtMTc2OTAyMjcwNTkzNy1raTRyeGUuanBlZyIsImlhdCI6MTc2OTAyMjcwNiwiZXhwIjoxODAwNTU4NzA2fQ.qGxu978f1ZaFQT2qsod54V7H2HmEbecIpRSXBJ67ltw\\"></p><p><br></p><p><br></p><h1>להזהר מפחמימות</h1>"}]}	{}	{}	draft	2026-01-21 19:10:53.32143+00	2026-01-21 19:12:12.256875+00	50668840-6376-4411-9dc4-b7606ead34ef	\N
\.


--
-- Data for Name: fillout_submissions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."fillout_submissions" ("id", "fillout_submission_id", "fillout_form_id", "submission_type", "submission_data", "lead_id", "customer_id", "created_at", "updated_at", "created_by") FROM stdin;
67fb7fa5-11c7-4239-91b9-3b7d7ff5d002	fba124eb-d6a0-47de-987b-d1b58788f9c3	שאלון התאמה	שאלון התאמה	{"_formId": "שאלון התאמה", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-22T15:07:37.807Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"form_name": "שאלון התאמה", "submission_id": "fba124eb-d6a0-47de-987b-d1b58788f9c3"}}	\N	\N	2026-01-22 15:07:39.185602+00	2026-01-22 15:07:39.185602+00	\N
9af41a6b-868b-4473-98f1-c830f71a0515	f741380f-0417-4f20-a9dc-2f47208d4bf0	שאלון התאמה	שאלון התאמה	{"_formId": "שאלון התאמה", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-25T06:17:34.705Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"form_name": "שאלון התאמה", "submission_id": "f741380f-0417-4f20-a9dc-2f47208d4bf0"}}	\N	\N	2026-01-25 06:17:35.805903+00	2026-01-25 06:17:35.805903+00	\N
23770134-fdca-4ce7-9e96-b6c64a917470	afa93c09-fc89-4a92-81a4-b65baa2961c9	שאלון התאמה	שאלון התאמה	{"_formId": "שאלון התאמה", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-25T19:40:06.859Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"form_name": "שאלון התאמה", "submission_id": "afa93c09-fc89-4a92-81a4-b65baa2961c9"}}	\N	\N	2026-01-25 19:40:07.863678+00	2026-01-25 19:40:07.863678+00	\N
48cf5549-0f78-4c61-81e4-006df66a32b5	8b3b5e40-ef50-41d1-8dd1-cae1ba930481	jHNYYKDSGpus	שאלון התאמה	{"_formId": "jHNYYKDSGpus", "lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-28T16:24:28.105Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"formId": "jHNYYKDSGpus", "lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "form_name": "שאלון התאמה", "submission_id": "8b3b5e40-ef50-41d1-8dd1-cae1ba930481"}}	\N	\N	2026-01-28 16:24:29.010604+00	2026-01-29 14:45:10.377545+00	\N
67a05101-6aed-4b39-a6b0-bf424a218aef	f8189b57-014e-4475-84ee-512c19c5e079		other	{"lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "Form_name": "פגישת התאמה", "_formName": "פגישת התאמה", "eventEndTime": "2026-02-02T16:30:00.000Z", "meeting_type": "פגישת התאמה", "eventStartTime": "2026-02-02T16:00:00.000Z", "event_end_time": "2026-02-02T16:30:00.000Z", "_submissionTime": "2026-01-28T16:09:00.386Z", "event_start_time": "2026-02-02T16:00:00.000Z", "סוג פגישה": "פגישת התאמה", "_rawWebhookPayload": {"lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "Form_name": "פגישת התאמה", "submission_id": "f8189b57-014e-4475-84ee-512c19c5e079", "event_end_time": "2026-02-02T16:30:00.000Z", "event_start_time": "2026-02-02T16:00:00.000Z"}}	\N	\N	2026-01-28 16:09:00.702958+00	2026-01-29 14:45:10.377545+00	\N
77164244-c19b-4540-8b83-f9e6dc6c7c76	817f9c3a-4853-42db-95f5-438bfbc297b4	n5VwsjFk5ous	meeting	{"_formId": "n5VwsjFk5ous", "lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "Form_name": "פגישת התאמה", "_formName": "פגישת התאמה", "eventEndTime": "2026-02-02T18:30:00.000Z", "meeting_type": "פגישת התאמה", "eventStartTime": "2026-02-02T18:00:00.000Z", "event_end_time": "2026-02-02T18:30:00.000Z", "_submissionTime": "2026-01-28T16:15:21.155Z", "event_start_time": "2026-02-02T18:00:00.000Z", "סוג פגישה": "פגישת התאמה", "_rawWebhookPayload": {"form_id": "n5VwsjFk5ous", "lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "Form_name": "פגישת התאמה", "submission_id": "817f9c3a-4853-42db-95f5-438bfbc297b4", "event_end_time": "2026-02-02T18:30:00.000Z", "event_start_time": "2026-02-02T18:00:00.000Z"}}	\N	\N	2026-01-28 16:15:21.706056+00	2026-01-29 14:45:10.377545+00	\N
5fdbb2ad-ab37-4e77-9766-82470fc7e991	6977789a-0b31-4c44-8618-42405f6d470e	jHNYYKDSGpus	שאלון התאמה	{"_formId": "jHNYYKDSGpus", "lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-29T14:39:27.155Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"formId": "jHNYYKDSGpus", "lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "form_name": "שאלון התאמה", "submission_id": "6977789a-0b31-4c44-8618-42405f6d470e"}}	\N	\N	2026-01-29 14:39:28.841217+00	2026-01-29 14:45:10.377545+00	\N
3dbe9483-0139-4b0a-958b-39986b0e7c0c	5c62ff43-5159-40fd-9581-7061a488a730	jHNYYKDSGpus	שאלון התאמה	{"_formId": "jHNYYKDSGpus", "lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-29T14:44:26.983Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"formId": "jHNYYKDSGpus", "lead_id": "80fe6444-d80d-4b5b-8f1c-2fcd8258b36e", "form_name": "שאלון התאמה", "submission_id": "5c62ff43-5159-40fd-9581-7061a488a730"}}	\N	\N	2026-01-29 14:44:28.057806+00	2026-01-29 14:45:10.377545+00	\N
f25c2fed-cb34-4638-b44f-d9af757d3e7a	916fc822-1e38-4e6c-985f-8947d409388e	n5VwsjFk5ous	meeting	{"_formId": "n5VwsjFk5ous", "lead_id": "b24ca8ea-c22f-46c1-82b9-1b51b372dcca", "Form_name": "פגישת התאמה", "_formName": "פגישת התאמה", "eventEndTime": "2026-02-03T17:00:00.000Z", "meeting_type": "פגישת התאמה", "eventStartTime": "2026-02-03T16:30:00.000Z", "event_end_time": "2026-02-03T17:00:00.000Z", "_submissionTime": "2026-01-29T14:45:43.715Z", "event_start_time": "2026-02-03T16:30:00.000Z", "סוג פגישה": "פגישת התאמה", "_rawWebhookPayload": {"form_id": "n5VwsjFk5ous", "lead_id": "b24ca8ea-c22f-46c1-82b9-1b51b372dcca", "Form_name": "פגישת התאמה", "submission_id": "916fc822-1e38-4e6c-985f-8947d409388e", "event_end_time": "2026-02-03T17:00:00.000Z", "event_start_time": "2026-02-03T16:30:00.000Z"}}	\N	\N	2026-01-29 14:45:44.435648+00	2026-01-29 15:02:31.153459+00	\N
e1f52e08-9dd2-402f-a2fb-441d9c8872ab	b31e5a1b-5f8c-46d4-b737-258deb8ca88a	jHNYYKDSGpus	שאלון התאמה	{"_formId": "jHNYYKDSGpus", "lead_id": "b24ca8ea-c22f-46c1-82b9-1b51b372dcca", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-29T14:46:39.393Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"formId": "jHNYYKDSGpus", "lead_id": "b24ca8ea-c22f-46c1-82b9-1b51b372dcca", "form_name": "שאלון התאמה", "submission_id": "b31e5a1b-5f8c-46d4-b737-258deb8ca88a"}}	\N	\N	2026-01-29 14:46:40.186079+00	2026-01-29 15:02:31.153459+00	\N
407de9e4-c480-48e4-9063-6d887763d3c8	1d1708d4-4a6e-41dd-9639-6bd78d49bffb	jHNYYKDSGpus	שאלון התאמה	{"_formId": "jHNYYKDSGpus", "lead_id": "a96d452f-990f-441d-b9ce-272630d4717d", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-29T15:03:38.527Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"formId": "jHNYYKDSGpus", "lead_id": "a96d452f-990f-441d-b9ce-272630d4717d", "form_name": "שאלון התאמה", "submission_id": "1d1708d4-4a6e-41dd-9639-6bd78d49bffb"}}	\N	\N	2026-01-29 15:03:39.639515+00	2026-01-29 15:12:40.99214+00	\N
284a3999-75c6-4db2-adca-96712f9f763d	a30a5409-e531-40a4-a49f-05bcb08500ec	n5VwsjFk5ous	meeting	{"_formId": "n5VwsjFk5ous", "Form_name": "פגישת התאמה", "_formName": "פגישת התאמה", "eventEndTime": "2026-02-02T16:30:00.000Z", "meeting_type": "פגישת התאמה", "eventStartTime": "2026-02-02T16:00:00.000Z", "event_end_time": "2026-02-02T16:30:00.000Z", "_submissionTime": "2026-01-29T16:42:35.333Z", "event_start_time": "2026-02-02T16:00:00.000Z", "סוג פגישה": "פגישת התאמה", "_rawWebhookPayload": {"form_id": "n5VwsjFk5ous", "Form_name": "פגישת התאמה", "submission_id": "a30a5409-e531-40a4-a49f-05bcb08500ec", "event_end_time": "2026-02-02T16:30:00.000Z", "event_start_time": "2026-02-02T16:00:00.000Z"}}	\N	\N	2026-01-29 16:42:36.957794+00	2026-01-29 16:42:36.957794+00	\N
50c70a78-38d9-41ae-a9e0-a72c79678dc4	ad632577-9ed5-4bff-b24e-282d2ca4bedc	jHNYYKDSGpus	שאלון התאמה	{"_formId": "jHNYYKDSGpus", "lead_id": "aa9c6adc-5cd9-4937-bd44-c39ab8effee7", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-29T15:13:42.240Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"formId": "jHNYYKDSGpus", "lead_id": "aa9c6adc-5cd9-4937-bd44-c39ab8effee7", "form_name": "שאלון התאמה", "submission_id": "ad632577-9ed5-4bff-b24e-282d2ca4bedc"}}	\N	96d78f57-0a52-4d89-bcdf-d24e2795f24f	2026-01-29 15:13:43.331944+00	2026-01-29 22:01:24.797341+00	\N
cd992e14-4eea-4051-9468-bc9725d4212b	0da19500-b0f2-4c52-88d4-632f00a9f4dc	n5VwsjFk5ous	meeting	{"_formId": "n5VwsjFk5ous", "lead_id": "aa9c6adc-5cd9-4937-bd44-c39ab8effee7", "Form_name": "פגישת התאמה", "_formName": "פגישת התאמה", "eventEndTime": "2026-02-02T17:30:00.000Z", "meeting_type": "פגישת התאמה", "eventStartTime": "2026-02-02T17:00:00.000Z", "event_end_time": "2026-02-02T17:30:00.000Z", "_submissionTime": "2026-01-29T15:22:48.695Z", "event_start_time": "2026-02-02T17:00:00.000Z", "סוג פגישה": "פגישת התאמה", "_rawWebhookPayload": {"form_id": "n5VwsjFk5ous", "lead_id": "aa9c6adc-5cd9-4937-bd44-c39ab8effee7", "Form_name": "פגישת התאמה", "submission_id": "0da19500-b0f2-4c52-88d4-632f00a9f4dc", "event_end_time": "2026-02-02T17:30:00.000Z", "event_start_time": "2026-02-02T17:00:00.000Z"}}	\N	96d78f57-0a52-4d89-bcdf-d24e2795f24f	2026-01-29 15:22:49.386654+00	2026-01-29 22:01:24.797341+00	\N
7685fb47-78c3-4a7f-91bc-d9cdf1181586	b16dc841-4d5b-409e-8211-c9966652d9e8	jHNYYKDSGpus	שאלון התאמה	{"_formId": "jHNYYKDSGpus", "lead_id": "aa9c6adc-5cd9-4937-bd44-c39ab8effee7", "Form_name": "שאלון התאמה", "_formName": "שאלון התאמה", "form_name": "שאלון התאמה", "meeting_type": "שאלון התאמה", "_submissionTime": "2026-01-29T15:38:00.879Z", "סוג פגישה": "שאלון התאמה", "_rawWebhookPayload": {"formId": "jHNYYKDSGpus", "lead_id": "aa9c6adc-5cd9-4937-bd44-c39ab8effee7", "form_name": "שאלון התאמה", "submission_id": "b16dc841-4d5b-409e-8211-c9966652d9e8"}}	\N	96d78f57-0a52-4d89-bcdf-d24e2795f24f	2026-01-29 15:38:01.977876+00	2026-01-29 22:01:24.797341+00	\N
\.


--
-- Data for Name: green_api_settings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."green_api_settings" ("id", "id_instance", "api_token_instance", "created_at", "updated_at", "created_by", "updated_by") FROM stdin;
\.


--
-- Data for Name: interface_folders; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."interface_folders" ("id", "name", "interface_key", "user_id", "display_order", "created_at", "updated_at") FROM stdin;
be91b9f4-1974-4b30-9905-48aecef103d6	בטן	exercises	50668840-6376-4411-9dc4-b7606ead34ef	1	2026-01-29 23:53:05.568398+00	2026-01-29 23:53:05.568398+00
b8d163ce-55bf-405f-a640-bba7f32b538c	פג גוף תחתון	exercises	50668840-6376-4411-9dc4-b7606ead34ef	2	2026-01-29 23:53:24.661716+00	2026-01-29 23:53:24.661716+00
d2675dff-e328-4568-ad6f-525bce8fc303	פלג גוף עליון	exercises	50668840-6376-4411-9dc4-b7606ead34ef	3	2026-01-29 23:53:36.55599+00	2026-01-29 23:53:36.55599+00
\.


--
-- Data for Name: internal_knowledge_base; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."internal_knowledge_base" ("id", "title", "description", "video_url", "tags", "duration", "additional_info", "created_at", "updated_at", "created_by") FROM stdin;
71b7d435-3e69-4492-aef4-42c0921f574c	הדרכת מערכת כללי 1	בסרטון אנחנו רואים הדרכה ראשונית של המערכת, והסברים עליה	https://www.loom.com/share/f37f189e0fa44e97a433cf181de051a8	{CRM,"הדרכה כללית"}	600	{}	2026-01-14 01:45:42.554024+00	2026-01-14 01:45:42.554024+00	50668840-6376-4411-9dc4-b7606ead34ef
\.


--
-- Data for Name: user_invitations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."user_invitations" ("id", "email", "user_id", "customer_id", "lead_id", "token_hash", "token_salt", "status", "invited_by", "invited_at", "expires_at", "accepted_at", "created_at", "updated_at") FROM stdin;
\.


--
-- Data for Name: invitation_audit_log; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."invitation_audit_log" ("id", "invitation_id", "action", "performed_by", "ip_address", "user_agent", "metadata", "created_at") FROM stdin;
\.


--
-- Data for Name: meetings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."meetings" ("id", "lead_id", "customer_id", "fillout_submission_id", "meeting_data", "created_at", "updated_at", "created_by") FROM stdin;
\.


--
-- Data for Name: notifications; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."notifications" ("id", "user_id", "customer_id", "lead_id", "type", "title", "message", "action_url", "is_read", "created_at", "read_at", "metadata") FROM stdin;
\.


--
-- Data for Name: nutrition_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."nutrition_plans" ("id", "user_id", "lead_id", "template_id", "start_date", "description", "targets", "created_at", "updated_at", "created_by", "customer_id", "budget_id", "is_active", "deleted_at", "name") FROM stdin;
cea9e26c-96e3-4e5d-9232-6127478aeb99	50668840-6376-4411-9dc4-b7606ead34ef	278533bb-a303-4447-92a8-3fa1ba4a8114	\N	2026-01-29	תוכנית תזונה מתכנית פעולה: ריברס	{"fat": 0, "carbs": 0, "protein": 0, "calories": 0, "fiber_min": 20}	2026-01-29 22:52:45.309456+00	2026-01-29 22:52:45.189+00	50668840-6376-4411-9dc4-b7606ead34ef	708c5b1a-6611-45df-8a85-f2f04909f4ae	32998caa-d8b3-4f00-95b6-5b204282e487	t	\N	\N
6757fce9-ea11-45e7-bedc-cf87cb897993	50668840-6376-4411-9dc4-b7606ead34ef	53d28a1c-321f-40d9-8375-a527456a27d5	\N	2026-01-20	תוכנית תזונה מתקציב: כככ	{"fat": 70, "carbs": 140, "protein": 140, "calories": 1750, "fiber_min": 32, "water_min": 2.5}	2026-01-20 22:05:16.709322+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef	af7bdb9d-65aa-45b0-be2b-007ea60ae134	\N	t	\N	\N
57f17359-6eaa-42d7-9efe-d6fe1fb57b54	50668840-6376-4411-9dc4-b7606ead34ef	53d28a1c-321f-40d9-8375-a527456a27d5	\N	2026-01-20	תוכנית תזונה מתקציב: כככ	{"fat": 70, "carbs": 140, "protein": 140, "calories": 1750, "fiber_min": 32, "water_min": 2.5}	2026-01-20 22:04:50.795522+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef	af7bdb9d-65aa-45b0-be2b-007ea60ae134	\N	t	\N	\N
91eff7d4-c827-4dc2-8084-ffd3d4276a40	50668840-6376-4411-9dc4-b7606ead34ef	10827900-0971-4a59-9611-9f8fb929182e	\N	2026-01-21	תוכנית תזונה מתקציב: תקציב לנטע	{"fat": 0, "carbs": 0, "protein": 140, "calories": 2000, "fiber_min": 30, "water_min": 2.5}	2026-01-21 19:00:14.294276+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef	f379a13d-19c9-4338-a0fd-df07cb597f5e	\N	t	\N	\N
\.


--
-- Data for Name: payments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."payments" ("id", "customer_id", "lead_id", "product_name", "amount", "currency", "status", "stripe_payment_id", "transaction_id", "receipt_url", "notes", "created_at", "updated_at", "created_by", "collection_id") FROM stdin;
0ac0212f-68de-4bf8-abce-8a3730160f3d	f379a13d-19c9-4338-a0fd-df07cb597f5e	\N	גכעגכע	444.00	ILS	שולם	\N	\N	\N	\N	2026-01-21 19:13:33.074534+00	2026-01-29 22:01:24.797341+00	50668840-6376-4411-9dc4-b7606ead34ef	\N
95952250-fbda-4782-b9d6-b410c31b6c53	af7bdb9d-65aa-45b0-be2b-007ea60ae134	\N	50	50.00	ILS	שולם	\N	\N	\N	\N	2026-01-20 21:56:55.823868+00	2026-01-29 22:01:24.797341+00	50668840-6376-4411-9dc4-b7606ead34ef	\N
\.


--
-- Data for Name: proposals; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."proposals" ("id", "created_at", "updated_at", "lead_id", "customer_id", "title", "description", "proposal_link", "external_proposal_id", "status", "amount", "currency", "sent_at", "viewed_at", "signed_at", "expires_at", "metadata", "created_by") FROM stdin;
\.


--
-- Data for Name: saved_action_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."saved_action_plans" ("id", "user_id", "budget_id", "name", "description", "saved_at", "snapshot", "notes", "lead_id") FROM stdin;
\.


--
-- Data for Name: saved_views; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."saved_views" ("id", "resource_key", "view_name", "filter_config", "is_default", "created_by", "created_at", "updated_at", "icon_name", "display_order", "folder_id") FROM stdin;
8abdbb68-7b80-46d1-a734-7c8ffa408cc4	customers	כל הלקוחות	{"searchQuery": "", "selectedDate": null}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-14 01:44:13.270167+00	2026-01-20 17:13:15.908572+00	\N	0	\N
4f3a4cf7-64db-4b34-9236-a201b6f3f548	leads	כל הלידים	{"searchQuery": "", "selectedAge": null, "selectedDate": null, "selectedHeight": null, "selectedSource": null, "selectedStatus": null, "selectedWeight": null, "columnVisibility": {"id": true, "age": true, "name": true, "email": true, "notes": true, "phone": true, "height": true, "source": true, "status": true, "weight": true, "birthDate": true, "createdDate": true, "fitnessGoal": true, "activityLevel": true, "preferredTime": true}, "selectedFitnessGoal": null, "selectedActivityLevel": null, "selectedPreferredTime": null}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-14 01:44:13.435541+00	2026-01-20 17:13:15.908572+00	\N	0	\N
441cfd4b-ddaf-4f22-9f1c-4d4caedb92d0	meetings	כל הפגישות	{"searchQuery": "", "selectedDate": null, "columnVisibility": {"phone": true, "status": true, "created_at": true, "meeting_date": true, "meeting_time": true, "customer_name": true}}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-14 01:44:13.452512+00	2026-01-20 17:13:15.908572+00	\N	0	\N
0e778fe4-e952-451a-853a-d82926eff214	nutrition_templates	כל תבניות התזונה	{"searchQuery": "", "selectedDate": null, "columnVisibility": {"name": true, "tags": false, "actions": true, "createdDate": true, "description": true, "connectedLeads": false}}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-14 01:57:26.643961+00	2026-01-20 17:13:15.908572+00	\N	0	\N
9a05bde4-ecad-44b1-bb9b-ea5980b93fdc	payments	כל התשלומים	{"searchQuery": "", "selectedDate": null}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-19 12:59:07.406123+00	2026-01-20 17:13:15.908572+00	\N	0	\N
d9637896-3677-4ba1-aa2f-8f2107684a42	templates	כל התכניות	{"searchQuery": "", "selectedDate": null, "selectedTags": [], "columnVisibility": {"name": true, "tags": true, "actions": true, "createdDate": true, "description": true, "connectedLeads": true}, "selectedHasLeads": "all"}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-14 01:57:26.69227+00	2026-01-20 17:13:15.908572+00	\N	0	\N
eb9a3c08-c619-4397-9fd9-6681c29824fc	collections	כל הגבייות	{}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-20 17:14:22.424377+00	2026-01-20 17:14:22.424377+00	\N	1	\N
d199d8e4-4017-4baf-bd94-2a7f50ee4c4b	collections	כל הגבייות	{}	t	6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	2026-01-20 17:14:22.424377+00	2026-01-20 17:14:22.424377+00	\N	1	\N
e8994e39-4e8a-4002-9710-fb8a8a6fb6df	collections	כל הגבייות	{}	t	fe090720-f100-4977-ba2e-3702fa207e1e	2026-01-20 17:14:22.424377+00	2026-01-20 17:14:22.424377+00	\N	1	\N
b538d696-0430-4abf-9eaf-16624427df3a	leads	לא פעיל	{"filterGroup": {"id": "group-1769020743851", "children": [{"id": "status-1769020759082", "type": "multiselect", "values": ["פעיל"], "fieldId": "status", "operator": "isNot", "fieldLabel": "סטטוס"}], "operator": "and"}, "searchQuery": "", "selectedAge": null, "selectedDate": null, "selectedHeight": null, "selectedSource": null, "selectedStatus": null, "selectedWeight": null, "advancedFilters": [{"id": "status-1769020759082", "type": "multiselect", "values": ["פעיל"], "fieldId": "status", "operator": "isNot", "fieldLabel": "סטטוס"}], "columnVisibility": {"id": true, "age": true, "name": true, "email": true, "notes": true, "phone": true, "height": true, "source": true, "status": true, "weight": true, "createdDate": true, "fitnessGoal": true, "activityLevel": true, "preferredTime": true}, "selectedFitnessGoal": null, "selectedActivityLevel": null, "selectedPreferredTime": null}	f	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-21 18:39:12.210967+00	2026-01-21 18:39:20.399901+00	\N	2	\N
98a60fe5-6d55-494f-8aa0-75dfca65f559	leads	לא פעיל (עותק)	{"filterGroup": {"id": "group-1769020743851", "children": [{"id": "status-1769020759082", "type": "multiselect", "values": ["פעיל"], "fieldId": "status", "operator": "isNot", "fieldLabel": "סטטוס"}], "operator": "and"}, "searchQuery": "", "selectedAge": null, "selectedDate": null, "selectedHeight": null, "selectedSource": null, "selectedStatus": null, "selectedWeight": null, "advancedFilters": [{"id": "status-1769020759082", "type": "multiselect", "values": ["פעיל"], "fieldId": "status", "operator": "isNot", "fieldLabel": "סטטוס"}], "columnVisibility": {"id": true, "age": true, "name": true, "email": true, "notes": true, "phone": true, "height": true, "source": true, "status": true, "weight": true, "createdDate": true, "fitnessGoal": true, "activityLevel": true, "preferredTime": true}, "selectedFitnessGoal": null, "selectedActivityLevel": null, "selectedPreferredTime": null}	f	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-21 18:46:05.367135+00	2026-01-21 18:46:05.367135+00	\N	3	\N
9227f87c-444f-4674-b0a4-9d1f633a6e73	subscription_types	כל סוגי המנויים	{}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-27 19:09:13.804469+00	2026-01-27 19:09:13.804469+00	\N	1	\N
dcc95e31-448d-4be8-88f4-92f2a9b2348d	subscription_types	כל סוגי המנויים	{}	t	6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	2026-01-27 19:09:13.804469+00	2026-01-27 19:09:13.804469+00	\N	1	\N
5667dbc7-7ec4-4fdd-a650-aeb45cff6609	subscription_types	כל סוגי המנויים	{}	t	fe090720-f100-4977-ba2e-3702fa207e1e	2026-01-27 19:09:13.804469+00	2026-01-27 19:09:13.804469+00	\N	1	\N
b39e376a-ae0c-45bd-9871-6bce7fbf1492	whatsapp_automations	כל האוטומציות	{}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-27 19:09:13.804469+00	2026-01-27 19:09:13.804469+00	\N	1	\N
b1f0b3c1-62f8-4fb3-b0fb-cc8adc855287	whatsapp_automations	כל האוטומציות	{}	t	6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	2026-01-27 19:09:13.804469+00	2026-01-27 19:09:13.804469+00	\N	1	\N
843b17a8-0f21-4342-9334-39b9160b3510	whatsapp_automations	כל האוטומציות	{}	t	fe090720-f100-4977-ba2e-3702fa207e1e	2026-01-27 19:09:13.804469+00	2026-01-27 19:09:13.804469+00	\N	1	\N
fc5a34b5-8f85-4b45-9bf5-6934a26dcc6e	exercises	כל התרגילים	{}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-27 19:09:14.296494+00	2026-01-27 19:09:14.296494+00	\N	1	\N
e21960b8-b775-4073-9739-f0b6c54027fa	exercises	כל התרגילים	{}	t	6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	2026-01-27 19:09:14.296494+00	2026-01-27 19:09:14.296494+00	\N	1	\N
93b4ce1a-872d-454c-8652-06eb33fcb5d0	exercises	כל התרגילים	{}	t	fe090720-f100-4977-ba2e-3702fa207e1e	2026-01-27 19:09:14.296494+00	2026-01-27 19:09:14.296494+00	\N	1	\N
97058c56-a4f1-4033-a757-a8b469aa6312	supplement_templates	כל התבניות	{}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-27 19:09:16.177471+00	2026-01-27 19:09:16.177471+00	\N	1	\N
99a938e3-1d34-4470-a338-11bfe94ed392	supplement_templates	כל התבניות	{}	t	6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	2026-01-27 19:09:16.177471+00	2026-01-27 19:09:16.177471+00	\N	1	\N
0618da0b-9d7f-47fc-a2cf-d720b14dda75	supplement_templates	כל התבניות	{}	t	fe090720-f100-4977-ba2e-3702fa207e1e	2026-01-27 19:09:16.177471+00	2026-01-27 19:09:16.177471+00	\N	1	\N
bd34eebd-701a-4f25-a569-4b08ff677212	budgets	כל תכניות הפעולה	{"searchQuery": "", "selectedDate": null, "columnVisibility": {"name": true, "actions": true, "steps_goal": true, "createdDate": true, "description": true, "supplements": false, "eating_order": false, "eating_rules": false, "workout_template": true, "nutrition_targets": false, "nutrition_template": true, "steps_instructions": false}}	t	50668840-6376-4411-9dc4-b7606ead34ef	2026-01-14 01:44:13.415944+00	2026-01-27 19:09:17.578434+00	\N	0	\N
\.


--
-- Data for Name: steps_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."steps_plans" ("id", "user_id", "lead_id", "customer_id", "budget_id", "template_id", "start_date", "end_date", "description", "steps_goal", "steps_instructions", "is_active", "created_at", "updated_at", "created_by") FROM stdin;
2ce8b384-457d-4a70-b105-5821050ecc6f	50668840-6376-4411-9dc4-b7606ead34ef	278533bb-a303-4447-92a8-3fa1ba4a8114	708c5b1a-6611-45df-8a85-f2f04909f4ae	32998caa-d8b3-4f00-95b6-5b204282e487	\N	2026-01-29	\N	תוכנית צעדים מתכנית פעולה: ריברס	10000	\N	t	2026-01-29 22:52:45.916761+00	2026-01-29 22:52:45.802+00	50668840-6376-4411-9dc4-b7606ead34ef
9ea95891-204b-44ab-b3f1-56820e1bc6d6	50668840-6376-4411-9dc4-b7606ead34ef	\N	af7bdb9d-65aa-45b0-be2b-007ea60ae134	\N	\N	2026-01-20	\N	תוכנית צעדים מתקציב: כככ	800	\N	t	2026-01-20 22:05:17.212786+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef
322af2dc-caa2-440b-8119-c2e9698eb9db	50668840-6376-4411-9dc4-b7606ead34ef	\N	f379a13d-19c9-4338-a0fd-df07cb597f5e	\N	\N	2026-01-21	\N	תוכנית צעדים מתכנית פעולה: תקציב לנטע	7000	\N	t	2026-01-21 19:00:14.669672+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef
\.


--
-- Data for Name: subscription_types; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."subscription_types" ("id", "name", "duration", "price", "created_at", "updated_at", "created_by", "currency", "duration_unit", "second_period") FROM stdin;
a7a30b4d-c0dd-4cd3-935e-265761a61b7e	665	1	100.00	2026-01-14 02:14:16.152316+00	2026-01-14 02:14:16.152316+00	50668840-6376-4411-9dc4-b7606ead34ef	ILS	months	\N
74cf37d9-b658-470c-871c-09d1d3b7f9ae	4 חודשים	1	1700.00	2026-01-14 20:13:56.567416+00	2026-01-14 20:14:35.784248+00	50668840-6376-4411-9dc4-b7606ead34ef	ILS	months	\N
f583c9f6-04d4-4e62-9c41-d552ef8efb2a	חופשי חודשי	1	1250.00	2026-01-14 20:14:48.203725+00	2026-01-14 20:14:48.203725+00	50668840-6376-4411-9dc4-b7606ead34ef	ILS	months	\N
8382c4a9-77cb-4890-ae1c-c46f9f4c67f7	חופשי חודשי (ישן)	1	900.00	2026-01-14 20:15:25.954902+00	2026-01-14 20:15:25.954902+00	50668840-6376-4411-9dc4-b7606ead34ef	ILS	months	\N
\.


--
-- Data for Name: supplement_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."supplement_plans" ("id", "user_id", "lead_id", "customer_id", "budget_id", "template_id", "start_date", "end_date", "description", "supplements", "is_active", "created_at", "updated_at", "created_by") FROM stdin;
cae30854-19a1-4ebe-9553-1d6663574da6	50668840-6376-4411-9dc4-b7606ead34ef	\N	\N	\N	\N	2026-01-28	\N	תוכנית תוספים מתכנית פעולה: תקציב לנטע	[{"name": "ויטמין די", "dosage": "22", "timing": "בערב"}, {"name": "קריאטין", "dosage": "19", "timing": "בבוקר"}, {"name": "מע", "dosage": "", "timing": ""}]	t	2026-01-28 15:32:01.62117+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef
0588a904-144d-4cb5-84c8-18c21067edb0	50668840-6376-4411-9dc4-b7606ead34ef	\N	f379a13d-19c9-4338-a0fd-df07cb597f5e	\N	\N	2026-01-21	\N	תוכנית תוספים מתקציב: תקציב לנטע	[{"name": "ויטמין די", "dosage": "22", "timing": "בערב"}, {"name": "קריאטין", "dosage": "19", "timing": "בבוקר"}]	t	2026-01-21 19:00:15.100093+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef
7f398e47-c6be-4c72-ad73-64052ab0c9d1	50668840-6376-4411-9dc4-b7606ead34ef	278533bb-a303-4447-92a8-3fa1ba4a8114	708c5b1a-6611-45df-8a85-f2f04909f4ae	32998caa-d8b3-4f00-95b6-5b204282e487	\N	2026-01-29	\N	תוכנית תוספים מתכנית פעולה: ריברס	[{"name": "ברברין", "link1": "https://iherb.co/1mmrKqvZ", "link2": "https://amzn.to/46QKpvu", "dosage": "2 כדורים ביום", "timing": "רבע שעה לפני ארוחה עשירה בפחמימות"}, {"name": "קולגן (THRONE)", "link1": "https://iherb.co/VVQZKNa3", "link2": "https://www.amazon.com/dp/B0B7K9Y1FD/?coliid=I1KQAC9HSU2ATH&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_93V78YPRF2TWBK4DHKFD", "dosage": "סקופ", "timing": ""}, {"name": "קולגן (לעצמות ומפרקים)", "link1": "https://iherb.co/cdeyDSJ", "link2": "https://amzn.to/49AhddJ", "dosage": "סקופ", "timing": ""}, {"name": "ויטמין D", "link1": "https://iherb.co/4Lzfkpz3", "link2": "https://www.amazon.com/dp/B003CF7TOA/?coliid=ICG2XPPNG6XAN&colid=3UVZ2K8H1OMDK&psc=1&ref_=cm_sw_r_cp_ud_lstpd_5KRCKHZTF4GT1RGYBV3S", "dosage": "1 כדור", "timing": "בבוקר עם מאכל שומני"}, {"name": "תוסף סיבים", "link1": "https://iherb.co/9GWRUJpQ", "link2": "https://amzn.to/3LgaJ9H", "dosage": "1 סקופ", "timing": ""}, {"name": "מגנזיום (אבקה-לשינה)", "link1": "https://iherb.co/VD2VdjMU", "link2": "https://amzn.to/49C7MKL", "dosage": "1-2 סקופ", "timing": "בכוס מים בלילה לפני השינה"}, {"name": "מגנזיום גליצינט (לילה) BIO OPTIMIZERS", "link1": "https://iherb.co/xRAxVcwz", "link2": "https://amzn.to/4k7WYqZ", "dosage": "3 כדורים", "timing": "בלילה"}, {"name": "מגנזיום גליצינט+טריונט) לילה AMAZON", "link1": "https://amzn.to/47ubbtO", "dosage": "3 כדורים", "timing": ""}, {"name": "קריאטין", "link1": "https://iherb.co/SuDXikfb", "link2": "https://amzn.to/491joH6", "dosage": "1-3 סקופ ביום", "timing": "במים"}, {"name": "פרוביוטיקה", "link1": "https://amzn.to/4n5G2kP", "link2": "https://iherb.co/wKEPjXvx", "dosage": "", "timing": ""}]	t	2026-01-29 22:52:46.530109+00	2026-01-29 22:52:46.412+00	50668840-6376-4411-9dc4-b7606ead34ef
eefa3a69-64bc-4626-9eed-8d21f493ba6c	50668840-6376-4411-9dc4-b7606ead34ef	\N	af7bdb9d-65aa-45b0-be2b-007ea60ae134	\N	\N	2026-01-20	\N	תוכנית תוספים מתקציב: כככ	[{"name": "גהכ", "dosage": "33", "timing": "ככ"}, {"name": "22", "dosage": "44", "timing": "ככ"}]	t	2026-01-20 22:05:17.687261+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef
64595acb-c34f-4589-88fc-2c32a09907e9	50668840-6376-4411-9dc4-b7606ead34ef	\N	af7bdb9d-65aa-45b0-be2b-007ea60ae134	\N	\N	2026-01-20	\N	תוכנית תוספים מתקציב: כככ	[{"name": "גהכ", "dosage": "33", "timing": "ככ"}, {"name": "22", "dosage": "44", "timing": "ככ"}]	f	2026-01-20 22:04:51.22869+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef
\.


--
-- Data for Name: user_interface_preferences; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."user_interface_preferences" ("id", "user_id", "interface_key", "icon_name", "created_at", "updated_at", "display_order", "numeric_value") FROM stdin;
\.


--
-- Data for Name: weekly_reviews; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."weekly_reviews" ("id", "lead_id", "customer_id", "week_start_date", "week_end_date", "target_calories", "target_protein", "target_carbs", "target_fat", "target_fiber", "target_steps", "actual_calories_avg", "actual_protein_avg", "actual_carbs_avg", "actual_fat_avg", "actual_fiber_avg", "actual_calories_weekly_avg", "weekly_avg_weight", "waist_measurement", "trainer_summary", "action_plan", "updated_steps_goal", "updated_calories_target", "created_at", "updated_at", "created_by", "target_weight", "target_waist") FROM stdin;
\.


--
-- Data for Name: whatsapp_flow_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."whatsapp_flow_templates" ("id", "user_id", "flow_key", "template_content", "created_at", "updated_at", "buttons", "media", "name", "status", "description") FROM stdin;
662cf0f2-53cb-4a27-8753-709f7777f08d	fe090720-f100-4977-ba2e-3702fa207e1e	weekly_review	📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}}\n\n🎯 יעדים:\nקלוריות: {{target_calories}} קק"ל\nחלבון: {{target_protein}} גרם\nסיבים: {{target_fiber}} גרם\nצעדים: {{target_steps}}\n\n📈 בפועל (ממוצע):\nקלוריות: {{actual_calories}} קק"ל\nמשקל ממוצע: {{actual_weight}} ק"ג	2026-01-19 12:55:54.964395+00	2026-01-27 19:09:17.733398+00	[]	\N	סיכום שבועי ויעדים	מוגדר	\N
e3e4a263-1a0f-4d6d-87ea-478f5aa46822	50668840-6376-4411-9dc4-b7606ead34ef	weekly_review	<p>📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}} 🎯 יעדים: קלוריות: {{target_calories}} קק"ל חלבון: {{target_protein}} גרם סיבים: {{target_fiber}} גרם צעדים: {{target_steps}} 📈 בפועל (ממוצע): קלוריות: {{actual_calories}} קק"ל משקל ממוצע: {{actual_weight}} ק"ג</p>	2026-01-19 12:55:54.964395+00	2026-01-29 23:05:09.48052+00	[]	\N	סיכום שבועי ויעדים	מוגדר	\N
3abb8856-f9e7-4013-9608-7a68b54c0eca	6a718dbd-0fa3-4e93-bc64-f2ad3116bc63	weekly_review	📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}}\n\n🎯 יעדים:\nקלוריות: {{target_calories}} קק"ל\nחלבון: {{target_protein}} גרם\nסיבים: {{target_fiber}} גרם\nצעדים: {{target_steps}}\n\n📈 בפועל (ממוצע):\nקלוריות: {{actual_calories}} קק"ל\nמשקל ממוצע: {{actual_weight}} ק"ג	2026-01-19 12:55:54.964395+00	2026-01-27 19:09:17.733398+00	[]	\N	סיכום שבועי ויעדים	מוגדר	\N
f29db1e9-caa0-44ca-b929-946f58e60802	50668840-6376-4411-9dc4-b7606ead34ef	trainee_user_credentials	<p>היי {{name}}, </p><p>חשבון המשתמש שלך נוצר בהצלחה במערכת הצ'ק אין! </p><p>אלו הם פרטי הכניסה שלך: </p><p>📧 אימייל: {{email}} </p><p>🔑 סיסמה: {{password}} </p><p>ניתן להתחבר בכתובת: {{login_url}} </p><p><br></p><p>דרך המערכת הזו תמלאי את פרטי הצ'ק אין השבועיים, תוכלי למצוא את התקציבים וההנחיות שלך, תוכנית האימונים ועוד</p><p><br></p><p>נטע </p>	2026-01-19 15:12:37.383632+00	2026-01-29 23:00:55.749048+00	[]	\N	שליחת פרטי משתמש	מוגדר	\N
31ae53d0-fbc2-4b5a-89e3-2eaa1f9c20c0	50668840-6376-4411-9dc4-b7606ead34ef	intro_questionnaire	<p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">איזה כיף שקבענו שיחה! 🙌</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">מחכה כבר להכיר אותך ולשמוע ממך באופן אישי.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">כדי שנוכל לנצל את הזמן בצורה הכי מדויקת </span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">אשמח שתמלאי את השאלון הזה מראש.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">זה יעזור לי להבין מי את, איפה את נמצאת, ומה את באמת צריכה </span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">כדי שאוכל להקשיב, לשאול את השאלות הנכונות ולוודא שהליווי האישי אכן מתאים עבורך</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">📄 הנה הקישור לשאלון:</span></p><p>https://dietneta.fillout.com/1on1premiumform</p><p><br></p><p>אשמח שתעדכני אותי אחרי שמילאת אותו בהודעה חוזרת</p><p>תודה ונשתמע בקרוב</p><p>נטע</p>	2026-01-14 01:46:52.203463+00	2026-01-29 23:01:33.550878+00	[]	\N	אוטומטי שליחת שאלון הכרות לאחר קביעת שיחה	מוגדר	\N
0fb34729-2153-44d1-b862-d4b624b74f7d	50668840-6376-4411-9dc4-b7606ead34ef	payment_request	<p>היי {{name}}, </p><p><br></p><p>מצורף פה הלינק לתשלום עבור הליווי האישי</p><p>{{payment_link}} </p><p>אשמח שתעדכני אותי לאחר שהתשלום בוצע שאוכל לאשר שאני רואה גם אצלי</p><p><br></p><p>תודה,</p><p>נטע</p>	2026-01-19 15:12:37.17409+00	2026-01-29 23:04:57.513418+00	[]	\N	בקשת תשלום	מוגדר	\N
368983ae-91f5-4e42-a850-0208f9b63169	50668840-6376-4411-9dc4-b7606ead34ef	customer_journey_start	<p>היי, תודה שפנית והתעניינת בתהליך הליווי האישי 🙏</p><p><br></p><p>&nbsp;אני מלווה נשים שמוכנות לקחת צעד משמעותי בדרך שלהן.</p><p>תהליך עמוק, אישי, שמותאם בדיוק למי שאת ולמה שאת צריכה עכשיו.</p><p><br></p><p>כדי להבין אם זה אכן הדבר המדויק עבורך, אני מזמינה אותך לתאם איתי שיחת היכרות.</p><p><br></p><p>בשיחה נדבר בגובה העיניים, אכיר אותך לעומק, אספר איך הליווי מתנהל, ונוכל לבדוק יחד אם זה באמת תפור למידות שלך.</p><p><br></p><p>חשוב לי לציין שהתהליך פתוח רק למספר מוגבל של נשים בכל שלב, אז אם את מרגישה שזה מדבר אלייך, כדאי לתפוס מקום לשיחה כשהיומן עדיין פתוח.</p><p><br></p><p><br></p><p>💬 לתיאום השיחה, לחצי כאן ובחרי זמן שנוח לך:</p><p><br></p><p>https://dietneta.fillout.com/-open-meeting?lead_id={{lead_id}}</p><p><br></p><p>למילוי פרטים:</p><p>https://dietneta.fillout.com/priorcall?lead_id={{lead_id}}</p>	2026-01-14 01:48:27.045165+00	2026-01-28 16:22:58.044126+00	[]	\N	תחילת מסע לקוח ותיאום פגישה	מוגדר	\N
da3e3a7e-7799-4361-bde0-396919e3dadd	50668840-6376-4411-9dc4-b7606ead34ef	budget	<p>הי {{name}}</p><p><br></p><p>התקציב האישי שלך מוכן עבורך,</p><p>תוכלי למצוא את כל הנתונים במערכת הצק' אין</p><p><br></p>	2026-01-29 23:02:51.824534+00	2026-01-29 23:02:51.824534+00	[]	\N	\N	מוגדר	\N
\.


--
-- Data for Name: workout_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."workout_plans" ("id", "user_id", "lead_id", "start_date", "description", "strength", "cardio", "intervals", "custom_attributes", "created_at", "updated_at", "created_by", "template_id", "is_active", "deleted_at", "customer_id", "budget_id", "name") FROM stdin;
80ec9e9b-db12-4f3a-be92-84ae6983d07e	50668840-6376-4411-9dc4-b7606ead34ef	53d28a1c-321f-40d9-8375-a527456a27d5	2026-01-20	תוכנית אימונים מתקציב: כככ	0	0	0	{"data": {"weeklyWorkout": {"days": {"friday": {"day": "friday", "isActive": false, "exercises": []}, "monday": {"day": "monday", "isActive": false, "exercises": []}, "sunday": {"day": "sunday", "isActive": true, "exercises": [{"id": "1768946436759-0.28402187621147057", "name": "גדכדג", "reps": 10, "sets": 3}, {"id": "1768946454713-0.4004387696292534", "name": "ספסל לחיצה", "reps": 8, "sets": 4}, {"id": "1768946454713-0.9199210131944925", "name": "לחיצת כתפיים", "reps": 10, "sets": 3}, {"id": "1768946454713-0.6136195738413109", "name": "דיפים", "reps": 12, "sets": 3}, {"id": "1768946454713-0.1684890227843283", "name": "טריצפס", "reps": 12, "sets": 3}, {"id": "1768946458321-0.6911141340853347", "name": "ספסל לחיצה", "reps": 8, "sets": 4}, {"id": "1768946458321-0.5306429205092226", "name": "לחיצת כתפיים", "reps": 10, "sets": 3}, {"id": "1768946458321-0.6038593862366576", "name": "דיפים", "reps": 12, "sets": 3}, {"id": "1768946458321-0.480898070299403", "name": "טריצפס", "reps": 12, "sets": 3}]}, "tuesday": {"day": "tuesday", "isActive": false, "exercises": []}, "saturday": {"day": "saturday", "isActive": false, "exercises": []}, "thursday": {"day": "thursday", "isActive": false, "exercises": []}, "wednesday": {"day": "wednesday", "isActive": false, "exercises": []}}, "startDate": "2026-01-21", "stepsGoal": 0, "description": "", "generalGoals": ""}}, "schema": []}	2026-01-20 22:04:50.461347+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef	6e717bed-c709-47d3-9688-fdd3f137f0e7	t	\N	af7bdb9d-65aa-45b0-be2b-007ea60ae134	\N	\N
18a19af9-a540-477d-a3d5-65ade6b623c4	50668840-6376-4411-9dc4-b7606ead34ef	10827900-0971-4a59-9611-9f8fb929182e	2026-01-21	תוכנית אימונים מתקציב: תקציב לנטע	0	0	0	{"data": {"weeklyWorkout": {"days": {"friday": {"day": "friday", "isActive": false, "exercises": []}, "monday": {"day": "monday", "isActive": true, "exercises": [{"id": "1769021592471-0.016841179009880247", "name": "סקווטים", "reps": 10, "sets": 3, "image_url": "https://www.youtube.com/watch?v=sBJppqCeFGI"}, {"id": "1769021648081-0.94583902367398", "name": "עעעעע", "reps": 9, "sets": 3}, {"id": "1769021654703-0.02306508014809061", "name": "כעיכע", "reps": 10, "sets": 3}]}, "sunday": {"day": "sunday", "isActive": false, "exercises": []}, "tuesday": {"day": "tuesday", "isActive": false, "exercises": []}, "saturday": {"day": "saturday", "isActive": false, "exercises": []}, "thursday": {"day": "thursday", "isActive": false, "exercises": []}, "wednesday": {"day": "wednesday", "isActive": false, "exercises": []}}, "startDate": "2026-01-21", "stepsGoal": 0, "description": "תוכנית לנשים רזות כבר ", "generalGoals": ""}}, "schema": []}	2026-01-21 19:00:14.010115+00	2026-01-29 23:05:30.904+00	50668840-6376-4411-9dc4-b7606ead34ef	\N	t	\N	f379a13d-19c9-4338-a0fd-df07cb597f5e	\N	\N
\.


--
-- Data for Name: schema_migrations; Type: TABLE DATA; Schema: supabase_migrations; Owner: postgres
--

COPY "supabase_migrations"."schema_migrations" ("version", "statements", "name") FROM stdin;
20240001	{"-- =====================================================\n-- Initial Schema Migration for Diet Neta CRM\n-- Created: 2024-01-01\n-- Description: Production-ready schema with RLS, JSONB flexibility, and auto-triggers\n-- =====================================================\n\n-- =====================================================\n-- 1. EXTENSIONS\n-- =====================================================\n\n-- Note: gen_random_uuid() is built into PostgreSQL 13+ and doesn't require an extension\n\n-- =====================================================\n-- 2. UTILITY FUNCTIONS\n-- =====================================================\n\n-- Generic function to automatically update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = NOW();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- =====================================================\n-- 3. TABLE: profiles\n-- =====================================================\n\n-- Profiles table links to auth.users and manages user roles\nCREATE TABLE IF NOT EXISTS profiles (\n    id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,\n    email TEXT NOT NULL,\n    full_name TEXT,\n    role TEXT NOT NULL DEFAULT 'user' CHECK (role IN ('admin', 'user')),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL\n)","-- Index for faster role lookups\nCREATE INDEX IF NOT EXISTS idx_profiles_role ON profiles(role)","CREATE INDEX IF NOT EXISTS idx_profiles_email ON profiles(email)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_profiles_updated_at\n    BEFORE UPDATE ON profiles\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- Function to automatically create profile when user signs up\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER AS $$\nBEGIN\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (\n        NEW.id,\n        NEW.email,\n        COALESCE(NEW.raw_user_meta_data->>'full_name', ''),\n        COALESCE(NEW.raw_user_meta_data->>'role', 'user')\n    );\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Trigger to call handle_new_user when a new user is created in auth.users\nCREATE TRIGGER on_auth_user_created\n    AFTER INSERT ON auth.users\n    FOR EACH ROW\n    EXECUTE FUNCTION public.handle_new_user()","-- =====================================================\n-- 4. TABLE: leads (The Central Entity)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS leads (\n    -- Meta Data\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    assigned_to UUID REFERENCES profiles(id) ON DELETE SET NULL,\n    \n    -- Personal Info\n    full_name TEXT NOT NULL,\n    phone TEXT UNIQUE NOT NULL,\n    email TEXT,\n    city TEXT,\n    birth_date DATE,\n    gender TEXT CHECK (gender IN ('male', 'female', 'other')) DEFAULT NULL,\n    \n    -- Status Management\n    status_main TEXT,\n    status_sub TEXT,\n    \n    -- Physical Metrics\n    height DECIMAL(5, 2), -- in cm\n    weight DECIMAL(5, 2), -- in kg\n    bmi DECIMAL(4, 2), -- calculated or stored\n    \n    -- Business/Subscription\n    join_date TIMESTAMP WITH TIME ZONE,\n    subscription_data JSONB DEFAULT '{}'::jsonb,\n    \n    -- Dynamic Data Columns (JSONB for flexibility)\n    daily_protocol JSONB DEFAULT '{}'::jsonb,\n    -- Structure: { \\"stepsGoal\\": 8000, \\"workoutGoal\\": 3, \\"supplements\\": [\\"Omega 3\\", \\"Magnesium\\"] }\n    \n    workout_history JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ \\"name\\": \\"Plan A\\", \\"startDate\\": \\"2024-01-01\\", \\"validUntil\\": \\"2024-04-01\\", \n    --              \\"duration\\": \\"3 months\\", \\"description\\": \\"...\\", \n    --              \\"strengthCount\\": 3, \\"cardioCount\\": 1, \\"intervalsCount\\": 1 }]\n    \n    steps_history JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ \\"weekNumber\\": 1, \\"startDate\\": \\"2024-01-01\\", \\"endDate\\": \\"2024-01-07\\", \\"target\\": 7000 }]\n    \n    -- Additional fields from the application\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_leads_assigned_to ON leads(assigned_to)","CREATE INDEX IF NOT EXISTS idx_leads_status_main ON leads(status_main)","CREATE INDEX IF NOT EXISTS idx_leads_status_sub ON leads(status_sub)","CREATE INDEX IF NOT EXISTS idx_leads_phone ON leads(phone)","CREATE INDEX IF NOT EXISTS idx_leads_email ON leads(email)","CREATE INDEX IF NOT EXISTS idx_leads_created_at ON leads(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_leads_join_date ON leads(join_date)","-- GIN indexes for JSONB columns (enables fast queries on JSONB data)\nCREATE INDEX IF NOT EXISTS idx_leads_daily_protocol ON leads USING GIN (daily_protocol)","CREATE INDEX IF NOT EXISTS idx_leads_workout_history ON leads USING GIN (workout_history)","CREATE INDEX IF NOT EXISTS idx_leads_steps_history ON leads USING GIN (steps_history)","CREATE INDEX IF NOT EXISTS idx_leads_subscription_data ON leads USING GIN (subscription_data)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_leads_updated_at\n    BEFORE UPDATE ON leads\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- 5. ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on profiles table\nALTER TABLE profiles ENABLE ROW LEVEL SECURITY","-- Enable RLS on leads table\nALTER TABLE leads ENABLE ROW LEVEL SECURITY","-- =====================================================\n-- 6. RLS POLICIES: profiles\n-- =====================================================\n\n-- Policy: Users can read their own profile\nCREATE POLICY \\"Users can read own profile\\"\n    ON profiles FOR SELECT\n    USING (auth.uid() = id)","-- Policy: Users can update their own profile\nCREATE POLICY \\"Users can update own profile\\"\n    ON profiles FOR UPDATE\n    USING (auth.uid() = id)\n    WITH CHECK (auth.uid() = id)","-- Policy: Admins have full access to profiles\nCREATE POLICY \\"Admins have full access to profiles\\"\n    ON profiles FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- 7. RLS POLICIES: leads\n-- =====================================================\n\n-- Policy: Authenticated users can read all leads (adjust based on business logic)\nCREATE POLICY \\"Authenticated users can read leads\\"\n    ON leads FOR SELECT\n    USING (auth.role() = 'authenticated')","-- Policy: Authenticated users can insert leads\nCREATE POLICY \\"Authenticated users can insert leads\\"\n    ON leads FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","-- Policy: Users can update leads assigned to them\nCREATE POLICY \\"Users can update assigned leads\\"\n    ON leads FOR UPDATE\n    USING (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Admins have full access to leads\nCREATE POLICY \\"Admins have full access to leads\\"\n    ON leads FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Users can delete leads (only admins or assigned users)\nCREATE POLICY \\"Users can delete assigned leads\\"\n    ON leads FOR DELETE\n    USING (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- 8. HELPER FUNCTIONS (Optional but useful)\n-- =====================================================\n\n-- Function to calculate BMI (can be used in triggers or application layer)\nCREATE OR REPLACE FUNCTION calculate_bmi(height_cm DECIMAL, weight_kg DECIMAL)\nRETURNS DECIMAL AS $$\nBEGIN\n    IF height_cm IS NULL OR weight_kg IS NULL OR height_cm <= 0 OR weight_kg <= 0 THEN\n        RETURN NULL;\n    END IF;\n    -- BMI = weight (kg) / (height (m))^2\n    RETURN ROUND((weight_kg / POWER(height_cm / 100.0, 2))::DECIMAL, 2);\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE","-- Optional: Trigger to auto-calculate BMI when height or weight changes\nCREATE OR REPLACE FUNCTION update_lead_bmi()\nRETURNS TRIGGER AS $$\nBEGIN\n    IF NEW.height IS NOT NULL AND NEW.weight IS NOT NULL THEN\n        NEW.bmi = calculate_bmi(NEW.height, NEW.weight);\n    END IF;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","CREATE TRIGGER calculate_bmi_trigger\n    BEFORE INSERT OR UPDATE OF height, weight ON leads\n    FOR EACH ROW\n    EXECUTE FUNCTION update_lead_bmi()","-- =====================================================\n-- 9. COMMENTS (Documentation)\n-- =====================================================\n\nCOMMENT ON TABLE profiles IS 'User profiles linked to auth.users, manages roles and user metadata'","COMMENT ON TABLE leads IS 'Central entity for CRM leads/trainees with flexible JSONB columns for dynamic data'","COMMENT ON COLUMN leads.daily_protocol IS 'JSONB: { \\"stepsGoal\\": number, \\"workoutGoal\\": number, \\"supplements\\": string[] }'","COMMENT ON COLUMN leads.workout_history IS 'JSONB: Array of workout program objects with dates, splits, and descriptions'","COMMENT ON COLUMN leads.steps_history IS 'JSONB: Array of step tracking objects with week numbers, dates, and targets'","COMMENT ON COLUMN leads.subscription_data IS 'JSONB: Flexible subscription information including pricing and package details'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	initial_schema
20240102000000	{"-- =====================================================\n-- Ensure Leads Table Exists\n-- Created: 2024-01-02\n-- Description: This migration ensures the leads table exists\n--              and is properly accessible in the public schema\n-- =====================================================\n\n-- Ensure we're working in the public schema\nSET search_path TO public","-- Drop table if it exists (only if you want to recreate it)\n-- Uncomment the next line if you need to recreate the table\n-- DROP TABLE IF EXISTS leads CASCADE;\n\n-- Create the leads table if it doesn't exist\nCREATE TABLE IF NOT EXISTS public.leads (\n    -- Meta Data\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    assigned_to UUID REFERENCES public.profiles(id) ON DELETE SET NULL,\n    \n    -- Personal Info\n    full_name TEXT NOT NULL,\n    phone TEXT UNIQUE NOT NULL,\n    email TEXT,\n    city TEXT,\n    birth_date DATE,\n    gender TEXT CHECK (gender IN ('male', 'female', 'other')) DEFAULT NULL,\n    \n    -- Status Management\n    status_main TEXT,\n    status_sub TEXT,\n    \n    -- Physical Metrics\n    height DECIMAL(5, 2), -- in cm\n    weight DECIMAL(5, 2), -- in kg\n    bmi DECIMAL(4, 2), -- calculated or stored\n    \n    -- Business/Subscription\n    join_date TIMESTAMP WITH TIME ZONE,\n    subscription_data JSONB DEFAULT '{}'::jsonb,\n    \n    -- Dynamic Data Columns (JSONB for flexibility)\n    daily_protocol JSONB DEFAULT '{}'::jsonb,\n    workout_history JSONB DEFAULT '[]'::jsonb,\n    steps_history JSONB DEFAULT '[]'::jsonb,\n    \n    -- Additional fields from the application\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT\n)","-- Ensure the table is in the public schema\nALTER TABLE IF EXISTS public.leads SET SCHEMA public","-- Grant necessary permissions\nGRANT ALL ON public.leads TO authenticated","GRANT ALL ON public.leads TO anon","GRANT ALL ON public.leads TO service_role","-- Create indexes if they don't exist\nCREATE INDEX IF NOT EXISTS idx_leads_assigned_to ON public.leads(assigned_to)","CREATE INDEX IF NOT EXISTS idx_leads_status_main ON public.leads(status_main)","CREATE INDEX IF NOT EXISTS idx_leads_status_sub ON public.leads(status_sub)","CREATE INDEX IF NOT EXISTS idx_leads_phone ON public.leads(phone)","CREATE INDEX IF NOT EXISTS idx_leads_email ON public.leads(email)","CREATE INDEX IF NOT EXISTS idx_leads_created_at ON public.leads(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_leads_join_date ON public.leads(join_date)","-- GIN indexes for JSONB columns\nCREATE INDEX IF NOT EXISTS idx_leads_daily_protocol ON public.leads USING GIN (daily_protocol)","CREATE INDEX IF NOT EXISTS idx_leads_workout_history ON public.leads USING GIN (workout_history)","CREATE INDEX IF NOT EXISTS idx_leads_steps_history ON public.leads USING GIN (steps_history)","CREATE INDEX IF NOT EXISTS idx_leads_subscription_data ON public.leads USING GIN (subscription_data)","-- Ensure the update_updated_at_column function exists\nCREATE OR REPLACE FUNCTION public.update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = NOW();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger for auto-updating updated_at\nDROP TRIGGER IF EXISTS update_leads_updated_at ON public.leads","CREATE TRIGGER update_leads_updated_at\n    BEFORE UPDATE ON public.leads\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Ensure BMI calculation function exists\nCREATE OR REPLACE FUNCTION public.calculate_bmi(height_cm DECIMAL, weight_kg DECIMAL)\nRETURNS DECIMAL AS $$\nBEGIN\n    IF height_cm IS NULL OR weight_kg IS NULL OR height_cm <= 0 OR weight_kg <= 0 THEN\n        RETURN NULL;\n    END IF;\n    RETURN ROUND((weight_kg / POWER(height_cm / 100.0, 2))::DECIMAL, 2);\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE","-- Create trigger for auto-calculating BMI\nDROP TRIGGER IF EXISTS calculate_bmi_trigger ON public.leads","CREATE OR REPLACE FUNCTION public.update_lead_bmi()\nRETURNS TRIGGER AS $$\nBEGIN\n    IF NEW.height IS NOT NULL AND NEW.weight IS NOT NULL THEN\n        NEW.bmi = public.calculate_bmi(NEW.height, NEW.weight);\n    END IF;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","CREATE TRIGGER calculate_bmi_trigger\n    BEFORE INSERT OR UPDATE OF height, weight ON public.leads\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_lead_bmi()","-- Enable RLS\nALTER TABLE public.leads ENABLE ROW LEVEL SECURITY","-- Drop existing policies if they exist (to avoid conflicts)\nDROP POLICY IF EXISTS \\"Authenticated users can read leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Authenticated users can insert leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Users can update assigned leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Admins have full access to leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Users can delete assigned leads\\" ON public.leads","-- Recreate RLS policies\nCREATE POLICY \\"Authenticated users can read leads\\"\n    ON public.leads FOR SELECT\n    USING (auth.role() = 'authenticated')","CREATE POLICY \\"Authenticated users can insert leads\\"\n    ON public.leads FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","CREATE POLICY \\"Users can update assigned leads\\"\n    ON public.leads FOR UPDATE\n    USING (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","CREATE POLICY \\"Admins have full access to leads\\"\n    ON public.leads FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","CREATE POLICY \\"Users can delete assigned leads\\"\n    ON public.leads FOR DELETE\n    USING (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Add comment for documentation\nCOMMENT ON TABLE public.leads IS 'Central entity for CRM leads/trainees with flexible JSONB columns for dynamic data'"}	ensure_leads_table
20240102000001	{"-- =====================================================\n-- Fix RLS Infinite Recursion Issue\n-- Created: 2024-01-02\n-- Description: Fixes the infinite recursion in profiles RLS policies\n-- =====================================================\n\n-- Drop the problematic admin policy on profiles that causes recursion\nDROP POLICY IF EXISTS \\"Admins have full access to profiles\\" ON public.profiles","-- Create a security definer function to check admin role (bypasses RLS)\nCREATE OR REPLACE FUNCTION public.is_admin(user_id UUID)\nRETURNS BOOLEAN AS $$\nBEGIN\n    RETURN EXISTS (\n        SELECT 1 FROM public.profiles\n        WHERE id = user_id AND role = 'admin'\n    );\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Recreate the admin policy using the function (avoids recursion)\nCREATE POLICY \\"Admins have full access to profiles\\"\n    ON public.profiles FOR ALL\n    USING (public.is_admin(auth.uid()))\n    WITH CHECK (public.is_admin(auth.uid()))","-- Also fix the leads policies to use the function\nDROP POLICY IF EXISTS \\"Users can update assigned leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Admins have full access to leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Users can delete assigned leads\\" ON public.leads","-- Recreate leads policies using the function\nCREATE POLICY \\"Users can update assigned leads\\"\n    ON public.leads FOR UPDATE\n    USING (\n        assigned_to = auth.uid() OR\n        public.is_admin(auth.uid())\n    )\n    WITH CHECK (\n        assigned_to = auth.uid() OR\n        public.is_admin(auth.uid())\n    )","CREATE POLICY \\"Admins have full access to leads\\"\n    ON public.leads FOR ALL\n    USING (public.is_admin(auth.uid()))\n    WITH CHECK (public.is_admin(auth.uid()))","CREATE POLICY \\"Users can delete assigned leads\\"\n    ON public.leads FOR DELETE\n    USING (\n        assigned_to = auth.uid() OR\n        public.is_admin(auth.uid())\n    )","-- For local development, also allow anonymous access to insert leads\n-- (Remove this in production or adjust based on your needs)\nDROP POLICY IF EXISTS \\"Allow anonymous insert leads\\" ON public.leads","CREATE POLICY \\"Allow anonymous insert leads\\"\n    ON public.leads FOR INSERT\n    TO anon\n    WITH CHECK (true)","DROP POLICY IF EXISTS \\"Allow anonymous read leads\\" ON public.leads","CREATE POLICY \\"Allow anonymous read leads\\"\n    ON public.leads FOR SELECT\n    TO anon\n    USING (true)"}	fix_rls_recursion
20240102000002	{"-- =====================================================\n-- Workout Plans Migration\n-- Created: 2024-01-02\n-- Description: User workout plans with dynamic custom attributes\n-- =====================================================\n\n-- =====================================================\n-- TABLE: workout_plans\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS workout_plans (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    description TEXT,\n    \n    -- Metric columns\n    strength INTEGER DEFAULT 0,\n    cardio INTEGER DEFAULT 0,\n    intervals INTEGER DEFAULT 0,\n    \n    -- Dynamic custom attributes (JSONB)\n    -- Structure: { \\"schema\\": [{ \\"fieldName\\": \\"string\\", \\"fieldType\\": \\"text|number|date|boolean\\" }], \\"data\\": { \\"fieldName\\": \\"value\\" } }\n    custom_attributes JSONB DEFAULT '{\\"schema\\": [], \\"data\\": {}}'::jsonb,\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_workout_plans_user_id ON workout_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_workout_plans_lead_id ON workout_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_workout_plans_start_date ON workout_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_workout_plans_created_at ON workout_plans(created_at DESC)","-- GIN index for JSONB column (enables fast queries on JSONB data)\nCREATE INDEX IF NOT EXISTS idx_workout_plans_custom_attributes ON workout_plans USING GIN (custom_attributes)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_workout_plans_updated_at\n    BEFORE UPDATE ON workout_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on workout_plans table\nALTER TABLE workout_plans ENABLE ROW LEVEL SECURITY","-- Policy: Users can read their own workout plans\nCREATE POLICY \\"Users can read own workout plans\\"\n    ON workout_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own workout plans\nCREATE POLICY \\"Users can insert own workout plans\\"\n    ON workout_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own workout plans\nCREATE POLICY \\"Users can update own workout plans\\"\n    ON workout_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own workout plans\nCREATE POLICY \\"Users can delete own workout plans\\"\n    ON workout_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to workout plans\nCREATE POLICY \\"Admins have full access to workout plans\\"\n    ON workout_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )"}	workout_plans
20240102000003	{"-- =====================================================\n-- Remove Weight and RPE from Workout Plans\n-- Created: 2024-01-02\n-- Description: Clean up JSONB data to remove weight and rpe fields from exercises\n-- =====================================================\n\n-- Update existing workout plans to remove weight and rpe from exercises in JSONB\n-- This function processes each workout plan and removes weight/rpe from all exercises\nDO $$\nDECLARE\n    plan_record RECORD;\n    updated_days JSONB;\n    day_key TEXT;\n    day_data JSONB;\n    updated_exercises JSONB;\n    exercise JSONB;\nBEGIN\n    FOR plan_record IN \n        SELECT id, custom_attributes \n        FROM workout_plans \n        WHERE custom_attributes->'data'->'weeklyWorkout'->'days' IS NOT NULL\n    LOOP\n        updated_days := '{}'::JSONB;\n        \n        -- Process each day\n        FOR day_key, day_data IN \n            SELECT * FROM jsonb_each(plan_record.custom_attributes->'data'->'weeklyWorkout'->'days')\n        LOOP\n            -- Process exercises in this day - remove weight and rpe fields\n            updated_exercises := (\n                SELECT jsonb_agg(exercise - 'weight' - 'rpe')\n                FROM jsonb_array_elements(day_data->'exercises') AS exercise\n            );\n            \n            -- Update day with cleaned exercises\n            day_data := jsonb_set(day_data, '{exercises}', COALESCE(updated_exercises, '[]'::JSONB));\n            updated_days := updated_days || jsonb_build_object(day_key, day_data);\n        END LOOP;\n        \n        -- Update the workout plan\n        UPDATE workout_plans\n        SET custom_attributes = jsonb_set(\n            plan_record.custom_attributes,\n            '{data,weeklyWorkout,days}',\n            updated_days\n        )\n        WHERE id = plan_record.id;\n    END LOOP;\nEND $$","-- Note: Since weight and rpe are stored in JSONB (not as table columns),\n-- we only need to clean the JSONB data. No columns need to be dropped from the table."}	remove_weight_rpe_from_workout_plans
20240102000004	{"-- =====================================================\n-- Saved Views Migration\n-- Created: 2024-01-02\n-- Description: Table for storing user-defined saved views/filters for resources\n-- =====================================================\n\n-- =====================================================\n-- TABLE: saved_views\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS saved_views (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    resource_key TEXT NOT NULL CHECK (resource_key IN ('leads', 'workouts', 'customers')),\n    view_name TEXT NOT NULL,\n    filter_config JSONB NOT NULL DEFAULT '{}'::JSONB,\n    is_default BOOLEAN NOT NULL DEFAULT FALSE,\n    created_by UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Ensure unique view names per resource per user\n    CONSTRAINT unique_view_name_per_resource_user \n        UNIQUE (resource_key, created_by, view_name)\n)","-- Indexes for faster queries\nCREATE INDEX IF NOT EXISTS idx_saved_views_resource_key ON saved_views(resource_key)","CREATE INDEX IF NOT EXISTS idx_saved_views_created_by ON saved_views(created_by)","CREATE INDEX IF NOT EXISTS idx_saved_views_resource_user ON saved_views(resource_key, created_by)","CREATE INDEX IF NOT EXISTS idx_saved_views_default ON saved_views(resource_key, created_by, is_default) WHERE is_default = TRUE","-- Unique partial index to ensure only one default view per resource per user\nCREATE UNIQUE INDEX IF NOT EXISTS idx_saved_views_unique_default \n    ON saved_views(resource_key, created_by) \n    WHERE is_default = TRUE","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_saved_views_updated_at\n    BEFORE UPDATE ON saved_views\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS)\n-- =====================================================\n\n-- Enable RLS\nALTER TABLE saved_views ENABLE ROW LEVEL SECURITY","-- Policy: Users can view their own saved views\nCREATE POLICY \\"Users can view their own saved views\\"\n    ON saved_views\n    FOR SELECT\n    USING (auth.uid() = created_by)","-- Policy: Users can insert their own saved views\nCREATE POLICY \\"Users can insert their own saved views\\"\n    ON saved_views\n    FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own saved views\nCREATE POLICY \\"Users can update their own saved views\\"\n    ON saved_views\n    FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own saved views\nCREATE POLICY \\"Users can delete their own saved views\\"\n    ON saved_views\n    FOR DELETE\n    USING (auth.uid() = created_by)","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE saved_views IS 'User-defined saved views/filters for different resources (leads, workouts, etc.)'","COMMENT ON COLUMN saved_views.resource_key IS 'The resource type this view applies to (e.g., \\"leads\\", \\"workouts\\")'","COMMENT ON COLUMN saved_views.view_name IS 'User-friendly name for the saved view'","COMMENT ON COLUMN saved_views.filter_config IS 'JSONB object storing the complete filter/sort state for this view'","COMMENT ON COLUMN saved_views.is_default IS 'Whether this is the default view for the resource (only one default per resource per user)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	saved_views
20240102000005	{"-- =====================================================\n-- Workout Templates Migration\n-- Created: 2024-01-02\n-- Description: Reusable workout templates that can be imported by users\n-- =====================================================\n\n-- =====================================================\n-- TABLE: workout_templates\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS workout_templates (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name TEXT NOT NULL,\n    description TEXT,\n    goal_tags TEXT[] DEFAULT '{}',\n    routine_data JSONB NOT NULL DEFAULT '{}'::jsonb,\n    is_public BOOLEAN NOT NULL DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_workout_templates_created_by ON workout_templates(created_by)","CREATE INDEX IF NOT EXISTS idx_workout_templates_is_public ON workout_templates(is_public)","CREATE INDEX IF NOT EXISTS idx_workout_templates_goal_tags ON workout_templates USING GIN (goal_tags)","CREATE INDEX IF NOT EXISTS idx_workout_templates_routine_data ON workout_templates USING GIN (routine_data)","CREATE INDEX IF NOT EXISTS idx_workout_templates_created_at ON workout_templates(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_workout_templates_updated_at\n    BEFORE UPDATE ON workout_templates\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on workout_templates table\nALTER TABLE workout_templates ENABLE ROW LEVEL SECURITY","-- Policy: Users can view public templates or their own templates\nCREATE POLICY \\"Users can view public or own templates\\"\n    ON workout_templates FOR SELECT\n    USING (\n        is_public = TRUE OR \n        created_by = auth.uid()\n    )","-- Policy: Users can insert their own templates\nCREATE POLICY \\"Users can insert own templates\\"\n    ON workout_templates FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own templates\nCREATE POLICY \\"Users can update own templates\\"\n    ON workout_templates FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own templates\nCREATE POLICY \\"Users can delete own templates\\"\n    ON workout_templates FOR DELETE\n    USING (auth.uid() = created_by)","-- Policy: Admins have full access to templates\nCREATE POLICY \\"Admins have full access to templates\\"\n    ON workout_templates FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE workout_templates IS 'Reusable workout templates that can be imported by users to create workout plans'","COMMENT ON COLUMN workout_templates.name IS 'Template name'","COMMENT ON COLUMN workout_templates.description IS 'Template description'","COMMENT ON COLUMN workout_templates.goal_tags IS 'Array of goal tags (e.g., [\\"חיטוב\\", \\"כוח\\", \\"סיבולת\\"])'","COMMENT ON COLUMN workout_templates.routine_data IS 'JSONB containing the workout routine data (matches workout_plans.custom_attributes.data.weeklyWorkout schema)'","COMMENT ON COLUMN workout_templates.is_public IS 'Whether the template is publicly visible to all users'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	workout_templates
20240102000006	{"-- =====================================================\n-- Add 'templates' to saved_views resource_key constraint\n-- Created: 2024-01-02\n-- Description: Allow saved views for workout templates\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'templates'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_templates_to_saved_views
20240102000007	{"-- =====================================================\n-- Add template_id to workout_plans\n-- Created: 2024-01-02\n-- Description: Track which template a workout plan was created from (reference only, snapshot pattern maintained)\n-- =====================================================\n\n-- Add template_id column (nullable, just for reference)\nALTER TABLE workout_plans\nADD COLUMN IF NOT EXISTS template_id UUID REFERENCES workout_templates(id) ON DELETE SET NULL","-- Create index for performance\nCREATE INDEX IF NOT EXISTS idx_workout_plans_template_id ON workout_plans(template_id)","-- Note: This is a reference only. The actual routine_data is stored in workout_plans.custom_attributes\n-- When a template is changed, existing workout_plans remain independent (snapshot pattern)"}	add_template_id_to_workout_plans
20240102000008	{"-- =====================================================\n-- Nutrition Templates Migration\n-- Created: 2024-01-02\n-- Description: Reusable nutrition templates for macro-nutrient planning and calculation\n-- =====================================================\n\n-- =====================================================\n-- TABLE: nutrition_templates\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS nutrition_templates (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name TEXT NOT NULL,\n    description TEXT,\n    targets JSONB NOT NULL DEFAULT '{}'::jsonb,\n    -- Structure: { calories: number, protein: number, carbs: number, fat: number, fiber: number }\n    is_public BOOLEAN NOT NULL DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_nutrition_templates_created_by ON nutrition_templates(created_by)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_is_public ON nutrition_templates(is_public)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_targets ON nutrition_templates USING GIN (targets)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_created_at ON nutrition_templates(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_nutrition_templates_updated_at\n    BEFORE UPDATE ON nutrition_templates\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on nutrition_templates table\nALTER TABLE nutrition_templates ENABLE ROW LEVEL SECURITY","-- Policy: Users can view public templates or their own templates\nCREATE POLICY \\"Users can view public or own nutrition templates\\"\n    ON nutrition_templates FOR SELECT\n    USING (\n        is_public = TRUE OR \n        created_by = auth.uid()\n    )","-- Policy: Users can insert their own templates\nCREATE POLICY \\"Users can insert own nutrition templates\\"\n    ON nutrition_templates FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own templates\nCREATE POLICY \\"Users can update own nutrition templates\\"\n    ON nutrition_templates FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own templates\nCREATE POLICY \\"Users can delete own nutrition templates\\"\n    ON nutrition_templates FOR DELETE\n    USING (auth.uid() = created_by)","-- Policy: Admins have full access to templates\nCREATE POLICY \\"Admins have full access to nutrition templates\\"\n    ON nutrition_templates FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE nutrition_templates IS 'Reusable nutrition templates for macro-nutrient planning and calculation'","COMMENT ON COLUMN nutrition_templates.name IS 'Template name'","COMMENT ON COLUMN nutrition_templates.description IS 'Template description'","COMMENT ON COLUMN nutrition_templates.targets IS 'JSONB containing macro targets: { calories: number, protein: number, carbs: number, fat: number, fiber: number }'","COMMENT ON COLUMN nutrition_templates.is_public IS 'Whether the template is publicly visible to all users'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	nutrition_templates
20240102000009	{"-- =====================================================\n-- Nutrition Plans Migration\n-- Created: 2024-01-02\n-- Description: User nutrition plans linked to leads (snapshot pattern - independent from templates)\n-- =====================================================\n\n-- =====================================================\n-- TABLE: nutrition_plans\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS nutrition_plans (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    template_id UUID REFERENCES nutrition_templates(id) ON DELETE SET NULL,\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    description TEXT,\n    \n    -- Nutrition targets (snapshot - independent from template)\n    -- Structure: { calories: number, protein: number, carbs: number, fat: number, fiber: number }\n    targets JSONB NOT NULL DEFAULT '{}'::jsonb,\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_nutrition_plans_user_id ON nutrition_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_lead_id ON nutrition_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_template_id ON nutrition_plans(template_id)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_start_date ON nutrition_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_created_at ON nutrition_plans(created_at DESC)","-- GIN index for JSONB column (enables fast queries on JSONB data)\nCREATE INDEX IF NOT EXISTS idx_nutrition_plans_targets ON nutrition_plans USING GIN (targets)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_nutrition_plans_updated_at\n    BEFORE UPDATE ON nutrition_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on nutrition_plans table\nALTER TABLE nutrition_plans ENABLE ROW LEVEL SECURITY","-- Policy: Users can read their own nutrition plans\nCREATE POLICY \\"Users can read own nutrition plans\\"\n    ON nutrition_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own nutrition plans\nCREATE POLICY \\"Users can insert own nutrition plans\\"\n    ON nutrition_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own nutrition plans\nCREATE POLICY \\"Users can update own nutrition plans\\"\n    ON nutrition_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own nutrition plans\nCREATE POLICY \\"Users can delete own nutrition plans\\"\n    ON nutrition_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to nutrition plans\nCREATE POLICY \\"Admins have full access to nutrition plans\\"\n    ON nutrition_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE nutrition_plans IS 'User nutrition plans linked to leads (snapshot pattern - independent from templates)'","COMMENT ON COLUMN nutrition_plans.lead_id IS 'Reference to the lead this plan is assigned to'","COMMENT ON COLUMN nutrition_plans.template_id IS 'Reference to the template this plan was created from (for tracking only, changes to template do not affect this plan)'","COMMENT ON COLUMN nutrition_plans.targets IS 'JSONB containing macro targets: { calories: number, protein: number, carbs: number, fat: number, fiber: number } - This is a snapshot, independent from the template'","COMMENT ON COLUMN nutrition_plans.start_date IS 'Date when the nutrition plan starts'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	nutrition_plans
20240102000010	{"-- =====================================================\n-- Add 'nutrition_templates' to saved_views resource_key constraint\n-- Created: 2024-01-02\n-- Description: Allow saved views for nutrition templates\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'nutrition_templates'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_nutrition_templates_to_saved_views
20240102000011	{"-- =====================================================\n-- Add history tracking to workout_plans\n-- Created: 2024-01-02\n-- Description: Add is_active and deleted_at fields to track workout plan history\n-- =====================================================\n\n-- Add is_active and deleted_at columns\nALTER TABLE workout_plans\n  ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true NOT NULL,\n  ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMP WITH TIME ZONE","-- Create index for active plans\nCREATE INDEX IF NOT EXISTS idx_workout_plans_is_active ON workout_plans(is_active) WHERE is_active = true","CREATE INDEX IF NOT EXISTS idx_workout_plans_deleted_at ON workout_plans(deleted_at) WHERE deleted_at IS NOT NULL","-- Update existing plans to be active\nUPDATE workout_plans SET is_active = true WHERE is_active IS NULL","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_workout_plan_history
20240102000012	{"-- =====================================================\n-- Normalize Database: Separate Customers from Leads\n-- Created: 2024-01-02\n-- Description: Create customers table and normalize leads table\n--              Decouple Identity (Customer) from Opportunity (Lead)\n--              Unique identifier: phone number\n-- =====================================================\n\n-- =====================================================\n-- STEP A: Create customers table\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS public.customers (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    full_name TEXT NOT NULL,\n    phone TEXT NOT NULL UNIQUE,\n    email TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL\n)","-- Create indexes for customers\nCREATE INDEX IF NOT EXISTS idx_customers_phone ON public.customers(phone)","CREATE INDEX IF NOT EXISTS idx_customers_email ON public.customers(email)","CREATE INDEX IF NOT EXISTS idx_customers_created_at ON public.customers(created_at DESC)","-- Create trigger for auto-updating updated_at\nCREATE TRIGGER update_customers_updated_at\n    BEFORE UPDATE ON public.customers\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS on customers table\nALTER TABLE public.customers ENABLE ROW LEVEL SECURITY","-- RLS Policies for customers\nDROP POLICY IF EXISTS \\"Authenticated users can read customers\\" ON public.customers","DROP POLICY IF EXISTS \\"Authenticated users can insert customers\\" ON public.customers","DROP POLICY IF EXISTS \\"Authenticated users can update customers\\" ON public.customers","DROP POLICY IF EXISTS \\"Admins have full access to customers\\" ON public.customers","CREATE POLICY \\"Authenticated users can read customers\\"\n    ON public.customers FOR SELECT\n    USING (auth.role() = 'authenticated')","CREATE POLICY \\"Authenticated users can insert customers\\"\n    ON public.customers FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","CREATE POLICY \\"Authenticated users can update customers\\"\n    ON public.customers FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","CREATE POLICY \\"Admins have full access to customers\\"\n    ON public.customers FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- STEP B: Data Migration (Backfill Script)\n-- =====================================================\n-- Since we're resetting the DB, this step is not needed\n-- But we'll include it for completeness in case of future migrations\n\n-- This would migrate existing data if needed:\n-- INSERT INTO public.customers (full_name, phone, email, created_at, updated_at)\n-- SELECT DISTINCT ON (phone)\n--     full_name,\n--     phone,\n--     email,\n--     MIN(created_at) as created_at,\n--     NOW() as updated_at\n-- FROM public.leads\n-- WHERE phone IS NOT NULL\n-- GROUP BY phone, full_name, email\n-- ON CONFLICT (phone) DO NOTHING;\n\n-- =====================================================\n-- STEP C: Update leads table\n-- =====================================================\n\n-- Add customer_id column\nALTER TABLE public.leads\n    ADD COLUMN IF NOT EXISTS customer_id UUID REFERENCES public.customers(id) ON DELETE CASCADE","-- Create index for customer_id\nCREATE INDEX IF NOT EXISTS idx_leads_customer_id ON public.leads(customer_id)","-- Link existing data (if any exists)\n-- UPDATE public.leads l\n-- SET customer_id = c.id\n-- FROM public.customers c\n-- WHERE l.phone = c.phone;\n\n-- Make customer_id NOT NULL (since we're resetting, we can set it immediately)\nALTER TABLE public.leads ALTER COLUMN customer_id SET NOT NULL","-- Remove old columns (since we're resetting, we can drop them immediately)\nALTER TABLE public.leads\n    DROP COLUMN IF EXISTS full_name,\n    DROP COLUMN IF EXISTS phone,\n    DROP COLUMN IF EXISTS email","-- Drop old indexes that are no longer needed\nDROP INDEX IF EXISTS public.idx_leads_phone","DROP INDEX IF EXISTS public.idx_leads_email","-- Add comment for documentation\nCOMMENT ON TABLE public.customers IS 'Customer identity table - unique by phone number'","COMMENT ON COLUMN public.customers.phone IS 'Unique identifier for customer identity'","COMMENT ON TABLE public.leads IS 'Lead/Opportunity table - linked to customers via customer_id'","COMMENT ON COLUMN public.leads.customer_id IS 'Foreign key to customers table - one customer can have many leads'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	normalize_customers_leads
20240102000013	{"-- =====================================================\n-- Add 'customers' to saved_views resource_key constraint\n-- Created: 2024-01-02\n-- Description: Allow saved views for customers\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'customers'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_customers_to_saved_views
20240102000014	{"-- =====================================================\n-- Service Data Relocation: Move Coaching Data from Leads to Customers\n-- Created: 2024-01-02\n-- Description: Relocate ownership of coaching data (Workouts, Nutrition, Steps, Measurements)\n--              from Lead entity to Customer entity\n-- Philosophy: Lead = Sales/CRM, Customer = Service/Coaching\n-- =====================================================\n\n-- =====================================================\n-- STEP A: Add customer_id to service tables\n-- =====================================================\n\n-- Add customer_id to workout_plans\nALTER TABLE workout_plans\n    ADD COLUMN IF NOT EXISTS customer_id UUID REFERENCES customers(id) ON DELETE CASCADE","-- Add customer_id to nutrition_plans\nALTER TABLE nutrition_plans\n    ADD COLUMN IF NOT EXISTS customer_id UUID REFERENCES customers(id) ON DELETE CASCADE","-- Create indexes for customer_id\nCREATE INDEX IF NOT EXISTS idx_workout_plans_customer_id ON workout_plans(customer_id)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_customer_id ON nutrition_plans(customer_id)","-- =====================================================\n-- STEP B: Migrate existing data (populate customer_id from lead_id)\n-- =====================================================\n\n-- Migrate workout_plans: Set customer_id based on lead_id -> customer_id relationship\nUPDATE workout_plans wp\nSET customer_id = l.customer_id\nFROM leads l\nWHERE wp.lead_id = l.id\n  AND wp.customer_id IS NULL\n  AND l.customer_id IS NOT NULL","-- Migrate nutrition_plans: Set customer_id based on lead_id -> customer_id relationship\nUPDATE nutrition_plans np\nSET customer_id = l.customer_id\nFROM leads l\nWHERE np.lead_id = l.id\n  AND np.customer_id IS NULL\n  AND l.customer_id IS NOT NULL","-- Handle orphaned records: Delete workout_plans that can't be linked to a customer\n-- (These are orphaned records with invalid lead_id references or NULL lead_id)\n-- First, try to find customer_id through any remaining valid lead relationships\nUPDATE workout_plans wp\nSET customer_id = l.customer_id\nFROM leads l\nWHERE wp.lead_id = l.id\n  AND wp.customer_id IS NULL\n  AND l.customer_id IS NOT NULL","-- Now delete any remaining orphaned records that still have NULL customer_id\nDELETE FROM workout_plans\nWHERE customer_id IS NULL","-- Handle orphaned records: Delete nutrition_plans that can't be linked to a customer\n-- First, try to find customer_id through any remaining valid lead relationships\nUPDATE nutrition_plans np\nSET customer_id = l.customer_id\nFROM leads l\nWHERE np.lead_id = l.id\n  AND np.customer_id IS NULL\n  AND l.customer_id IS NOT NULL","-- Now delete any remaining orphaned records that still have NULL customer_id\nDELETE FROM nutrition_plans\nWHERE customer_id IS NULL","-- =====================================================\n-- STEP C: Add coaching data columns to customers table\n-- =====================================================\n\n-- Add coaching data JSONB columns to customers\nALTER TABLE customers\n    ADD COLUMN IF NOT EXISTS daily_protocol JSONB DEFAULT '{}'::jsonb,\n    ADD COLUMN IF NOT EXISTS workout_history JSONB DEFAULT '[]'::jsonb,\n    ADD COLUMN IF NOT EXISTS steps_history JSONB DEFAULT '[]'::jsonb","-- Create GIN indexes for JSONB columns\nCREATE INDEX IF NOT EXISTS idx_customers_daily_protocol ON customers USING GIN (daily_protocol)","CREATE INDEX IF NOT EXISTS idx_customers_workout_history ON customers USING GIN (workout_history)","CREATE INDEX IF NOT EXISTS idx_customers_steps_history ON customers USING GIN (steps_history)","-- =====================================================\n-- STEP D: Migrate coaching data from leads to customers\n-- =====================================================\n\n-- Migrate daily_protocol, workout_history, steps_history from leads to customers\n-- Aggregate data per customer (in case of multiple leads per customer)\n-- Note: Since we're resetting the DB, this migration step is mainly for documentation\n-- In a production migration, you would aggregate data from all leads per customer\nUPDATE customers c\nSET \n    daily_protocol = COALESCE(\n        (SELECT daily_protocol FROM leads WHERE customer_id = c.id AND daily_protocol IS NOT NULL AND daily_protocol != '{}'::jsonb ORDER BY created_at DESC LIMIT 1),\n        '{}'::jsonb\n    ),\n    workout_history = COALESCE(\n        (\n            SELECT jsonb_agg(DISTINCT elem)\n            FROM leads l, jsonb_array_elements(l.workout_history) elem\n            WHERE l.customer_id = c.id \n              AND l.workout_history IS NOT NULL \n              AND l.workout_history != '[]'::jsonb\n        ),\n        '[]'::jsonb\n    ),\n    steps_history = COALESCE(\n        (\n            SELECT jsonb_agg(DISTINCT elem)\n            FROM leads l, jsonb_array_elements(l.steps_history) elem\n            WHERE l.customer_id = c.id \n              AND l.steps_history IS NOT NULL \n              AND l.steps_history != '[]'::jsonb\n        ),\n        '[]'::jsonb\n    )\nWHERE EXISTS (SELECT 1 FROM leads WHERE customer_id = c.id)","-- =====================================================\n-- STEP E: Make customer_id NOT NULL and deprecate lead_id\n-- =====================================================\n\n-- Verify all records have customer_id before setting NOT NULL\n-- (This should pass after orphaned records are deleted in Step B)\nDO $$\nBEGIN\n    -- Check for any remaining NULL customer_id values\n    IF EXISTS (SELECT 1 FROM workout_plans WHERE customer_id IS NULL) THEN\n        RAISE EXCEPTION 'Cannot set NOT NULL: workout_plans still contains NULL customer_id values. Please check orphaned records.';\n    END IF;\n    \n    IF EXISTS (SELECT 1 FROM nutrition_plans WHERE customer_id IS NULL) THEN\n        RAISE EXCEPTION 'Cannot set NOT NULL: nutrition_plans still contains NULL customer_id values. Please check orphaned records.';\n    END IF;\nEND $$","-- For workout_plans: Make customer_id required for new records (keep lead_id nullable for backward compatibility)\n-- Note: We keep lead_id for now but it's deprecated - new records should use customer_id\nALTER TABLE workout_plans\n    ALTER COLUMN customer_id SET NOT NULL","-- For nutrition_plans: Make customer_id required for new records\nALTER TABLE nutrition_plans\n    ALTER COLUMN customer_id SET NOT NULL","-- Drop the foreign key constraint on lead_id (we'll keep the column but remove the constraint)\n-- This allows us to keep historical data but prevents new relationships\nALTER TABLE workout_plans\n    DROP CONSTRAINT IF EXISTS workout_plans_lead_id_fkey","ALTER TABLE nutrition_plans\n    DROP CONSTRAINT IF EXISTS nutrition_plans_lead_id_fkey","-- Add comments to mark lead_id as deprecated\nCOMMENT ON COLUMN workout_plans.lead_id IS 'DEPRECATED: Use customer_id instead. This column is kept for historical data only.'","COMMENT ON COLUMN nutrition_plans.lead_id IS 'DEPRECATED: Use customer_id instead. This column is kept for historical data only.'","-- =====================================================\n-- STEP F: Update RLS policies to use customer_id\n-- =====================================================\n\n-- Note: RLS policies will need to be updated in application logic\n-- The policies currently check user_id, which is still valid\n-- We add customer-based policies for admin access\n\n-- Policy: Admins can read all workout plans by customer\nDROP POLICY IF EXISTS \\"Admins can read workout plans by customer\\" ON workout_plans","CREATE POLICY \\"Admins can read workout plans by customer\\"\n    ON workout_plans FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Admins can read all nutrition plans by customer\nDROP POLICY IF EXISTS \\"Admins can read nutrition plans by customer\\" ON nutrition_plans","CREATE POLICY \\"Admins can read nutrition plans by customer\\"\n    ON nutrition_plans FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- STEP G: Add comments for documentation\n-- =====================================================\n\nCOMMENT ON COLUMN customers.daily_protocol IS 'JSONB: { \\"stepsGoal\\": number, \\"workoutGoal\\": number, \\"supplements\\": string[] } - Coaching protocol data'","COMMENT ON COLUMN customers.workout_history IS 'JSONB: Array of workout program objects with dates, splits, and descriptions - Historical coaching data'","COMMENT ON COLUMN customers.steps_history IS 'JSONB: Array of step tracking objects with week numbers, dates, and targets - Historical coaching data'","COMMENT ON COLUMN workout_plans.customer_id IS 'Reference to the customer this workout plan belongs to (coaching data)'","COMMENT ON COLUMN nutrition_plans.customer_id IS 'Reference to the customer this nutrition plan belongs to (coaching data)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	relocate_service_data_to_customers
20240102000015	{"-- =====================================================\n-- Performance Optimization: Shift Left Strategy\n-- Created: 2024-01-02\n-- Description: Move filtering, calculations, and aggregations to PostgreSQL\n--              Replace client-side JS logic with database functions\n-- Philosophy: Database does the heavy lifting, frontend stays light\n-- =====================================================\n\n-- =====================================================\n-- STEP 1: Create Optimized Indexes (Strategic, not over-indexing)\n-- =====================================================\n\n-- Indexes for filtering columns (most common filters)\nCREATE INDEX IF NOT EXISTS idx_leads_status_main ON public.leads(status_main) WHERE status_main IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_status_sub ON public.leads(status_sub) WHERE status_sub IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_source ON public.leads(source) WHERE source IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_fitness_goal ON public.leads(fitness_goal) WHERE fitness_goal IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_activity_level ON public.leads(activity_level) WHERE activity_level IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_preferred_time ON public.leads(preferred_time) WHERE preferred_time IS NOT NULL","-- Note: Removed idx_leads_created_at_date - DATE() is not IMMUTABLE\n-- Use existing idx_leads_created_at index for date filtering instead\n\n-- Composite index for common filter combinations\nCREATE INDEX IF NOT EXISTS idx_leads_status_source ON public.leads(status_main, source) WHERE status_main IS NOT NULL AND source IS NOT NULL","-- Index for customer_id (already exists, but ensure it's there)\nCREATE INDEX IF NOT EXISTS idx_leads_customer_id ON public.leads(customer_id)","-- Index for birth_date (for age calculations)\nCREATE INDEX IF NOT EXISTS idx_leads_birth_date ON public.leads(birth_date) WHERE birth_date IS NOT NULL","-- Note: Removed idx_leads_created_at_date index\n-- DATE() function is not IMMUTABLE, so it can't be used in index expressions\n-- The existing idx_leads_created_at index on created_at (DESC) is sufficient for date filtering\n\n-- =====================================================\n-- STEP 2: Create View for Leads with Customer Data (Pre-joined)\n-- =====================================================\n\nCREATE OR REPLACE VIEW public.v_leads_with_customer AS\nSELECT \n    l.id,\n    l.created_at,\n    l.updated_at,\n    l.assigned_to,\n    l.customer_id,\n    l.city,\n    l.birth_date,\n    l.gender,\n    l.status_main,\n    l.status_sub,\n    l.height,\n    l.weight,\n    l.bmi,\n    l.join_date,\n    l.subscription_data,\n    l.daily_protocol,\n    l.workout_history,\n    l.steps_history,\n    l.source,\n    l.fitness_goal,\n    l.activity_level,\n    l.preferred_time,\n    l.notes,\n    -- Customer data (joined)\n    c.full_name as customer_name,\n    c.phone as customer_phone,\n    c.email as customer_email,\n    -- Calculated fields (PostgreSQL does the math)\n    EXTRACT(YEAR FROM AGE(l.birth_date))::INTEGER as age,\n    TO_CHAR(l.created_at, 'YYYY-MM-DD') as created_date_formatted,\n    TO_CHAR(l.birth_date, 'YYYY-MM-DD') as birth_date_formatted,\n    -- Extract JSONB fields (PostgreSQL parses JSON)\n    (l.daily_protocol->>'stepsGoal')::INTEGER as daily_steps_goal,\n    (l.daily_protocol->>'workoutGoal')::INTEGER as weekly_workouts,\n    -- Extract supplements array from JSONB (handle both array and null)\n    CASE \n        WHEN l.daily_protocol->'supplements' IS NULL THEN ARRAY[]::TEXT[]\n        WHEN jsonb_typeof(l.daily_protocol->'supplements') = 'array' \n        THEN ARRAY(SELECT jsonb_array_elements_text(l.daily_protocol->'supplements'))\n        ELSE ARRAY[]::TEXT[]\n    END as daily_supplements,\n    -- Extract subscription data\n    (l.subscription_data->>'months')::INTEGER as subscription_months,\n    (l.subscription_data->>'initialPrice')::DECIMAL as subscription_initial_price,\n    (l.subscription_data->>'renewalPrice')::DECIMAL as subscription_renewal_price\nFROM public.leads l\nINNER JOIN public.customers c ON l.customer_id = c.id","-- Grant access to authenticated users\nGRANT SELECT ON public.v_leads_with_customer TO authenticated","-- =====================================================\n-- STEP 3: Create RPC Function for Filtered Leads (Complex Filtering)\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.get_filtered_leads(\n    p_search_query TEXT DEFAULT NULL,\n    p_created_date DATE DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_limit_count INTEGER DEFAULT 1000,\n    p_offset_count INTEGER DEFAULT 0\n)\nRETURNS TABLE (\n    id UUID,\n    created_at TIMESTAMP WITH TIME ZONE,\n    updated_at TIMESTAMP WITH TIME ZONE,\n    customer_id UUID,\n    customer_name TEXT,\n    customer_phone TEXT,\n    customer_email TEXT,\n    status_main TEXT,\n    status_sub TEXT,\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT,\n    age INTEGER,\n    birth_date DATE,\n    birth_date_formatted TEXT,\n    created_date_formatted TEXT,\n    height DECIMAL,\n    weight DECIMAL,\n    daily_steps_goal INTEGER,\n    weekly_workouts INTEGER,\n    daily_supplements TEXT[],\n    subscription_months INTEGER,\n    subscription_initial_price DECIMAL,\n    subscription_renewal_price DECIMAL\n) \nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nBEGIN\n    RETURN QUERY\n    SELECT \n        v.id,\n        v.created_at,\n        v.updated_at,\n        v.customer_id,\n        v.customer_name,\n        v.customer_phone,\n        v.customer_email,\n        v.status_main,\n        v.status_sub,\n        v.source,\n        v.fitness_goal,\n        v.activity_level,\n        v.preferred_time,\n        v.notes,\n        v.age,\n        v.birth_date,\n        v.birth_date_formatted,\n        v.created_date_formatted,\n        v.height,\n        v.weight,\n        v.daily_steps_goal,\n        v.weekly_workouts,\n        v.daily_supplements,\n        v.subscription_months,\n        v.subscription_initial_price,\n        v.subscription_renewal_price\n    FROM public.v_leads_with_customer v\n    WHERE \n        -- Search query (PostgreSQL text search - fast with indexes)\n        (p_search_query IS NULL OR \n         v.customer_name ILIKE '%' || p_search_query || '%' OR\n         v.customer_email ILIKE '%' || p_search_query || '%' OR\n         v.customer_phone LIKE '%' || p_search_query || '%' OR\n         v.fitness_goal ILIKE '%' || p_search_query || '%' OR\n         v.notes ILIKE '%' || p_search_query || '%')\n        -- Date filter (PostgreSQL date comparison)\n        AND (p_created_date IS NULL OR DATE(v.created_at) = p_created_date)\n        -- Status filters (uses indexes)\n        AND (p_status_main IS NULL OR v.status_main = p_status_main)\n        AND (p_status_sub IS NULL OR v.status_sub = p_status_sub)\n        -- Age filter (calculated in PostgreSQL)\n        AND (p_age IS NULL OR v.age::TEXT = p_age)\n        -- Height filter\n        AND (p_height IS NULL OR v.height::TEXT = p_height)\n        -- Weight filter\n        AND (p_weight IS NULL OR v.weight::TEXT = p_weight)\n        -- Fitness goal filter (uses index)\n        AND (p_fitness_goal IS NULL OR v.fitness_goal = p_fitness_goal)\n        -- Activity level filter (uses index)\n        AND (p_activity_level IS NULL OR v.activity_level = p_activity_level)\n        -- Preferred time filter (uses index)\n        AND (p_preferred_time IS NULL OR v.preferred_time = p_preferred_time)\n        -- Source filter (uses index)\n        AND (p_source IS NULL OR v.source = p_source)\n    ORDER BY v.created_at DESC\n    LIMIT p_limit_count\n    OFFSET p_offset_count;\nEND;\n$$","-- Grant execute permission to authenticated users\nGRANT EXECUTE ON FUNCTION public.get_filtered_leads TO authenticated","-- =====================================================\n-- STEP 4: Create Helper Function for Age Calculation (Reusable)\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.calculate_age_from_birth_date(birth_date DATE)\nRETURNS INTEGER\nLANGUAGE plpgsql\nIMMUTABLE\nAS $$\nBEGIN\n    IF birth_date IS NULL THEN\n        RETURN 0;\n    END IF;\n    RETURN EXTRACT(YEAR FROM AGE(birth_date))::INTEGER;\nEND;\n$$","-- =====================================================\n-- STEP 5: Create Function to Get Unique Filter Values (For Dropdowns)\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.get_lead_filter_options()\nRETURNS JSONB\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    result JSONB;\nBEGIN\n    SELECT jsonb_build_object(\n        'statuses', ARRAY(SELECT DISTINCT status_main FROM public.leads WHERE status_main IS NOT NULL ORDER BY status_main)::TEXT[],\n        'sources', ARRAY(SELECT DISTINCT source FROM public.leads WHERE source IS NOT NULL ORDER BY source)::TEXT[],\n        'fitness_goals', ARRAY(SELECT DISTINCT fitness_goal FROM public.leads WHERE fitness_goal IS NOT NULL ORDER BY fitness_goal)::TEXT[],\n        'activity_levels', ARRAY(SELECT DISTINCT activity_level FROM public.leads WHERE activity_level IS NOT NULL ORDER BY activity_level)::TEXT[],\n        'preferred_times', ARRAY(SELECT DISTINCT preferred_time FROM public.leads WHERE preferred_time IS NOT NULL ORDER BY preferred_time)::TEXT[],\n        'ages', ARRAY(SELECT DISTINCT EXTRACT(YEAR FROM AGE(birth_date))::TEXT \n                      FROM public.leads \n                      WHERE birth_date IS NOT NULL \n                      ORDER BY EXTRACT(YEAR FROM AGE(birth_date)))::TEXT[],\n        'heights', ARRAY(SELECT DISTINCT height::TEXT \n                         FROM public.leads \n                         WHERE height IS NOT NULL \n                         ORDER BY height)::TEXT[],\n        'weights', ARRAY(SELECT DISTINCT weight::TEXT \n                         FROM public.leads \n                         WHERE weight IS NOT NULL \n                         ORDER BY weight)::TEXT[]\n    ) INTO result;\n    \n    RETURN result;\nEND;\n$$","-- Grant execute permission\nGRANT EXECUTE ON FUNCTION public.get_lead_filter_options TO authenticated","-- =====================================================\n-- STEP 6: Comments for Documentation\n-- =====================================================\n\nCOMMENT ON VIEW public.v_leads_with_customer IS 'Pre-joined view of leads with customer data and calculated fields. Use this for read operations to avoid client-side joins.'","COMMENT ON FUNCTION public.get_filtered_leads IS 'RPC function for complex lead filtering. All filtering happens in PostgreSQL. Returns pre-calculated fields (age, formatted dates, JSONB extracts).'","COMMENT ON FUNCTION public.calculate_age_from_birth_date IS 'Immutable function to calculate age from birth date. Can be used in queries and views.'","COMMENT ON FUNCTION public.get_lead_filter_options IS 'Returns distinct filter values for dropdowns. Calculated once in PostgreSQL instead of client-side.'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	optimize_leads_queries
20240102000016	{"-- =====================================================\n-- Add Profile Fields to Customers Table\n-- Created: 2024-01-02\n-- Description: Add fields for Rich Profile Hero view\n--              - total_spent: Calculated from leads subscription_data\n--              - membership_tier: Derived from total_spent\n--              - avatar_url: URL for customer avatar image\n-- =====================================================\n\n-- Add new columns to customers table\nALTER TABLE public.customers\n  ADD COLUMN IF NOT EXISTS avatar_url TEXT,\n  ADD COLUMN IF NOT EXISTS total_spent NUMERIC(10, 2) DEFAULT 0,\n  ADD COLUMN IF NOT EXISTS membership_tier TEXT DEFAULT 'New' CHECK (membership_tier IN ('New', 'Standard', 'Premium', 'VIP'))","-- Create index for membership_tier for faster filtering\nCREATE INDEX IF NOT EXISTS idx_customers_membership_tier ON public.customers(membership_tier)","-- Add comments for documentation\nCOMMENT ON COLUMN public.customers.avatar_url IS 'URL to customer avatar/profile image'","COMMENT ON COLUMN public.customers.total_spent IS 'Total amount spent across all leads (calculated field)'","COMMENT ON COLUMN public.customers.membership_tier IS 'Customer membership tier based on total_spent: New (<500), Standard (500-1999), Premium (2000-4999), VIP (5000+)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_profile_fields_to_customers
20240102000017	{"-- =====================================================\n-- Add Nutrition and Supplements History to Leads Table\n-- Created: 2024-01-02\n-- Description: Add nutrition_history and supplements_history JSONB columns\n--              to store historical nutrition plans and supplements plans\n-- =====================================================\n\n-- Add nutrition_history column to leads table\nALTER TABLE public.leads\n  ADD COLUMN IF NOT EXISTS nutrition_history JSONB DEFAULT '[]'::jsonb","-- Add supplements_history column to leads table\nALTER TABLE public.leads\n  ADD COLUMN IF NOT EXISTS supplements_history JSONB DEFAULT '[]'::jsonb","-- Create GIN indexes for efficient JSONB queries\nCREATE INDEX IF NOT EXISTS idx_leads_nutrition_history ON public.leads USING GIN (nutrition_history)","CREATE INDEX IF NOT EXISTS idx_leads_supplements_history ON public.leads USING GIN (supplements_history)","-- Add comments for documentation\nCOMMENT ON COLUMN public.leads.nutrition_history IS 'Array of historical nutrition plans for this lead'","COMMENT ON COLUMN public.leads.supplements_history IS 'Array of historical supplements plans for this lead'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_nutrition_supplements_history_to_leads
20240102000018	{"-- Migration: Add customer_notes table for unified customer notes system\n-- Created: 2024-01-02\n-- Description: Customer-centric notes that are unified across all leads belonging to the same customer\n\nCREATE TABLE IF NOT EXISTS customer_notes (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  customer_id UUID NOT NULL REFERENCES customers(id) ON DELETE CASCADE,\n  content TEXT NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id)\n)","-- Create indexes for performance\nCREATE INDEX IF NOT EXISTS idx_customer_notes_customer_id ON customer_notes(customer_id)","CREATE INDEX IF NOT EXISTS idx_customer_notes_created_at ON customer_notes(created_at DESC)","-- Enable RLS\nALTER TABLE customer_notes ENABLE ROW LEVEL SECURITY","-- RLS Policies: Allow authenticated users to manage notes\n-- Adjust these policies based on your specific requirements\n\nCREATE POLICY \\"Users can view customer notes\\" ON customer_notes\n  FOR SELECT\n  USING (auth.role() = 'authenticated')","CREATE POLICY \\"Users can insert customer notes\\" ON customer_notes\n  FOR INSERT\n  WITH CHECK (auth.role() = 'authenticated')","CREATE POLICY \\"Users can update customer notes\\" ON customer_notes\n  FOR UPDATE\n  USING (auth.role() = 'authenticated')","CREATE POLICY \\"Users can delete customer notes\\" ON customer_notes\n  FOR DELETE\n  USING (auth.role() = 'authenticated')","-- Function to automatically update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_customer_notes_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Trigger to automatically update updated_at\nCREATE TRIGGER customer_notes_updated_at\n  BEFORE UPDATE ON customer_notes\n  FOR EACH ROW\n  EXECUTE FUNCTION update_customer_notes_updated_at()"}	add_customer_notes
20240102000019	{"-- Migration: Add icon_name column to saved_views table\n-- This allows users to customize the icon for each saved view\n\n-- Add icon_name column (nullable, defaults to NULL for existing rows)\nALTER TABLE saved_views \nADD COLUMN IF NOT EXISTS icon_name TEXT","-- Add comment to explain the column\nCOMMENT ON COLUMN saved_views.icon_name IS 'Name of the Lucide icon component to use for this view (e.g., \\"Users\\", \\"Dumbbell\\", \\"Flame\\"). If NULL, uses default icon for the resource_key.'"}	add_icon_name_to_saved_views
20240102000020	{"-- Migration: Add user_interface_preferences table for storing custom interface icons\n-- This allows users to customize icons for main interface items (e.g., \\"ניהול לידים\\", \\"ניהול לקוחות\\")\n\nCREATE TABLE IF NOT EXISTS user_interface_preferences (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    interface_key TEXT NOT NULL, -- e.g., 'leads', 'customers', 'templates', etc.\n    icon_name TEXT NOT NULL, -- e.g., 'Users', 'Dumbbell', 'LayoutDashboard', etc.\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Ensure one preference per interface per user\n    CONSTRAINT unique_user_interface_preference \n        UNIQUE (user_id, interface_key)\n)","-- Index for faster queries\nCREATE INDEX IF NOT EXISTS idx_user_interface_preferences_user_id \n    ON user_interface_preferences(user_id)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_user_interface_preferences_updated_at\n    BEFORE UPDATE ON user_interface_preferences\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- Enable RLS\nALTER TABLE user_interface_preferences ENABLE ROW LEVEL SECURITY","-- Policy: Users can view their own preferences\nCREATE POLICY \\"Users can view their own interface preferences\\"\n    ON user_interface_preferences\n    FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own preferences\nCREATE POLICY \\"Users can insert their own interface preferences\\"\n    ON user_interface_preferences\n    FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own preferences\nCREATE POLICY \\"Users can update their own interface preferences\\"\n    ON user_interface_preferences\n    FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own preferences\nCREATE POLICY \\"Users can delete their own interface preferences\\"\n    ON user_interface_preferences\n    FOR DELETE\n    USING (auth.uid() = user_id)","-- Comments\nCOMMENT ON TABLE user_interface_preferences IS 'User preferences for customizing interface icons'","COMMENT ON COLUMN user_interface_preferences.interface_key IS 'The interface identifier (e.g., \\"leads\\", \\"customers\\", \\"templates\\")'","COMMENT ON COLUMN user_interface_preferences.icon_name IS 'The Lucide icon name (e.g., \\"Users\\", \\"Dumbbell\\", \\"LayoutDashboard\\")'"}	add_user_interface_preferences
20240102000021	{"-- Migration: Allow authenticated users to update leads\n-- This ensures that any authenticated user can update leads they can read\n-- Required for the inline editing functionality to work properly\n\n-- Note: We keep the existing admin policy which uses is_admin() function\n-- This new policy allows any authenticated user to update leads\n\n-- Create new policy that allows authenticated users to update leads\n-- Since we already have a SELECT policy allowing authenticated users to read leads,\n-- we should allow them to update leads as well for the CRM functionality\n-- The admin policy (created in 20240102000001) will still apply for admins\nCREATE POLICY \\"Authenticated users can update leads\\"\n    ON public.leads FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","COMMENT ON POLICY \\"Authenticated users can update leads\\" ON public.leads IS \n    'Allows all authenticated users to update leads for CRM functionality'"}	allow_authenticated_users_update_leads
20240102000022	{"-- Migration: Add lead_id column to customer_notes table\n-- Created: 2024-01-02\n-- Description: Allow notes to be associated with specific leads/inquiries\n\nALTER TABLE customer_notes \nADD COLUMN IF NOT EXISTS lead_id UUID REFERENCES leads(id) ON DELETE SET NULL","-- Create index for performance\nCREATE INDEX IF NOT EXISTS idx_customer_notes_lead_id ON customer_notes(lead_id)","-- Add comment\nCOMMENT ON COLUMN customer_notes.lead_id IS 'Optional reference to a specific lead/inquiry. NULL means the note applies to all inquiries for the customer.'"}	add_lead_id_to_customer_notes
20240102000023	{"-- Migration: Add Client Portal Support\n-- Created: 2024-01-02\n-- Description: Enable client/trainee role, link customers to auth users, and create daily check-ins\n\n-- =====================================================\n-- 1. UPDATE profiles.role to include 'trainee'\n-- =====================================================\n\n-- Drop the existing CHECK constraint\nALTER TABLE profiles DROP CONSTRAINT IF EXISTS profiles_role_check","-- Add new CHECK constraint with 'trainee' role\nALTER TABLE profiles \nADD CONSTRAINT profiles_role_check \nCHECK (role IN ('admin', 'user', 'trainee'))","-- Update comment\nCOMMENT ON COLUMN profiles.role IS 'User role: admin (coach/admin), user (coach), trainee (client/trainee)'","-- =====================================================\n-- 2. ADD user_id to customers table\n-- =====================================================\n\n-- Add user_id column to customers (nullable, as existing customers may not have user accounts yet)\nALTER TABLE customers \nADD COLUMN IF NOT EXISTS user_id UUID REFERENCES auth.users(id) ON DELETE SET NULL","-- Create index for faster lookups\nCREATE INDEX IF NOT EXISTS idx_customers_user_id ON customers(user_id)","-- Add unique constraint to ensure one user can only be linked to one customer\nCREATE UNIQUE INDEX IF NOT EXISTS idx_customers_user_id_unique ON customers(user_id) \nWHERE user_id IS NOT NULL","-- Add comment\nCOMMENT ON COLUMN customers.user_id IS 'Link to auth.users - allows clients to log in and access their portal'","-- =====================================================\n-- 3. CREATE daily_check_ins table\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS daily_check_ins (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  customer_id UUID NOT NULL REFERENCES customers(id) ON DELETE CASCADE,\n  lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n  check_in_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  \n  -- Check-in statuses\n  workout_completed BOOLEAN DEFAULT false,\n  steps_goal_met BOOLEAN DEFAULT false,\n  steps_actual INTEGER, -- Actual steps taken (optional)\n  nutrition_goal_met BOOLEAN DEFAULT false,\n  supplements_taken JSONB DEFAULT '[]'::jsonb, -- Array of supplement names taken\n  \n  -- Additional notes\n  notes TEXT,\n  \n  -- Metadata\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n  \n  -- Ensure one check-in per customer per day\n  UNIQUE(customer_id, check_in_date)\n)","-- Create indexes for performance\nCREATE INDEX IF NOT EXISTS idx_daily_check_ins_customer_id ON daily_check_ins(customer_id)","CREATE INDEX IF NOT EXISTS idx_daily_check_ins_lead_id ON daily_check_ins(lead_id)","CREATE INDEX IF NOT EXISTS idx_daily_check_ins_date ON daily_check_ins(check_in_date DESC)","CREATE INDEX IF NOT EXISTS idx_daily_check_ins_customer_date ON daily_check_ins(customer_id, check_in_date DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_daily_check_ins_updated_at\n  BEFORE UPDATE ON daily_check_ins\n  FOR EACH ROW\n  EXECUTE FUNCTION update_updated_at_column()","-- Add comments\nCOMMENT ON TABLE daily_check_ins IS 'Daily check-in records for client compliance tracking'","COMMENT ON COLUMN daily_check_ins.workout_completed IS 'Whether the client completed their workout for the day'","COMMENT ON COLUMN daily_check_ins.steps_goal_met IS 'Whether the client met their daily steps goal'","COMMENT ON COLUMN daily_check_ins.steps_actual IS 'Actual number of steps taken (optional, for detailed tracking)'","COMMENT ON COLUMN daily_check_ins.nutrition_goal_met IS 'Whether the client met their nutrition/macro goals'","COMMENT ON COLUMN daily_check_ins.supplements_taken IS 'JSONB array of supplement names that were taken'","-- =====================================================\n-- 4. ENABLE RLS ON daily_check_ins\n-- =====================================================\n\nALTER TABLE daily_check_ins ENABLE ROW LEVEL SECURITY","-- Policy: Trainees can view their own check-ins\nCREATE POLICY \\"Trainees can view own check-ins\\"\n  ON daily_check_ins FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = daily_check_ins.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- Policy: Trainees can insert their own check-ins\nCREATE POLICY \\"Trainees can insert own check-ins\\"\n  ON daily_check_ins FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = daily_check_ins.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- Policy: Trainees can update their own check-ins\nCREATE POLICY \\"Trainees can update own check-ins\\"\n  ON daily_check_ins FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = daily_check_ins.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = daily_check_ins.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- Policy: Coaches/admins can view all check-ins\nCREATE POLICY \\"Coaches can view all check-ins\\"\n  ON daily_check_ins FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE id = auth.uid() \n      AND role IN ('admin', 'user')\n    )\n  )","-- Policy: Coaches/admins can insert check-ins for any customer\nCREATE POLICY \\"Coaches can insert check-ins\\"\n  ON daily_check_ins FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE id = auth.uid() \n      AND role IN ('admin', 'user')\n    )\n  )","-- Policy: Coaches/admins can update check-ins for any customer\nCREATE POLICY \\"Coaches can update check-ins\\"\n  ON daily_check_ins FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE id = auth.uid() \n      AND role IN ('admin', 'user')\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE id = auth.uid() \n      AND role IN ('admin', 'user')\n    )\n  )","-- =====================================================\n-- 5. UPDATE RLS POLICIES FOR customers\n-- =====================================================\n\n-- Policy: Trainees can view their own customer record\nCREATE POLICY \\"Trainees can view own customer\\"\n  ON customers FOR SELECT\n  USING (user_id = auth.uid())","-- Policy: Trainees can update their own customer record (for profile editing)\nCREATE POLICY \\"Trainees can update own customer\\"\n  ON customers FOR UPDATE\n  USING (user_id = auth.uid())\n  WITH CHECK (user_id = auth.uid())","-- =====================================================\n-- 6. UPDATE RLS POLICIES FOR leads (for trainee access)\n-- =====================================================\n\n-- Policy: Trainees can view leads associated with their customer_id\nCREATE POLICY \\"Trainees can view own leads\\"\n  ON leads FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = leads.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- Policy: Trainees can update their own leads (for weight, height, etc.)\nCREATE POLICY \\"Trainees can update own leads\\"\n  ON leads FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = leads.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = leads.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_client_portal_support
20240102000024	{"-- Migration: Fix Trainee User Role\n-- Created: 2024-01-02\n-- Description: \n--   1. Update existing trainee user's role from 'user' to 'trainee' in the profiles table\n--   2. Create profile with correct role if user exists in auth.users but not in profiles\n--   3. Update handle_new_user function to automatically set role='trainee' for trainee@test.com\n\n-- =====================================================\n-- 1. UPDATE handle_new_user to auto-set trainee role\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER AS $$\nBEGIN\n    -- Auto-set role to 'trainee' for trainee@test.com\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (\n        NEW.id,\n        NEW.email,\n        COALESCE(NEW.raw_user_meta_data->>'full_name', ''),\n        CASE \n            WHEN NEW.email = 'trainee@test.com' THEN 'trainee'\n            ELSE COALESCE(NEW.raw_user_meta_data->>'role', 'user')\n        END\n    );\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- =====================================================\n-- 2. UPDATE/CREATE trainee@test.com role to 'trainee'\n-- =====================================================\n\nDO $$\nDECLARE\n  v_user_id UUID;\n  v_role TEXT;\n  v_updated_count INTEGER;\nBEGIN\n  -- Find the user in auth.users\n  SELECT id INTO v_user_id\n  FROM auth.users\n  WHERE email = 'trainee@test.com';\n  \n  IF v_user_id IS NULL THEN\n    RAISE NOTICE '⚠️ User trainee@test.com not found in auth.users - will be set to trainee when user is created';\n    RETURN;\n  END IF;\n  \n  -- Check if profile exists\n  SELECT role INTO v_role\n  FROM profiles\n  WHERE id = v_user_id;\n  \n  IF v_role IS NULL THEN\n    -- Profile doesn't exist, create it with 'trainee' role\n    INSERT INTO profiles (id, email, role, full_name)\n    VALUES (v_user_id, 'trainee@test.com', 'trainee', 'Test Trainee')\n    ON CONFLICT (id) DO UPDATE\n      SET role = 'trainee',\n          email = EXCLUDED.email;\n    \n    RAISE NOTICE '✅ Created profile for trainee@test.com with role: trainee';\n  ELSIF v_role != 'trainee' THEN\n    -- Profile exists but has wrong role, update it\n    UPDATE profiles \n    SET role = 'trainee' \n    WHERE id = v_user_id;\n    \n    GET DIAGNOSTICS v_updated_count = ROW_COUNT;\n    \n    IF v_updated_count > 0 THEN\n      RAISE NOTICE '✅ Updated trainee@test.com role from % to: trainee', v_role;\n    END IF;\n  ELSE\n    -- Profile already has correct role\n    RAISE NOTICE '✅ User trainee@test.com already has role: trainee';\n  END IF;\nEND $$"}	fix_trainee_user_role
20240102000025	{"-- Migration: Create Test Users (Manager & Client)\n-- Created: 2024-01-02\n-- Description: Creates two test users:\n--   1. Manager user (coach/admin) - sees full dashboard\n--   2. Client user (trainee) - sees only their client portal\n-- IMPORTANT: This must be the LAST migration to run\n\n-- =====================================================\n-- CREATE TEST USERS\n-- =====================================================\n\nDO $$\nDECLARE\n  v_manager_user_id UUID;\n  v_client_user_id UUID;\n  v_client_customer_id UUID;\n  v_client_lead_id UUID;\nBEGIN\n  -- =====================================================\n  -- 1. CREATE MANAGER USER (coach/admin)\n  -- =====================================================\n  \n  -- Check if manager user already exists\n  SELECT id INTO v_manager_user_id\n  FROM auth.users\n  WHERE email = 'manager@dietneta.com';\n  \n  -- Create auth user for manager (only if doesn't exist)\n  IF v_manager_user_id IS NULL THEN\n    INSERT INTO auth.users (\n      instance_id,\n      id,\n      aud,\n      role,\n      email,\n      encrypted_password,\n      email_confirmed_at,\n      recovery_sent_at,\n      last_sign_in_at,\n      raw_app_meta_data,\n      raw_user_meta_data,\n      created_at,\n      updated_at,\n      confirmation_token,\n      email_change,\n      email_change_token_new,\n      recovery_token\n    ) VALUES (\n      '00000000-0000-0000-0000-000000000000',\n      gen_random_uuid(),\n      'authenticated',\n      'authenticated',\n      'manager@dietneta.com',\n      crypt('Manager123!', gen_salt('bf')),\n      NOW(),\n      NOW(),\n      NOW(),\n      '{\\"provider\\": \\"email\\", \\"providers\\": [\\"email\\"]}',\n      '{\\"full_name\\": \\"מנהל מערכת\\", \\"role\\": \\"admin\\"}',\n      NOW(),\n      NOW(),\n      '',\n      '',\n      '',\n      ''\n    )\n    RETURNING id INTO v_manager_user_id;\n  END IF;\n  \n  -- Create profile for manager (if user exists)\n  IF v_manager_user_id IS NOT NULL THEN\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (v_manager_user_id, 'manager@dietneta.com', 'מנהל מערכת', 'admin')\n    ON CONFLICT (id) DO UPDATE\n      SET role = 'admin',\n          email = 'manager@dietneta.com',\n          full_name = 'מנהל מערכת';\n    \n    RAISE NOTICE '✅ Manager user created/updated: manager@dietneta.com (ID: %)', v_manager_user_id;\n  ELSE\n    -- User already exists, get the ID\n    SELECT id INTO v_manager_user_id\n    FROM auth.users\n    WHERE email = 'manager@dietneta.com';\n    \n    -- Update profile to ensure correct role\n    UPDATE public.profiles\n    SET role = 'admin',\n        email = 'manager@dietneta.com',\n        full_name = 'מנהל מערכת'\n    WHERE id = v_manager_user_id;\n    \n    RAISE NOTICE '✅ Manager user already exists, profile updated: manager@dietneta.com (ID: %)', v_manager_user_id;\n  END IF;\n  \n  -- =====================================================\n  -- 2. CREATE CLIENT USER (trainee)\n  -- =====================================================\n  \n  -- Check if client user already exists\n  SELECT id INTO v_client_user_id\n  FROM auth.users\n  WHERE email = 'client@dietneta.com';\n  \n  -- Create auth user for client (only if doesn't exist)\n  IF v_client_user_id IS NULL THEN\n    INSERT INTO auth.users (\n      instance_id,\n      id,\n      aud,\n      role,\n      email,\n      encrypted_password,\n      email_confirmed_at,\n      recovery_sent_at,\n      last_sign_in_at,\n      raw_app_meta_data,\n      raw_user_meta_data,\n      created_at,\n      updated_at,\n      confirmation_token,\n      email_change,\n      email_change_token_new,\n      recovery_token\n    ) VALUES (\n      '00000000-0000-0000-0000-000000000000',\n      gen_random_uuid(),\n      'authenticated',\n      'authenticated',\n      'client@dietneta.com',\n      crypt('Client123!', gen_salt('bf')),\n      NOW(),\n      NOW(),\n      NOW(),\n      '{\\"provider\\": \\"email\\", \\"providers\\": [\\"email\\"]}',\n      '{\\"full_name\\": \\"לקוח בדיקה\\", \\"role\\": \\"trainee\\"}',\n      NOW(),\n      NOW(),\n      '',\n      '',\n      '',\n      ''\n    )\n    RETURNING id INTO v_client_user_id;\n  END IF;\n  \n  -- Create profile for client (if user exists)\n  IF v_client_user_id IS NOT NULL THEN\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (v_client_user_id, 'client@dietneta.com', 'לקוח בדיקה', 'trainee')\n    ON CONFLICT (id) DO UPDATE\n      SET role = 'trainee',\n          email = 'client@dietneta.com',\n          full_name = 'לקוח בדיקה';\n    \n    RAISE NOTICE '✅ Client user created/updated: client@dietneta.com (ID: %)', v_client_user_id;\n  ELSE\n    -- User already exists, get the ID\n    SELECT id INTO v_client_user_id\n    FROM auth.users\n    WHERE email = 'client@dietneta.com';\n    \n    -- Update profile to ensure correct role\n    UPDATE public.profiles\n    SET role = 'trainee',\n        email = 'client@dietneta.com',\n        full_name = 'לקוח בדיקה'\n    WHERE id = v_client_user_id;\n    \n    RAISE NOTICE '✅ Client user already exists, profile updated: client@dietneta.com (ID: %)', v_client_user_id;\n  END IF;\n  \n  -- =====================================================\n  -- 3. CREATE CUSTOMER RECORD FOR CLIENT\n  -- =====================================================\n  \n  IF v_client_user_id IS NOT NULL THEN\n    -- Create customer record linked to client user\n    -- Use upsert approach since we can't rely on ON CONFLICT with partial unique index\n    INSERT INTO customers (full_name, phone, email, user_id)\n    VALUES (\n      'לקוח בדיקה',\n      '0501234567',\n      'client@dietneta.com',\n      v_client_user_id\n    )\n    ON CONFLICT (phone) DO UPDATE\n      SET user_id = EXCLUDED.user_id,\n          full_name = EXCLUDED.full_name,\n          email = EXCLUDED.email\n    RETURNING id INTO v_client_customer_id;\n    \n    -- If customer already existed with different user_id, update it\n    IF v_client_customer_id IS NULL THEN\n      UPDATE customers\n      SET user_id = v_client_user_id,\n          full_name = 'לקוח בדיקה',\n          email = 'client@dietneta.com'\n      WHERE phone = '0501234567'\n      RETURNING id INTO v_client_customer_id;\n    END IF;\n    \n    RAISE NOTICE '✅ Customer record created/updated for client (ID: %)', v_client_customer_id;\n    \n    -- =====================================================\n    -- 4. CREATE LEAD RECORD FOR CLIENT\n    -- =====================================================\n    \n    -- Create a lead record for the client (only if doesn't exist)\n    -- Note: After normalization, leads table no longer has full_name, phone, email columns\n    -- Those are in the customers table, linked via customer_id\n    INSERT INTO leads (\n      customer_id,\n      status_main,\n      fitness_goal,\n      height,\n      weight,\n      activity_level\n    )\n    SELECT \n      v_client_customer_id,\n      'בטיפול',\n      'ירידה במשקל',\n      175.0,\n      75.0,\n      'בינוני'\n    WHERE NOT EXISTS (\n      SELECT 1 FROM leads \n      WHERE customer_id = v_client_customer_id \n    )\n    RETURNING id INTO v_client_lead_id;\n    \n    RAISE NOTICE '✅ Lead record created/updated for client (ID: %)', v_client_lead_id;\n  END IF;\n  \n  RAISE NOTICE '';\n  RAISE NOTICE '========================================';\n  RAISE NOTICE '✅ TEST USERS CREATED SUCCESSFULLY';\n  RAISE NOTICE '========================================';\n  RAISE NOTICE '';\n  RAISE NOTICE '📧 MANAGER USER:';\n  RAISE NOTICE '   Email: manager@dietneta.com';\n  RAISE NOTICE '   Password: Manager123!';\n  RAISE NOTICE '   Role: admin (sees full dashboard)';\n  RAISE NOTICE '';\n  RAISE NOTICE '📧 CLIENT USER:';\n  RAISE NOTICE '   Email: client@dietneta.com';\n  RAISE NOTICE '   Password: Client123!';\n  RAISE NOTICE '   Role: trainee (sees only client portal)';\n  RAISE NOTICE '';\n  RAISE NOTICE '========================================';\n  \nEXCEPTION\n  WHEN OTHERS THEN\n    RAISE WARNING 'Error creating test users: %', SQLERRM;\n    -- Don't fail the migration if users already exist\nEND $$"}	create_test_users
20240102000026	{"-- Migration: Add Trainee Access to Workout and Nutrition Plans\n-- Created: 2024-01-02\n-- Description: Allow trainees to access their workout and nutrition plans via customer_id\n\n-- =====================================================\n-- 1. UPDATE RLS POLICIES FOR workout_plans (for trainee access)\n-- =====================================================\n\n-- Policy: Trainees can view workout plans associated with their customer_id\nCREATE POLICY \\"Trainees can view own workout plans\\"\n  ON workout_plans FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = workout_plans.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- =====================================================\n-- 2. UPDATE RLS POLICIES FOR nutrition_plans (for trainee access)\n-- =====================================================\n\n-- Policy: Trainees can view nutrition plans associated with their customer_id\nCREATE POLICY \\"Trainees can view own nutrition plans\\"\n  ON nutrition_plans FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = nutrition_plans.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_trainee_access_to_plans
20240102000027	{"-- Migration: Secure User Invitations System\n-- Created: 2024-01-02\n-- Description: Implements secure invitation system for trainee user creation without passwords\n\n-- =====================================================\n-- 1. CREATE user_invitations TABLE\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS public.user_invitations (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    \n    -- User identification\n    email TEXT NOT NULL,\n    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,\n    customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    \n    -- Secure token (hashed at rest)\n    token_hash TEXT NOT NULL UNIQUE, -- SHA-256 hash of the invitation token\n    token_salt TEXT NOT NULL, -- Random salt for token hashing\n    \n    -- Invitation metadata\n    status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'sent', 'accepted', 'expired', 'revoked')),\n    invited_by UUID REFERENCES auth.users(id) ON DELETE SET NULL, -- Admin/manager who created the invitation\n    invited_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL, -- Configurable expiration (default 7 days)\n    accepted_at TIMESTAMP WITH TIME ZONE,\n    \n    -- Audit fields\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Constraints\n    CONSTRAINT user_invitations_email_user_id_check CHECK (\n        (email IS NOT NULL) OR (user_id IS NOT NULL)\n    )\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_user_invitations_email ON public.user_invitations(email)","CREATE INDEX IF NOT EXISTS idx_user_invitations_user_id ON public.user_invitations(user_id)","CREATE INDEX IF NOT EXISTS idx_user_invitations_customer_id ON public.user_invitations(customer_id)","CREATE INDEX IF NOT EXISTS idx_user_invitations_token_hash ON public.user_invitations(token_hash)","CREATE INDEX IF NOT EXISTS idx_user_invitations_status ON public.user_invitations(status)","CREATE INDEX IF NOT EXISTS idx_user_invitations_expires_at ON public.user_invitations(expires_at)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_user_invitations_updated_at\n    BEFORE UPDATE ON public.user_invitations\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- 2. CREATE invitation_audit_log TABLE (for security audit)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS public.invitation_audit_log (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    invitation_id UUID REFERENCES user_invitations(id) ON DELETE CASCADE,\n    action TEXT NOT NULL CHECK (action IN ('created', 'sent', 'resent', 'accepted', 'expired', 'revoked', 'viewed')),\n    performed_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    ip_address INET,\n    user_agent TEXT,\n    metadata JSONB DEFAULT '{}'::jsonb,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL\n)","CREATE INDEX IF NOT EXISTS idx_invitation_audit_log_invitation_id ON public.invitation_audit_log(invitation_id)","CREATE INDEX IF NOT EXISTS idx_invitation_audit_log_performed_by ON public.invitation_audit_log(performed_by)","CREATE INDEX IF NOT EXISTS idx_invitation_audit_log_created_at ON public.invitation_audit_log(created_at DESC)","-- =====================================================\n-- 3. ENABLE RLS\n-- =====================================================\n\nALTER TABLE public.user_invitations ENABLE ROW LEVEL SECURITY","ALTER TABLE public.invitation_audit_log ENABLE ROW LEVEL SECURITY","-- =====================================================\n-- 4. RLS POLICIES FOR user_invitations\n-- =====================================================\n\n-- Policy: Admins/managers can view all invitations\nCREATE POLICY \\"Admins can view all invitations\\"\n    ON public.user_invitations FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Admins/managers can create invitations\nCREATE POLICY \\"Admins can create invitations\\"\n    ON public.user_invitations FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Admins/managers can update invitations (for resend, revoke)\nCREATE POLICY \\"Admins can update invitations\\"\n    ON public.user_invitations FOR UPDATE\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Users can view their own invitation (by email match)\n-- Use profiles table instead of auth.users to avoid permission issues\nCREATE POLICY \\"Users can view own invitation\\"\n    ON public.user_invitations FOR SELECT\n    USING (\n        email = (SELECT email FROM profiles WHERE id = auth.uid())\n        OR user_id = auth.uid()\n    )","-- =====================================================\n-- 5. RLS POLICIES FOR invitation_audit_log\n-- =====================================================\n\n-- Policy: Admins can view all audit logs\nCREATE POLICY \\"Admins can view audit logs\\"\n    ON public.invitation_audit_log FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: System can insert audit logs (via service role or admin)\nCREATE POLICY \\"System can insert audit logs\\"\n    ON public.invitation_audit_log FOR INSERT\n    WITH CHECK (true)","-- Will be restricted by RLS on user_invitations\n\n-- =====================================================\n-- 6. HELPER FUNCTION: Generate secure invitation token\n-- =====================================================\n\n-- This function generates a cryptographically secure token\n-- The actual token is generated client-side and hashed before storage\nCREATE OR REPLACE FUNCTION public.generate_invitation_token()\nRETURNS TEXT AS $$\nDECLARE\n    token TEXT;\nBEGIN\n    -- Generate a secure random token (32 bytes = 64 hex characters)\n    -- This is just a placeholder - actual token generation happens in application code\n    -- using crypto.randomBytes or similar\n    token := encode(gen_random_bytes(32), 'hex');\n    RETURN token;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- =====================================================\n-- 7. HELPER FUNCTION: Hash token for storage\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.hash_invitation_token(token TEXT, salt TEXT)\nRETURNS TEXT AS $$\nBEGIN\n    -- Use SHA-256 for token hashing\n    -- In production, consider using bcrypt or argon2\n    RETURN encode(digest(salt || token, 'sha256'), 'hex');\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE","-- =====================================================\n-- 8. HELPER FUNCTION: Verify invitation token\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.verify_invitation_token(\n    p_token_hash TEXT,\n    p_token TEXT,\n    p_salt TEXT\n)\nRETURNS BOOLEAN AS $$\nBEGIN\n    -- Verify token by hashing and comparing\n    RETURN p_token_hash = public.hash_invitation_token(p_token, p_salt);\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE","-- =====================================================\n-- 9. HELPER FUNCTION: Check if invitation is valid\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.is_invitation_valid(p_invitation_id UUID)\nRETURNS BOOLEAN AS $$\nDECLARE\n    v_status TEXT;\n    v_expires_at TIMESTAMP WITH TIME ZONE;\nBEGIN\n    SELECT status, expires_at INTO v_status, v_expires_at\n    FROM public.user_invitations\n    WHERE id = p_invitation_id;\n    \n    IF NOT FOUND THEN\n        RETURN FALSE;\n    END IF;\n    \n    -- Check if expired or revoked\n    IF v_status IN ('expired', 'revoked', 'accepted') THEN\n        RETURN FALSE;\n    END IF;\n    \n    -- Check expiration\n    IF v_expires_at < NOW() THEN\n        -- Auto-update status to expired\n        UPDATE public.user_invitations\n        SET status = 'expired', updated_at = NOW()\n        WHERE id = p_invitation_id;\n        RETURN FALSE;\n    END IF;\n    \n    RETURN TRUE;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- =====================================================\n-- 10. COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE public.user_invitations IS 'Secure invitation system for trainee user creation without passwords'","COMMENT ON COLUMN public.user_invitations.token_hash IS 'SHA-256 hash of the invitation token (never store plaintext)'","COMMENT ON COLUMN public.user_invitations.token_salt IS 'Random salt used for token hashing'","COMMENT ON COLUMN public.user_invitations.status IS 'Invitation status: pending, sent, accepted, expired, revoked'","COMMENT ON COLUMN public.user_invitations.expires_at IS 'Token expiration timestamp (default 7 days from creation)'","COMMENT ON TABLE public.invitation_audit_log IS 'Audit log for all invitation-related actions for security compliance'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	secure_user_invitations
20240102000028	{"-- Migration: Fix RLS Policies for user_invitations\n-- Created: 2024-01-02\n-- Description: Fixes RLS policies that were trying to access auth.users directly\n\n-- Drop all existing policies to recreate them properly\nDROP POLICY IF EXISTS \\"Users can view own invitation\\" ON public.user_invitations","DROP POLICY IF EXISTS \\"Admins can view all invitations\\" ON public.user_invitations","DROP POLICY IF EXISTS \\"Admins can create invitations\\" ON public.user_invitations","DROP POLICY IF EXISTS \\"Admins can update invitations\\" ON public.user_invitations","-- Create a helper function to check if user is admin/manager\n-- This avoids repeated subqueries in policies\nCREATE OR REPLACE FUNCTION public.is_admin_or_manager()\nRETURNS BOOLEAN AS $$\nBEGIN\n    RETURN EXISTS (\n        SELECT 1 FROM profiles\n        WHERE id = auth.uid() \n        AND role IN ('admin', 'user')\n    );\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER STABLE","-- Policy: Admins/managers can view all invitations\nCREATE POLICY \\"Admins can view all invitations\\"\n    ON public.user_invitations FOR SELECT\n    USING (public.is_admin_or_manager())","-- Policy: Users can view their own invitation (by user_id or email from profile)\nCREATE POLICY \\"Users can view own invitation\\"\n    ON public.user_invitations FOR SELECT\n    USING (\n        user_id = auth.uid()\n        OR (\n            email = (SELECT email FROM profiles WHERE id = auth.uid())\n        )\n    )","-- Policy: Admins/managers can create invitations\nCREATE POLICY \\"Admins can create invitations\\"\n    ON public.user_invitations FOR INSERT\n    WITH CHECK (public.is_admin_or_manager())","-- Policy: Admins/managers can update invitations (for resend, revoke)\nCREATE POLICY \\"Admins can update invitations\\"\n    ON public.user_invitations FOR UPDATE\n    USING (public.is_admin_or_manager())\n    WITH CHECK (public.is_admin_or_manager())"}	fix_invitation_rls
20240102000029	{"-- Migration: Fix Manager User Password\n-- Created: 2024-01-02\n-- Description: Properly creates/resets manager user password using Supabase Auth\n\n-- This migration uses a function to properly set the password\n-- Note: Direct password updates in auth.users don't work with Supabase Auth\n-- This migration will be handled by a script instead\n\n-- For now, we'll just ensure the profile is correct\n-- The password should be reset using the admin API or script\n\nDO $$\nDECLARE\n  v_manager_user_id UUID;\nBEGIN\n  -- Find manager user\n  SELECT id INTO v_manager_user_id\n  FROM auth.users\n  WHERE email = 'manager@dietneta.com'\n  LIMIT 1;\n  \n  -- Ensure profile exists and is correct\n  IF v_manager_user_id IS NOT NULL THEN\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (v_manager_user_id, 'manager@dietneta.com', 'מנהל מערכת', 'admin')\n    ON CONFLICT (id) DO UPDATE\n      SET role = 'admin',\n          email = 'manager@dietneta.com',\n          full_name = 'מנהל מערכת';\n    \n    RAISE NOTICE '✅ Manager profile updated: manager@dietneta.com (ID: %)', v_manager_user_id;\n    RAISE NOTICE '⚠️  Password reset required. Run: node scripts/reset_manager_password.js';\n  ELSE\n    RAISE NOTICE '⚠️  Manager user not found. Please create using Supabase Auth signUp or admin API.';\n  END IF;\nEND $$"}	fix_manager_user_password
20240102000030	{"-- Migration: Add WhatsApp Flow Templates Table\n-- Description: Stores message templates for WhatsApp automation flows\n-- Created: 2024-01-02\n\n-- Create whatsapp_flow_templates table\nCREATE TABLE IF NOT EXISTS public.whatsapp_flow_templates (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  flow_key TEXT NOT NULL, -- e.g., 'customer_journey_start', 'intro_questionnaire'\n  template_content TEXT NOT NULL DEFAULT '', -- The message template with placeholders\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  \n  -- Ensure one template per flow per user\n  UNIQUE(user_id, flow_key)\n)","-- Add RLS policies\nALTER TABLE public.whatsapp_flow_templates ENABLE ROW LEVEL SECURITY","-- Policy: Users can view their own templates\nCREATE POLICY \\"Users can view own templates\\"\n  ON public.whatsapp_flow_templates\n  FOR SELECT\n  USING (auth.uid() = user_id)","-- Policy: Users can insert their own templates\nCREATE POLICY \\"Users can insert own templates\\"\n  ON public.whatsapp_flow_templates\n  FOR INSERT\n  WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own templates\nCREATE POLICY \\"Users can update own templates\\"\n  ON public.whatsapp_flow_templates\n  FOR UPDATE\n  USING (auth.uid() = user_id)\n  WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own templates\nCREATE POLICY \\"Users can delete own templates\\"\n  ON public.whatsapp_flow_templates\n  FOR DELETE\n  USING (auth.uid() = user_id)","-- Create index for faster lookups\nCREATE INDEX IF NOT EXISTS idx_whatsapp_flow_templates_user_flow \n  ON public.whatsapp_flow_templates(user_id, flow_key)","-- Create function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_whatsapp_flow_templates_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger to automatically update updated_at\nCREATE TRIGGER update_whatsapp_flow_templates_updated_at\n  BEFORE UPDATE ON public.whatsapp_flow_templates\n  FOR EACH ROW\n  EXECUTE FUNCTION update_whatsapp_flow_templates_updated_at()","-- Add comments\nCOMMENT ON TABLE public.whatsapp_flow_templates IS 'Stores WhatsApp message templates for automation flows'","COMMENT ON COLUMN public.whatsapp_flow_templates.flow_key IS 'Unique identifier for the flow (e.g., customer_journey_start, intro_questionnaire)'","COMMENT ON COLUMN public.whatsapp_flow_templates.template_content IS 'Message template with placeholders like {{name}}, {{phone}}, etc.'"}	add_whatsapp_flow_templates
20240102000031	{"-- Migration: Add buttons support to WhatsApp Flow Templates\n-- Description: Adds JSONB column to store interactive buttons for WhatsApp messages\n-- Created: 2024-01-02\n-- Migration number: 20240102000031 (must be last in sequence)\n\n-- Add buttons column to store interactive buttons array\nALTER TABLE public.whatsapp_flow_templates\nADD COLUMN IF NOT EXISTS buttons JSONB DEFAULT '[]'::jsonb","-- Add comment\nCOMMENT ON COLUMN public.whatsapp_flow_templates.buttons IS 'Array of interactive buttons: [{\\"id\\": \\"1\\", \\"text\\": \\"Button Text\\"}]'","-- Ensure any existing data complies with max 3 buttons rule before adding constraint\n-- This is safe because the column was just added, so there should be no existing data\n-- But we do this defensively in case the migration is run multiple times\nUPDATE public.whatsapp_flow_templates\nSET buttons = '[]'::jsonb\nWHERE buttons IS NULL \n   OR (jsonb_typeof(buttons) = 'array' AND jsonb_array_length(COALESCE(buttons, '[]'::jsonb)) > 3)","-- Add constraint to ensure buttons array has max 3 items (idempotent)\n-- Use DO block to safely handle constraint creation/dropping\nDO $$\nBEGIN\n    -- Drop constraint if it exists (in case of re-running migration)\n    IF EXISTS (\n        SELECT 1 FROM pg_constraint \n        WHERE conname = 'check_buttons_max_count' \n        AND conrelid = 'public.whatsapp_flow_templates'::regclass\n    ) THEN\n        ALTER TABLE public.whatsapp_flow_templates DROP CONSTRAINT check_buttons_max_count;\n    END IF;\n    \n    -- Add the constraint\n    ALTER TABLE public.whatsapp_flow_templates\n    ADD CONSTRAINT check_buttons_max_count \n    CHECK (jsonb_array_length(COALESCE(buttons, '[]'::jsonb)) <= 3);\nEXCEPTION\n    WHEN others THEN\n        -- If constraint creation fails, log but don't fail the migration\n        RAISE NOTICE 'Could not add check_buttons_max_count constraint: %', SQLERRM;\nEND $$"}	add_buttons_to_whatsapp_templates
20251228093611	{"-- Migration: Add Green API Settings Table\n-- Description: Stores Green API credentials in PostgreSQL instead of using Edge Functions\n-- Created: 2025-12-28\n-- Migration number: 20251228093611 (must be last in sequence)\n\n-- Create settings table for Green API credentials\nCREATE TABLE IF NOT EXISTS public.green_api_settings (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    id_instance TEXT NOT NULL,\n    api_token_instance TEXT NOT NULL,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Enable RLS\nALTER TABLE public.green_api_settings ENABLE ROW LEVEL SECURITY","-- Policy: Authenticated users can read Green API settings (needed to send messages)\nCREATE POLICY \\"Authenticated users can read Green API settings\\"\n    ON public.green_api_settings FOR SELECT\n    USING (auth.uid() IS NOT NULL)","-- Policy: Only admins can insert Green API settings\nCREATE POLICY \\"Admins can insert Green API settings\\"\n    ON public.green_api_settings FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Only admins can update Green API settings\nCREATE POLICY \\"Admins can update Green API settings\\"\n    ON public.green_api_settings FOR UPDATE\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Only admins can delete Green API settings\nCREATE POLICY \\"Admins can delete Green API settings\\"\n    ON public.green_api_settings FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Trigger to auto-update updated_at and updated_by\nCREATE TRIGGER update_green_api_settings_updated_at\n    BEFORE UPDATE ON public.green_api_settings\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- Function to set created_by and updated_by on insert\nCREATE OR REPLACE FUNCTION set_green_api_settings_user()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.created_by = COALESCE(NEW.created_by, auth.uid());\n    NEW.updated_by = auth.uid();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Trigger to set user fields\nCREATE TRIGGER set_green_api_settings_user_trigger\n    BEFORE INSERT OR UPDATE ON public.green_api_settings\n    FOR EACH ROW\n    EXECUTE FUNCTION set_green_api_settings_user()","-- Add comments\nCOMMENT ON TABLE public.green_api_settings IS 'Stores Green API credentials for WhatsApp messaging'","COMMENT ON COLUMN public.green_api_settings.id_instance IS 'Green API instance ID'","COMMENT ON COLUMN public.green_api_settings.api_token_instance IS 'Green API token instance'"}	add_green_api_settings
20251228120000	{"-- Migration: Expand daily_check_ins table with comprehensive metrics\n-- This adds 19 new fields for luxury daily check-in tracking\n\n-- Physical measurements (6 fields)\nALTER TABLE daily_check_ins\n  ADD COLUMN IF NOT EXISTS weight NUMERIC(5,2), -- Weight in kg\n  ADD COLUMN IF NOT EXISTS belly_circumference INTEGER, -- היקף בטן in cm\n  ADD COLUMN IF NOT EXISTS waist_circumference INTEGER, -- היקף מותן in cm\n  ADD COLUMN IF NOT EXISTS thigh_circumference INTEGER, -- היקף ירכיים in cm\n  ADD COLUMN IF NOT EXISTS arm_circumference INTEGER, -- היקף יד in cm\n  ADD COLUMN IF NOT EXISTS neck_circumference INTEGER, -- היקף צוואר in cm\n  -- Activity metrics (3 new fields, steps_actual already exists)\n  ADD COLUMN IF NOT EXISTS exercises_count INTEGER, -- כמה תרגילים עשית\n  ADD COLUMN IF NOT EXISTS cardio_amount INTEGER, -- כמה אירובי עשית (minutes)\n  ADD COLUMN IF NOT EXISTS intervals_count INTEGER, -- כמה אינטרוולים\n  -- Nutrition and Hydration (4 fields)\n  ADD COLUMN IF NOT EXISTS calories_daily INTEGER, -- קלוריות יומי\n  ADD COLUMN IF NOT EXISTS protein_daily INTEGER, -- חלבון יומי in grams\n  ADD COLUMN IF NOT EXISTS fiber_daily INTEGER, -- סיבים יומי in grams\n  ADD COLUMN IF NOT EXISTS water_amount NUMERIC(5,2), -- כמה מים שתית in liters\n  -- Well-being scales 1-10 (3 fields)\n  ADD COLUMN IF NOT EXISTS stress_level INTEGER, -- רמת הלחץ היומי\n  ADD COLUMN IF NOT EXISTS hunger_level INTEGER, -- רמת הרעב שלך\n  ADD COLUMN IF NOT EXISTS energy_level INTEGER, -- רמת האנרגיה שלך\n  -- Rest (1 field)\n  ADD COLUMN IF NOT EXISTS sleep_hours NUMERIC(4,2)","-- כמה שעות ישנת\n\n-- Add CHECK constraints for well-being scales (must be done separately after columns exist)\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_constraint WHERE conname = 'daily_check_ins_stress_level_check'\n  ) THEN\n    ALTER TABLE daily_check_ins\n      ADD CONSTRAINT daily_check_ins_stress_level_check \n        CHECK (stress_level IS NULL OR (stress_level >= 1 AND stress_level <= 10));\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_constraint WHERE conname = 'daily_check_ins_hunger_level_check'\n  ) THEN\n    ALTER TABLE daily_check_ins\n      ADD CONSTRAINT daily_check_ins_hunger_level_check \n        CHECK (hunger_level IS NULL OR (hunger_level >= 1 AND hunger_level <= 10));\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_constraint WHERE conname = 'daily_check_ins_energy_level_check'\n  ) THEN\n    ALTER TABLE daily_check_ins\n      ADD CONSTRAINT daily_check_ins_energy_level_check \n        CHECK (energy_level IS NULL OR (energy_level >= 1 AND energy_level <= 10));\n  END IF;\nEND $$","-- Add comments for documentation\nCOMMENT ON COLUMN daily_check_ins.weight IS 'Weight measurement in kg (משקל)'","COMMENT ON COLUMN daily_check_ins.belly_circumference IS 'Belly circumference in cm (היקף בטן)'","COMMENT ON COLUMN daily_check_ins.waist_circumference IS 'Waist circumference in cm (היקף מותן)'","COMMENT ON COLUMN daily_check_ins.thigh_circumference IS 'Thigh circumference in cm (היקף ירכיים)'","COMMENT ON COLUMN daily_check_ins.arm_circumference IS 'Arm circumference in cm (היקף יד)'","COMMENT ON COLUMN daily_check_ins.neck_circumference IS 'Neck circumference in cm (היקף צוואר)'","COMMENT ON COLUMN daily_check_ins.exercises_count IS 'Number of exercises completed (כמה תרגילים עשית)'","COMMENT ON COLUMN daily_check_ins.cardio_amount IS 'Cardio duration in minutes (כמה אירובי עשית)'","COMMENT ON COLUMN daily_check_ins.intervals_count IS 'Number of interval training sessions (כמה אינטרוולים)'","COMMENT ON COLUMN daily_check_ins.calories_daily IS 'Daily calorie intake (קלוריות יומי)'","COMMENT ON COLUMN daily_check_ins.protein_daily IS 'Daily protein intake in grams (חלבון יומי)'","COMMENT ON COLUMN daily_check_ins.fiber_daily IS 'Daily fiber intake in grams (סיבים יומי)'","COMMENT ON COLUMN daily_check_ins.water_amount IS 'Water consumed in liters (כמה מים שתית)'","COMMENT ON COLUMN daily_check_ins.stress_level IS 'Daily stress level 1-10 (רמת הלחץ היומי)'","COMMENT ON COLUMN daily_check_ins.hunger_level IS 'Hunger level 1-10 (רמת הרעב שלך)'","COMMENT ON COLUMN daily_check_ins.energy_level IS 'Energy level 1-10 (רמת האנרגיה שלך)'","COMMENT ON COLUMN daily_check_ins.sleep_hours IS 'Hours of sleep (כמה שעות ישנת)'"}	expand_daily_check_ins
20251229000000	{"-- =====================================================\n-- Budgets (Taktziv) Migration\n-- Created: 2024-12-29\n-- Description: Master budget templates that aggregate nutrition, workout, steps, and supplements\n-- =====================================================\n\n-- =====================================================\n-- TABLE: budgets (Budget Templates)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS budgets (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name TEXT NOT NULL,\n    description TEXT,\n    \n    -- Nutrition Master (can link to nutrition_template or have custom values)\n    nutrition_template_id UUID REFERENCES nutrition_templates(id) ON DELETE SET NULL,\n    nutrition_targets JSONB DEFAULT '{}'::jsonb,\n    -- Structure: { calories: number, protein: number, carbs: number, fat: number, fiber_min: number, water_min: number }\n    \n    -- Steps Module\n    steps_goal INTEGER DEFAULT 0,\n    steps_instructions TEXT,\n    \n    -- Workout Link\n    workout_template_id UUID REFERENCES workout_templates(id) ON DELETE SET NULL,\n    \n    -- Supplements Module (JSONB array)\n    supplements JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ name: string, dosage: string, timing: string }]\n    \n    -- Guidelines\n    eating_order TEXT, -- e.g., \\"Vegetables -> Protein -> Carbs\\"\n    eating_rules TEXT, -- e.g., \\"Don't eat carbs alone\\"\n    \n    -- Metadata\n    is_public BOOLEAN NOT NULL DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_budgets_created_by ON budgets(created_by)","CREATE INDEX IF NOT EXISTS idx_budgets_is_public ON budgets(is_public)","CREATE INDEX IF NOT EXISTS idx_budgets_nutrition_template_id ON budgets(nutrition_template_id)","CREATE INDEX IF NOT EXISTS idx_budgets_workout_template_id ON budgets(workout_template_id)","CREATE INDEX IF NOT EXISTS idx_budgets_nutrition_targets ON budgets USING GIN (nutrition_targets)","CREATE INDEX IF NOT EXISTS idx_budgets_supplements ON budgets USING GIN (supplements)","CREATE INDEX IF NOT EXISTS idx_budgets_created_at ON budgets(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_budgets_updated_at\n    BEFORE UPDATE ON budgets\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- TABLE: budget_assignments (Active Client Budgets)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS budget_assignments (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    budget_id UUID NOT NULL REFERENCES budgets(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE CASCADE,\n    customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n    \n    -- Assignment metadata\n    assigned_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    assigned_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    is_active BOOLEAN NOT NULL DEFAULT TRUE,\n    \n    -- Notes specific to this assignment\n    notes TEXT,\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_budget_assignments_budget_id ON budget_assignments(budget_id)","CREATE INDEX IF NOT EXISTS idx_budget_assignments_lead_id ON budget_assignments(lead_id)","CREATE INDEX IF NOT EXISTS idx_budget_assignments_customer_id ON budget_assignments(customer_id)","CREATE INDEX IF NOT EXISTS idx_budget_assignments_is_active ON budget_assignments(is_active)","CREATE INDEX IF NOT EXISTS idx_budget_assignments_assigned_at ON budget_assignments(assigned_at DESC)","-- Unique constraint: One active budget per lead/customer\nCREATE UNIQUE INDEX IF NOT EXISTS idx_budget_assignments_unique_active_lead \n    ON budget_assignments(lead_id) \n    WHERE is_active = TRUE AND lead_id IS NOT NULL","CREATE UNIQUE INDEX IF NOT EXISTS idx_budget_assignments_unique_active_customer \n    ON budget_assignments(customer_id) \n    WHERE is_active = TRUE AND customer_id IS NOT NULL","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_budget_assignments_updated_at\n    BEFORE UPDATE ON budget_assignments\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on budgets table\nALTER TABLE budgets ENABLE ROW LEVEL SECURITY","-- Policy: Users can view public budgets or their own budgets\nCREATE POLICY \\"Users can view public or own budgets\\"\n    ON budgets FOR SELECT\n    USING (\n        is_public = TRUE OR \n        created_by = auth.uid()\n    )","-- Policy: Users can insert their own budgets\nCREATE POLICY \\"Users can insert own budgets\\"\n    ON budgets FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own budgets\nCREATE POLICY \\"Users can update own budgets\\"\n    ON budgets FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own budgets\nCREATE POLICY \\"Users can delete own budgets\\"\n    ON budgets FOR DELETE\n    USING (auth.uid() = created_by)","-- Policy: Admins have full access to budgets\nCREATE POLICY \\"Admins have full access to budgets\\"\n    ON budgets FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Enable RLS on budget_assignments table\nALTER TABLE budget_assignments ENABLE ROW LEVEL SECURITY","-- Policy: Users can view assignments for their own leads/customers or if they created the budget\nCREATE POLICY \\"Users can view relevant budget assignments\\"\n    ON budget_assignments FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND (budgets.created_by = auth.uid() OR budgets.is_public = TRUE)\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Users can insert assignments if they own the budget\nCREATE POLICY \\"Users can insert budget assignments for own budgets\\"\n    ON budget_assignments FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND budgets.created_by = auth.uid()\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Users can update assignments if they own the budget\nCREATE POLICY \\"Users can update budget assignments for own budgets\\"\n    ON budget_assignments FOR UPDATE\n    USING (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND budgets.created_by = auth.uid()\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND budgets.created_by = auth.uid()\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Users can delete assignments if they own the budget\nCREATE POLICY \\"Users can delete budget assignments for own budgets\\"\n    ON budget_assignments FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND budgets.created_by = auth.uid()\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE budgets IS 'Master budget templates that aggregate nutrition, workout, steps, and supplements'","COMMENT ON COLUMN budgets.nutrition_targets IS 'JSONB containing macro targets: { calories: number, protein: number, carbs: number, fat: number, fiber_min: number, water_min: number }'","COMMENT ON COLUMN budgets.supplements IS 'JSONB array of supplements: [{ name: string, dosage: string, timing: string }]'","COMMENT ON TABLE budget_assignments IS 'Active budget assignments to leads/customers'","COMMENT ON COLUMN budget_assignments.is_active IS 'Only one active budget per lead/customer at a time'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_budgets
20251229000001	{"-- =====================================================\n-- Add 'budgets' to saved_views resource_key constraint\n-- Created: 2025-12-29\n-- Description: Allow saved views for budgets (Taktziv)\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'budgets'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_budgets_to_saved_views
20251230000000	{"-- Migration: Add check-in field configurations table\n-- Allows admins to customize which fields and sections are visible in client check-in forms\n\n-- Create check_in_field_configurations table\nCREATE TABLE IF NOT EXISTS check_in_field_configurations (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n  -- If customer_id is NULL, this is a global/default configuration\n  configuration JSONB NOT NULL DEFAULT '{}'::jsonb,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id),\n  \n  -- Ensure only one configuration per customer (or one global)\n  CONSTRAINT check_in_field_configurations_customer_unique UNIQUE (customer_id)\n)","-- Add index for faster lookups\nCREATE INDEX IF NOT EXISTS idx_check_in_field_configurations_customer_id \n  ON check_in_field_configurations(customer_id)","-- Add index for global configurations\nCREATE INDEX IF NOT EXISTS idx_check_in_field_configurations_global \n  ON check_in_field_configurations((customer_id IS NULL))","-- Enable RLS\nALTER TABLE check_in_field_configurations ENABLE ROW LEVEL SECURITY","-- RLS Policies\n-- Admins can read/write all configurations\nCREATE POLICY \\"Admins can manage all check-in field configurations\\"\n  ON check_in_field_configurations\n  FOR ALL\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'manager')\n    )\n  )","-- Clients can read their own configuration\nCREATE POLICY \\"Clients can read their check-in field configuration\\"\n  ON check_in_field_configurations\n  FOR SELECT\n  USING (\n    customer_id IN (\n      SELECT id FROM customers\n      WHERE user_id = auth.uid()\n    )\n    OR customer_id IS NULL -- Also allow reading global/default config\n  )","-- Function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_check_in_field_configurations_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Trigger to automatically update updated_at\nCREATE TRIGGER update_check_in_field_configurations_updated_at\n  BEFORE UPDATE ON check_in_field_configurations\n  FOR EACH ROW\n  EXECUTE FUNCTION update_check_in_field_configurations_updated_at()","-- Add comments\nCOMMENT ON TABLE check_in_field_configurations IS 'Stores configuration for check-in field visibility and labels per customer or globally'","COMMENT ON COLUMN check_in_field_configurations.customer_id IS 'Customer ID for customer-specific config, NULL for global/default config'","COMMENT ON COLUMN check_in_field_configurations.configuration IS 'JSONB object containing field visibility, labels, and section visibility settings'","-- Example configuration structure:\n-- {\n--   \\"sections\\": {\n--     \\"body\\": { \\"visible\\": true, \\"label\\": \\"מדדי גוף\\" },\n--     \\"activity\\": { \\"visible\\": true, \\"label\\": \\"פעילות\\" },\n--     \\"nutrition\\": { \\"visible\\": true, \\"label\\": \\"תזונה\\" },\n--     \\"wellness\\": { \\"visible\\": true, \\"label\\": \\"בריאות\\" }\n--   },\n--   \\"fields\\": {\n--     \\"weight\\": { \\"visible\\": true, \\"label\\": \\"משקל\\", \\"section\\": \\"body\\" },\n--     \\"bellyCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף בטן\\", \\"section\\": \\"body\\" },\n--     \\"waistCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף מותן\\", \\"section\\": \\"body\\" },\n--     \\"thighCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף ירכיים\\", \\"section\\": \\"body\\" },\n--     \\"armCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף יד\\", \\"section\\": \\"body\\" },\n--     \\"neckCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף צוואר\\", \\"section\\": \\"body\\" },\n--     \\"stepsActual\\": { \\"visible\\": true, \\"label\\": \\"מס' צעדים יומי\\", \\"section\\": \\"activity\\" },\n--     \\"exercisesCount\\": { \\"visible\\": true, \\"label\\": \\"כמה תרגילים עשית\\", \\"section\\": \\"activity\\" },\n--     \\"cardioAmount\\": { \\"visible\\": true, \\"label\\": \\"כמה אירובי עשית\\", \\"section\\": \\"activity\\" },\n--     \\"intervalsCount\\": { \\"visible\\": true, \\"label\\": \\"כמה אינטרוולים\\", \\"section\\": \\"activity\\" },\n--     \\"caloriesDaily\\": { \\"visible\\": true, \\"label\\": \\"קלוריות יומי\\", \\"section\\": \\"nutrition\\" },\n--     \\"proteinDaily\\": { \\"visible\\": true, \\"label\\": \\"חלבון יומי\\", \\"section\\": \\"nutrition\\" },\n--     \\"fiberDaily\\": { \\"visible\\": true, \\"label\\": \\"סיבים יומי\\", \\"section\\": \\"nutrition\\" },\n--     \\"waterAmount\\": { \\"visible\\": true, \\"label\\": \\"כמה מים שתית\\", \\"section\\": \\"nutrition\\" },\n--     \\"stressLevel\\": { \\"visible\\": true, \\"label\\": \\"רמת הלחץ היומי\\", \\"section\\": \\"wellness\\" },\n--     \\"hungerLevel\\": { \\"visible\\": true, \\"label\\": \\"רמת הרעב שלך\\", \\"section\\": \\"wellness\\" },\n--     \\"energyLevel\\": { \\"visible\\": true, \\"label\\": \\"רמת האנרגיה שלך\\", \\"section\\": \\"wellness\\" },\n--     \\"sleepHours\\": { \\"visible\\": true, \\"label\\": \\"כמה שעות ישנת\\", \\"section\\": \\"wellness\\" }\n--   }\n-- }"}	add_check_in_field_configurations
20251231000000	{"-- =====================================================\n-- Add Budget Links to Plans Migration\n-- Created: 2024-12-31\n-- Description: Links workout_plans, nutrition_plans, and supplement_plans to budgets\n-- =====================================================\n\n-- =====================================================\n-- Add budget_id to workout_plans\n-- =====================================================\n\nALTER TABLE workout_plans \nADD COLUMN IF NOT EXISTS budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL","CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_id ON workout_plans(budget_id)","-- =====================================================\n-- Add budget_id to nutrition_plans\n-- =====================================================\n\nALTER TABLE nutrition_plans \nADD COLUMN IF NOT EXISTS budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_id ON nutrition_plans(budget_id)","-- =====================================================\n-- Create supplement_plans table\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS supplement_plans (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    customer_id UUID REFERENCES customers(id) ON DELETE SET NULL,\n    budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL,\n    template_id UUID, -- For future use if supplement templates are created\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    end_date DATE,\n    description TEXT,\n    \n    -- Supplements (JSONB array)\n    supplements JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ name: string, dosage: string, timing: string }]\n    \n    -- Metadata\n    is_active BOOLEAN NOT NULL DEFAULT TRUE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_supplement_plans_user_id ON supplement_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_lead_id ON supplement_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_customer_id ON supplement_plans(customer_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_id ON supplement_plans(budget_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_start_date ON supplement_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_created_at ON supplement_plans(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_supplements ON supplement_plans USING GIN (supplements)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_supplement_plans_updated_at\n    BEFORE UPDATE ON supplement_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES for supplement_plans\n-- =====================================================\n\n-- Enable RLS on supplement_plans table\nALTER TABLE supplement_plans ENABLE ROW LEVEL SECURITY","-- Policy: Users can read their own supplement plans\nCREATE POLICY \\"Users can read own supplement plans\\"\n    ON supplement_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own supplement plans\nCREATE POLICY \\"Users can insert own supplement plans\\"\n    ON supplement_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own supplement plans\nCREATE POLICY \\"Users can update own supplement plans\\"\n    ON supplement_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own supplement plans\nCREATE POLICY \\"Users can delete own supplement plans\\"\n    ON supplement_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to supplement plans\nCREATE POLICY \\"Admins have full access to supplement plans\\"\n    ON supplement_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON COLUMN workout_plans.budget_id IS 'Reference to the budget this workout plan was created from'","COMMENT ON COLUMN nutrition_plans.budget_id IS 'Reference to the budget this nutrition plan was created from'","COMMENT ON TABLE supplement_plans IS 'Supplement plans linked to leads/customers and budgets'","COMMENT ON COLUMN supplement_plans.budget_id IS 'Reference to the budget this supplement plan was created from'","COMMENT ON COLUMN supplement_plans.supplements IS 'JSONB array of supplements: [{ name: string, dosage: string, timing: string }]'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_budget_links_to_plans
20260101000000	{"-- =====================================================\n-- Fix Budget Links to Plans and Create Supplement Plans\n-- Created: 2026-01-01\n-- Description: Ensures budget_id columns exist in workout_plans and nutrition_plans,\n--              and creates supplement_plans table if it doesn't exist\n-- =====================================================\n\n-- =====================================================\n-- Add budget_id to workout_plans (if not exists)\n-- =====================================================\n\nDO $$\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_name = 'workout_plans' \n        AND column_name = 'budget_id'\n    ) THEN\n        ALTER TABLE workout_plans \n        ADD COLUMN budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL;\n        \n        CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_id ON workout_plans(budget_id);\n        \n        COMMENT ON COLUMN workout_plans.budget_id IS 'Reference to the budget this workout plan was created from';\n    END IF;\nEND $$","-- =====================================================\n-- Add budget_id to nutrition_plans (if not exists)\n-- =====================================================\n\nDO $$\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_name = 'nutrition_plans' \n        AND column_name = 'budget_id'\n    ) THEN\n        ALTER TABLE nutrition_plans \n        ADD COLUMN budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL;\n        \n        CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_id ON nutrition_plans(budget_id);\n        \n        COMMENT ON COLUMN nutrition_plans.budget_id IS 'Reference to the budget this nutrition plan was created from';\n    END IF;\nEND $$","-- =====================================================\n-- Create supplement_plans table (if not exists)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS supplement_plans (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    customer_id UUID REFERENCES customers(id) ON DELETE SET NULL,\n    budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL,\n    template_id UUID, -- For future use if supplement templates are created\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    end_date DATE,\n    description TEXT,\n    \n    -- Supplements (JSONB array)\n    supplements JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ name: string, dosage: string, timing: string }]\n    \n    -- Metadata\n    is_active BOOLEAN NOT NULL DEFAULT TRUE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_supplement_plans_user_id ON supplement_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_lead_id ON supplement_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_customer_id ON supplement_plans(customer_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_id ON supplement_plans(budget_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_start_date ON supplement_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_created_at ON supplement_plans(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_supplements ON supplement_plans USING GIN (supplements)","-- Trigger to auto-update updated_at (only if it doesn't exist)\nDO $$\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM pg_trigger \n        WHERE tgname = 'update_supplement_plans_updated_at'\n    ) THEN\n        CREATE TRIGGER update_supplement_plans_updated_at\n            BEFORE UPDATE ON supplement_plans\n            FOR EACH ROW\n            EXECUTE FUNCTION update_updated_at_column();\n    END IF;\nEND $$","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES for supplement_plans\n-- =====================================================\n\n-- Enable RLS on supplement_plans table\nALTER TABLE supplement_plans ENABLE ROW LEVEL SECURITY","-- Drop existing policies if they exist (to avoid conflicts)\nDROP POLICY IF EXISTS \\"Users can read own supplement plans\\" ON supplement_plans","DROP POLICY IF EXISTS \\"Users can insert own supplement plans\\" ON supplement_plans","DROP POLICY IF EXISTS \\"Users can update own supplement plans\\" ON supplement_plans","DROP POLICY IF EXISTS \\"Users can delete own supplement plans\\" ON supplement_plans","DROP POLICY IF EXISTS \\"Admins have full access to supplement plans\\" ON supplement_plans","-- Policy: Users can read their own supplement plans\nCREATE POLICY \\"Users can read own supplement plans\\"\n    ON supplement_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own supplement plans\nCREATE POLICY \\"Users can insert own supplement plans\\"\n    ON supplement_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own supplement plans\nCREATE POLICY \\"Users can update own supplement plans\\"\n    ON supplement_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own supplement plans\nCREATE POLICY \\"Users can delete own supplement plans\\"\n    ON supplement_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to supplement plans\nCREATE POLICY \\"Admins have full access to supplement plans\\"\n    ON supplement_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE supplement_plans IS 'Supplement plans linked to leads/customers and budgets'","COMMENT ON COLUMN supplement_plans.budget_id IS 'Reference to the budget this supplement plan was created from'","COMMENT ON COLUMN supplement_plans.supplements IS 'JSONB array of supplements: [{ name: string, dosage: string, timing: string }]'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_budget_links_and_supplement_plans
20260103000000	{"-- =====================================================\n-- Weekly Reviews Migration\n-- Created: 2026-01-03\n-- Description: Weekly strategy review module for trainer-client communication\n-- =====================================================\n\n-- =====================================================\n-- TABLE: weekly_reviews\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS weekly_reviews (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    \n    -- Links\n    lead_id UUID REFERENCES leads(id) ON DELETE CASCADE,\n    customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n    \n    -- Week identification\n    week_start_date DATE NOT NULL, -- First day of the week (typically Sunday or Monday)\n    week_end_date DATE NOT NULL,   -- Last day of the week\n    \n    -- Current Goals (from active budget/protocol at time of review)\n    target_calories INTEGER,\n    target_protein INTEGER, -- grams\n    target_carbs INTEGER,  -- grams\n    target_fat INTEGER,     -- grams\n    target_fiber INTEGER,   -- grams\n    target_steps INTEGER,\n    \n    -- Actual Averages (calculated from daily_check_ins for the week)\n    actual_calories_avg NUMERIC(10,2),\n    actual_protein_avg NUMERIC(10,2),\n    actual_carbs_avg NUMERIC(10,2),\n    actual_fat_avg NUMERIC(10,2),\n    actual_fiber_avg NUMERIC(10,2),\n    actual_calories_weekly_avg NUMERIC(10,2), -- Weekly average of daily calories\n    \n    -- Body Metrics\n    weekly_avg_weight NUMERIC(5,2), -- Average weight for the week\n    waist_measurement INTEGER,        -- Latest waist measurement from body metrics (cm)\n    \n    -- Trainer Inputs\n    trainer_summary TEXT,             -- סיכום ומסקנות (Summary & Insights)\n    action_plan TEXT,                 -- דגשים לשבוע הקרוב (Focus for next week)\n    \n    -- Protocol Updates (for next week)\n    updated_steps_goal INTEGER,       -- Updated step goal for following week\n    updated_calories_target INTEGER, -- Updated calorie target for following week\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    \n    -- Ensure one review per lead/customer per week\n    UNIQUE(lead_id, week_start_date),\n    UNIQUE(customer_id, week_start_date)\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_weekly_reviews_lead_id ON weekly_reviews(lead_id)","CREATE INDEX IF NOT EXISTS idx_weekly_reviews_customer_id ON weekly_reviews(customer_id)","CREATE INDEX IF NOT EXISTS idx_weekly_reviews_week_start ON weekly_reviews(week_start_date DESC)","CREATE INDEX IF NOT EXISTS idx_weekly_reviews_created_at ON weekly_reviews(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_weekly_reviews_updated_at\n    BEFORE UPDATE ON weekly_reviews\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\nALTER TABLE weekly_reviews ENABLE ROW LEVEL SECURITY","-- Policy: Trainees can view their own weekly reviews\nCREATE POLICY \\"Trainees can view own weekly reviews\\"\n    ON weekly_reviews FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM customers\n            WHERE customers.id = weekly_reviews.customer_id\n            AND customers.user_id = auth.uid()\n        )\n    )","-- Policy: Coaches/admins can view all weekly reviews\nCREATE POLICY \\"Coaches can view all weekly reviews\\"\n    ON weekly_reviews FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Coaches/admins can insert weekly reviews\nCREATE POLICY \\"Coaches can insert weekly reviews\\"\n    ON weekly_reviews FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Coaches/admins can update weekly reviews\nCREATE POLICY \\"Coaches can update weekly reviews\\"\n    ON weekly_reviews FOR UPDATE\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Coaches/admins can delete weekly reviews\nCREATE POLICY \\"Coaches can delete weekly reviews\\"\n    ON weekly_reviews FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE weekly_reviews IS 'Weekly strategy reviews linking trainer insights with client check-in data'","COMMENT ON COLUMN weekly_reviews.week_start_date IS 'First day of the week being reviewed'","COMMENT ON COLUMN weekly_reviews.week_end_date IS 'Last day of the week being reviewed'","COMMENT ON COLUMN weekly_reviews.target_calories IS 'Target calories from active budget/protocol at time of review'","COMMENT ON COLUMN weekly_reviews.actual_calories_avg IS 'Average daily calories from check-ins during the week'","COMMENT ON COLUMN weekly_reviews.weekly_avg_weight IS 'Average weight for the week from daily check-ins'","COMMENT ON COLUMN weekly_reviews.waist_measurement IS 'Latest waist measurement from body metrics section'","COMMENT ON COLUMN weekly_reviews.trainer_summary IS 'Trainer summary and insights (סיכום ומסקנות)'","COMMENT ON COLUMN weekly_reviews.action_plan IS 'Action plan for next week (דגשים לשבוע הקרוב)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_weekly_reviews
20260104000000	{"-- Migration: Create Meetings Table\n-- Description: Stores meeting data from Fillout form submissions\n-- Created: 2026-01-04\n\n-- Create meetings table\nCREATE TABLE IF NOT EXISTS public.meetings (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  lead_id UUID REFERENCES public.leads(id) ON DELETE SET NULL,\n  customer_id UUID REFERENCES public.customers(id) ON DELETE SET NULL,\n  fillout_submission_id TEXT, -- ID from Fillout submission\n  meeting_data JSONB NOT NULL DEFAULT '{}'::jsonb, -- Flexible JSONB to store all form data\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Add indexes\nCREATE INDEX IF NOT EXISTS idx_meetings_lead_id ON public.meetings(lead_id)","CREATE INDEX IF NOT EXISTS idx_meetings_customer_id ON public.meetings(customer_id)","CREATE INDEX IF NOT EXISTS idx_meetings_created_at ON public.meetings(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_meetings_fillout_submission_id ON public.meetings(fillout_submission_id)","-- Add RLS policies\nALTER TABLE public.meetings ENABLE ROW LEVEL SECURITY","-- Policy: Managers can view all meetings\nCREATE POLICY \\"Managers can view all meetings\\"\n  ON public.meetings\n  FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can insert meetings\nCREATE POLICY \\"Managers can insert meetings\\"\n  ON public.meetings\n  FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can update meetings\nCREATE POLICY \\"Managers can update meetings\\"\n  ON public.meetings\n  FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can delete meetings\nCREATE POLICY \\"Managers can delete meetings\\"\n  ON public.meetings\n  FOR DELETE\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Create function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_meetings_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger to automatically update updated_at\nCREATE TRIGGER update_meetings_updated_at\n  BEFORE UPDATE ON public.meetings\n  FOR EACH ROW\n  EXECUTE FUNCTION update_meetings_updated_at()","-- Add comments\nCOMMENT ON TABLE public.meetings IS 'Stores meeting data from Fillout form submissions'","COMMENT ON COLUMN public.meetings.lead_id IS 'Link to the lead that the meeting is associated with'","COMMENT ON COLUMN public.meetings.customer_id IS 'Link to the customer that the meeting is associated with'","COMMENT ON COLUMN public.meetings.fillout_submission_id IS 'Unique identifier from Fillout submission'","COMMENT ON COLUMN public.meetings.meeting_data IS 'Flexible JSONB containing all meeting data from Fillout form'"}	create_meetings
20260104000001	{"-- =====================================================\n-- Add 'meetings' to saved_views resource_key constraint\n-- Created: 2026-01-04\n-- Description: Allow saved views for meetings (Pegishot)\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'meetings'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets', 'meetings'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_meetings_to_saved_views
20260104000002	{"-- =====================================================\n-- Fix Meetings RLS Policies\n-- Created: 2026-01-04\n-- Description: Update RLS policies to use 'admin' and 'user' roles instead of 'manager'\n-- =====================================================\n\n-- Drop existing policies\nDROP POLICY IF EXISTS \\"Managers can view all meetings\\" ON public.meetings","DROP POLICY IF EXISTS \\"Managers can insert meetings\\" ON public.meetings","DROP POLICY IF EXISTS \\"Managers can update meetings\\" ON public.meetings","DROP POLICY IF EXISTS \\"Managers can delete meetings\\" ON public.meetings","-- Policy: Admins and users (managers) can view all meetings\nCREATE POLICY \\"Admins and users can view all meetings\\"\n  ON public.meetings\n  FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )","-- Policy: Admins and users can insert meetings\nCREATE POLICY \\"Admins and users can insert meetings\\"\n  ON public.meetings\n  FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )","-- Policy: Admins and users can update meetings\nCREATE POLICY \\"Admins and users can update meetings\\"\n  ON public.meetings\n  FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )","-- Policy: Admins and users can delete meetings\nCREATE POLICY \\"Admins and users can delete meetings\\"\n  ON public.meetings\n  FOR DELETE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_meetings_rls_policies
20260104000003	{"-- Migration: Backfill Meeting Data from Fillout\n-- Description: This migration provides a function to re-sync meeting_data from Fillout API\n--              for existing meetings that only have metadata. Run this manually via Supabase SQL editor\n--              or create an Edge Function to trigger it.\n-- Created: 2026-01-04\n\n-- Note: This migration doesn't automatically backfill data.\n-- To backfill existing meetings, you need to:\n-- 1. Call the sync-fillout-meetings Edge Function which will update existing meetings\n-- 2. Or manually update meetings via the Supabase dashboard\n-- 3. Or create a one-time script to fetch from Fillout API and update meeting_data\n\n-- The sync-fillout-meetings function has been updated to properly extract all question data\n-- including the Schedule field. When you run the sync, it will update existing meetings\n-- with the full meeting_data including all form fields.\n\n-- This migration file serves as documentation that the extraction logic has been improved.\n-- No database schema changes are needed as meeting_data is already JSONB and can store any structure.\n\nCOMMENT ON COLUMN public.meetings.meeting_data IS 'Flexible JSONB containing all meeting data from Fillout form, including Schedule field for actual meeting date/time'"}	backfill_meeting_data_from_fillout
20260104000004	{"-- =====================================================\n-- Add 'check_in_settings' to saved_views resource_key constraint\n-- Created: 2026-01-04\n-- Description: Allow saved views for check-in settings\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'check_in_settings'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets', 'meetings', 'check_in_settings'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_check_in_settings_to_saved_views
20260104000005	{"-- =====================================================\n-- Add attachment_url column to customer_notes table\n-- Created: 2026-01-04\n-- Description: Allow notes to have file attachments stored in Supabase Storage\n-- =====================================================\n\n-- Add attachment_url column to store the file path in Supabase Storage\nALTER TABLE customer_notes \n  ADD COLUMN IF NOT EXISTS attachment_url TEXT","-- Create index for faster queries on notes with attachments\nCREATE INDEX IF NOT EXISTS idx_customer_notes_attachment_url \n  ON customer_notes(attachment_url) \n  WHERE attachment_url IS NOT NULL","-- Add comment for documentation\nCOMMENT ON COLUMN customer_notes.attachment_url IS 'URL/path to file attachment in Supabase Storage (client-assets bucket)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_attachment_url_to_customer_notes
20260104000006	{"-- =====================================================\n-- Create client-assets storage bucket with RLS policies\n-- Created: 2026-01-04\n-- Description: Storage bucket for progress photos and note attachments\n-- Path structure: [client_id]/progress/[file_name] and [client_id]/notes/[file_name]\n-- \n-- NOTE: Storage buckets must be created via Supabase Dashboard or CLI.\n-- This migration only sets up RLS policies for the 'client-assets' bucket.\n-- \n-- To create the bucket:\n-- 1. Via Supabase Dashboard: Go to Storage > Create Bucket > Name: \\"client-assets\\" > Public: false\n-- 2. Via CLI: Use Supabase Management API or create manually in dashboard\n-- \n-- The bucket should have:\n-- - Name: client-assets\n-- - Public: false (private, uses signed URLs)\n-- - File size limit: 10MB\n-- - Allowed MIME types: image/*, application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document\n-- \n-- IMPORTANT: Storage must be enabled in supabase/config.toml ([storage] enabled = true)\n-- and the bucket must be created before these policies will work.\n-- \n-- For local development:\n-- 1. Enable storage in supabase/config.toml: [storage] enabled = true\n-- 2. Restart Supabase: npx supabase stop && npx supabase start\n-- 3. Create the bucket via Supabase Studio (http://localhost:54323) > Storage > Create Bucket\n-- \n-- If storage is not enabled locally, this migration will fail. That's expected.\n-- The migration will work correctly in production/remote Supabase where storage is enabled.\n-- =====================================================\n\n-- Only create policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- RLS Policy: Allow trainees to upload files to their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can upload to own client folder\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can upload to own client folder\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      (\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''progress''\n        OR\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''notes''\n      )\n    )';\n\n    -- RLS Policy: Allow trainees to view files in their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can view own client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can view own client files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      (\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''progress''\n        OR\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''notes''\n      )\n    )';\n\n    -- RLS Policy: Allow trainees to delete files from their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can delete own client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can delete own client files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      (\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''progress''\n        OR\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''notes''\n      )\n    )';\n\n    -- RLS Policy: Allow managers/admins to upload files for any client\n    DROP POLICY IF EXISTS \\"Managers can upload client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can upload client files\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (\n        (storage.foldername(name))[2] = ''progress'' OR\n        (storage.foldername(name))[2] = ''notes''\n      )\n    )';\n\n    -- RLS Policy: Allow managers/admins to view all client files\n    DROP POLICY IF EXISTS \\"Managers can view all client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can view all client files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      )\n    )';\n\n    -- RLS Policy: Allow managers/admins to delete all client files\n    DROP POLICY IF EXISTS \\"Managers can delete all client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can delete all client files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      )\n    )';\n\n    RAISE NOTICE 'Storage RLS policies created successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy creation. Enable storage in config.toml and restart Supabase to create policies.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_client_assets_storage_bucket
20260104000007	{"-- =====================================================\n-- Create Steps Plans Table Migration\n-- Created: 2026-01-04\n-- Description: Create steps_plans table similar to supplement_plans\n-- =====================================================\n\n-- =====================================================\n-- Create steps_plans table\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS steps_plans (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    customer_id UUID REFERENCES customers(id) ON DELETE SET NULL,\n    budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL,\n    template_id UUID, -- For future use if steps templates are created\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    end_date DATE,\n    description TEXT,\n    \n    -- Steps data\n    steps_goal INTEGER NOT NULL DEFAULT 0,\n    steps_instructions TEXT,\n    \n    -- Metadata\n    is_active BOOLEAN NOT NULL DEFAULT TRUE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_steps_plans_user_id ON steps_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_steps_plans_lead_id ON steps_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_steps_plans_customer_id ON steps_plans(customer_id)","CREATE INDEX IF NOT EXISTS idx_steps_plans_budget_id ON steps_plans(budget_id)","CREATE INDEX IF NOT EXISTS idx_steps_plans_start_date ON steps_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_steps_plans_created_at ON steps_plans(created_at DESC)","-- Trigger to auto-update updated_at\n-- Ensure the function exists first\nCREATE OR REPLACE FUNCTION public.update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = NOW();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","CREATE TRIGGER update_steps_plans_updated_at\n    BEFORE UPDATE ON steps_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES for steps_plans\n-- =====================================================\n\n-- Enable RLS on steps_plans table\nALTER TABLE steps_plans ENABLE ROW LEVEL SECURITY","-- Policy: Users can read their own steps plans\nCREATE POLICY \\"Users can read own steps plans\\"\n    ON steps_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own steps plans\nCREATE POLICY \\"Users can insert own steps plans\\"\n    ON steps_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own steps plans\nCREATE POLICY \\"Users can update own steps plans\\"\n    ON steps_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own steps plans\nCREATE POLICY \\"Users can delete own steps plans\\"\n    ON steps_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to steps plans\nCREATE POLICY \\"Admins have full access to steps plans\\"\n    ON steps_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE steps_plans IS 'Steps plans linked to leads/customers and budgets'","COMMENT ON COLUMN steps_plans.budget_id IS 'Reference to the budget this steps plan was created from'","COMMENT ON COLUMN steps_plans.steps_goal IS 'Daily steps goal for this plan'","COMMENT ON COLUMN steps_plans.steps_instructions IS 'Instructions and guidelines for daily steps'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_steps_plans
20260104000008	{"-- =====================================================\n-- Prevent Duplicate Plans Per Budget Migration\n-- Created: 2026-01-04\n-- Description: Prevents duplicate plans (workout, nutrition, steps, supplement) \n--              for the same budget + customer/lead combination\n-- =====================================================\n\n-- =====================================================\n-- STEP 1: Clean up existing duplicates\n-- Keep only the most recent plan per budget_id + customer_id/lead_id combination\n-- =====================================================\n\n-- Clean up duplicate workout_plans (only if budget_id column exists)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY created_at DESC\n        ) as rn\n      FROM workout_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM workout_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate nutrition_plans (only if budget_id column exists)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY created_at DESC\n        ) as rn\n      FROM nutrition_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM nutrition_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate steps_plans\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY created_at DESC\n        ) as rn\n      FROM steps_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM steps_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate supplement_plans (only if budget_id column exists)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY created_at DESC\n        ) as rn\n      FROM supplement_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM supplement_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- =====================================================\n-- STEP 2: Create unique partial indexes to prevent future duplicates\n-- These indexes ensure only one plan per budget + customer/lead combination\n-- =====================================================\n\n-- Unique index for workout_plans (when budget_id is set)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_workout_plans_unique_budget_customer\n    ON workout_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_workout_plans_unique_budget_lead\n    ON workout_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Unique index for nutrition_plans (when budget_id is set)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_nutrition_plans_unique_budget_customer\n    ON nutrition_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_nutrition_plans_unique_budget_lead\n    ON nutrition_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Unique index for steps_plans (when budget_id is set)\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_steps_plans_unique_budget_customer\n    ON steps_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_steps_plans_unique_budget_lead\n    ON steps_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Unique index for supplement_plans (when budget_id is set)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_supplement_plans_unique_budget_customer\n    ON supplement_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_supplement_plans_unique_budget_lead\n    ON supplement_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- =====================================================\n-- COMMENTS (only if indexes exist)\n-- =====================================================\n\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_workout_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_workout_plans_unique_budget_customer IS ''Ensures only one workout plan per budget + customer combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_workout_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_workout_plans_unique_budget_lead IS ''Ensures only one workout plan per budget + lead combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_nutrition_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_nutrition_plans_unique_budget_customer IS ''Ensures only one nutrition plan per budget + customer combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_nutrition_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_nutrition_plans_unique_budget_lead IS ''Ensures only one nutrition plan per budget + lead combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_supplement_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_supplement_plans_unique_budget_customer IS ''Ensures only one supplement plan per budget + customer combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_supplement_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_supplement_plans_unique_budget_lead IS ''Ensures only one supplement plan per budget + lead combination''';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	prevent_duplicate_plans_per_budget
20260104000009	{"-- =====================================================\n-- Create Payments Table\n-- Created: 2026-01-04\n-- Description: Secure payments table for tracking customer/lead payments\n--              NO sensitive data (card numbers, CVV, passwords) stored\n--              Links to both customers and leads\n-- =====================================================\n\n-- Create payments table\nCREATE TABLE IF NOT EXISTS public.payments (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    customer_id UUID NOT NULL REFERENCES public.customers(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES public.leads(id) ON DELETE SET NULL,\n    product_name TEXT NOT NULL,\n    amount NUMERIC(10, 2) NOT NULL CHECK (amount >= 0),\n    currency TEXT NOT NULL DEFAULT 'ILS',\n    status TEXT NOT NULL CHECK (status IN ('שולם', 'ממתין', 'הוחזר', 'נכשל')),\n    stripe_payment_id TEXT,\n    transaction_id TEXT,\n    receipt_url TEXT,\n    notes TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Create indexes for efficient queries\nCREATE INDEX IF NOT EXISTS idx_payments_customer_id ON public.payments(customer_id)","CREATE INDEX IF NOT EXISTS idx_payments_lead_id ON public.payments(lead_id)","CREATE INDEX IF NOT EXISTS idx_payments_created_at ON public.payments(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_payments_status ON public.payments(status)","CREATE INDEX IF NOT EXISTS idx_payments_stripe_payment_id ON public.payments(stripe_payment_id) WHERE stripe_payment_id IS NOT NULL","-- Create trigger for auto-updating updated_at\nCREATE TRIGGER update_payments_updated_at\n    BEFORE UPDATE ON public.payments\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS on payments table\nALTER TABLE public.payments ENABLE ROW LEVEL SECURITY","-- RLS Policies for payments\n-- Authenticated users can read payments for customers/leads they have access to\nDROP POLICY IF EXISTS \\"Authenticated users can read payments\\" ON public.payments","CREATE POLICY \\"Authenticated users can read payments\\"\n    ON public.payments FOR SELECT\n    USING (\n        auth.role() = 'authenticated' AND (\n            -- Users can see payments for customers they have access to\n            EXISTS (\n                SELECT 1 FROM public.customers\n                WHERE customers.id = payments.customer_id\n            )\n            OR\n            -- Admins can see all payments\n            EXISTS (\n                SELECT 1 FROM public.profiles\n                WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n            )\n        )\n    )","-- Authenticated users can insert payments\nDROP POLICY IF EXISTS \\"Authenticated users can insert payments\\" ON public.payments","CREATE POLICY \\"Authenticated users can insert payments\\"\n    ON public.payments FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","-- Authenticated users can update payments\nDROP POLICY IF EXISTS \\"Authenticated users can update payments\\" ON public.payments","CREATE POLICY \\"Authenticated users can update payments\\"\n    ON public.payments FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","-- Admins have full access to payments\nDROP POLICY IF EXISTS \\"Admins have full access to payments\\" ON public.payments","CREATE POLICY \\"Admins have full access to payments\\"\n    ON public.payments FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n        )\n    )","-- Add comment to table\nCOMMENT ON TABLE public.payments IS 'Customer/lead payment records. NO sensitive payment data (card numbers, CVV, passwords) stored.'","COMMENT ON COLUMN public.payments.stripe_payment_id IS 'Stripe payment intent ID - external reference only'","COMMENT ON COLUMN public.payments.transaction_id IS 'Transaction ID for tracking purposes'","COMMENT ON COLUMN public.payments.receipt_url IS 'URL to receipt document (stored in secure storage)'","COMMENT ON COLUMN public.payments.status IS 'Payment status in Hebrew: שולם (paid), ממתין (pending), הוחזר (refunded), נכשל (failed)'"}	create_payments
20260111161628	{"-- Migration: Add Media Support to WhatsApp Flow Templates\n-- Description: Adds media column to store image, video, or GIF URLs\n-- Created: 2026-01-11\n\n-- Add media column to whatsapp_flow_templates table\n-- Media is stored as JSONB with structure: { type: 'image'|'video'|'gif', url: string }\nALTER TABLE public.whatsapp_flow_templates\nADD COLUMN IF NOT EXISTS media JSONB DEFAULT NULL","-- Add comment\nCOMMENT ON COLUMN public.whatsapp_flow_templates.media IS 'Media attachment for template (image, video, or GIF) stored as JSONB: { type: \\"image\\"|\\"video\\"|\\"gif\\", url: string }'","-- Add index for faster queries if needed\nCREATE INDEX IF NOT EXISTS idx_whatsapp_flow_templates_media \nON public.whatsapp_flow_templates USING gin(media)"}	add_media_to_whatsapp_templates
20260111162708	{"-- =====================================================\n-- Ensure client-assets storage bucket exists with templates folder policies\n-- Created: 2026-01-11\n-- Description: Ensures the client-assets bucket exists and has RLS policies for templates folder\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Ensure storage bucket exists (idempotent)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'buckets'\n  ) THEN\n    -- Insert bucket if it doesn't exist (idempotent)\n    INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)\n    VALUES (\n      'client-assets',\n      'client-assets',\n      false, -- private bucket (uses signed URLs)\n      52428800, -- 50MB file size limit (in bytes) - matches config.toml\n      ARRAY[\n        'image/jpeg',\n        'image/jpg', \n        'image/png',\n        'image/gif',\n        'image/webp',\n        'video/mp4',\n        'video/mpeg',\n        'video/quicktime',\n        'application/pdf',\n        'application/msword',\n        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n      ]::text[]\n    )\n    ON CONFLICT (id) DO UPDATE SET\n      file_size_limit = EXCLUDED.file_size_limit,\n      allowed_mime_types = EXCLUDED.allowed_mime_types;\n    \n    RAISE NOTICE 'Storage bucket \\"client-assets\\" ensured successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping bucket creation. Enable storage in config.toml and restart Supabase.';\n  END IF;\nEND $$","-- Add RLS policies for templates folder if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- RLS Policy: Allow authenticated users (managers/admins) to upload template files\n    -- Path structure: templates/{user_id}/{flow_key}/{filename}\n    DROP POLICY IF EXISTS \\"Managers can upload template files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can upload template files\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''templates''\n    )';\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to view template files\n    DROP POLICY IF EXISTS \\"Managers can view template files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can view template files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''templates''\n    )';\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to delete template files\n    DROP POLICY IF EXISTS \\"Managers can delete template files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can delete template files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''templates''\n    )';\n\n    RAISE NOTICE 'Storage RLS policies for templates folder created successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy creation. Enable storage in config.toml and restart Supabase to create policies.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	ensure_client_assets_storage_bucket
20260112000000	{"-- =====================================================\n-- Add Storage Policies for Workout Exercises Media\n-- Created: 2026-01-12\n-- Description: Adds RLS policies to allow managers/admins to upload and manage\n--              images and videos for workout exercises in the client-assets bucket\n-- Path structure: workout-exercises/[exercise_id]/[images|videos]/[file_name]\n-- =====================================================\n\n-- Only create policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- RLS Policy: Allow managers/admins to upload workout exercise media\n    DROP POLICY IF EXISTS \\"Managers can upload workout exercise media\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can upload workout exercise media\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''workout-exercises''\n    )';\n\n    -- RLS Policy: Allow managers/admins to view workout exercise media\n    DROP POLICY IF EXISTS \\"Managers can view workout exercise media\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can view workout exercise media\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      (\n        EXISTS (\n          SELECT 1 FROM profiles\n          WHERE profiles.id = auth.uid()\n          AND profiles.role IN (''admin'', ''user'')\n        ) AND\n        (storage.foldername(name))[1] = ''workout-exercises''\n      )\n    )';\n\n    -- RLS Policy: Allow managers/admins to delete workout exercise media\n    DROP POLICY IF EXISTS \\"Managers can delete workout exercise media\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can delete workout exercise media\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''workout-exercises''\n    )';\n\n    RAISE NOTICE 'Workout exercises storage RLS policies created successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy creation. Enable storage in config.toml and restart Supabase to create policies.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_workout_exercises_storage_policies
20260113000000	{"-- =====================================================\n-- Subscription Types (Sugei Menuyim) Migration\n-- Created: 2026-01-13\n-- Description: Master subscription type templates for leads\n-- =====================================================\n\n-- =====================================================\n-- TABLE: subscription_types\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS subscription_types (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name TEXT NOT NULL,\n    duration INTEGER NOT NULL, -- Duration in months\n    price NUMERIC(10, 2) NOT NULL, -- Price in NIS\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_subscription_types_created_by ON subscription_types(created_by)","CREATE INDEX IF NOT EXISTS idx_subscription_types_created_at ON subscription_types(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_subscription_types_updated_at\n    BEFORE UPDATE ON subscription_types\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on subscription_types table\nALTER TABLE subscription_types ENABLE ROW LEVEL SECURITY","-- Policy: Users can view all subscription types\nCREATE POLICY \\"Users can view subscription types\\"\n    ON subscription_types FOR SELECT\n    USING (true)","-- Policy: Users can insert their own subscription types\nCREATE POLICY \\"Users can insert own subscription types\\"\n    ON subscription_types FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own subscription types\nCREATE POLICY \\"Users can update own subscription types\\"\n    ON subscription_types FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own subscription types\nCREATE POLICY \\"Users can delete own subscription types\\"\n    ON subscription_types FOR DELETE\n    USING (auth.uid() = created_by)","-- Policy: Admins have full access to subscription types\nCREATE POLICY \\"Admins have full access to subscription types\\"\n    ON subscription_types FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE subscription_types IS 'Master subscription type templates that can be used to populate lead subscription data'","COMMENT ON COLUMN subscription_types.duration IS 'Duration in months (e.g., 3, 6, 12)'","COMMENT ON COLUMN subscription_types.price IS 'Price in NIS (e.g., 299.99)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_subscription_types
20260114000000	{"-- =====================================================\n-- Blood Tests (Bedikot Dam) Migration\n-- Created: 2026-01-14\n-- Description: Blood test PDF uploads for leads\n-- =====================================================\n\n-- =====================================================\n-- TABLE: blood_tests\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS blood_tests (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    lead_id UUID NOT NULL REFERENCES leads(id) ON DELETE CASCADE,\n    file_url TEXT NOT NULL, -- Storage path in client-assets bucket\n    file_name TEXT NOT NULL, -- Original file name\n    upload_date TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    uploaded_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_blood_tests_lead_id ON blood_tests(lead_id)","CREATE INDEX IF NOT EXISTS idx_blood_tests_upload_date ON blood_tests(upload_date DESC)","CREATE INDEX IF NOT EXISTS idx_blood_tests_uploaded_by ON blood_tests(uploaded_by)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_blood_tests_updated_at\n    BEFORE UPDATE ON blood_tests\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on blood_tests table\nALTER TABLE blood_tests ENABLE ROW LEVEL SECURITY","-- Policy: Users can view blood tests for leads they have access to\nCREATE POLICY \\"Users can view blood tests for accessible leads\\"\n    ON blood_tests FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM leads\n            WHERE leads.id = blood_tests.lead_id\n            AND (\n                leads.assigned_to = auth.uid()\n                OR EXISTS (\n                    SELECT 1 FROM profiles\n                    WHERE profiles.id = auth.uid()\n                    AND profiles.role IN ('admin', 'user')\n                )\n                OR EXISTS (\n                    SELECT 1 FROM customers\n                    JOIN leads ON leads.customer_id = customers.id\n                    WHERE leads.id = blood_tests.lead_id\n                    AND customers.id IN (\n                        SELECT customer_id FROM profiles\n                        WHERE profiles.id = auth.uid()\n                        AND profiles.role = 'trainee'\n                    )\n                )\n            )\n        )\n    )","-- Policy: Trainees can insert blood tests for their own customer's leads\nCREATE POLICY \\"Trainees can insert blood tests for their customer\\"\n    ON blood_tests FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM leads\n            JOIN customers ON customers.id = leads.customer_id\n            WHERE leads.id = blood_tests.lead_id\n            AND customers.id IN (\n                SELECT customer_id FROM profiles\n                WHERE profiles.id = auth.uid()\n                AND profiles.role = 'trainee'\n            )\n        )\n        AND auth.uid() = uploaded_by\n    )","-- Policy: Managers/admins can insert blood tests for any lead\nCREATE POLICY \\"Managers can insert blood tests\\"\n    ON blood_tests FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE profiles.id = auth.uid()\n            AND profiles.role IN ('admin', 'user')\n        )\n        AND (\n            auth.uid() = uploaded_by\n            OR uploaded_by IS NULL\n        )\n    )","-- Policy: Trainees can delete their own blood tests\nCREATE POLICY \\"Trainees can delete their own blood tests\\"\n    ON blood_tests FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM leads\n            JOIN customers ON customers.id = leads.customer_id\n            WHERE leads.id = blood_tests.lead_id\n            AND customers.id IN (\n                SELECT customer_id FROM profiles\n                WHERE profiles.id = auth.uid()\n                AND profiles.role = 'trainee'\n            )\n        )\n        AND uploaded_by = auth.uid()\n    )","-- Policy: Managers/admins can delete any blood test\nCREATE POLICY \\"Managers can delete blood tests\\"\n    ON blood_tests FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE profiles.id = auth.uid()\n            AND profiles.role IN ('admin', 'user')\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE blood_tests IS 'Blood test PDF files uploaded by clients or managers'","COMMENT ON COLUMN blood_tests.lead_id IS 'Reference to the lead (client)'","COMMENT ON COLUMN blood_tests.file_url IS 'Storage path in client-assets bucket (e.g., customer_id/blood-tests/filename.pdf)'","COMMENT ON COLUMN blood_tests.file_name IS 'Original file name for display'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_blood_tests
20260114000001	{"-- =====================================================\n-- Add Storage Policies for Blood Tests\n-- Created: 2026-01-14\n-- Description: Add RLS policies for blood-tests folder in client-assets bucket\n-- =====================================================\n\n-- Only create policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- RLS Policy: Allow trainees to upload blood test PDFs to their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can upload blood tests to own client folder\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can upload blood tests to own client folder\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = (storage.foldername(name))[1]\n        AND customers.user_id = auth.uid()\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow trainees to view blood test PDFs in their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can view own blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can view own blood tests\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = (storage.foldername(name))[1]\n        AND customers.user_id = auth.uid()\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow trainees to delete blood test PDFs from their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can delete own blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can delete own blood tests\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = (storage.foldername(name))[1]\n        AND customers.user_id = auth.uid()\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow managers/admins to upload blood test PDFs for any client\n    DROP POLICY IF EXISTS \\"Managers can upload blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can upload blood tests\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow managers/admins to view all blood test PDFs\n    DROP POLICY IF EXISTS \\"Managers can view all blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can view all blood tests\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow managers/admins to delete all blood test PDFs\n    DROP POLICY IF EXISTS \\"Managers can delete all blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can delete all blood tests\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    RAISE NOTICE 'Blood tests storage RLS policies created successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy creation. Enable storage in config.toml and restart Supabase to create policies.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_blood_tests_storage_policies
20260115000000	{"-- Add active flag to profiles for trainee activation control\nALTER TABLE public.profiles\n  ADD COLUMN IF NOT EXISTS is_active BOOLEAN NOT NULL DEFAULT true","COMMENT ON COLUMN public.profiles.is_active IS 'Whether the user account is active (trainee access gating)'"}	add_profiles_is_active
20260125000002	{"-- =====================================================\n-- Add collection_id to payments table\n-- Created: 2026-01-25\n-- Description: Link payments to collections (optional)\n--              Payments can exist without a collection\n-- =====================================================\n\n-- Add collection_id column to payments table (nullable - payments can exist without a collection)\nALTER TABLE public.payments \nADD COLUMN IF NOT EXISTS collection_id UUID REFERENCES public.collections(id) ON DELETE SET NULL","-- Create index for efficient queries\nCREATE INDEX IF NOT EXISTS idx_payments_collection_id ON public.payments(collection_id)","-- Add comment\nCOMMENT ON COLUMN public.payments.collection_id IS 'Optional link to a collection (גבייה). Payments can exist without a collection.'"}	add_collection_id_to_payments
20260115000001	{"-- =====================================================\n-- Create Internal Knowledge Base Table\n-- Created: 2026-01-15\n-- Description: Internal knowledge base for storing video links and resources\n--              For internal usage by staff/managers (NOT customer-related)\n-- =====================================================\n\n-- Create internal_knowledge_base table\nCREATE TABLE IF NOT EXISTS public.internal_knowledge_base (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    title TEXT NOT NULL,\n    description TEXT,\n    video_url TEXT NOT NULL, -- Video link (URL only, no storage)\n    tags TEXT[] DEFAULT '{}', -- Array of tags for categorization\n    duration INTEGER, -- Duration in seconds (optional)\n    additional_info JSONB DEFAULT '{}'::jsonb, -- Flexible additional metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Create indexes for efficient queries\nCREATE INDEX IF NOT EXISTS idx_internal_kb_created_at ON public.internal_knowledge_base(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_internal_kb_tags ON public.internal_knowledge_base USING GIN (tags)","CREATE INDEX IF NOT EXISTS idx_internal_kb_title ON public.internal_knowledge_base(title)","CREATE INDEX IF NOT EXISTS idx_internal_kb_created_by ON public.internal_knowledge_base(created_by)","-- Create trigger for auto-updating updated_at\nCREATE TRIGGER update_internal_kb_updated_at\n    BEFORE UPDATE ON public.internal_knowledge_base\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS on internal_knowledge_base table\nALTER TABLE public.internal_knowledge_base ENABLE ROW LEVEL SECURITY","-- RLS Policies for internal_knowledge_base\n-- Authenticated users (staff/managers) can read all entries\nDROP POLICY IF EXISTS \\"Authenticated users can read knowledge base\\" ON public.internal_knowledge_base","CREATE POLICY \\"Authenticated users can read knowledge base\\"\n    ON public.internal_knowledge_base FOR SELECT\n    USING (auth.role() = 'authenticated')","-- Authenticated users can insert entries\nDROP POLICY IF EXISTS \\"Authenticated users can insert knowledge base\\" ON public.internal_knowledge_base","CREATE POLICY \\"Authenticated users can insert knowledge base\\"\n    ON public.internal_knowledge_base FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","-- Authenticated users can update entries\nDROP POLICY IF EXISTS \\"Authenticated users can update knowledge base\\" ON public.internal_knowledge_base","CREATE POLICY \\"Authenticated users can update knowledge base\\"\n    ON public.internal_knowledge_base FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","-- Authenticated users can delete entries\nDROP POLICY IF EXISTS \\"Authenticated users can delete knowledge base\\" ON public.internal_knowledge_base","CREATE POLICY \\"Authenticated users can delete knowledge base\\"\n    ON public.internal_knowledge_base FOR DELETE\n    USING (auth.role() = 'authenticated')","-- Add comment to table\nCOMMENT ON TABLE public.internal_knowledge_base IS 'Internal knowledge base for storing video links and resources for staff/managers (NOT customer-related)'","COMMENT ON COLUMN public.internal_knowledge_base.video_url IS 'Video link URL (external link, no storage)'","COMMENT ON COLUMN public.internal_knowledge_base.tags IS 'Array of tags for categorization and filtering'","COMMENT ON COLUMN public.internal_knowledge_base.duration IS 'Duration in seconds (optional)'","COMMENT ON COLUMN public.internal_knowledge_base.additional_info IS 'Flexible JSONB field for additional metadata'"}	create_internal_knowledge_base
20260115000002	{"-- =====================================================\n-- Make video_url optional in internal_knowledge_base\n-- Created: 2026-01-15\n-- Description: Allow video_url to be NULL\n-- =====================================================\n\nALTER TABLE public.internal_knowledge_base \n  ALTER COLUMN video_url DROP NOT NULL"}	make_video_url_optional
20260120000000	{"-- Add customer_id to profiles for trainee/customer linkage\nALTER TABLE public.profiles\n    ADD COLUMN IF NOT EXISTS customer_id UUID REFERENCES public.customers(id) ON DELETE SET NULL","CREATE INDEX IF NOT EXISTS idx_profiles_customer_id ON public.profiles(customer_id)","COMMENT ON COLUMN public.profiles.customer_id IS 'Linked customer for trainee users'","-- Backfill existing links from customers.user_id\nUPDATE public.profiles p\nSET customer_id = c.id\nFROM public.customers c\nWHERE c.user_id = p.id\n  AND p.customer_id IS NULL"}	add_profiles_customer_id
20260120000001	{"-- =====================================================\n-- Add age column alongside birth_date\n-- Created: 2026-01-16\n-- Description: Adds age column to leads table while keeping birth_date\n--              Age can be manually entered, independent of birth_date\n-- =====================================================\n\nSET search_path TO public","-- Step 1: Add age column to leads table (keep birth_date)\nALTER TABLE public.leads \nADD COLUMN IF NOT EXISTS age INTEGER","-- Step 2: Create index for age column\nCREATE INDEX IF NOT EXISTS idx_leads_age ON public.leads(age) WHERE age IS NOT NULL","-- Step 3: Drop and recreate the view to include both birth_date and age\nDROP VIEW IF EXISTS public.v_leads_with_customer CASCADE","CREATE VIEW public.v_leads_with_customer AS\nSELECT \n    l.id,\n    l.created_at,\n    l.updated_at,\n    l.assigned_to,\n    l.customer_id,\n    l.city,\n    l.birth_date,\n    l.age,\n    l.gender,\n    l.status_main,\n    l.status_sub,\n    l.height,\n    l.weight,\n    l.bmi,\n    l.join_date,\n    l.subscription_data,\n    l.daily_protocol,\n    l.workout_history,\n    l.steps_history,\n    l.source,\n    l.fitness_goal,\n    l.activity_level,\n    l.preferred_time,\n    l.notes,\n    -- Customer data (joined)\n    c.full_name as customer_name,\n    c.phone as customer_phone,\n    c.email as customer_email,\n    -- Calculated fields (PostgreSQL does the math)\n    TO_CHAR(l.created_at, 'YYYY-MM-DD') as created_date_formatted,\n    TO_CHAR(l.birth_date, 'YYYY-MM-DD') as birth_date_formatted,\n    -- Extract JSONB fields (PostgreSQL parses JSON)\n    (l.daily_protocol->>'stepsGoal')::INTEGER as daily_steps_goal,\n    (l.daily_protocol->>'workoutGoal')::INTEGER as weekly_workouts,\n    -- Extract supplements array from JSONB (handle both array and null)\n    CASE \n        WHEN l.daily_protocol->'supplements' IS NULL THEN ARRAY[]::TEXT[]\n        WHEN jsonb_typeof(l.daily_protocol->'supplements') = 'array' \n        THEN ARRAY(SELECT jsonb_array_elements_text(l.daily_protocol->'supplements'))\n        ELSE ARRAY[]::TEXT[]\n    END as daily_supplements,\n    (l.subscription_data->>'months')::INTEGER as subscription_months,\n    (l.subscription_data->>'initialPrice')::DECIMAL as subscription_initial_price,\n    (l.subscription_data->>'renewalPrice')::DECIMAL as subscription_renewal_price\nFROM public.leads l\nLEFT JOIN public.customers c ON l.customer_id = c.id","-- Step 7: Update get_filtered_leads function to use age instead of birth_date\nCREATE OR REPLACE FUNCTION public.get_filtered_leads(\n    p_limit_count INTEGER DEFAULT 100,\n    p_offset_count INTEGER DEFAULT 0,\n    p_search_query TEXT DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_date TEXT DEFAULT NULL\n)\nRETURNS TABLE (\n    id UUID,\n    created_at TIMESTAMP WITH TIME ZONE,\n    updated_at TIMESTAMP WITH TIME ZONE,\n    assigned_to UUID,\n    customer_id UUID,\n    city TEXT,\n    birth_date DATE,\n    age INTEGER,\n    gender TEXT,\n    status_main TEXT,\n    status_sub TEXT,\n    height DECIMAL,\n    weight DECIMAL,\n    bmi DECIMAL,\n    join_date TIMESTAMP WITH TIME ZONE,\n    subscription_data JSONB,\n    daily_protocol JSONB,\n    workout_history JSONB,\n    steps_history JSONB,\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT,\n    customer_name TEXT,\n    customer_phone TEXT,\n    customer_email TEXT,\n    created_date_formatted TEXT,\n    birth_date_formatted TEXT,\n    daily_steps_goal INTEGER,\n    weekly_workouts INTEGER,\n    daily_supplements TEXT[],\n    subscription_months INTEGER,\n    subscription_initial_price DECIMAL,\n    subscription_renewal_price DECIMAL\n)\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nBEGIN\n    RETURN QUERY\n    SELECT \n        v.id,\n        v.created_at,\n        v.updated_at,\n        v.assigned_to,\n        v.customer_id,\n        v.city,\n        v.birth_date,\n        v.age,\n        v.gender,\n        v.status_main,\n        v.status_sub,\n        v.height,\n        v.weight,\n        v.bmi,\n        v.join_date,\n        v.subscription_data,\n        v.daily_protocol,\n        v.workout_history,\n        v.steps_history,\n        v.source,\n        v.fitness_goal,\n        v.activity_level,\n        v.preferred_time,\n        v.notes,\n        v.customer_name,\n        v.customer_phone,\n        v.customer_email,\n        v.created_date_formatted,\n        v.birth_date_formatted,\n        v.daily_steps_goal,\n        v.weekly_workouts,\n        v.daily_supplements,\n        v.subscription_months,\n        v.subscription_initial_price,\n        v.subscription_renewal_price\n    FROM public.v_leads_with_customer v\n    WHERE \n        -- Search query (name, phone, email)\n        (p_search_query IS NULL OR \n         v.customer_name ILIKE '%' || p_search_query || '%' OR\n         v.customer_phone ILIKE '%' || p_search_query || '%' OR\n         v.customer_email ILIKE '%' || p_search_query || '%')\n        -- Status filter\n        AND (p_status_main IS NULL OR v.status_main = p_status_main)\n        AND (p_status_sub IS NULL OR v.status_sub = p_status_sub)\n        -- Source filter\n        AND (p_source IS NULL OR v.source = p_source)\n        -- Fitness goal filter\n        AND (p_fitness_goal IS NULL OR v.fitness_goal = p_fitness_goal)\n        -- Activity level filter\n        AND (p_activity_level IS NULL OR v.activity_level = p_activity_level)\n        -- Preferred time filter\n        AND (p_preferred_time IS NULL OR v.preferred_time = p_preferred_time)\n        -- Age filter (now using age column directly)\n        AND (p_age IS NULL OR v.age::TEXT = p_age)\n        -- Height filter\n        AND (p_height IS NULL OR v.height::TEXT = p_height)\n        -- Weight filter\n        AND (p_weight IS NULL OR v.weight::TEXT = p_weight)\n        -- Date filter (created_at date)\n        AND (p_date IS NULL OR v.created_date_formatted = p_date)\n    ORDER BY v.created_at DESC\n    LIMIT p_limit_count\n    OFFSET p_offset_count;\nEND;\n$$","-- Step 8: Update get_lead_filter_options function to use age column\nCREATE OR REPLACE FUNCTION public.get_lead_filter_options()\nRETURNS JSONB\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    result JSONB;\nBEGIN\n    SELECT jsonb_build_object(\n        'statuses', ARRAY(SELECT DISTINCT status_main FROM public.leads WHERE status_main IS NOT NULL ORDER BY status_main)::TEXT[],\n        'sources', ARRAY(SELECT DISTINCT source FROM public.leads WHERE source IS NOT NULL ORDER BY source)::TEXT[],\n        'fitness_goals', ARRAY(SELECT DISTINCT fitness_goal FROM public.leads WHERE fitness_goal IS NOT NULL ORDER BY fitness_goal)::TEXT[],\n        'activity_levels', ARRAY(SELECT DISTINCT activity_level FROM public.leads WHERE activity_level IS NOT NULL ORDER BY activity_level)::TEXT[],\n        'preferred_times', ARRAY(SELECT DISTINCT preferred_time FROM public.leads WHERE preferred_time IS NOT NULL ORDER BY preferred_time)::TEXT[],\n        'ages', ARRAY(SELECT DISTINCT age::TEXT \n                      FROM public.leads \n                      WHERE age IS NOT NULL \n                      ORDER BY age)::TEXT[],\n        'heights', ARRAY(SELECT DISTINCT height::TEXT \n                         FROM public.leads \n                         WHERE height IS NOT NULL \n                         ORDER BY height)::TEXT[],\n        'weights', ARRAY(SELECT DISTINCT weight::TEXT \n                         FROM public.leads \n                         WHERE weight IS NOT NULL \n                         ORDER BY weight)::TEXT[]\n    ) INTO result;\n    \n    RETURN result;\nEND;\n$$","-- Step 9: Update comments\nCOMMENT ON COLUMN public.leads.age IS 'Age in years. Can be manually entered, independent of birth_date.'","COMMENT ON COLUMN public.leads.birth_date IS 'Birth date. Can be entered manually, independent of age.'","COMMENT ON VIEW public.v_leads_with_customer IS 'Pre-joined view of leads with customer data and calculated fields. Includes both birth_date and age columns.'","COMMENT ON FUNCTION public.get_filtered_leads(INTEGER, INTEGER, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) IS 'RPC function for complex lead filtering. All filtering happens in PostgreSQL. Includes both birth_date and age columns.'","COMMENT ON FUNCTION public.get_lead_filter_options() IS 'Returns distinct filter values for dropdowns. Uses age column directly.'"}	replace_birth_date_with_age
20260120000002	{"-- =====================================================\n-- Add period boolean field to leads table\n-- Created: 2026-01-20\n-- Description: Adds period field to personal information section\n--              This is a boolean field to track menstrual period status\n-- =====================================================\n\nSET search_path TO public","-- Add period column to leads table\nALTER TABLE public.leads \nADD COLUMN IF NOT EXISTS period BOOLEAN DEFAULT NULL","-- Create index for period column\nCREATE INDEX IF NOT EXISTS idx_leads_period ON public.leads(period) WHERE period IS NOT NULL","-- Update the view to include period field\nDROP VIEW IF EXISTS public.v_leads_with_customer CASCADE","CREATE VIEW public.v_leads_with_customer AS\nSELECT \n    l.id,\n    l.created_at,\n    l.updated_at,\n    l.assigned_to,\n    l.customer_id,\n    l.city,\n    l.birth_date,\n    l.age,\n    l.gender,\n    l.period,\n    l.status_main,\n    l.status_sub,\n    l.height,\n    l.weight,\n    l.bmi,\n    l.join_date,\n    l.subscription_data,\n    l.daily_protocol,\n    l.workout_history,\n    l.steps_history,\n    l.source,\n    l.fitness_goal,\n    l.activity_level,\n    l.preferred_time,\n    l.notes,\n    -- Customer data (joined)\n    c.full_name as customer_name,\n    c.phone as customer_phone,\n    c.email as customer_email,\n    -- Calculated fields (PostgreSQL does the math)\n    TO_CHAR(l.created_at, 'YYYY-MM-DD') as created_date_formatted,\n    TO_CHAR(l.birth_date, 'YYYY-MM-DD') as birth_date_formatted,\n    -- Extract JSONB fields (PostgreSQL parses JSON)\n    (l.daily_protocol->>'stepsGoal')::INTEGER as daily_steps_goal,\n    (l.daily_protocol->>'workoutGoal')::INTEGER as weekly_workouts,\n    -- Extract supplements array from JSONB (handle both array and null)\n    CASE \n        WHEN l.daily_protocol->'supplements' IS NULL THEN ARRAY[]::TEXT[]\n        WHEN jsonb_typeof(l.daily_protocol->'supplements') = 'array' \n        THEN ARRAY(SELECT jsonb_array_elements_text(l.daily_protocol->'supplements'))\n        ELSE ARRAY[]::TEXT[]\n    END as daily_supplements,\n    (l.subscription_data->>'months')::INTEGER as subscription_months,\n    (l.subscription_data->>'initialPrice')::DECIMAL as subscription_initial_price,\n    (l.subscription_data->>'renewalPrice')::DECIMAL as subscription_renewal_price\nFROM public.leads l\nLEFT JOIN public.customers c ON l.customer_id = c.id","-- Grant permissions on the view\nGRANT SELECT ON public.v_leads_with_customer TO authenticated","GRANT SELECT ON public.v_leads_with_customer TO anon"}	add_period_field
20260120000003	{"-- =====================================================\n-- Add currency field to subscription_types table\n-- Created: 2026-01-20\n-- Description: Adds currency column to subscription types\n--              Supports ILS, USD, EUR currencies\n--              Defaults to 'ILS' for backward compatibility\n-- =====================================================\n\nSET search_path TO public","-- Add currency column to subscription_types table\nALTER TABLE public.subscription_types \nADD COLUMN IF NOT EXISTS currency TEXT DEFAULT 'ILS' NOT NULL CHECK (currency IN ('ILS', 'USD', 'EUR'))","-- Create index for currency column\nCREATE INDEX IF NOT EXISTS idx_subscription_types_currency ON public.subscription_types(currency)","-- Update comment for price column\nCOMMENT ON COLUMN public.subscription_types.price IS 'Price amount (value varies based on currency)'","COMMENT ON COLUMN public.subscription_types.currency IS 'Currency code: ILS (Israeli Shekel), USD (US Dollar), or EUR (Euro)'"}	add_currency_to_subscription_types
20260120000004	{"-- Create notifications table for real-time activity tracking\n-- This table stores notifications for admin users when trainees perform actions\n\nCREATE TABLE IF NOT EXISTS notifications (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n  lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n  type TEXT NOT NULL, -- e.g., 'weight_updated', 'meal_logged', 'check_in_completed', etc.\n  title TEXT NOT NULL, -- e.g., \\"עדכון משקל\\"\n  message TEXT NOT NULL, -- e.g., \\"יוסי כהן עדכן את המשקל ל-75 ק״ג\\"\n  action_url TEXT, -- URL to navigate when clicking notification (e.g., \\"/customers/{customer_id}\\")\n  is_read BOOLEAN DEFAULT FALSE,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  read_at TIMESTAMPTZ,\n  \n  -- Metadata for additional context\n  metadata JSONB DEFAULT '{}'::jsonb\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_notifications_user_id ON notifications(user_id)","CREATE INDEX IF NOT EXISTS idx_notifications_user_read ON notifications(user_id, is_read)","CREATE INDEX IF NOT EXISTS idx_notifications_created_at ON notifications(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_notifications_customer_id ON notifications(customer_id)","CREATE INDEX IF NOT EXISTS idx_notifications_lead_id ON notifications(lead_id)","-- RLS Policies\nALTER TABLE notifications ENABLE ROW LEVEL SECURITY","-- Policy: Users can only see their own notifications\nCREATE POLICY \\"Users can view their own notifications\\"\n  ON notifications\n  FOR SELECT\n  USING (auth.uid() = user_id)","-- Policy: System can create notifications for any user\n-- (This will be used by Edge Functions or service role)\nCREATE POLICY \\"Service role can create notifications\\"\n  ON notifications\n  FOR INSERT\n  WITH CHECK (true)","-- Policy: Users can update their own notifications (mark as read)\nCREATE POLICY \\"Users can update their own notifications\\"\n  ON notifications\n  FOR UPDATE\n  USING (auth.uid() = user_id)\n  WITH CHECK (auth.uid() = user_id)","-- Function to mark notification as read\nCREATE OR REPLACE FUNCTION mark_notification_read(notification_id UUID)\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nBEGIN\n  UPDATE notifications\n  SET is_read = TRUE,\n      read_at = NOW()\n  WHERE id = notification_id\n    AND user_id = auth.uid();\nEND;\n$$","-- Function to mark all notifications as read for a user\nCREATE OR REPLACE FUNCTION mark_all_notifications_read()\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nBEGIN\n  UPDATE notifications\n  SET is_read = TRUE,\n      read_at = NOW()\n  WHERE user_id = auth.uid()\n    AND is_read = FALSE;\nEND;\n$$","-- Function to get unread notification count\nCREATE OR REPLACE FUNCTION get_unread_notification_count()\nRETURNS INTEGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nDECLARE\n  count INTEGER;\nBEGIN\n  SELECT COUNT(*)::INTEGER\n  INTO count\n  FROM notifications\n  WHERE user_id = auth.uid()\n    AND is_read = FALSE;\n  \n  RETURN COALESCE(count, 0);\nEND;\n$$","-- Grant execute permissions\nGRANT EXECUTE ON FUNCTION mark_notification_read(UUID) TO authenticated","GRANT EXECUTE ON FUNCTION mark_all_notifications_read() TO authenticated","GRANT EXECUTE ON FUNCTION get_unread_notification_count() TO authenticated","-- Comments\nCOMMENT ON TABLE notifications IS 'Stores real-time notifications for admin users about trainee activities'","COMMENT ON COLUMN notifications.type IS 'Type of notification: weight_updated, meal_logged, check_in_completed, etc.'","COMMENT ON COLUMN notifications.action_url IS 'URL to navigate when clicking the notification'","COMMENT ON COLUMN notifications.metadata IS 'Additional context data in JSON format'"}	create_notifications
20260120000005	{"-- =====================================================\n-- Fix templates folder storage RLS policies\n-- Created: 2026-01-20\n-- Description: Updates RLS policies for templates folder to use more reliable path matching\n--              Replaces storage.foldername(name)[1] with starts_with() for better reliability\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Only update policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Drop existing policies\n    DROP POLICY IF EXISTS \\"Managers can upload template files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view template files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete template files\\" ON storage.objects;\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to upload template files\n    -- Path structure: templates/{user_id}/{flow_key}/{filename}\n    -- Using starts_with() for more reliable path matching\n    CREATE POLICY \\"Managers can upload template files\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      name LIKE 'templates/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to view template files\n    CREATE POLICY \\"Managers can view template files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'templates/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to delete template files\n    CREATE POLICY \\"Managers can delete template files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'templates/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    RAISE NOTICE 'Storage RLS policies for templates folder updated successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy update. Enable storage in config.toml and restart Supabase.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_templates_storage_rls
20260120000006	{"-- =====================================================\n-- Add Manual Override Fields to Nutrition Templates\n-- Created: 2026-01-20\n-- Description: Adds manual override state tracking and new fields (steps, workouts, supplements)\n--              to allow professional users to set values manually without auto-calculation\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Add manual override tracking and new fields to nutrition_templates\nALTER TABLE nutrition_templates\n  ADD COLUMN IF NOT EXISTS manual_override JSONB DEFAULT '{}'::jsonb,\n  -- Structure: { calories: boolean, protein: boolean, carbs: boolean, fat: boolean, fiber: boolean }\n  -- Tracks which fields have been manually overridden\n  ADD COLUMN IF NOT EXISTS manual_fields JSONB DEFAULT '{}'::jsonb","-- Structure: { steps: number | null, workouts: text | null, supplements: text | null }\n  -- Stores manual fields: steps, workouts, supplements\n\n-- Add comment\nCOMMENT ON COLUMN nutrition_templates.manual_override IS 'JSONB tracking which macro/calorie fields have been manually overridden: { calories: boolean, protein: boolean, carbs: boolean, fat: boolean, fiber: boolean }'","COMMENT ON COLUMN nutrition_templates.manual_fields IS 'JSONB storing manual fields: { steps: number | null, workouts: text | null, supplements: text | null }'","-- Create GIN index for manual_override JSONB column (enables fast queries on JSONB data)\nCREATE INDEX IF NOT EXISTS idx_nutrition_templates_manual_override ON nutrition_templates USING GIN (manual_override)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_manual_fields ON nutrition_templates USING GIN (manual_fields)","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_manual_override_fields_to_nutrition_templates
20260121000000	{"-- =====================================================\n-- Ensure Storage Bucket is Private\n-- Created: 2026-01-21\n-- Description: Ensures the client-assets bucket is private (public = false)\n--              This migration ensures all files require signed URLs for access\n--              Only admin/worker roles can view all files, regular users can only view their own\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Ensure storage bucket is private (idempotent)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'buckets'\n  ) THEN\n    -- Update bucket to ensure it's private (public = false)\n    -- This ensures all files require signed URLs for access\n    UPDATE storage.buckets\n    SET public = false\n    WHERE id = 'client-assets' AND public = true;\n    \n    -- If bucket doesn't exist, create it as private\n    INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)\n    VALUES (\n      'client-assets',\n      'client-assets',\n      false, -- private bucket (uses signed URLs)\n      52428800, -- 50MB file size limit (in bytes) - matches config.toml\n      ARRAY[\n        'image/jpeg',\n        'image/jpg', \n        'image/png',\n        'image/gif',\n        'image/webp',\n        'video/mp4',\n        'video/mpeg',\n        'video/quicktime',\n        'application/pdf',\n        'application/msword',\n        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n      ]::text[]\n    )\n    ON CONFLICT (id) DO UPDATE SET\n      public = false, -- Always ensure private\n      file_size_limit = EXCLUDED.file_size_limit,\n      allowed_mime_types = EXCLUDED.allowed_mime_types;\n    \n    RAISE NOTICE 'Storage bucket \\"client-assets\\" is now private (requires signed URLs)';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping bucket update. Enable storage in config.toml and restart Supabase.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	ensure_storage_bucket_is_private
20260121000001	{"-- =====================================================\n-- Fix workout-exercises folder storage RLS policies\n-- Created: 2026-01-21\n-- Description: Updates RLS policies for workout-exercises folder to use more reliable path matching\n--              Replaces storage.foldername(name)[1] with LIKE pattern for better reliability\n--              Path structure: workout-exercises/{exercise_id}/images/{filename} or workout-exercises/{exercise_id}/videos/{filename}\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Only update policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Drop existing policies\n    DROP POLICY IF EXISTS \\"Managers can upload workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete workout exercise media\\" ON storage.objects;\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to upload workout exercise media\n    -- Path structure: workout-exercises/{exercise_id}/images/{filename} or workout-exercises/{exercise_id}/videos/{filename}\n    -- Using LIKE pattern for more reliable path matching\n    CREATE POLICY \\"Managers can upload workout exercise media\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      name LIKE 'workout-exercises/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to view workout exercise media\n    CREATE POLICY \\"Managers can view workout exercise media\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'workout-exercises/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to delete workout exercise media\n    CREATE POLICY \\"Managers can delete workout exercise media\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'workout-exercises/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    RAISE NOTICE 'Storage RLS policies for workout-exercises folder updated successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy update. Enable storage in config.toml and restart Supabase.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_workout_exercises_storage_rls
20260121000002	{"-- =====================================================\n-- Add Duration Unit to Subscription Types\n-- Created: 2026-01-21\n-- Description: Allow subscription types to specify duration in days, weeks, or months\n-- =====================================================\n\n-- Add duration_unit column with default 'months' for backward compatibility\nALTER TABLE subscription_types\nADD COLUMN IF NOT EXISTS duration_unit TEXT NOT NULL DEFAULT 'months'\nCHECK (duration_unit IN ('days', 'weeks', 'months'))","-- Update comment on duration column\nCOMMENT ON COLUMN subscription_types.duration IS 'Duration value (interpreted based on duration_unit)'","COMMENT ON COLUMN subscription_types.duration_unit IS 'Unit for duration: days, weeks, or months'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_duration_unit_to_subscription_types
20260121000003	{"-- =====================================================\n-- Add 'payments' to saved_views resource_key constraint\n-- Created: 2026-01-21\n-- Description: Allow saved views for payments (Tashlumim)\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'payments'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets', 'meetings', 'check_in_settings', 'payments'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_payments_to_saved_views
20260121000004	{"-- =====================================================\n-- Migration: Create Fillout Submissions Table\n-- Created: 2026-01-21\n-- Description: Stores all Fillout form submissions with submission type for easy categorization\n-- =====================================================\n\n-- Create fillout_submissions table\nCREATE TABLE IF NOT EXISTS public.fillout_submissions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  fillout_submission_id TEXT NOT NULL UNIQUE, -- Unique identifier from Fillout\n  fillout_form_id TEXT NOT NULL, -- Form ID from Fillout\n  submission_type TEXT, -- Type of submission (e.g., 'meeting', 'questionnaire', etc.)\n  submission_data JSONB NOT NULL DEFAULT '{}'::jsonb, -- Flexible JSONB to store all form data\n  lead_id UUID REFERENCES public.leads(id) ON DELETE SET NULL,\n  customer_id UUID REFERENCES public.customers(id) ON DELETE SET NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Add indexes\nCREATE INDEX IF NOT EXISTS idx_fillout_submissions_fillout_submission_id ON public.fillout_submissions(fillout_submission_id)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_fillout_form_id ON public.fillout_submissions(fillout_form_id)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_submission_type ON public.fillout_submissions(submission_type)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_lead_id ON public.fillout_submissions(lead_id)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_customer_id ON public.fillout_submissions(customer_id)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_created_at ON public.fillout_submissions(created_at DESC)","-- Add RLS policies\nALTER TABLE public.fillout_submissions ENABLE ROW LEVEL SECURITY","-- Policy: Managers can view all submissions\nCREATE POLICY \\"Managers can view all fillout submissions\\"\n  ON public.fillout_submissions\n  FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can insert submissions\nCREATE POLICY \\"Managers can insert fillout submissions\\"\n  ON public.fillout_submissions\n  FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can update submissions\nCREATE POLICY \\"Managers can update fillout submissions\\"\n  ON public.fillout_submissions\n  FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can delete submissions\nCREATE POLICY \\"Managers can delete fillout submissions\\"\n  ON public.fillout_submissions\n  FOR DELETE\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Allow service role (edge functions) to insert/update submissions\nCREATE POLICY \\"Service role can manage fillout submissions\\"\n  ON public.fillout_submissions\n  FOR ALL\n  USING (auth.role() = 'service_role')\n  WITH CHECK (auth.role() = 'service_role')","-- Create function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_fillout_submissions_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger to automatically update updated_at\nCREATE TRIGGER update_fillout_submissions_updated_at\n  BEFORE UPDATE ON public.fillout_submissions\n  FOR EACH ROW\n  EXECUTE FUNCTION update_fillout_submissions_updated_at()","-- Add comments\nCOMMENT ON TABLE public.fillout_submissions IS 'Stores all Fillout form submissions with type for easy categorization'","COMMENT ON COLUMN public.fillout_submissions.fillout_submission_id IS 'Unique identifier from Fillout submission'","COMMENT ON COLUMN public.fillout_submissions.fillout_form_id IS 'Form ID from Fillout'","COMMENT ON COLUMN public.fillout_submissions.submission_type IS 'Type of submission (e.g., meeting, questionnaire) - extracted from form submission'","COMMENT ON COLUMN public.fillout_submissions.submission_data IS 'Flexible JSONB containing all form submission data'","COMMENT ON COLUMN public.fillout_submissions.lead_id IS 'Link to the lead that the submission is associated with'","COMMENT ON COLUMN public.fillout_submissions.customer_id IS 'Link to the customer that the submission is associated with'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_fillout_submissions
20260121000005	{"-- =====================================================\n-- Migration: Add Pagination, Sorting, and Group By to Leads\n-- Created: 2026-01-21\n-- Description: Adds server-side pagination, sorting, and grouping support to get_filtered_leads RPC function\n--              Also adds separate get_filtered_leads_count function for total count\n-- =====================================================\n\n-- Step 1: Update get_filtered_leads function to support sorting and grouping\nCREATE OR REPLACE FUNCTION public.get_filtered_leads(\n    p_limit_count INTEGER DEFAULT 100,\n    p_offset_count INTEGER DEFAULT 0,\n    p_search_query TEXT DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_date TEXT DEFAULT NULL,\n    -- New parameters for sorting\n    p_sort_by TEXT DEFAULT 'created_at',\n    p_sort_order TEXT DEFAULT 'DESC',\n    -- New parameters for grouping (level 1 and level 2)\n    p_group_by_level1 TEXT DEFAULT NULL,\n    p_group_by_level2 TEXT DEFAULT NULL\n)\nRETURNS TABLE (\n    id UUID,\n    created_at TIMESTAMP WITH TIME ZONE,\n    updated_at TIMESTAMP WITH TIME ZONE,\n    assigned_to UUID,\n    customer_id UUID,\n    city TEXT,\n    birth_date DATE,\n    age INTEGER,\n    gender TEXT,\n    status_main TEXT,\n    status_sub TEXT,\n    height DECIMAL,\n    weight DECIMAL,\n    bmi DECIMAL,\n    join_date TIMESTAMP WITH TIME ZONE,\n    subscription_data JSONB,\n    daily_protocol JSONB,\n    workout_history JSONB,\n    steps_history JSONB,\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT,\n    customer_name TEXT,\n    customer_phone TEXT,\n    customer_email TEXT,\n    created_date_formatted TEXT,\n    birth_date_formatted TEXT,\n    daily_steps_goal INTEGER,\n    weekly_workouts INTEGER,\n    daily_supplements TEXT[],\n    subscription_months INTEGER,\n    subscription_initial_price DECIMAL,\n    subscription_renewal_price DECIMAL\n)\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    v_sort_direction TEXT;\n    v_order_by_clause TEXT;\nBEGIN\n    -- Validate sort_order (must be ASC or DESC)\n    v_sort_direction := UPPER(COALESCE(NULLIF(p_sort_order, ''), 'DESC'));\n    IF v_sort_direction NOT IN ('ASC', 'DESC') THEN\n        v_sort_direction := 'DESC';\n    END IF;\n\n    -- Build ORDER BY clause - start with grouping columns, then sorting column\n    v_order_by_clause := '';\n    \n    -- Add grouping columns to ORDER BY (for grouping in frontend, ensures groups are sorted together)\n    IF p_group_by_level1 IS NOT NULL THEN\n        v_order_by_clause := v_order_by_clause || CASE \n            WHEN p_group_by_level1 = 'status' OR p_group_by_level1 = 'status_main' THEN 'v.status_main ASC, '\n            WHEN p_group_by_level1 = 'source' THEN 'v.source ASC, '\n            WHEN p_group_by_level1 = 'fitnessGoal' OR p_group_by_level1 = 'fitness_goal' THEN 'v.fitness_goal ASC, '\n            WHEN p_group_by_level1 = 'activityLevel' OR p_group_by_level1 = 'activity_level' THEN 'v.activity_level ASC, '\n            WHEN p_group_by_level1 = 'preferredTime' OR p_group_by_level1 = 'preferred_time' THEN 'v.preferred_time ASC, '\n            WHEN p_group_by_level1 = 'name' OR p_group_by_level1 = 'customer_name' THEN 'v.customer_name ASC, '\n            WHEN p_group_by_level1 = 'age' THEN 'v.age ASC, '\n            WHEN p_group_by_level1 = 'height' THEN 'v.height ASC, '\n            WHEN p_group_by_level1 = 'weight' THEN 'v.weight ASC, '\n            ELSE ''\n        END;\n    END IF;\n    \n    IF p_group_by_level2 IS NOT NULL THEN\n        v_order_by_clause := v_order_by_clause || CASE \n            WHEN p_group_by_level2 = 'status' OR p_group_by_level2 = 'status_main' THEN 'v.status_main ASC, '\n            WHEN p_group_by_level2 = 'source' THEN 'v.source ASC, '\n            WHEN p_group_by_level2 = 'fitnessGoal' OR p_group_by_level2 = 'fitness_goal' THEN 'v.fitness_goal ASC, '\n            WHEN p_group_by_level2 = 'activityLevel' OR p_group_by_level2 = 'activity_level' THEN 'v.activity_level ASC, '\n            WHEN p_group_by_level2 = 'preferredTime' OR p_group_by_level2 = 'preferred_time' THEN 'v.preferred_time ASC, '\n            WHEN p_group_by_level2 = 'name' OR p_group_by_level2 = 'customer_name' THEN 'v.customer_name ASC, '\n            WHEN p_group_by_level2 = 'age' THEN 'v.age ASC, '\n            WHEN p_group_by_level2 = 'height' THEN 'v.height ASC, '\n            WHEN p_group_by_level2 = 'weight' THEN 'v.weight ASC, '\n            ELSE ''\n        END;\n    END IF;\n    \n    -- Add main sorting column\n    v_order_by_clause := v_order_by_clause || CASE \n        WHEN p_sort_by = 'createdDate' OR p_sort_by = 'created_date' OR p_sort_by = 'created_at' THEN 'v.created_at ' || v_sort_direction\n        WHEN p_sort_by = 'name' OR p_sort_by = 'customer_name' THEN 'v.customer_name ' || v_sort_direction\n        WHEN p_sort_by = 'status' OR p_sort_by = 'status_main' THEN 'v.status_main ' || v_sort_direction\n        WHEN p_sort_by = 'phone' OR p_sort_by = 'customer_phone' THEN 'v.customer_phone ' || v_sort_direction\n        WHEN p_sort_by = 'email' OR p_sort_by = 'customer_email' THEN 'v.customer_email ' || v_sort_direction\n        WHEN p_sort_by = 'source' THEN 'v.source ' || v_sort_direction\n        WHEN p_sort_by = 'age' THEN 'v.age ' || v_sort_direction\n        WHEN p_sort_by = 'height' THEN 'v.height ' || v_sort_direction\n        WHEN p_sort_by = 'weight' THEN 'v.weight ' || v_sort_direction\n        WHEN p_sort_by = 'fitnessGoal' OR p_sort_by = 'fitness_goal' THEN 'v.fitness_goal ' || v_sort_direction\n        WHEN p_sort_by = 'activityLevel' OR p_sort_by = 'activity_level' THEN 'v.activity_level ' || v_sort_direction\n        WHEN p_sort_by = 'preferredTime' OR p_sort_by = 'preferred_time' THEN 'v.preferred_time ' || v_sort_direction\n        WHEN p_sort_by = 'notes' THEN 'v.notes ' || v_sort_direction\n        ELSE 'v.created_at ' || v_sort_direction -- Default fallback\n    END;\n\n    -- Execute query with dynamic ORDER BY using EXECUTE (safe with validated inputs)\n    RETURN QUERY\n    EXECUTE format('\n        SELECT \n            v.id,\n            v.created_at,\n            v.updated_at,\n            v.assigned_to,\n            v.customer_id,\n            v.city,\n            v.birth_date,\n            v.age,\n            v.gender,\n            v.status_main,\n            v.status_sub,\n            v.height,\n            v.weight,\n            v.bmi,\n            v.join_date,\n            v.subscription_data,\n            v.daily_protocol,\n            v.workout_history,\n            v.steps_history,\n            v.source,\n            v.fitness_goal,\n            v.activity_level,\n            v.preferred_time,\n            v.notes,\n            v.customer_name,\n            v.customer_phone,\n            v.customer_email,\n            v.created_date_formatted,\n            v.birth_date_formatted,\n            v.daily_steps_goal,\n            v.weekly_workouts,\n            v.daily_supplements,\n            v.subscription_months,\n            v.subscription_initial_price,\n            v.subscription_renewal_price\n        FROM public.v_leads_with_customer v\n        WHERE \n            -- Search query (name, phone, email)\n            ($1 IS NULL OR \n             v.customer_name ILIKE ''%%'' || $1 || ''%%'' OR\n             v.customer_phone ILIKE ''%%'' || $1 || ''%%'' OR\n             v.customer_email ILIKE ''%%'' || $1 || ''%%'')\n            -- Status filter\n            AND ($2 IS NULL OR v.status_main = $2)\n            AND ($3 IS NULL OR v.status_sub = $3)\n            -- Source filter\n            AND ($4 IS NULL OR v.source = $4)\n            -- Fitness goal filter\n            AND ($5 IS NULL OR v.fitness_goal = $5)\n            -- Activity level filter\n            AND ($6 IS NULL OR v.activity_level = $6)\n            -- Preferred time filter\n            AND ($7 IS NULL OR v.preferred_time = $7)\n            -- Age filter\n            AND ($8 IS NULL OR v.age::TEXT = $8)\n            -- Height filter\n            AND ($9 IS NULL OR v.height::TEXT = $9)\n            -- Weight filter\n            AND ($10 IS NULL OR v.weight::TEXT = $10)\n            -- Date filter (created_at date)\n            AND ($11 IS NULL OR v.created_date_formatted = $11)\n        ORDER BY %s\n        LIMIT $12\n        OFFSET $13\n    ', v_order_by_clause)\n    USING \n        p_search_query,\n        p_status_main,\n        p_status_sub,\n        p_source,\n        p_fitness_goal,\n        p_activity_level,\n        p_preferred_time,\n        p_age,\n        p_height,\n        p_weight,\n        p_date,\n        p_limit_count,\n        p_offset_count;\nEND;\n$$","-- Step 2: Create separate count function for total leads matching filters\nCREATE OR REPLACE FUNCTION public.get_filtered_leads_count(\n    p_search_query TEXT DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_date TEXT DEFAULT NULL\n)\nRETURNS INTEGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    v_count INTEGER;\nBEGIN\n    SELECT COUNT(*)::INTEGER INTO v_count\n    FROM public.v_leads_with_customer v\n    WHERE \n        -- Search query (name, phone, email)\n        (p_search_query IS NULL OR \n         v.customer_name ILIKE '%' || p_search_query || '%' OR\n         v.customer_phone ILIKE '%' || p_search_query || '%' OR\n         v.customer_email ILIKE '%' || p_search_query || '%')\n        -- Status filter\n        AND (p_status_main IS NULL OR v.status_main = p_status_main)\n        AND (p_status_sub IS NULL OR v.status_sub = p_status_sub)\n        -- Source filter\n        AND (p_source IS NULL OR v.source = p_source)\n        -- Fitness goal filter\n        AND (p_fitness_goal IS NULL OR v.fitness_goal = p_fitness_goal)\n        -- Activity level filter\n        AND (p_activity_level IS NULL OR v.activity_level = p_activity_level)\n        -- Preferred time filter\n        AND (p_preferred_time IS NULL OR v.preferred_time = p_preferred_time)\n        -- Age filter\n        AND (p_age IS NULL OR v.age::TEXT = p_age)\n        -- Height filter\n        AND (p_height IS NULL OR v.height::TEXT = p_height)\n        -- Weight filter\n        AND (p_weight IS NULL OR v.weight::TEXT = p_weight)\n        -- Date filter (created_at date)\n        AND (p_date IS NULL OR v.created_date_formatted = p_date);\n\n    RETURN COALESCE(v_count, 0);\nEND;\n$$","-- Step 3: Grant execute permissions\nGRANT EXECUTE ON FUNCTION public.get_filtered_leads(INTEGER, INTEGER, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) TO authenticated","GRANT EXECUTE ON FUNCTION public.get_filtered_leads_count(TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) TO authenticated","-- Step 4: Update comments\nCOMMENT ON FUNCTION public.get_filtered_leads(INTEGER, INTEGER, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) IS 'RPC function for complex lead filtering with server-side pagination, sorting, and grouping support. All filtering happens in PostgreSQL.'","COMMENT ON FUNCTION public.get_filtered_leads_count(TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) IS 'Returns total count of leads matching the filter criteria. Used for pagination to calculate total pages.'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_pagination_sorting_groupby_to_leads
20260121000006	{"-- =====================================================\n-- Add Activity Entries and Ensure Manual Fields to Nutrition Templates\n-- Created: 2026-01-21\n-- Description: Adds activity_entries column for METs calculation data\n--              Also ensures manual_override and manual_fields columns exist (in case previous migration wasn't run)\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Ensure manual_override column exists (in case previous migration wasn't run)\n-- Structure: { calories: boolean, protein: boolean, carbs: boolean, fat: boolean, fiber: boolean }\n-- Tracks which fields have been manually overridden\nALTER TABLE nutrition_templates\n  ADD COLUMN IF NOT EXISTS manual_override JSONB DEFAULT '{}'::jsonb","-- Ensure manual_fields column exists (in case previous migration wasn't run)\n-- Structure: { steps: number | null, workouts: text | null, supplements: text | null }\n-- Stores manual fields: steps, workouts, supplements\nALTER TABLE nutrition_templates\n  ADD COLUMN IF NOT EXISTS manual_fields JSONB DEFAULT '{}'::jsonb","-- Add activity_entries column for storing METs activity data\n-- Structure: Array of { id: string, activityType: string, mets: number, minutesPerWeek: number }\nALTER TABLE nutrition_templates\n  ADD COLUMN IF NOT EXISTS activity_entries JSONB DEFAULT '[]'::jsonb","-- Add comments\nCOMMENT ON COLUMN nutrition_templates.manual_override IS 'JSONB tracking which macro/calorie fields have been manually overridden: { calories: boolean, protein: boolean, carbs: boolean, fat: boolean, fiber: boolean }'","COMMENT ON COLUMN nutrition_templates.manual_fields IS 'JSONB storing manual fields: { steps: number | null, workouts: text | null, supplements: text | null }'","COMMENT ON COLUMN nutrition_templates.activity_entries IS 'JSONB array storing activity entries for METs calculation: [{ id: string, activityType: string, mets: number, minutesPerWeek: number }]'","-- Create GIN indexes for JSONB columns (enables fast queries on JSONB data)\nCREATE INDEX IF NOT EXISTS idx_nutrition_templates_manual_override ON nutrition_templates USING GIN (manual_override)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_manual_fields ON nutrition_templates USING GIN (manual_fields)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_activity_entries ON nutrition_templates USING GIN (activity_entries)","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_activity_entries_to_nutrition_templates
20260121000007	{"-- =====================================================\n-- Fix Nutrition Templates Columns\n-- Created: 2026-01-21\n-- Description: Ensures all required columns exist in nutrition_templates table\n--              This is a comprehensive fix for any missing columns\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Ensure manual_override column exists\n-- Structure: { calories: boolean, protein: boolean, carbs: boolean, fat: boolean, fiber: boolean }\nDO $$ \nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_schema = 'public' \n        AND table_name = 'nutrition_templates' \n        AND column_name = 'manual_override'\n    ) THEN\n        ALTER TABLE nutrition_templates\n        ADD COLUMN manual_override JSONB DEFAULT '{}'::jsonb;\n        \n        COMMENT ON COLUMN nutrition_templates.manual_override IS 'JSONB tracking which macro/calorie fields have been manually overridden: { calories: boolean, protein: boolean, carbs: boolean, fat: boolean, fiber: boolean }';\n    END IF;\nEND $$","-- Ensure manual_fields column exists\n-- Structure: { steps: number | null, workouts: text | null, supplements: text | null }\nDO $$ \nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_schema = 'public' \n        AND table_name = 'nutrition_templates' \n        AND column_name = 'manual_fields'\n    ) THEN\n        ALTER TABLE nutrition_templates\n        ADD COLUMN manual_fields JSONB DEFAULT '{}'::jsonb;\n        \n        COMMENT ON COLUMN nutrition_templates.manual_fields IS 'JSONB storing manual fields: { steps: number | null, workouts: text | null, supplements: text | null }';\n    END IF;\nEND $$","-- Ensure activity_entries column exists\n-- Structure: Array of { id: string, activityType: string, mets: number, minutesPerWeek: number }\nDO $$ \nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_schema = 'public' \n        AND table_name = 'nutrition_templates' \n        AND column_name = 'activity_entries'\n    ) THEN\n        ALTER TABLE nutrition_templates\n        ADD COLUMN activity_entries JSONB DEFAULT '[]'::jsonb;\n        \n        COMMENT ON COLUMN nutrition_templates.activity_entries IS 'JSONB array storing activity entries for METs calculation: [{ id: string, activityType: string, mets: number, minutesPerWeek: number }]';\n    END IF;\nEND $$","-- Create GIN indexes for JSONB columns (if they don't exist)\nCREATE INDEX IF NOT EXISTS idx_nutrition_templates_manual_override ON nutrition_templates USING GIN (manual_override)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_manual_fields ON nutrition_templates USING GIN (manual_fields)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_activity_entries ON nutrition_templates USING GIN (activity_entries)","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_nutrition_templates_columns
20260121000008	{"-- =====================================================\n-- Fix Fillout Submissions RLS Policies\n-- Created: 2026-01-21\n-- Description: Fixes RLS policies to avoid \\"permission denied for table users\\" error\n--              Uses auth.jwt() instead of querying auth.users directly\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Drop existing policies\nDROP POLICY IF EXISTS \\"Managers can view all fillout submissions\\" ON public.fillout_submissions","DROP POLICY IF EXISTS \\"Managers can insert fillout submissions\\" ON public.fillout_submissions","DROP POLICY IF EXISTS \\"Managers can update fillout submissions\\" ON public.fillout_submissions","DROP POLICY IF EXISTS \\"Managers can delete fillout submissions\\" ON public.fillout_submissions","-- Policy: Managers can view all submissions\n-- Uses profiles table to check role (same pattern as other tables)\nCREATE POLICY \\"Managers can view all fillout submissions\\"\n  ON public.fillout_submissions\n  FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )","-- Policy: Managers can insert submissions\nCREATE POLICY \\"Managers can insert fillout submissions\\"\n  ON public.fillout_submissions\n  FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )","-- Policy: Managers can update submissions\nCREATE POLICY \\"Managers can update fillout submissions\\"\n  ON public.fillout_submissions\n  FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )","-- Policy: Managers can delete submissions\nCREATE POLICY \\"Managers can delete fillout submissions\\"\n  ON public.fillout_submissions\n  FOR DELETE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_fillout_submissions_rls
20260121000009	{"-- =====================================================\n-- Add is_active to nutrition_plans\n-- Created: 2026-01-21\n-- Description: Add is_active and deleted_at columns to nutrition_plans for consistency with workout_plans\n--              This allows tracking active vs inactive nutrition plans\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Add is_active and deleted_at columns\nALTER TABLE nutrition_plans\n  ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true NOT NULL,\n  ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMP WITH TIME ZONE","-- Create index for active plans\nCREATE INDEX IF NOT EXISTS idx_nutrition_plans_is_active ON nutrition_plans(is_active) WHERE is_active = true","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_deleted_at ON nutrition_plans(deleted_at) WHERE deleted_at IS NOT NULL","-- Update existing plans to be active\nUPDATE nutrition_plans SET is_active = true WHERE is_active IS NULL","-- Add comments\nCOMMENT ON COLUMN nutrition_plans.is_active IS 'Whether this nutrition plan is currently active'","COMMENT ON COLUMN nutrition_plans.deleted_at IS 'Timestamp when this nutrition plan was deleted (soft delete)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_is_active_to_nutrition_plans
20260121000010	{"-- =====================================================\n-- Set Default Weekly Review WhatsApp Template\n-- Created: 2026-01-21\n-- Description: Sets default template for weekly_review automation\n--              This template matches the format used when sending weekly goals\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Create a function to set default weekly_review template for a user\nCREATE OR REPLACE FUNCTION set_default_weekly_review_template(p_user_id UUID)\nRETURNS void AS $$\nBEGIN\n  -- Insert or update the weekly_review template for the user\n  INSERT INTO public.whatsapp_flow_templates (user_id, flow_key, template_content, buttons, media)\n  VALUES (\n    p_user_id,\n    'weekly_review',\n    '📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}}\n\n🎯 יעדים:\nקלוריות: {{target_calories}} קק\\"ל\nחלבון: {{target_protein}} גרם\nסיבים: {{target_fiber}} גרם\nצעדים: {{target_steps}}\n\n📈 בפועל (ממוצע):\nקלוריות: {{actual_calories}} קק\\"ל\nמשקל ממוצע: {{actual_weight}} ק\\"ג',\n    '[]'::jsonb,\n    NULL\n  )\n  ON CONFLICT (user_id, flow_key)\n  DO UPDATE SET\n    template_content = EXCLUDED.template_content,\n    updated_at = NOW()\n  WHERE whatsapp_flow_templates.template_content = '' OR whatsapp_flow_templates.template_content IS NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Set default template for all existing users (coaches/managers)\n-- This will only set templates for users who don't already have a weekly_review template\nDO $$\nDECLARE\n  user_record RECORD;\nBEGIN\n  FOR user_record IN \n    SELECT id FROM auth.users\n    WHERE id NOT IN (\n      SELECT DISTINCT user_id \n      FROM public.whatsapp_flow_templates \n      WHERE flow_key = 'weekly_review' \n      AND template_content IS NOT NULL \n      AND template_content != ''\n    )\n  LOOP\n    PERFORM set_default_weekly_review_template(user_record.id);\n  END LOOP;\nEND $$","-- Add comment\nCOMMENT ON FUNCTION set_default_weekly_review_template(UUID) IS 'Sets default weekly_review WhatsApp template for a user. Only updates if template is empty or null.'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	set_default_weekly_review_template
20260121000011	{"-- =====================================================\n-- Fix Duplicate Plans Per Budget Migration\n-- Created: 2026-01-21\n-- Description: Removes duplicate plans per budget and ensures only one plan per budget_id\n--              This fixes the issue where the same plan appears twice when both customer_id and lead_id are set\n-- =====================================================\n\n-- =====================================================\n-- STEP 1: Clean up existing duplicates\n-- Keep only the most recent plan per budget_id + customer_id/lead_id combination\n-- =====================================================\n\n-- Clean up duplicate workout_plans - keep only one per budget_id per customer/lead\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY COALESCE(start_date, created_at) DESC, created_at DESC\n        ) as rn\n      FROM workout_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM workout_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate nutrition_plans - keep only one per budget_id per customer/lead\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY COALESCE(start_date, created_at) DESC, created_at DESC\n        ) as rn\n      FROM nutrition_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM nutrition_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate steps_plans - keep only one per budget_id per customer/lead\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY COALESCE(start_date, created_at) DESC, created_at DESC\n        ) as rn\n      FROM steps_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM steps_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate supplement_plans - keep only one per budget_id per customer/lead\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY COALESCE(start_date, created_at) DESC, created_at DESC\n        ) as rn\n      FROM supplement_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM supplement_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- =====================================================\n-- STEP 2: Add unique constraint to prevent future duplicates\n-- One plan per budget_id per customer_id/lead_id combination\n-- Using a single expression index that handles both customer_id and lead_id\n-- =====================================================\n\n-- Drop existing indexes if they exist and create new unique constraint for workout_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    -- Drop old indexes if they exist\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget';\n    \n    -- Create unique constraint using expression: one plan per budget_id + (customer_id or lead_id)\n    -- This handles cases where plan has customer_id only, lead_id only, or both\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_workout_plans_unique_budget_customer\n    ON workout_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_workout_plans_unique_budget_lead\n    ON workout_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Drop existing indexes if they exist and create new unique constraint for nutrition_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    -- Drop old indexes if they exist\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget';\n    \n    -- Create new unique constraint: one plan per budget_id + customer_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_nutrition_plans_unique_budget_customer\n    ON nutrition_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    -- Create new unique constraint: one plan per budget_id + lead_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_nutrition_plans_unique_budget_lead\n    ON nutrition_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Drop existing indexes if they exist and create new unique constraint for steps_plans\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    -- Drop old indexes if they exist\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget';\n    \n    -- Create new unique constraint: one plan per budget_id + customer_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_steps_plans_unique_budget_customer\n    ON steps_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    -- Create new unique constraint: one plan per budget_id + lead_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_steps_plans_unique_budget_lead\n    ON steps_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Drop existing indexes if they exist and create new unique constraint for supplement_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    -- Drop old indexes if they exist\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget';\n    \n    -- Create new unique constraint: one plan per budget_id + customer_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_supplement_plans_unique_budget_customer\n    ON supplement_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    -- Create new unique constraint: one plan per budget_id + lead_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_supplement_plans_unique_budget_lead\n    ON supplement_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_workout_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_workout_plans_unique_budget_customer IS ''Ensures only one workout plan per budget_id + customer_id combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_workout_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_workout_plans_unique_budget_lead IS ''Ensures only one workout plan per budget_id + lead_id combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_nutrition_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_nutrition_plans_unique_budget_customer IS ''Ensures only one nutrition plan per budget_id + customer_id combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_nutrition_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_nutrition_plans_unique_budget_lead IS ''Ensures only one nutrition plan per budget_id + lead_id combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_steps_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_steps_plans_unique_budget_customer IS ''Ensures only one steps plan per budget_id + customer_id combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_steps_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_steps_plans_unique_budget_lead IS ''Ensures only one steps plan per budget_id + lead_id combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_supplement_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_supplement_plans_unique_budget_customer IS ''Ensures only one supplement plan per budget_id + customer_id combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_supplement_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_supplement_plans_unique_budget_lead IS ''Ensures only one supplement plan per budget_id + lead_id combination''';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_duplicate_plans_per_budget
20260121000012	{"-- =====================================================\n-- Remove Strict Budget Constraints Migration\n-- Created: 2026-01-21\n-- Description: Removes overly strict unique constraints that prevent plan creation\n--              The application already handles deduplication via delete-before-insert logic\n-- =====================================================\n\n-- =====================================================\n-- STEP 1: Drop all unique constraints on budget_id\n-- These constraints are preventing legitimate plan creation\n-- =====================================================\n\n-- Drop unique constraints for workout_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget';\n  END IF;\nEND $$","-- Drop unique constraints for nutrition_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget';\n  END IF;\nEND $$","-- Drop unique constraints for steps_plans\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget';\n  END IF;\nEND $$","-- Drop unique constraints for supplement_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget';\n  END IF;\nEND $$","-- =====================================================\n-- STEP 2: Create non-unique indexes for performance\n-- These help with queries but don't prevent inserts\n-- =====================================================\n\n-- Create non-unique indexes for workout_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_id_perf\n    ON workout_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_customer_perf\n    ON workout_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_lead_perf\n    ON workout_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Create non-unique indexes for nutrition_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_id_perf\n    ON nutrition_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_customer_perf\n    ON nutrition_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_lead_perf\n    ON nutrition_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Create non-unique indexes for steps_plans\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_steps_plans_budget_id_perf\n    ON steps_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_steps_plans_budget_customer_perf\n    ON steps_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_steps_plans_budget_lead_perf\n    ON steps_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Create non-unique indexes for supplement_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_id_perf\n    ON supplement_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_customer_perf\n    ON supplement_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_lead_perf\n    ON supplement_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_workout_plans_budget_id_perf') THEN\n    EXECUTE 'COMMENT ON INDEX idx_workout_plans_budget_id_perf IS ''Performance index for querying workout plans by budget_id''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_nutrition_plans_budget_id_perf') THEN\n    EXECUTE 'COMMENT ON INDEX idx_nutrition_plans_budget_id_perf IS ''Performance index for querying nutrition plans by budget_id''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_steps_plans_budget_id_perf') THEN\n    EXECUTE 'COMMENT ON INDEX idx_steps_plans_budget_id_perf IS ''Performance index for querying steps plans by budget_id''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_supplement_plans_budget_id_perf') THEN\n    EXECUTE 'COMMENT ON INDEX idx_supplement_plans_budget_id_perf IS ''Performance index for querying supplement plans by budget_id''';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- Note: Deduplication is now handled entirely by application logic\n-- in budgetPlanSync.ts which deletes existing plans before inserting new ones\n-- ====================================================="}	remove_strict_budget_constraints
20260121000013	{"-- =====================================================\n-- Fix client-assets folder storage RLS policies (blood-tests, progress, notes)\n-- Created: 2026-01-21\n-- Description: Updates RLS policies for various folders in client-assets bucket to use more reliable path matching\n--              Replaces storage.foldername(name) with LIKE pattern\n--              Path structure: {customer_id}/{folder}/{filename}\n-- =====================================================\n\n-- Only update policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Drop existing blood-tests policies\n    DROP POLICY IF EXISTS \\"Trainees can upload blood tests to own client folder\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Trainees can view own blood tests\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Trainees can delete own blood tests\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can upload blood tests\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view all blood tests\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete all blood tests\\" ON storage.objects;\n\n    -- Drop existing progress/notes policies\n    DROP POLICY IF EXISTS \\"Trainees can upload to own client folder\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Trainees can view own client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Trainees can delete own client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can upload client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view all client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete all client files\\" ON storage.objects;\n\n    -- =====================================================\n    -- 1. TRAINEE POLICIES (for own folder)\n    -- =====================================================\n\n    -- RLS Policy: Allow trainees to upload files to their own client_id folder (progress, notes, blood-tests)\n    CREATE POLICY \\"Trainees can upload to own client folder\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      (\n        name LIKE '%/progress/%' OR\n        name LIKE '%/notes/%' OR\n        name LIKE '%/blood-tests/%'\n      ) AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = split_part(name, '/', 1)\n        AND customers.user_id = auth.uid()\n      )\n    );\n\n    -- RLS Policy: Allow trainees to view files in their own client_id folder\n    CREATE POLICY \\"Trainees can view own client files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      (\n        name LIKE '%/progress/%' OR\n        name LIKE '%/notes/%' OR\n        name LIKE '%/blood-tests/%'\n      ) AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = split_part(name, '/', 1)\n        AND customers.user_id = auth.uid()\n      )\n    );\n\n    -- RLS Policy: Allow trainees to delete files from their own client_id folder\n    CREATE POLICY \\"Trainees can delete own client files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      (\n        name LIKE '%/progress/%' OR\n        name LIKE '%/notes/%' OR\n        name LIKE '%/blood-tests/%'\n      ) AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = split_part(name, '/', 1)\n        AND customers.user_id = auth.uid()\n      )\n    );\n\n    -- =====================================================\n    -- 2. MANAGER POLICIES (for all client folders)\n    -- =====================================================\n\n    -- RLS Policy: Allow managers/admins to upload client files\n    CREATE POLICY \\"Managers can upload client files\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      (\n        name LIKE '%/progress/%' OR\n        name LIKE '%/notes/%' OR\n        name LIKE '%/blood-tests/%'\n      ) AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow managers/admins to view all client files\n    CREATE POLICY \\"Managers can view all client files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow managers/admins to delete all client files\n    CREATE POLICY \\"Managers can delete all client files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    RAISE NOTICE 'Storage RLS policies for client folders updated successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy update.';\n  END IF;\nEND $$"}	fix_blood_tests_storage_rls
20260121000014	{"-- =====================================================\n-- Fix workout-exercises storage RLS policies path matching\n-- Created: 2026-01-21\n-- Description: Updates RLS policies for workout-exercises folder to use LIKE pattern\n--              instead of storage.foldername() for more reliable path matching\n--              Path structure: workout-exercises/{exercise_id}/images/{filename} or workout-exercises/{exercise_id}/videos/{filename}\n-- =====================================================\n\n-- Only update policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Drop existing policies\n    DROP POLICY IF EXISTS \\"Managers can upload workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete workout exercise media\\" ON storage.objects;\n\n    -- RLS Policy: Allow managers/admins to upload workout exercise media\n    -- Using LIKE pattern for more reliable path matching\n    CREATE POLICY \\"Managers can upload workout exercise media\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      name LIKE 'workout-exercises/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow managers/admins to view workout exercise media\n    CREATE POLICY \\"Managers can view workout exercise media\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'workout-exercises/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow managers/admins to delete workout exercise media\n    CREATE POLICY \\"Managers can delete workout exercise media\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'workout-exercises/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    RAISE NOTICE 'Storage RLS policies for workout-exercises folder updated successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy update. Enable storage in config.toml and restart Supabase.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_workout_exercises_storage_rls_path
20260122000000	{"-- =====================================================\n-- Add target_weight and target_waist to weekly_reviews\n-- Created: 2026-01-22\n-- Description: Add editable target columns for weight and waist measurements\n-- =====================================================\n\n-- Add target_weight column (NUMERIC to match weekly_avg_weight)\nALTER TABLE weekly_reviews\nADD COLUMN IF NOT EXISTS target_weight NUMERIC(5,2)","-- Add target_waist column (INTEGER to match waist_measurement)\nALTER TABLE weekly_reviews\nADD COLUMN IF NOT EXISTS target_waist INTEGER","-- Add comments for documentation\nCOMMENT ON COLUMN weekly_reviews.target_weight IS 'Target weight for the week (kg)'","COMMENT ON COLUMN weekly_reviews.target_waist IS 'Target waist circumference for the week (cm)'"}	add_target_weight_waist_to_weekly_reviews
20260123000000	{"-- =====================================================\n-- Create External Knowledge Base Table\n-- Created: 2026-01-23\n-- Description: External knowledge base for storing articles that clients can view\n--              Managers can create articles with titles, content, images, videos, and status (draft/published)\n--              Only published articles are visible to clients in their portal\n-- =====================================================\n\n-- Create external_knowledge_base table\nCREATE TABLE IF NOT EXISTS public.external_knowledge_base (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    title TEXT NOT NULL,\n    content TEXT NOT NULL, -- Rich text content/article body\n    images TEXT[] DEFAULT '{}', -- Array of image URLs (storage paths or external URLs)\n    videos TEXT[] DEFAULT '{}', -- Array of video URLs (storage paths or external URLs)\n    status TEXT NOT NULL DEFAULT 'draft' CHECK (status IN ('draft', 'published')),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Create indexes for efficient queries\nCREATE INDEX IF NOT EXISTS idx_external_kb_status ON public.external_knowledge_base(status)","CREATE INDEX IF NOT EXISTS idx_external_kb_created_at ON public.external_knowledge_base(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_external_kb_title ON public.external_knowledge_base(title)","CREATE INDEX IF NOT EXISTS idx_external_kb_created_by ON public.external_knowledge_base(created_by)","-- Index for filtering published articles (most common query for clients)\nCREATE INDEX IF NOT EXISTS idx_external_kb_status_published ON public.external_knowledge_base(status, created_at DESC) \n    WHERE status = 'published'","-- Create trigger for auto-updating updated_at\nCREATE TRIGGER update_external_kb_updated_at\n    BEFORE UPDATE ON public.external_knowledge_base\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS on external_knowledge_base table\nALTER TABLE public.external_knowledge_base ENABLE ROW LEVEL SECURITY","-- RLS Policies for external_knowledge_base\n\n-- Managers (authenticated users) can read all entries (both draft and published)\nDROP POLICY IF EXISTS \\"Managers can read all knowledge base articles\\" ON public.external_knowledge_base","CREATE POLICY \\"Managers can read all knowledge base articles\\"\n    ON public.external_knowledge_base FOR SELECT\n    USING (\n        auth.role() = 'authenticated' AND\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid()\n            AND profiles.role IN ('manager', 'admin')\n        )\n    )","-- Clients (authenticated users with customer role) can only read published articles\nDROP POLICY IF EXISTS \\"Clients can read published articles\\" ON public.external_knowledge_base","CREATE POLICY \\"Clients can read published articles\\"\n    ON public.external_knowledge_base FOR SELECT\n    USING (\n        auth.role() = 'authenticated' AND\n        status = 'published' AND\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid()\n        )\n    )","-- Only managers can insert articles\nDROP POLICY IF EXISTS \\"Managers can insert knowledge base articles\\" ON public.external_knowledge_base","CREATE POLICY \\"Managers can insert knowledge base articles\\"\n    ON public.external_knowledge_base FOR INSERT\n    WITH CHECK (\n        auth.role() = 'authenticated' AND\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid()\n            AND profiles.role IN ('manager', 'admin')\n        )\n    )","-- Only managers can update articles\nDROP POLICY IF EXISTS \\"Managers can update knowledge base articles\\" ON public.external_knowledge_base","CREATE POLICY \\"Managers can update knowledge base articles\\"\n    ON public.external_knowledge_base FOR UPDATE\n    USING (\n        auth.role() = 'authenticated' AND\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid()\n            AND profiles.role IN ('manager', 'admin')\n        )\n    )\n    WITH CHECK (\n        auth.role() = 'authenticated' AND\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid()\n            AND profiles.role IN ('manager', 'admin')\n        )\n    )","-- Only managers can delete articles\nDROP POLICY IF EXISTS \\"Managers can delete knowledge base articles\\" ON public.external_knowledge_base","CREATE POLICY \\"Managers can delete knowledge base articles\\"\n    ON public.external_knowledge_base FOR DELETE\n    USING (\n        auth.role() = 'authenticated' AND\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid()\n            AND profiles.role IN ('manager', 'admin')\n        )\n    )","-- Add comments to table\nCOMMENT ON TABLE public.external_knowledge_base IS 'External knowledge base for storing articles that clients can view. Only published articles are visible to clients.'","COMMENT ON COLUMN public.external_knowledge_base.content IS 'Rich text content/article body'","COMMENT ON COLUMN public.external_knowledge_base.images IS 'Array of image URLs (storage paths or external URLs)'","COMMENT ON COLUMN public.external_knowledge_base.videos IS 'Array of video URLs (storage paths or external URLs)'","COMMENT ON COLUMN public.external_knowledge_base.status IS 'Status of the article: draft (only visible to managers) or published (visible to all clients)'"}	create_external_knowledge_base
20260123000001	{"-- =====================================================\n-- Add Storage Policies for Knowledge Base\n-- Created: 2026-01-23\n-- Description: RLS policies for knowledge-base folder in client-assets bucket\n--              Managers can upload/view/delete, clients can view published articles' media\n-- =====================================================\n\n-- Add RLS policies for knowledge-base folder if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- RLS Policy: Allow managers/admins to upload knowledge base files (images/videos)\n    DROP POLICY IF EXISTS \\"Managers can upload knowledge base files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can upload knowledge base files\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''knowledge-base''\n    )';\n\n    -- RLS Policy: Allow managers/admins to view all knowledge base files\n    DROP POLICY IF EXISTS \\"Managers can view knowledge base files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can view knowledge base files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''knowledge-base''\n    )';\n\n    -- RLS Policy: Allow managers/admins to delete knowledge base files\n    DROP POLICY IF EXISTS \\"Managers can delete knowledge base files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can delete knowledge base files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''knowledge-base''\n    )';\n\n    -- Note: Clients access knowledge base files via signed URLs stored in the database\n    -- Signed URLs are generated with 1-year expiration and don't require direct storage access\n    -- Therefore, no separate policy is needed for clients to view files\n\n    RAISE NOTICE 'Storage RLS policies for knowledge-base folder created successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy creation. Enable storage in config.toml and restart Supabase to create policies.';\n  END IF;\nEND $$"}	add_knowledge_base_storage_policies
20260123000002	{"-- =====================================================\n-- Add Cover Image and Update Content Structure for Inline Media\n-- Created: 2026-01-23\n-- Description: Add cover_image field and update content to support inline images/videos\n--              Content will be stored as JSONB with blocks structure for flexible media placement\n-- =====================================================\n\n-- Add cover_image field\nALTER TABLE public.external_knowledge_base \nADD COLUMN IF NOT EXISTS cover_image TEXT","-- Change content to JSONB to support structured content with inline media\n-- Content structure: { \\"blocks\\": [{ \\"type\\": \\"text|image|video\\", \\"content\\": \\"...\\", \\"url\\": \\"...\\" }] }\n-- For backward compatibility, we'll migrate existing TEXT content to JSONB format\nALTER TABLE public.external_knowledge_base \nALTER COLUMN content TYPE JSONB USING \n  CASE \n    WHEN content::text LIKE '{%' THEN content::jsonb\n    ELSE jsonb_build_object(\n      'blocks', \n      jsonb_build_array(\n        jsonb_build_object('type', 'text', 'content', content)\n      )\n    )\n  END","-- Add index for cover_image queries\nCREATE INDEX IF NOT EXISTS idx_external_kb_cover_image ON public.external_knowledge_base(cover_image) \nWHERE cover_image IS NOT NULL","-- Update comments\nCOMMENT ON COLUMN public.external_knowledge_base.cover_image IS 'Cover image URL for the article card display'","COMMENT ON COLUMN public.external_knowledge_base.content IS 'JSONB structured content with blocks. Format: { \\"blocks\\": [{ \\"type\\": \\"text|image|video\\", \\"content\\": \\"...\\", \\"url\\": \\"...\\" }] }'","COMMENT ON COLUMN public.external_knowledge_base.images IS 'DEPRECATED: Legacy array of image URLs. Use inline media in content blocks instead.'","COMMENT ON COLUMN public.external_knowledge_base.videos IS 'DEPRECATED: Legacy array of video URLs. Use inline media in content blocks instead.'"}	add_cover_image_and_inline_media
20260123000003	{"-- Migration: Add display_order columns for drag-and-drop ordering\n-- This allows users to customize the order of interfaces and pages/views\n\n-- Add display_order to user_interface_preferences (for interfaces)\nALTER TABLE user_interface_preferences \nADD COLUMN IF NOT EXISTS display_order INTEGER","-- Create index for efficient ordering queries\nCREATE INDEX IF NOT EXISTS idx_user_interface_preferences_display_order \n    ON user_interface_preferences(user_id, display_order)","-- Add display_order to saved_views (for pages/views)\nALTER TABLE saved_views \nADD COLUMN IF NOT EXISTS display_order INTEGER","-- Create index for efficient ordering queries\nCREATE INDEX IF NOT EXISTS idx_saved_views_display_order \n    ON saved_views(resource_key, created_by, display_order)","-- Initialize display_order for existing interfaces based on current interface_key order\n-- This sets a default order for existing preferences\nDO $$\nDECLARE\n    interface_order RECORD;\n    order_num INTEGER := 1;\nBEGIN\n    FOR interface_order IN \n        SELECT DISTINCT user_id, interface_key\n        FROM user_interface_preferences\n        ORDER BY user_id, interface_key\n    LOOP\n        UPDATE user_interface_preferences\n        SET display_order = order_num\n        WHERE user_id = interface_order.user_id \n          AND interface_key = interface_order.interface_key\n          AND display_order IS NULL;\n        order_num := order_num + 1;\n    END LOOP;\nEND $$","-- Initialize display_order for existing saved_views\n-- Default views always get order 0, then others by creation date\nDO $$\nDECLARE\n    view_order RECORD;\n    order_num INTEGER;\nBEGIN\n    FOR view_order IN \n        SELECT id, resource_key, created_by, is_default, created_at\n        FROM saved_views\n        ORDER BY resource_key, created_by, is_default DESC, created_at\n    LOOP\n        IF view_order.is_default THEN\n            order_num := 0;\n        ELSE\n            -- Get max order for this resource/user, or start from 1\n            SELECT COALESCE(MAX(display_order), 0) + 1\n            INTO order_num\n            FROM saved_views\n            WHERE resource_key = view_order.resource_key\n              AND created_by = view_order.created_by\n              AND id != view_order.id;\n        END IF;\n        \n        UPDATE saved_views\n        SET display_order = order_num\n        WHERE id = view_order.id\n          AND display_order IS NULL;\n    END LOOP;\nEND $$","-- Comments\nCOMMENT ON COLUMN user_interface_preferences.display_order IS 'Display order for the interface (lower numbers appear first)'","COMMENT ON COLUMN saved_views.display_order IS 'Display order for the page/view (0 for default view, higher numbers appear later)'"}	add_display_order_to_interfaces_and_pages
20260124000000	{"-- =====================================================\n-- Migration: Add Filter Support Views\n-- Created: 2026-01-24\n-- Description: Add server-side helper views for table filters\n-- =====================================================\n\n-- Customers with lead counts (total_leads)\nDROP VIEW IF EXISTS public.customers_with_lead_counts","CREATE VIEW public.customers_with_lead_counts AS\nSELECT\n  c.*,\n  COALESCE(l.lead_count, 0) AS total_leads\nFROM public.customers c\nLEFT JOIN (\n  SELECT customer_id, COUNT(*)::INT AS lead_count\n  FROM public.leads\n  WHERE customer_id IS NOT NULL\n  GROUP BY customer_id\n) l ON l.customer_id = c.id","GRANT SELECT ON public.customers_with_lead_counts TO authenticated","GRANT SELECT ON public.customers_with_lead_counts TO anon","COMMENT ON VIEW public.customers_with_lead_counts IS 'Customers with total lead counts for filtering and sorting.'","-- Workout templates with has_leads flag\nDROP VIEW IF EXISTS public.workout_templates_with_leads","CREATE VIEW public.workout_templates_with_leads AS\nSELECT\n  t.*,\n  EXISTS (\n    SELECT 1\n    FROM public.workout_plans wp\n    WHERE wp.template_id = t.id\n      AND wp.lead_id IS NOT NULL\n  ) AS has_leads\nFROM public.workout_templates t","GRANT SELECT ON public.workout_templates_with_leads TO authenticated","GRANT SELECT ON public.workout_templates_with_leads TO anon","COMMENT ON VIEW public.workout_templates_with_leads IS 'Workout templates with has_leads flag for filtering.'","-- Nutrition templates with numeric ranges\nDROP VIEW IF EXISTS public.nutrition_templates_with_ranges","CREATE VIEW public.nutrition_templates_with_ranges AS\nSELECT\n  t.*,\n  (t.targets->>'calories')::NUMERIC AS calories_value,\n  (t.targets->>'protein')::NUMERIC AS protein_value\nFROM public.nutrition_templates t","GRANT SELECT ON public.nutrition_templates_with_ranges TO authenticated","GRANT SELECT ON public.nutrition_templates_with_ranges TO anon","COMMENT ON VIEW public.nutrition_templates_with_ranges IS 'Nutrition templates with numeric calories/protein values for filtering.'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_filter_views
20260124000001	{"-- Migration: Create interface_folders table for organizing pages into folders\n-- This allows users to create folders under interfaces and organize pages into them\n\n-- =====================================================\n-- TABLE: interface_folders\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS interface_folders (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name TEXT NOT NULL,\n    interface_key TEXT NOT NULL, -- e.g., 'leads', 'customers', 'templates', etc.\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    display_order INTEGER,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Ensure unique folder names per interface per user\n    CONSTRAINT unique_folder_name_per_interface_user \n        UNIQUE (interface_key, user_id, name)\n)","-- Indexes for faster queries\nCREATE INDEX IF NOT EXISTS idx_interface_folders_interface_key ON interface_folders(interface_key)","CREATE INDEX IF NOT EXISTS idx_interface_folders_user_id ON interface_folders(user_id)","CREATE INDEX IF NOT EXISTS idx_interface_folders_interface_user ON interface_folders(interface_key, user_id)","CREATE INDEX IF NOT EXISTS idx_interface_folders_display_order ON interface_folders(interface_key, user_id, display_order)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_interface_folders_updated_at\n    BEFORE UPDATE ON interface_folders\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS)\n-- =====================================================\n\n-- Enable RLS\nALTER TABLE interface_folders ENABLE ROW LEVEL SECURITY","-- Policy: Users can view their own folders\nCREATE POLICY \\"Users can view their own folders\\"\n    ON interface_folders\n    FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own folders\nCREATE POLICY \\"Users can insert their own folders\\"\n    ON interface_folders\n    FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own folders\nCREATE POLICY \\"Users can update their own folders\\"\n    ON interface_folders\n    FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own folders\nCREATE POLICY \\"Users can delete their own folders\\"\n    ON interface_folders\n    FOR DELETE\n    USING (auth.uid() = user_id)","-- =====================================================\n-- Add folder_id to saved_views\n-- =====================================================\n\n-- Add folder_id column to saved_views (nullable - pages can be in a folder or not)\nALTER TABLE saved_views \nADD COLUMN IF NOT EXISTS folder_id UUID REFERENCES interface_folders(id) ON DELETE SET NULL","-- Create index for faster queries\nCREATE INDEX IF NOT EXISTS idx_saved_views_folder_id ON saved_views(folder_id)","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE interface_folders IS 'User-defined folders for organizing pages under interfaces'","COMMENT ON COLUMN interface_folders.name IS 'Name of the folder'","COMMENT ON COLUMN interface_folders.interface_key IS 'The interface this folder belongs to (e.g., \\"leads\\", \\"customers\\")'","COMMENT ON COLUMN interface_folders.display_order IS 'Display order for the folder (lower numbers appear first)'","COMMENT ON COLUMN saved_views.folder_id IS 'Optional folder this page belongs to. NULL means the page is directly under the interface.'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_interface_folders
20260125000001	{"-- =====================================================\n-- Create Collections (גבייה) Table\n-- Created: 2026-01-25\n-- Description: Collections table for tracking payment collections\n--              Links to leads and can have multiple payments\n-- =====================================================\n\n-- Create collections table\nCREATE TABLE IF NOT EXISTS public.collections (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    lead_id UUID NOT NULL REFERENCES public.leads(id) ON DELETE CASCADE,\n    customer_id UUID REFERENCES public.customers(id) ON DELETE SET NULL,\n    total_amount NUMERIC(10, 2) NOT NULL CHECK (total_amount >= 0),\n    due_date DATE,\n    status TEXT NOT NULL CHECK (status IN ('ממתין', 'חלקי', 'הושלם', 'בוטל')) DEFAULT 'ממתין',\n    description TEXT,\n    notes TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Create indexes for efficient queries\nCREATE INDEX IF NOT EXISTS idx_collections_lead_id ON public.collections(lead_id)","CREATE INDEX IF NOT EXISTS idx_collections_customer_id ON public.collections(customer_id)","CREATE INDEX IF NOT EXISTS idx_collections_created_at ON public.collections(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_collections_status ON public.collections(status)","CREATE INDEX IF NOT EXISTS idx_collections_due_date ON public.collections(due_date)","-- Create trigger for auto-updating updated_at\nCREATE TRIGGER update_collections_updated_at\n    BEFORE UPDATE ON public.collections\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS on collections table\nALTER TABLE public.collections ENABLE ROW LEVEL SECURITY","-- RLS Policies for collections\n-- Authenticated users can read collections for leads they have access to\nDROP POLICY IF EXISTS \\"Authenticated users can read collections\\" ON public.collections","CREATE POLICY \\"Authenticated users can read collections\\"\n    ON public.collections FOR SELECT\n    USING (\n        auth.role() = 'authenticated' AND (\n            -- Users can see collections for leads they have access to\n            EXISTS (\n                SELECT 1 FROM public.leads\n                WHERE leads.id = collections.lead_id\n            )\n            OR\n            -- Admins can see all collections\n            EXISTS (\n                SELECT 1 FROM public.profiles\n                WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n            )\n        )\n    )","-- Authenticated users can insert collections\nDROP POLICY IF EXISTS \\"Authenticated users can insert collections\\" ON public.collections","CREATE POLICY \\"Authenticated users can insert collections\\"\n    ON public.collections FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","-- Authenticated users can update collections\nDROP POLICY IF EXISTS \\"Authenticated users can update collections\\" ON public.collections","CREATE POLICY \\"Authenticated users can update collections\\"\n    ON public.collections FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","-- Authenticated users can delete collections\nDROP POLICY IF EXISTS \\"Authenticated users can delete collections\\" ON public.collections","CREATE POLICY \\"Authenticated users can delete collections\\"\n    ON public.collections FOR DELETE\n    USING (auth.role() = 'authenticated')","-- Admins have full access to collections\nDROP POLICY IF EXISTS \\"Admins have full access to collections\\" ON public.collections","CREATE POLICY \\"Admins have full access to collections\\"\n    ON public.collections FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n        )\n    )","-- Add comment to table\nCOMMENT ON TABLE public.collections IS 'Payment collections (גבייה) - groups of payments for a lead'","COMMENT ON COLUMN public.collections.lead_id IS 'Lead this collection belongs to (required)'","COMMENT ON COLUMN public.collections.customer_id IS 'Customer this collection belongs to (derived from lead, optional for direct reference)'","COMMENT ON COLUMN public.collections.total_amount IS 'Total amount expected for this collection'","COMMENT ON COLUMN public.collections.due_date IS 'Due date for the collection'","COMMENT ON COLUMN public.collections.status IS 'Collection status: ממתין (pending), חלקי (partial), הושלם (completed), בוטל (cancelled)'","COMMENT ON COLUMN public.collections.description IS 'Description of the collection'","COMMENT ON COLUMN public.collections.notes IS 'Additional notes about the collection'"}	create_collections
20260125000003	{"-- =====================================================\n-- Add collections to saved_views\n-- Created: 2026-01-25\n-- Description: Enable saved views for collections interface\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'collections'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets', 'meetings', 'check_in_settings', 'payments', 'collections'))","-- Insert collections into saved_views resource types if not exists\n-- This allows users to create custom views/filters for collections\nINSERT INTO public.saved_views (resource_key, view_name, filter_config, created_by, is_default, display_order)\nSELECT \n    'collections' as resource_key,\n    'כל הגבייות' as view_name,\n    '{}'::jsonb as filter_config,\n    u.id as created_by,\n    true as is_default,\n    1 as display_order\nFROM auth.users u\nWHERE NOT EXISTS (\n    SELECT 1 FROM public.saved_views sv\n    WHERE sv.resource_key = 'collections' \n    AND sv.created_by = u.id \n    AND sv.is_default = true\n)"}	add_collections_to_saved_views
20260126000000	{"-- =====================================================\n-- Auto-fill customer_id from lead_id in payments\n-- Created: 2026-01-26\n-- Description: Automatically populate customer_id from lead_id when lead_id is provided\n--              This ensures payments are properly linked to both lead and customer\n-- =====================================================\n\n-- Create function to auto-fill customer_id from lead_id\nCREATE OR REPLACE FUNCTION public.auto_fill_payment_customer_id()\nRETURNS TRIGGER AS $$\nBEGIN\n    -- If customer_id is not provided but lead_id is, get customer_id from lead\n    IF NEW.customer_id IS NULL AND NEW.lead_id IS NOT NULL THEN\n        SELECT customer_id INTO NEW.customer_id\n        FROM public.leads\n        WHERE id = NEW.lead_id;\n    END IF;\n    \n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger to call the function before insert\nDROP TRIGGER IF EXISTS trigger_auto_fill_payment_customer_id ON public.payments","CREATE TRIGGER trigger_auto_fill_payment_customer_id\n    BEFORE INSERT ON public.payments\n    FOR EACH ROW\n    EXECUTE FUNCTION public.auto_fill_payment_customer_id()","-- Also handle updates in case lead_id is changed\nDROP TRIGGER IF EXISTS trigger_auto_fill_payment_customer_id_update ON public.payments","CREATE TRIGGER trigger_auto_fill_payment_customer_id_update\n    BEFORE UPDATE ON public.payments\n    FOR EACH ROW\n    WHEN (OLD.lead_id IS DISTINCT FROM NEW.lead_id OR NEW.customer_id IS NULL)\n    EXECUTE FUNCTION public.auto_fill_payment_customer_id()","-- Add comment\nCOMMENT ON FUNCTION public.auto_fill_payment_customer_id() IS 'Automatically populates customer_id from lead_id when inserting or updating payments'"}	auto_fill_customer_id_from_lead
20260130000000	{"-- =====================================================\n-- Add subscription_types and whatsapp_automations to saved_views\n-- Created: 2026-01-30\n-- Description: Enable saved views for subscription types and WhatsApp automations interfaces\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'subscription_types' and 'whatsapp_automations'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets', 'meetings', 'check_in_settings', 'payments', 'collections', 'subscription_types', 'whatsapp_automations'))","-- Insert subscription_types default view for all users\nINSERT INTO public.saved_views (resource_key, view_name, filter_config, created_by, is_default, display_order)\nSELECT \n    'subscription_types' as resource_key,\n    'כל סוגי המנויים' as view_name,\n    '{}'::jsonb as filter_config,\n    u.id as created_by,\n    true as is_default,\n    1 as display_order\nFROM auth.users u\nWHERE NOT EXISTS (\n    SELECT 1 FROM public.saved_views sv\n    WHERE sv.resource_key = 'subscription_types' \n    AND sv.created_by = u.id \n    AND sv.is_default = true\n)","-- Insert whatsapp_automations default view for all users\nINSERT INTO public.saved_views (resource_key, view_name, filter_config, created_by, is_default, display_order)\nSELECT \n    'whatsapp_automations' as resource_key,\n    'כל האוטומציות' as view_name,\n    '{}'::jsonb as filter_config,\n    u.id as created_by,\n    true as is_default,\n    1 as display_order\nFROM auth.users u\nWHERE NOT EXISTS (\n    SELECT 1 FROM public.saved_views sv\n    WHERE sv.resource_key = 'whatsapp_automations' \n    AND sv.created_by = u.id \n    AND sv.is_default = true\n)","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_subscription_types_and_whatsapp_automations_to_saved_views
20260127000000	{"-- =====================================================\n-- Create prospero_proposals table\n-- Created: 2026-01-27\n-- Description: Stores Prospero proposals created via Make.com webhook\n--              Status can be \\"Sent\\" (when created) or \\"Signed\\" (when signed)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS public.prospero_proposals (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Foreign keys\n    lead_id UUID NOT NULL REFERENCES public.leads(id) ON DELETE CASCADE,\n    customer_id UUID REFERENCES public.customers(id) ON DELETE SET NULL,\n    \n    -- Proposal data\n    proposal_link TEXT NOT NULL,\n    prospero_proposal_id TEXT, -- ID from Prospero if provided\n    status TEXT NOT NULL DEFAULT 'Sent' CHECK (status IN ('Sent', 'Signed')),\n    \n    -- Additional metadata\n    metadata JSONB DEFAULT '{}'::jsonb\n)","-- Create indexes\nCREATE INDEX IF NOT EXISTS idx_prospero_proposals_lead_id ON public.prospero_proposals(lead_id)","CREATE INDEX IF NOT EXISTS idx_prospero_proposals_customer_id ON public.prospero_proposals(customer_id)","CREATE INDEX IF NOT EXISTS idx_prospero_proposals_status ON public.prospero_proposals(status)","CREATE INDEX IF NOT EXISTS idx_prospero_proposals_created_at ON public.prospero_proposals(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_prospero_proposals_prospero_id ON public.prospero_proposals(prospero_proposal_id)","-- Create trigger for auto-updating updated_at\nCREATE TRIGGER update_prospero_proposals_updated_at\n    BEFORE UPDATE ON public.prospero_proposals\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS\nALTER TABLE public.prospero_proposals ENABLE ROW LEVEL SECURITY","-- RLS Policies\n-- Allow authenticated users to view proposals\nCREATE POLICY \\"Authenticated users can view proposals\\"\n    ON public.prospero_proposals\n    FOR SELECT\n    TO authenticated\n    USING (true)","-- Allow authenticated users to insert proposals\nCREATE POLICY \\"Authenticated users can insert proposals\\"\n    ON public.prospero_proposals\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (true)","-- Allow authenticated users to update proposals\nCREATE POLICY \\"Authenticated users can update proposals\\"\n    ON public.prospero_proposals\n    FOR UPDATE\n    TO authenticated\n    USING (true)\n    WITH CHECK (true)","-- Add comments\nCOMMENT ON TABLE public.prospero_proposals IS 'Stores Prospero proposals created via Make.com webhook integration'","COMMENT ON COLUMN public.prospero_proposals.status IS 'Proposal status: \\"Sent\\" when created, \\"Signed\\" when signed by customer'","COMMENT ON COLUMN public.prospero_proposals.prospero_proposal_id IS 'Optional Prospero proposal ID if provided by the system'","COMMENT ON COLUMN public.prospero_proposals.metadata IS 'Additional metadata stored as JSON'"}	create_prospero_proposals
20260128000000	{"-- =====================================================\n-- Add Status Field to Subscription Types\n-- Created: 2026-01-28\n-- Description: Adds status column to subscription_types table\n--              Allows tracking subscription type status (Active/Inactive)\n--              Defaults to 'פעיל' (Active) for backward compatibility\n-- =====================================================\n\nSET search_path TO public","-- Add status column to subscription_types table\nALTER TABLE public.subscription_types \nADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'פעיל' NOT NULL","-- Create index for status column for filtering\nCREATE INDEX IF NOT EXISTS idx_subscription_types_status ON public.subscription_types(status) WHERE status IS NOT NULL","-- Add comment for status column\nCOMMENT ON COLUMN public.subscription_types.status IS 'Subscription type status: פעיל (Active) or לא פעיל (Inactive)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_status_to_subscription_types
20260129000000	{"-- =====================================================\n-- Create proposals table\n-- Created: 2026-01-29\n-- Description: Stores proposals for leads and customers\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS public.proposals (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Foreign keys\n    lead_id UUID REFERENCES public.leads(id) ON DELETE CASCADE,\n    customer_id UUID REFERENCES public.customers(id) ON DELETE SET NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    \n    -- Proposal data\n    title TEXT NOT NULL,\n    description TEXT,\n    proposal_link TEXT,\n    external_proposal_id TEXT,\n    status TEXT NOT NULL DEFAULT 'Draft' CHECK (status IN ('Draft', 'Sent', 'Viewed', 'Signed', 'Rejected', 'Expired')),\n    \n    -- Financial data\n    amount NUMERIC(12, 2),\n    currency TEXT DEFAULT 'ILS',\n    \n    -- Timestamps\n    sent_at TIMESTAMP WITH TIME ZONE,\n    viewed_at TIMESTAMP WITH TIME ZONE,\n    signed_at TIMESTAMP WITH TIME ZONE,\n    expires_at TIMESTAMP WITH TIME ZONE,\n    \n    -- Additional metadata\n    metadata JSONB DEFAULT '{}'::jsonb\n)","-- Create indexes\nCREATE INDEX IF NOT EXISTS idx_proposals_lead_id ON public.proposals(lead_id)","CREATE INDEX IF NOT EXISTS idx_proposals_customer_id ON public.proposals(customer_id)","CREATE INDEX IF NOT EXISTS idx_proposals_created_by ON public.proposals(created_by)","CREATE INDEX IF NOT EXISTS idx_proposals_status ON public.proposals(status)","CREATE INDEX IF NOT EXISTS idx_proposals_created_at ON public.proposals(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_proposals_external_id ON public.proposals(external_proposal_id)","CREATE INDEX IF NOT EXISTS idx_proposals_expires_at ON public.proposals(expires_at) WHERE expires_at IS NOT NULL","-- Create trigger for auto-updating updated_at\nDROP TRIGGER IF EXISTS update_proposals_updated_at ON public.proposals","CREATE TRIGGER update_proposals_updated_at\n    BEFORE UPDATE ON public.proposals\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS\nALTER TABLE public.proposals ENABLE ROW LEVEL SECURITY","-- RLS Policies\n-- Drop existing policies if they exist\nDROP POLICY IF EXISTS \\"Authenticated users can view proposals\\" ON public.proposals","DROP POLICY IF EXISTS \\"Authenticated users can insert proposals\\" ON public.proposals","DROP POLICY IF EXISTS \\"Authenticated users can update proposals\\" ON public.proposals","DROP POLICY IF EXISTS \\"Authenticated users can delete proposals\\" ON public.proposals","-- Allow authenticated users to view proposals\nCREATE POLICY \\"Authenticated users can view proposals\\"\n    ON public.proposals\n    FOR SELECT\n    TO authenticated\n    USING (true)","-- Allow authenticated users to insert proposals\nCREATE POLICY \\"Authenticated users can insert proposals\\"\n    ON public.proposals\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (true)","-- Allow authenticated users to update proposals\nCREATE POLICY \\"Authenticated users can update proposals\\"\n    ON public.proposals\n    FOR UPDATE\n    TO authenticated\n    USING (true)\n    WITH CHECK (true)","-- Allow authenticated users to delete proposals\nCREATE POLICY \\"Authenticated users can delete proposals\\"\n    ON public.proposals\n    FOR DELETE\n    TO authenticated\n    USING (true)","-- Add comments\nCOMMENT ON TABLE public.proposals IS 'Stores proposals for leads and customers'","COMMENT ON COLUMN public.proposals.status IS 'Proposal status: Draft, Sent, Viewed, Signed, Rejected, or Expired'","COMMENT ON COLUMN public.proposals.external_proposal_id IS 'External proposal ID from third-party systems'","COMMENT ON COLUMN public.proposals.metadata IS 'Additional metadata stored as JSON'"}	create_proposals
20260130000001	{"-- Migration: Add numeric_value column to user_interface_preferences\n-- This allows storing numeric preferences like sidebar width alongside icon preferences\n\n-- Make icon_name nullable to support numeric-only preferences\nALTER TABLE user_interface_preferences\nALTER COLUMN icon_name DROP NOT NULL","-- Add numeric_value column\nALTER TABLE user_interface_preferences\nADD COLUMN IF NOT EXISTS numeric_value INTEGER","-- Add comment\nCOMMENT ON COLUMN user_interface_preferences.numeric_value IS 'Numeric preference value (e.g., sidebar width in pixels)'","-- Update the unique constraint to allow same interface_key with different value types\n-- Note: The existing constraint on (user_id, interface_key) still applies\n-- This means one preference per interface per user, but now it can be either icon_name or numeric_value"}	add_numeric_value_to_user_interface_preferences
20260131000000	{"-- =====================================================\n-- Create Exercises Table\n-- Created: 2026-01-31\n-- Description: Stores exercise library with name, repetitions, weight, image, and video link\n-- =====================================================\n\n-- =====================================================\n-- TABLE: exercises\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS public.exercises (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name TEXT NOT NULL,\n    repetitions INTEGER, -- Default repetitions/reps\n    weight DECIMAL(5, 2), -- Default weight in kg\n    image TEXT, -- URL or path to image\n    video_link TEXT, -- URL to video (YouTube, Vimeo, etc.)\n    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_exercises_name ON public.exercises(name)","CREATE INDEX IF NOT EXISTS idx_exercises_created_at ON public.exercises(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_exercises_created_by ON public.exercises(created_by)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_exercises_updated_at\n    BEFORE UPDATE ON public.exercises\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on exercises table\nALTER TABLE public.exercises ENABLE ROW LEVEL SECURITY","-- Policy: Authenticated users can view all exercises\nCREATE POLICY \\"Authenticated users can view exercises\\"\n    ON public.exercises FOR SELECT\n    USING (auth.role() = 'authenticated')","-- Policy: Authenticated users can insert exercises\nCREATE POLICY \\"Authenticated users can insert exercises\\"\n    ON public.exercises FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","-- Policy: Authenticated users can update exercises\nCREATE POLICY \\"Authenticated users can update exercises\\"\n    ON public.exercises FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","-- Policy: Authenticated users can delete exercises\nCREATE POLICY \\"Authenticated users can delete exercises\\"\n    ON public.exercises FOR DELETE\n    USING (auth.role() = 'authenticated')","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE public.exercises IS 'Exercise library that can be selected and used in workout templates'","COMMENT ON COLUMN public.exercises.name IS 'Exercise name'","COMMENT ON COLUMN public.exercises.repetitions IS 'Default number of repetitions/reps'","COMMENT ON COLUMN public.exercises.weight IS 'Default weight in kg'","COMMENT ON COLUMN public.exercises.image IS 'URL or path to exercise image'","COMMENT ON COLUMN public.exercises.video_link IS 'URL to exercise video (YouTube, Vimeo, etc.)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_exercises
20260131000001	{"-- =====================================================\n-- Add exercises to saved_views\n-- Created: 2026-01-31\n-- Description: Enable saved views for exercises interface\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'exercises'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'exercises', 'nutrition_templates', 'budgets', 'meetings', 'check_in_settings', 'payments', 'collections', 'subscription_types', 'whatsapp_automations'))","-- Insert exercises default view for all users\nINSERT INTO public.saved_views (resource_key, view_name, filter_config, created_by, is_default, display_order)\nSELECT \n    'exercises' as resource_key,\n    'כל התרגילים' as view_name,\n    '{}'::jsonb as filter_config,\n    u.id as created_by,\n    true as is_default,\n    1 as display_order\nFROM auth.users u\nWHERE NOT EXISTS (\n    SELECT 1 FROM public.saved_views sv\n    WHERE sv.resource_key = 'exercises' \n    AND sv.created_by = u.id \n    AND sv.is_default = true\n)","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_exercises_to_saved_views
20260131000002	{"-- =====================================================\n-- Fix Exercise and Workout Storage RLS Policies\n-- Created: 2026-01-22\n-- Description: Ensures managers can upload to both workout-exercises and exercises folders\n-- =====================================================\n\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Drop existing specific policies to consolidate\n    DROP POLICY IF EXISTS \\"Managers can upload workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete workout exercise media\\" ON storage.objects;\n    \n    DROP POLICY IF EXISTS \\"Managers can upload exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete exercise media\\" ON storage.objects;\n\n    -- Drop the new policies if they exist (in case migration is re-run)\n    DROP POLICY IF EXISTS \\"Managers can upload exercise assets\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Authenticated users can view exercise assets\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete exercise assets\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can update exercise assets\\" ON storage.objects;\n\n    -- 1. INSERT: Allow managers/admins to upload\n    CREATE POLICY \\"Managers can upload exercise assets\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      (name LIKE 'workout-exercises/%' OR name LIKE 'exercises/%') AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- 2. SELECT: Allow all authenticated users to view (so trainees can see exercise images in their plans)\n    CREATE POLICY \\"Authenticated users can view exercise assets\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      (name LIKE 'workout-exercises/%' OR name LIKE 'exercises/%')\n    );\n\n    -- 3. DELETE: Allow managers/admins to delete\n    CREATE POLICY \\"Managers can delete exercise assets\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      (name LIKE 'workout-exercises/%' OR name LIKE 'exercises/%') AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- 4. UPDATE: Allow managers/admins to update (for upserts)\n    CREATE POLICY \\"Managers can update exercise assets\\"\n    ON storage.objects\n    FOR UPDATE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      (name LIKE 'workout-exercises/%' OR name LIKE 'exercises/%') AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    RAISE NOTICE 'Exercise storage RLS policies fixed successfully';\n  END IF;\nEND $$"}	fix_exercise_storage_rls
20260201000000	{"-- Create a view for collections with aggregated payment totals\n-- This enables server-side sorting/pagination on paid/remaining amounts.\n\nCREATE OR REPLACE VIEW public.collections_with_payments AS\nSELECT\n  c.*,\n  lead_customer.full_name AS lead_name,\n  customer.full_name AS customer_name,\n  COALESCE(SUM(CASE WHEN p.status = 'שולם' THEN p.amount ELSE 0 END), 0) AS paid_amount,\n  GREATEST(\n    COALESCE(c.total_amount, 0) - COALESCE(SUM(CASE WHEN p.status = 'שולם' THEN p.amount ELSE 0 END), 0),\n    0\n  ) AS remaining_amount\nFROM public.collections c\nLEFT JOIN public.leads l ON l.id = c.lead_id\nLEFT JOIN public.customers lead_customer ON lead_customer.id = l.customer_id\nLEFT JOIN public.customers customer ON customer.id = c.customer_id\nLEFT JOIN public.payments p ON p.collection_id = c.id\nGROUP BY c.id, lead_customer.full_name, customer.full_name","ALTER VIEW public.collections_with_payments SET (security_invoker = true)"}	create_collections_with_payments_view
20260202000000	{"-- =====================================================\n-- Update Leads View and Functions for Expanded Relations (Ultimate God Mode - FIXED)\n-- Created: 2026-02-02\n-- Description: Adds relations to EVERYTHING linked to leads\n-- =====================================================\n\n-- 1. Drop dependencies (Robustly drop all function signatures)\nDO $$\nDECLARE\n    r RECORD;\nBEGIN\n    -- Drop get_filtered_leads functions\n    FOR r IN SELECT oid::regprocedure AS func_signature\n             FROM pg_proc\n             WHERE proname = 'get_filtered_leads'\n             AND pronamespace = 'public'::regnamespace\n    LOOP\n        EXECUTE 'DROP FUNCTION IF EXISTS ' || r.func_signature || ' CASCADE';\n    END LOOP;\n\n    -- Drop get_filtered_leads_count functions\n    FOR r IN SELECT oid::regprocedure AS func_signature\n             FROM pg_proc\n             WHERE proname = 'get_filtered_leads_count'\n             AND pronamespace = 'public'::regnamespace\n    LOOP\n        EXECUTE 'DROP FUNCTION IF EXISTS ' || r.func_signature || ' CASCADE';\n    END LOOP;\nEND $$","DROP VIEW IF EXISTS public.v_leads_with_customer CASCADE","-- 2. Recreate View with ALL Aggregates and JSON Data\nCREATE OR REPLACE VIEW \\"public\\".\\"v_leads_with_customer\\" AS\nSELECT \n    l.id,\n    l.created_at,\n    l.updated_at,\n    l.assigned_to,\n    l.customer_id,\n    l.city,\n    l.birth_date,\n    l.age,\n    l.gender,\n    l.period,\n    l.status_main,\n    l.status_sub,\n    l.height,\n    l.weight,\n    l.bmi,\n    l.join_date,\n    l.subscription_data,\n    l.daily_protocol,\n    l.workout_history,\n    l.steps_history,\n    l.source,\n    l.fitness_goal,\n    l.activity_level,\n    l.preferred_time,\n    l.notes,\n    -- Customer data (One-to-One)\n    c.full_name as customer_name,\n    c.phone as customer_phone,\n    c.email as customer_email,\n    -- Calculated fields\n    TO_CHAR(l.created_at, 'YYYY-MM-DD') as created_date_formatted,\n    TO_CHAR(l.birth_date, 'YYYY-MM-DD') as birth_date_formatted,\n    -- JSONB fields extracted for convenience\n    (l.daily_protocol->>'stepsGoal')::INTEGER as daily_steps_goal,\n    (l.daily_protocol->>'workoutGoal')::INTEGER as weekly_workouts_goal,\n    (l.daily_protocol->>'supplements')::JSONB as daily_supplements,\n    (l.subscription_data->>'months')::INTEGER as subscription_months,\n    (l.subscription_data->>'initialPrice')::DECIMAL as subscription_initial_price,\n    (l.subscription_data->>'renewalPrice')::DECIMAL as subscription_renewal_price,\n    (l.subscription_data->>'name')::TEXT as subscription_name,\n    \n    -- Active Budget (One-to-One via assignment)\n    b.name as active_budget_name,\n    b.id as active_budget_id,\n    to_jsonb(b.*) as active_budget_json,\n    \n    -- Payments (One-to-Many)\n    COALESCE(p_agg.total_paid, 0) as total_paid,\n    p_agg.last_payment_date,\n    COALESCE(p_agg.payments_json, '[]'::jsonb) as payments_json,\n    \n    -- Collections (One-to-Many)\n    COALESCE(col_agg.total_expected, 0) as total_expected,\n    (COALESCE(col_agg.total_expected, 0) - COALESCE(p_agg.total_paid, 0)) as debt_amount,\n    COALESCE(col_agg.collections_json, '[]'::jsonb) as collections_json,\n    \n    -- Workout Plans (One-to-Many)\n    COALESCE(wp_agg.plan_count, 0) as workout_plans_count,\n    wp_agg.latest_plan_date as latest_workout_plan_date,\n    COALESCE(wp_agg.plans_json, '[]'::jsonb) as workout_plans_json,\n    \n    -- Nutrition Plans (One-to-Many)\n    COALESCE(np_agg.plan_count, 0) as nutrition_plans_count,\n    np_agg.latest_plan_date as latest_nutrition_plan_date,\n    COALESCE(np_agg.plans_json, '[]'::jsonb) as nutrition_plans_json,\n\n    -- Supplement Plans (One-to-Many)\n    COALESCE(sup_agg.plan_count, 0) as supplement_plans_count,\n    sup_agg.latest_plan_date as latest_supplement_plan_date,\n    COALESCE(sup_agg.plans_json, '[]'::jsonb) as supplement_plans_json,\n\n    -- Steps Plans (One-to-Many)\n    COALESCE(step_agg.plan_count, 0) as steps_plans_count,\n    step_agg.latest_plan_date as latest_steps_plan_date,\n    COALESCE(step_agg.plans_json, '[]'::jsonb) as steps_plans_json,\n\n    -- Meetings (One-to-Many)\n    COALESCE(meet_agg.meeting_count, 0) as meetings_count,\n    meet_agg.latest_meeting_date,\n    meet_agg.next_meeting_date,\n    COALESCE(meet_agg.meetings_json, '[]'::jsonb) as meetings_json,\n\n    -- Blood Tests (One-to-Many)\n    COALESCE(blood_agg.test_count, 0) as blood_tests_count,\n    blood_agg.latest_test_date,\n    COALESCE(blood_agg.tests_json, '[]'::jsonb) as blood_tests_json\n\nFROM public.leads l\nLEFT JOIN public.customers c ON l.customer_id = c.id\nLEFT JOIN public.budget_assignments ba ON l.id = ba.lead_id AND ba.is_active = true\nLEFT JOIN public.budgets b ON ba.budget_id = b.id\n\n-- Payments Aggregation\nLEFT JOIN (\n    SELECT lead_id, SUM(amount) as total_paid, MAX(created_at) as last_payment_date,\n           jsonb_agg(to_jsonb(p.*) ORDER BY created_at DESC) as payments_json\n    FROM public.payments p GROUP BY lead_id\n) p_agg ON l.id = p_agg.lead_id\n\n-- Collections Aggregation\nLEFT JOIN (\n    SELECT lead_id, SUM(total_amount) as total_expected,\n           jsonb_agg(to_jsonb(cl.*) ORDER BY due_date ASC) as collections_json\n    FROM public.collections cl GROUP BY lead_id\n) col_agg ON l.id = col_agg.lead_id\n\n-- Workout Plans\nLEFT JOIN (\n    SELECT lead_id, COUNT(*) as plan_count, MAX(start_date) as latest_plan_date,\n           jsonb_agg(to_jsonb(wp.*) ORDER BY start_date DESC) as plans_json\n    FROM public.workout_plans wp GROUP BY lead_id\n) wp_agg ON l.id = wp_agg.lead_id\n\n-- Nutrition Plans\nLEFT JOIN (\n    SELECT lead_id, COUNT(*) as plan_count, MAX(start_date) as latest_plan_date,\n           jsonb_agg(to_jsonb(np.*) ORDER BY start_date DESC) as plans_json\n    FROM public.nutrition_plans np GROUP BY lead_id\n) np_agg ON l.id = np_agg.lead_id\n\n-- Supplement Plans\nLEFT JOIN (\n    SELECT lead_id, COUNT(*) as plan_count, MAX(start_date) as latest_plan_date,\n           jsonb_agg(to_jsonb(sp.*) ORDER BY start_date DESC) as plans_json\n    FROM public.supplement_plans sp GROUP BY lead_id\n) sup_agg ON l.id = sup_agg.lead_id\n\n-- Steps Plans\nLEFT JOIN (\n    SELECT lead_id, COUNT(*) as plan_count, MAX(start_date) as latest_plan_date,\n           jsonb_agg(to_jsonb(stp.*) ORDER BY start_date DESC) as plans_json\n    FROM public.steps_plans stp GROUP BY lead_id\n) step_agg ON l.id = step_agg.lead_id\n\n-- Meetings\nLEFT JOIN (\n    SELECT lead_id, COUNT(*) as meeting_count, \n           MAX(created_at) FILTER (WHERE created_at < now()) as latest_meeting_date,\n           MIN(created_at) FILTER (WHERE created_at >= now()) as next_meeting_date,\n           jsonb_agg(to_jsonb(m.*) ORDER BY created_at DESC) as meetings_json\n    FROM public.meetings m GROUP BY lead_id\n) meet_agg ON l.id = meet_agg.lead_id\n\n-- Blood Tests\nLEFT JOIN (\n    SELECT lead_id, COUNT(*) as test_count, MAX(created_at) as latest_test_date,\n           jsonb_agg(to_jsonb(bt.*) ORDER BY created_at DESC) as tests_json\n    FROM public.blood_tests bt GROUP BY lead_id\n) blood_agg ON l.id = blood_agg.lead_id","-- Grant permissions\nGRANT SELECT ON public.v_leads_with_customer TO authenticated","GRANT SELECT ON public.v_leads_with_customer TO anon","GRANT SELECT ON public.v_leads_with_customer TO service_role","-- 3. Recreate get_filtered_leads with ALL columns\nCREATE OR REPLACE FUNCTION public.get_filtered_leads(\n    p_limit_count INTEGER DEFAULT 100,\n    p_offset_count INTEGER DEFAULT 0,\n    p_search_query TEXT DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_date TEXT DEFAULT NULL,\n    p_sort_by TEXT DEFAULT 'created_at',\n    p_sort_order TEXT DEFAULT 'DESC',\n    p_group_by_level1 TEXT DEFAULT NULL,\n    p_group_by_level2 TEXT DEFAULT NULL\n)\nRETURNS TABLE (\n    id UUID,\n    created_at TIMESTAMP WITH TIME ZONE,\n    updated_at TIMESTAMP WITH TIME ZONE,\n    assigned_to UUID,\n    customer_id UUID,\n    city TEXT,\n    birth_date DATE,\n    age INTEGER,\n    gender TEXT,\n    status_main TEXT,\n    status_sub TEXT,\n    height DECIMAL,\n    weight DECIMAL,\n    bmi DECIMAL,\n    join_date TIMESTAMP WITH TIME ZONE,\n    subscription_data JSONB,\n    daily_protocol JSONB,\n    workout_history JSONB,\n    steps_history JSONB,\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT,\n    customer_name TEXT,\n    customer_phone TEXT,\n    customer_email TEXT,\n    created_date_formatted TEXT,\n    birth_date_formatted TEXT,\n    daily_steps_goal INTEGER,\n    weekly_workouts_goal INTEGER,\n    daily_supplements JSONB,\n    subscription_months INTEGER,\n    subscription_initial_price DECIMAL,\n    subscription_renewal_price DECIMAL,\n    subscription_name TEXT,\n    \n    active_budget_name TEXT,\n    active_budget_id UUID,\n    active_budget_json JSONB,\n    \n    total_paid DECIMAL,\n    last_payment_date TIMESTAMP WITH TIME ZONE,\n    payments_json JSONB,\n    \n    total_expected DECIMAL,\n    debt_amount DECIMAL,\n    collections_json JSONB,\n    \n    workout_plans_count BIGINT,\n    latest_workout_plan_date DATE,\n    workout_plans_json JSONB,\n    \n    nutrition_plans_count BIGINT,\n    latest_nutrition_plan_date DATE,\n    nutrition_plans_json JSONB,\n\n    supplement_plans_count BIGINT,\n    latest_supplement_plan_date DATE,\n    supplement_plans_json JSONB,\n\n    steps_plans_count BIGINT,\n    latest_steps_plan_date DATE,\n    steps_plans_json JSONB,\n\n    meetings_count BIGINT,\n    latest_meeting_date TIMESTAMP WITH TIME ZONE,\n    next_meeting_date TIMESTAMP WITH TIME ZONE,\n    meetings_json JSONB,\n\n    blood_tests_count BIGINT,\n    latest_test_date TIMESTAMP WITH TIME ZONE,\n    blood_tests_json JSONB\n)\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    v_sort_direction TEXT;\n    v_order_by_clause TEXT;\nBEGIN\n    v_sort_direction := UPPER(COALESCE(NULLIF(p_sort_order, ''), 'DESC'));\n    IF v_sort_direction NOT IN ('ASC', 'DESC') THEN v_sort_direction := 'DESC'; END IF;\n\n    v_order_by_clause := '';\n    \n    IF p_group_by_level1 IS NOT NULL THEN\n        v_order_by_clause := v_order_by_clause || CASE \n            WHEN p_group_by_level1 IN ('status', 'status_main') THEN 'v.status_main ASC, '\n            WHEN p_group_by_level1 = 'source' THEN 'v.source ASC, '\n            WHEN p_group_by_level1 IN ('name', 'customer_name') THEN 'v.customer_name ASC, '\n            WHEN p_group_by_level1 = 'active_budget_name' THEN 'v.active_budget_name ASC, '\n            ELSE ''\n        END;\n    END IF;\n    \n    IF p_group_by_level2 IS NOT NULL THEN\n        v_order_by_clause := v_order_by_clause || CASE \n            WHEN p_group_by_level2 IN ('status', 'status_main') THEN 'v.status_main ASC, '\n            WHEN p_group_by_level2 = 'source' THEN 'v.source ASC, '\n            WHEN p_group_by_level2 IN ('name', 'customer_name') THEN 'v.customer_name ASC, '\n            ELSE ''\n        END;\n    END IF;\n    \n    v_order_by_clause := v_order_by_clause || CASE \n        WHEN p_sort_by IN ('createdDate', 'created_date', 'created_at') THEN 'v.created_at ' || v_sort_direction\n        WHEN p_sort_by IN ('name', 'customer_name') THEN 'v.customer_name ' || v_sort_direction\n        WHEN p_sort_by IN ('status', 'status_main') THEN 'v.status_main ' || v_sort_direction\n        WHEN p_sort_by = 'debt_amount' THEN 'v.debt_amount ' || v_sort_direction\n        ELSE 'v.created_at ' || v_sort_direction\n    END;\n\n    RETURN QUERY\n    EXECUTE format('\n        SELECT \n            v.*\n        FROM public.v_leads_with_customer v\n        WHERE \n            ($1 IS NULL OR \n             v.customer_name ILIKE ''%%'' || $1 || ''%%'' OR\n             v.customer_phone ILIKE ''%%'' || $1 || ''%%'' OR\n             v.customer_email ILIKE ''%%'' || $1 || ''%%'')\n            AND ($2 IS NULL OR v.status_main = $2)\n            AND ($3 IS NULL OR v.status_sub = $3)\n            AND ($4 IS NULL OR v.source = $4)\n            AND ($5 IS NULL OR v.fitness_goal = $5)\n            AND ($6 IS NULL OR v.activity_level = $6)\n            AND ($7 IS NULL OR v.preferred_time = $7)\n            AND ($8 IS NULL OR v.age::TEXT = $8)\n            AND ($9 IS NULL OR v.height::TEXT = $9)\n            AND ($10 IS NULL OR v.weight::TEXT = $10)\n            AND ($11 IS NULL OR v.created_date_formatted = $11)\n        ORDER BY %s\n        LIMIT $12\n        OFFSET $13\n    ', v_order_by_clause)\n    USING \n        p_search_query, p_status_main, p_status_sub, p_source, p_fitness_goal, p_activity_level, \n        p_preferred_time, p_age, p_height, p_weight, p_date, p_limit_count, p_offset_count;\nEND;\n$$","-- 4. Recreate get_filtered_leads_count\nCREATE OR REPLACE FUNCTION public.get_filtered_leads_count(\n    p_search_query TEXT DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_date TEXT DEFAULT NULL\n)\nRETURNS INTEGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    v_count INTEGER;\nBEGIN\n    SELECT COUNT(*)::INTEGER INTO v_count\n    FROM public.v_leads_with_customer v\n    WHERE \n        (p_search_query IS NULL OR \n         v.customer_name ILIKE '%' || p_search_query || '%' OR\n         v.customer_phone ILIKE '%' || p_search_query || '%' OR\n         v.customer_email ILIKE '%' || p_search_query || '%')\n        AND (p_status_main IS NULL OR v.status_main = p_status_main)\n        AND (p_status_sub IS NULL OR v.status_sub = p_status_sub)\n        AND (p_source IS NULL OR v.source = p_source)\n        AND (p_fitness_goal IS NULL OR v.fitness_goal = p_fitness_goal)\n        AND (p_activity_level IS NULL OR v.activity_level = p_activity_level)\n        AND (p_preferred_time IS NULL OR v.preferred_time = p_preferred_time)\n        AND (p_age IS NULL OR v.age::TEXT = p_age)\n        AND (p_height IS NULL OR v.height::TEXT = p_height)\n        AND (p_weight IS NULL OR v.weight::TEXT = p_weight)\n        AND (p_date IS NULL OR v.created_date_formatted = p_date);\n\n    RETURN COALESCE(v_count, 0);\nEND;\n$$","GRANT EXECUTE ON FUNCTION public.get_filtered_leads TO authenticated","GRANT EXECUTE ON FUNCTION public.get_filtered_leads_count TO authenticated"}	update_leads_view
20260204000000	{"-- Add avatar_url to profiles table\nALTER TABLE public.profiles\nADD COLUMN IF NOT EXISTS avatar_url TEXT","COMMENT ON COLUMN public.profiles.avatar_url IS 'URL of the user''s profile picture'","-- Create avatars storage bucket if it doesn't exist\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'buckets'\n  ) THEN\n    -- Insert bucket if it doesn't exist\n    INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)\n    VALUES (\n      'avatars',\n      'avatars',\n      true, -- Public bucket so avatars can be easily viewed\n      5242880, -- 5MB limit\n      ARRAY['image/jpeg', 'image/png', 'image/gif', 'image/webp']::text[]\n    )\n    ON CONFLICT (id) DO UPDATE SET\n      public = EXCLUDED.public,\n      file_size_limit = EXCLUDED.file_size_limit,\n      allowed_mime_types = EXCLUDED.allowed_mime_types;\n  END IF;\nEND $$","-- RLS Policies for avatars bucket\n\n-- Policy: Anyone can view avatars\nDROP POLICY IF EXISTS \\"Anyone can view avatars\\" ON storage.objects","CREATE POLICY \\"Anyone can view avatars\\"\nON storage.objects FOR SELECT\nUSING ( bucket_id = 'avatars' )","-- Policy: Authenticated users can upload their own avatar\n-- We'll use the file path convention: {user_id}/{filename}\nDROP POLICY IF EXISTS \\"Users can upload their own avatar\\" ON storage.objects","CREATE POLICY \\"Users can upload their own avatar\\"\nON storage.objects FOR INSERT\nTO authenticated\nWITH CHECK (\n  bucket_id = 'avatars' AND\n  (storage.foldername(name))[1] = auth.uid()::text\n)","-- Policy: Users can update their own avatar\nDROP POLICY IF EXISTS \\"Users can update their own avatar\\" ON storage.objects","CREATE POLICY \\"Users can update their own avatar\\"\nON storage.objects FOR UPDATE\nTO authenticated\nUSING (\n  bucket_id = 'avatars' AND\n  (storage.foldername(name))[1] = auth.uid()::text\n)\nWITH CHECK (\n  bucket_id = 'avatars' AND\n  (storage.foldername(name))[1] = auth.uid()::text\n)","-- Policy: Users can delete their own avatar\nDROP POLICY IF EXISTS \\"Users can delete their own avatar\\" ON storage.objects","CREATE POLICY \\"Users can delete their own avatar\\"\nON storage.objects FOR DELETE\nTO authenticated\nUSING (\n  bucket_id = 'avatars' AND\n  (storage.foldername(name))[1] = auth.uid()::text\n)"}	add_avatar_url
20260205000005	{"-- =====================================================\n-- Update Budget History Trigger\n-- Created: 2026-02-05\n-- Description: Update trigger to include all budget fields including supplement_template_id\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION log_budget_changes()\nRETURNS TRIGGER AS $$\nDECLARE\n    changes_json JSONB;\n    user_id UUID;\nBEGIN\n    user_id := auth.uid();\n    \n    IF (TG_OP = 'UPDATE') THEN\n        -- Only log if there are actual changes to relevant fields\n        -- We ignore updated_at\n        IF (OLD.name IS DISTINCT FROM NEW.name OR\n            OLD.description IS DISTINCT FROM NEW.description OR\n            OLD.nutrition_template_id IS DISTINCT FROM NEW.nutrition_template_id OR\n            OLD.nutrition_targets IS DISTINCT FROM NEW.nutrition_targets OR\n            OLD.steps_goal IS DISTINCT FROM NEW.steps_goal OR\n            OLD.steps_instructions IS DISTINCT FROM NEW.steps_instructions OR\n            OLD.workout_template_id IS DISTINCT FROM NEW.workout_template_id OR\n            OLD.supplement_template_id IS DISTINCT FROM NEW.supplement_template_id OR\n            OLD.supplements IS DISTINCT FROM NEW.supplements OR\n            OLD.eating_order IS DISTINCT FROM NEW.eating_order OR\n            OLD.eating_rules IS DISTINCT FROM NEW.eating_rules OR\n            OLD.is_public IS DISTINCT FROM NEW.is_public) THEN\n            \n            changes_json := jsonb_build_object(\n                'old', to_jsonb(OLD),\n                'new', to_jsonb(NEW)\n            );\n            \n            INSERT INTO budget_history (budget_id, changed_at, changed_by, change_type, changes, snapshot)\n            VALUES (NEW.id, NOW(), user_id, 'update', changes_json, to_jsonb(NEW));\n        END IF;\n        \n        RETURN NEW;\n    ELSIF (TG_OP = 'INSERT') THEN\n        INSERT INTO budget_history (budget_id, changed_at, changed_by, change_type, changes, snapshot)\n        VALUES (NEW.id, NOW(), user_id, 'create', '{}'::jsonb, to_jsonb(NEW));\n        RETURN NEW;\n    END IF;\n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER"}	update_budget_history_trigger
20260205000000	{"-- Create function to check expiring subscriptions and notify admins\nCREATE OR REPLACE FUNCTION check_expiring_subscriptions() RETURNS void AS $$\nDECLARE\n  lead_record RECORD;\n  admin_user RECORD;\n  days_until_expiration INT;\n  notification_type TEXT := 'subscription_expiring';\n  existing_count INT;\n  message_text TEXT;\nBEGIN\n  -- Loop through active leads with expiration date\n  -- Check for expiration date in subscription_data JSONB\n  FOR lead_record IN\n    SELECT \n      l.id, \n      l.customer_id,\n      c.full_name as customer_name,\n      (l.subscription_data->>'expirationDate')::DATE as expiration_date\n    FROM leads l\n    LEFT JOIN customers c ON l.customer_id = c.id\n    WHERE \n      l.subscription_data->>'expirationDate' IS NOT NULL \n      AND (l.subscription_data->>'status')::TEXT = 'פעיל'\n  LOOP\n    -- Calculate days until expiration\n    days_until_expiration := lead_record.expiration_date - CURRENT_DATE;\n    \n    -- Check if subscription is expiring in 7, 3, or 0 days\n    -- Also checking negative values if we missed the exact day (e.g. -1 for yesterday)\n    -- But let's stick to exact days for now to avoid spam, or checking range.\n    -- Better: check if expiration is exactly 7, 3, or 0 days from now.\n    IF days_until_expiration IN (7, 3, 0) THEN\n      \n      -- Prepare message\n      IF days_until_expiration = 0 THEN\n        message_text := 'המנוי של ' || COALESCE(lead_record.customer_name, 'לקוח') || ' מסתיים היום (' || TO_CHAR(lead_record.expiration_date, 'DD/MM/YYYY') || ')';\n      ELSE\n        message_text := 'המנוי של ' || COALESCE(lead_record.customer_name, 'לקוח') || ' יסתיים בעוד ' || days_until_expiration || ' ימים (' || TO_CHAR(lead_record.expiration_date, 'DD/MM/YYYY') || ')';\n      END IF;\n\n      -- For each admin user\n      FOR admin_user IN SELECT id FROM profiles WHERE role = 'admin' LOOP\n        \n        -- Check for existing notification today to avoid duplicates\n        -- Checking last 20 hours to handle potential timezone shifts or slightly early runs\n        SELECT COUNT(*) INTO existing_count\n        FROM notifications\n        WHERE \n          user_id = admin_user.id\n          AND lead_id = lead_record.id \n          AND type = notification_type \n          AND created_at > NOW() - INTERVAL '20 hours'\n          AND message = message_text;\n          \n        IF existing_count = 0 THEN\n          INSERT INTO notifications (\n            user_id,\n            customer_id,\n            lead_id,\n            type,\n            title,\n            message,\n            action_url\n          ) VALUES (\n            admin_user.id,\n            lead_record.customer_id,\n            lead_record.id,\n            notification_type,\n            'תזכורת סיום מנוי',\n            message_text,\n            '/dashboard/leads/' || lead_record.id\n          );\n        END IF;\n        \n      END LOOP;\n      \n    END IF;\n  END LOOP;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Grant execute permission to authenticated users (so they can trigger it on login)\nGRANT EXECUTE ON FUNCTION check_expiring_subscriptions() TO authenticated"}	check_subscription_expiration
20260205000001	{"-- =====================================================\n-- Update client-assets folder storage RLS policies to include 'avatar' folder\n-- Created: 2026-02-05\n-- Description: Updates RLS policies to allow uploads to 'avatar' folder\n--              Path structure: {customer_id}/{folder}/{filename}\n--              Folders: progress, notes, blood-tests, avatar\n-- =====================================================\n\n-- Only update policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Drop existing policies\n    DROP POLICY IF EXISTS \\"Trainees can upload to own client folder\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Trainees can view own client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Trainees can delete own client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can upload client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view all client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete all client files\\" ON storage.objects;\n\n    -- =====================================================\n    -- 1. TRAINEE POLICIES (for own folder)\n    -- =====================================================\n\n    -- RLS Policy: Allow trainees to upload files to their own client_id folder\n    CREATE POLICY \\"Trainees can upload to own client folder\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      (\n        name LIKE '%/progress/%' OR\n        name LIKE '%/notes/%' OR\n        name LIKE '%/blood-tests/%' OR\n        name LIKE '%/avatar/%'\n      ) AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = split_part(name, '/', 1)\n        AND customers.user_id = auth.uid()\n      )\n    );\n\n    -- RLS Policy: Allow trainees to view files in their own client_id folder\n    CREATE POLICY \\"Trainees can view own client files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      (\n        name LIKE '%/progress/%' OR\n        name LIKE '%/notes/%' OR\n        name LIKE '%/blood-tests/%' OR\n        name LIKE '%/avatar/%'\n      ) AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = split_part(name, '/', 1)\n        AND customers.user_id = auth.uid()\n      )\n    );\n\n    -- RLS Policy: Allow trainees to delete files from their own client_id folder\n    CREATE POLICY \\"Trainees can delete own client files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      (\n        name LIKE '%/progress/%' OR\n        name LIKE '%/notes/%' OR\n        name LIKE '%/blood-tests/%' OR\n        name LIKE '%/avatar/%'\n      ) AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = split_part(name, '/', 1)\n        AND customers.user_id = auth.uid()\n      )\n    );\n\n    -- =====================================================\n    -- 2. MANAGER POLICIES (for all client folders)\n    -- =====================================================\n\n    -- RLS Policy: Allow managers/admins to upload client files\n    CREATE POLICY \\"Managers can upload client files\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      (\n        name LIKE '%/progress/%' OR\n        name LIKE '%/notes/%' OR\n        name LIKE '%/blood-tests/%' OR\n        name LIKE '%/avatar/%'\n      ) AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow managers/admins to view all client files\n    CREATE POLICY \\"Managers can view all client files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow managers/admins to delete all client files\n    CREATE POLICY \\"Managers can delete all client files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    RAISE NOTICE 'Storage RLS policies for avatar uploads updated successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy update.';\n  END IF;\nEND $$"}	add_avatar_storage_policies
20260205000002	{"-- =====================================================\n-- Budget History Migration\n-- Created: 2026-02-05\n-- Description: Track changes to budgets for audit history\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS budget_history (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    budget_id UUID NOT NULL REFERENCES budgets(id) ON DELETE CASCADE,\n    changed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    changed_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    change_type TEXT NOT NULL, -- 'create', 'update'\n    changes JSONB NOT NULL DEFAULT '{}'::jsonb, -- Store old and new values\n    snapshot JSONB -- Full snapshot of the budget after change\n)","-- Indexes\nCREATE INDEX IF NOT EXISTS idx_budget_history_budget_id ON budget_history(budget_id)","CREATE INDEX IF NOT EXISTS idx_budget_history_changed_at ON budget_history(changed_at DESC)","-- Enable RLS\nALTER TABLE budget_history ENABLE ROW LEVEL SECURITY","-- Policies\n\n-- Admins/Staff can view all history\nCREATE POLICY \\"Staff can view all budget history\\"\n    ON budget_history FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role IN ('admin', 'manager', 'coach')\n        )\n    )","-- Users can view history of budgets they created\nCREATE POLICY \\"Users can view history of own budgets\\"\n    ON budget_history FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_history.budget_id\n            AND budgets.created_by = auth.uid()\n        )\n    )","-- Trigger Function\nCREATE OR REPLACE FUNCTION log_budget_changes()\nRETURNS TRIGGER AS $$\nDECLARE\n    changes_json JSONB;\n    user_id UUID;\nBEGIN\n    user_id := auth.uid();\n    \n    IF (TG_OP = 'UPDATE') THEN\n        -- Only log if there are actual changes to relevant fields\n        -- We ignore updated_at\n        IF (OLD.name IS DISTINCT FROM NEW.name OR\n            OLD.description IS DISTINCT FROM NEW.description OR\n            OLD.nutrition_template_id IS DISTINCT FROM NEW.nutrition_template_id OR\n            OLD.nutrition_targets IS DISTINCT FROM NEW.nutrition_targets OR\n            OLD.steps_goal IS DISTINCT FROM NEW.steps_goal OR\n            OLD.steps_instructions IS DISTINCT FROM NEW.steps_instructions OR\n            OLD.workout_template_id IS DISTINCT FROM NEW.workout_template_id OR\n            OLD.supplements IS DISTINCT FROM NEW.supplements OR\n            OLD.eating_order IS DISTINCT FROM NEW.eating_order OR\n            OLD.eating_rules IS DISTINCT FROM NEW.eating_rules OR\n            OLD.is_public IS DISTINCT FROM NEW.is_public) THEN\n            \n            changes_json := jsonb_build_object(\n                'old', to_jsonb(OLD),\n                'new', to_jsonb(NEW)\n            );\n            \n            INSERT INTO budget_history (budget_id, changed_at, changed_by, change_type, changes, snapshot)\n            VALUES (NEW.id, NOW(), user_id, 'update', changes_json, to_jsonb(NEW));\n        END IF;\n        \n        RETURN NEW;\n    ELSIF (TG_OP = 'INSERT') THEN\n        INSERT INTO budget_history (budget_id, changed_at, changed_by, change_type, changes, snapshot)\n        VALUES (NEW.id, NOW(), user_id, 'create', '{}'::jsonb, to_jsonb(NEW));\n        RETURN NEW;\n    END IF;\n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Trigger\nDROP TRIGGER IF EXISTS log_budget_changes_trigger ON budgets","CREATE TRIGGER log_budget_changes_trigger\n    AFTER INSERT OR UPDATE ON budgets\n    FOR EACH ROW\n    EXECUTE FUNCTION log_budget_changes()"}	create_budget_history
20260205000003	{"-- Update function to check expiring subscriptions (both current and future) and notify admins\nCREATE OR REPLACE FUNCTION check_expiring_subscriptions() RETURNS void AS $$\nDECLARE\n  lead_record RECORD;\n  admin_user RECORD;\n  days_until_expiration INT;\n  notification_type TEXT := 'subscription_ending';\n  existing_count INT;\n  message_text TEXT;\n  \n  -- Variables for future subscription\n  future_expiration_date DATE;\n  future_days_until_expiration INT;\nBEGIN\n  -- Loop through active leads with expiration date (current OR future)\n  FOR lead_record IN\n    SELECT \n      l.id, \n      l.customer_id,\n      c.full_name as customer_name,\n      (l.subscription_data->>'expirationDate')::DATE as current_expiration_date,\n      (l.subscription_data->'future_subscription'->>'expirationDate')::DATE as future_expiration_date,\n      (l.subscription_data->>'status')::TEXT as current_status,\n      (l.subscription_data->'future_subscription'->>'status')::TEXT as future_status\n    FROM leads l\n    LEFT JOIN customers c ON l.customer_id = c.id\n    WHERE \n      (l.subscription_data->>'expirationDate' IS NOT NULL AND (l.subscription_data->>'status')::TEXT = 'פעיל')\n      OR \n      (l.subscription_data->'future_subscription'->>'expirationDate' IS NOT NULL AND (l.subscription_data->'future_subscription'->>'status')::TEXT IN ('פעיל', 'ממתין'))\n  LOOP\n    \n    -- 1. Check Current Subscription\n    IF lead_record.current_expiration_date IS NOT NULL AND lead_record.current_status = 'פעיל' THEN\n        days_until_expiration := lead_record.current_expiration_date - CURRENT_DATE;\n        \n        IF days_until_expiration IN (7, 3, 0) THEN\n          IF days_until_expiration = 0 THEN\n            message_text := 'המנוי של ' || COALESCE(lead_record.customer_name, 'לקוח') || ' מסתיים היום (' || TO_CHAR(lead_record.current_expiration_date, 'DD/MM/YYYY') || ')';\n          ELSE\n            message_text := 'המנוי של ' || COALESCE(lead_record.customer_name, 'לקוח') || ' יסתיים בעוד ' || days_until_expiration || ' ימים (' || TO_CHAR(lead_record.current_expiration_date, 'DD/MM/YYYY') || ')';\n          END IF;\n\n          -- Send notification\n          FOR admin_user IN SELECT id FROM profiles WHERE role = 'admin' LOOP\n            SELECT COUNT(*) INTO existing_count\n            FROM notifications\n            WHERE \n              user_id = admin_user.id\n              AND lead_id = lead_record.id \n              AND type = notification_type \n              AND created_at > NOW() - INTERVAL '20 hours'\n              AND message = message_text;\n              \n            IF existing_count = 0 THEN\n              INSERT INTO notifications (\n                user_id, customer_id, lead_id, type, title, message, action_url\n              ) VALUES (\n                admin_user.id, lead_record.customer_id, lead_record.id, notification_type, 'תזכורת סיום מנוי', message_text, '/dashboard/leads/' || lead_record.id\n              );\n            END IF;\n          END LOOP;\n        END IF;\n    END IF;\n\n    -- 2. Check Future Subscription\n    IF lead_record.future_expiration_date IS NOT NULL AND lead_record.future_status IN ('פעיל', 'ממתין') THEN\n        future_days_until_expiration := lead_record.future_expiration_date - CURRENT_DATE;\n        \n        IF future_days_until_expiration IN (7, 3, 0) THEN\n          IF future_days_until_expiration = 0 THEN\n            message_text := 'המנוי העתידי של ' || COALESCE(lead_record.customer_name, 'לקוח') || ' מסתיים היום (' || TO_CHAR(lead_record.future_expiration_date, 'DD/MM/YYYY') || ')';\n          ELSE\n            message_text := 'המנוי העתידי של ' || COALESCE(lead_record.customer_name, 'לקוח') || ' יסתיים בעוד ' || future_days_until_expiration || ' ימים (' || TO_CHAR(lead_record.future_expiration_date, 'DD/MM/YYYY') || ')';\n          END IF;\n\n          -- Send notification\n          FOR admin_user IN SELECT id FROM profiles WHERE role = 'admin' LOOP\n            SELECT COUNT(*) INTO existing_count\n            FROM notifications\n            WHERE \n              user_id = admin_user.id\n              AND lead_id = lead_record.id \n              AND type = notification_type \n              AND created_at > NOW() - INTERVAL '20 hours'\n              AND message = message_text;\n              \n            IF existing_count = 0 THEN\n              INSERT INTO notifications (\n                user_id, customer_id, lead_id, type, title, message, action_url\n              ) VALUES (\n                admin_user.id, lead_record.customer_id, lead_record.id, notification_type, 'תזכורת סיום מנוי עתידי', message_text, '/dashboard/leads/' || lead_record.id\n              );\n            END IF;\n          END LOOP;\n        END IF;\n    END IF;\n\n  END LOOP;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Grant execute permission to authenticated users\nGRANT EXECUTE ON FUNCTION check_expiring_subscriptions() TO authenticated"}	update_check_subscription_expiration
20260205000004	{"-- =====================================================\n-- Create Supplement Templates\n-- Created: 2026-02-05\n-- Description: Reusable supplement templates that can be imported by users\n-- =====================================================\n\n-- =====================================================\n-- TABLE: supplement_templates\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS supplement_templates (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name TEXT NOT NULL,\n    description TEXT,\n    supplements JSONB DEFAULT '[]'::jsonb, -- Array of supplements: [{ name: string, dosage: string, timing: string, link1: string, link2: string }]\n    is_public BOOLEAN NOT NULL DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_supplement_templates_created_by ON supplement_templates(created_by)","CREATE INDEX IF NOT EXISTS idx_supplement_templates_is_public ON supplement_templates(is_public)","CREATE INDEX IF NOT EXISTS idx_supplement_templates_supplements ON supplement_templates USING GIN (supplements)","CREATE INDEX IF NOT EXISTS idx_supplement_templates_created_at ON supplement_templates(created_at DESC)","-- Trigger to auto-update updated_at\nDO $$\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM pg_trigger \n        WHERE tgname = 'update_supplement_templates_updated_at'\n    ) THEN\n        CREATE TRIGGER update_supplement_templates_updated_at\n            BEFORE UPDATE ON supplement_templates\n            FOR EACH ROW\n            EXECUTE FUNCTION update_updated_at_column();\n    END IF;\nEND $$","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on supplement_templates table\nALTER TABLE supplement_templates ENABLE ROW LEVEL SECURITY","-- Drop existing policies if they exist (to avoid conflicts)\nDROP POLICY IF EXISTS \\"Users can view public or own supplement templates\\" ON supplement_templates","DROP POLICY IF EXISTS \\"Users can insert own supplement templates\\" ON supplement_templates","DROP POLICY IF EXISTS \\"Users can update own supplement templates\\" ON supplement_templates","DROP POLICY IF EXISTS \\"Users can delete own supplement templates\\" ON supplement_templates","DROP POLICY IF EXISTS \\"Admins have full access to supplement templates\\" ON supplement_templates","-- Policy: Users can view public templates or their own templates\nCREATE POLICY \\"Users can view public or own supplement templates\\"\n    ON supplement_templates FOR SELECT\n    USING (\n        is_public = TRUE OR \n        created_by = auth.uid()\n    )","-- Policy: Users can insert their own templates\nCREATE POLICY \\"Users can insert own supplement templates\\"\n    ON supplement_templates FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own templates\nCREATE POLICY \\"Users can update own supplement templates\\"\n    ON supplement_templates FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own templates\nCREATE POLICY \\"Users can delete own supplement templates\\"\n    ON supplement_templates FOR DELETE\n    USING (auth.uid() = created_by)","-- Policy: Admins have full access to templates\nCREATE POLICY \\"Admins have full access to supplement templates\\"\n    ON supplement_templates FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- Add supplement_template_id to budgets\n-- =====================================================\n\nDO $$\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_name = 'budgets' \n        AND column_name = 'supplement_template_id'\n    ) THEN\n        ALTER TABLE budgets \n        ADD COLUMN supplement_template_id UUID REFERENCES supplement_templates(id) ON DELETE SET NULL;\n        \n        CREATE INDEX IF NOT EXISTS idx_budgets_supplement_template_id ON budgets(supplement_template_id);\n    END IF;\nEND $$","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE supplement_templates IS 'Reusable supplement templates that can be imported by users to create supplement plans'","COMMENT ON COLUMN supplement_templates.name IS 'Template name'","COMMENT ON COLUMN supplement_templates.description IS 'Template description'","COMMENT ON COLUMN supplement_templates.supplements IS 'JSONB array of supplements: [{ name: string, dosage: string, timing: string, link1: string, link2: string }]'","COMMENT ON COLUMN supplement_templates.is_public IS 'Whether the template is publicly visible to all users'","COMMENT ON COLUMN budgets.supplement_template_id IS 'Reference to the supplement template used in this budget'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_supplement_templates
20260205000006	{"-- =====================================================\n-- Add supplement_templates to saved_views\n-- Created: 2026-02-05\n-- Description: Enable saved views for supplement templates interface\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'supplement_templates'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'exercises', 'nutrition_templates', 'budgets', 'meetings', 'check_in_settings', 'payments', 'collections', 'subscription_types', 'whatsapp_automations', 'supplement_templates'))","-- Insert supplement_templates default view for all users\nINSERT INTO public.saved_views (resource_key, view_name, filter_config, created_by, is_default, display_order)\nSELECT \n    'supplement_templates' as resource_key,\n    'כל התבניות' as view_name,\n    '{}'::jsonb as filter_config,\n    u.id as created_by,\n    true as is_default,\n    1 as display_order\nFROM auth.users u\nWHERE NOT EXISTS (\n    SELECT 1 FROM public.saved_views sv\n    WHERE sv.resource_key = 'supplement_templates' \n    AND sv.created_by = u.id \n    AND sv.is_default = true\n)","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_supplement_templates_to_saved_views
20260206000001	{"-- =====================================================\n-- Fix Budget Update RLS\n-- Created: 2026-02-06\n-- Description: Allow staff to update budgets to ensure history logging works\n-- =====================================================\n\n-- Allow managers and coaches to update budgets\n-- This is necessary for the budget history trigger to fire when they make changes\n\nDO $$\nBEGIN\n    -- Check if the policy already exists to avoid errors\n    IF NOT EXISTS (\n        SELECT 1 FROM pg_policies \n        WHERE tablename = 'budgets' \n        AND policyname = 'Staff can update budgets'\n    ) THEN\n        CREATE POLICY \\"Staff can update budgets\\"\n            ON budgets FOR UPDATE\n            USING (\n                EXISTS (\n                    SELECT 1 FROM profiles\n                    WHERE id = auth.uid() AND role IN ('admin', 'manager', 'coach')\n                )\n            )\n            WITH CHECK (\n                EXISTS (\n                    SELECT 1 FROM profiles\n                    WHERE id = auth.uid() AND role IN ('admin', 'manager', 'coach')\n                )\n            );\n    END IF;\nEND\n$$"}	fix_budget_update_rls
20260206000002	{"-- Fix budget_history foreign key to reference profiles instead of auth.users\n-- This allows PostgREST to join the tables\n\nALTER TABLE budget_history\n  DROP CONSTRAINT IF EXISTS budget_history_changed_by_fkey","ALTER TABLE budget_history\n  ADD CONSTRAINT budget_history_changed_by_fkey\n  FOREIGN KEY (changed_by)\n  REFERENCES public.profiles(id)\n  ON DELETE SET NULL"}	fix_budget_history_fk
20260206000003	{"-- =====================================================\n-- Ensure Budget History Trigger Covers All Fields\n-- Created: 2026-02-06\n-- Description: Re-apply trigger to guarantee all fields including supplement_template_id are logged\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION log_budget_changes()\nRETURNS TRIGGER AS $$\nDECLARE\n    changes_json JSONB;\n    user_id UUID;\nBEGIN\n    user_id := auth.uid();\n    \n    IF (TG_OP = 'UPDATE') THEN\n        -- Only log if there are actual changes to relevant fields\n        -- We ignore updated_at, created_at, created_by, id\n        IF (OLD.name IS DISTINCT FROM NEW.name OR\n            OLD.description IS DISTINCT FROM NEW.description OR\n            OLD.nutrition_template_id IS DISTINCT FROM NEW.nutrition_template_id OR\n            OLD.nutrition_targets IS DISTINCT FROM NEW.nutrition_targets OR\n            OLD.steps_goal IS DISTINCT FROM NEW.steps_goal OR\n            OLD.steps_instructions IS DISTINCT FROM NEW.steps_instructions OR\n            OLD.workout_template_id IS DISTINCT FROM NEW.workout_template_id OR\n            OLD.supplement_template_id IS DISTINCT FROM NEW.supplement_template_id OR\n            OLD.supplements IS DISTINCT FROM NEW.supplements OR\n            OLD.eating_order IS DISTINCT FROM NEW.eating_order OR\n            OLD.eating_rules IS DISTINCT FROM NEW.eating_rules OR\n            OLD.is_public IS DISTINCT FROM NEW.is_public) THEN\n            \n            changes_json := jsonb_build_object(\n                'old', to_jsonb(OLD),\n                'new', to_jsonb(NEW)\n            );\n            \n            INSERT INTO budget_history (budget_id, changed_at, changed_by, change_type, changes, snapshot)\n            VALUES (NEW.id, NOW(), user_id, 'update', changes_json, to_jsonb(NEW));\n        END IF;\n        \n        RETURN NEW;\n    ELSIF (TG_OP = 'INSERT') THEN\n        INSERT INTO budget_history (budget_id, changed_at, changed_by, change_type, changes, snapshot)\n        VALUES (NEW.id, NOW(), user_id, 'create', '{}'::jsonb, to_jsonb(NEW));\n        RETURN NEW;\n    END IF;\n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Ensure trigger exists\nDROP TRIGGER IF EXISTS log_budget_changes_trigger ON budgets","CREATE TRIGGER log_budget_changes_trigger\n    AFTER INSERT OR UPDATE ON budgets\n    FOR EACH ROW\n    EXECUTE FUNCTION log_budget_changes()"}	ensure_budget_history_trigger
20260206000005	{"-- =====================================================\n-- Fix Plans Name and History Migration\n-- Created: 2026-02-06\n-- Description: \n-- 1. Add name column to nutrition_plans and workout_plans\n-- 2. Add lead_id to budget_history\n-- 3. Create triggers to log plan changes to budget_history\n-- =====================================================\n\n-- 1. Add name column to plans\nALTER TABLE nutrition_plans ADD COLUMN IF NOT EXISTS name TEXT","ALTER TABLE workout_plans ADD COLUMN IF NOT EXISTS name TEXT","-- 2. Add lead_id to budget_history\nALTER TABLE budget_history ADD COLUMN IF NOT EXISTS lead_id UUID REFERENCES leads(id) ON DELETE SET NULL","CREATE INDEX IF NOT EXISTS idx_budget_history_lead_id ON budget_history(lead_id)","-- 3. Create logging functions for plans\n\n-- Function to log nutrition plan changes\nCREATE OR REPLACE FUNCTION log_nutrition_plan_changes()\nRETURNS TRIGGER AS $$\nDECLARE\n    changes_json JSONB;\n    user_id UUID;\n    lead_id_val UUID;\n    budget_id_val UUID;\nBEGIN\n    user_id := auth.uid();\n    lead_id_val := COALESCE(NEW.lead_id, OLD.lead_id);\n    budget_id_val := COALESCE(NEW.budget_id, OLD.budget_id);\n    \n    -- Only log if linked to a budget\n    IF budget_id_val IS NULL THEN\n        RETURN NULL;\n    END IF;\n\n    IF (TG_OP = 'UPDATE') THEN\n        -- Check if relevant fields changed\n        IF (OLD.targets IS DISTINCT FROM NEW.targets OR\n            OLD.start_date IS DISTINCT FROM NEW.start_date OR\n            OLD.description IS DISTINCT FROM NEW.description OR\n            OLD.name IS DISTINCT FROM NEW.name OR\n            OLD.is_active IS DISTINCT FROM NEW.is_active) THEN\n            \n            changes_json := jsonb_build_object(\n                'old', to_jsonb(OLD),\n                'new', to_jsonb(NEW),\n                'entity', 'nutrition_plan'\n            );\n            \n            INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n            VALUES (budget_id_val, lead_id_val, NOW(), user_id, 'nutrition_update', changes_json, to_jsonb(NEW));\n        END IF;\n        \n        RETURN NEW;\n    ELSIF (TG_OP = 'INSERT') THEN\n        changes_json := jsonb_build_object(\n            'entity', 'nutrition_plan'\n        );\n        INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n        VALUES (budget_id_val, lead_id_val, NOW(), user_id, 'nutrition_create', changes_json, to_jsonb(NEW));\n        RETURN NEW;\n    END IF;\n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Function to log workout plan changes\nCREATE OR REPLACE FUNCTION log_workout_plan_changes()\nRETURNS TRIGGER AS $$\nDECLARE\n    changes_json JSONB;\n    user_id UUID;\n    lead_id_val UUID;\n    budget_id_val UUID;\nBEGIN\n    user_id := auth.uid();\n    lead_id_val := COALESCE(NEW.lead_id, OLD.lead_id);\n    budget_id_val := COALESCE(NEW.budget_id, OLD.budget_id);\n    \n    -- Only log if linked to a budget\n    IF budget_id_val IS NULL THEN\n        RETURN NULL;\n    END IF;\n\n    IF (TG_OP = 'UPDATE') THEN\n        -- Check if relevant fields changed\n        IF (OLD.start_date IS DISTINCT FROM NEW.start_date OR\n            OLD.description IS DISTINCT FROM NEW.description OR\n            OLD.name IS DISTINCT FROM NEW.name OR\n            OLD.strength IS DISTINCT FROM NEW.strength OR\n            OLD.cardio IS DISTINCT FROM NEW.cardio OR\n            OLD.intervals IS DISTINCT FROM NEW.intervals OR\n            OLD.custom_attributes IS DISTINCT FROM NEW.custom_attributes OR\n            OLD.is_active IS DISTINCT FROM NEW.is_active) THEN\n            \n            changes_json := jsonb_build_object(\n                'old', to_jsonb(OLD),\n                'new', to_jsonb(NEW),\n                'entity', 'workout_plan'\n            );\n            \n            INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n            VALUES (budget_id_val, lead_id_val, NOW(), user_id, 'workout_update', changes_json, to_jsonb(NEW));\n        END IF;\n        \n        RETURN NEW;\n    ELSIF (TG_OP = 'INSERT') THEN\n        changes_json := jsonb_build_object(\n            'entity', 'workout_plan'\n        );\n        INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n        VALUES (budget_id_val, lead_id_val, NOW(), user_id, 'workout_create', changes_json, to_jsonb(NEW));\n        RETURN NEW;\n    END IF;\n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Create triggers\nDROP TRIGGER IF EXISTS log_nutrition_plan_changes_trigger ON nutrition_plans","CREATE TRIGGER log_nutrition_plan_changes_trigger\n    AFTER INSERT OR UPDATE ON nutrition_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION log_nutrition_plan_changes()","DROP TRIGGER IF EXISTS log_workout_plan_changes_trigger ON workout_plans","CREATE TRIGGER log_workout_plan_changes_trigger\n    AFTER INSERT OR UPDATE ON workout_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION log_workout_plan_changes()"}	fix_plans_name_and_history
20260207000000	{"-- =====================================================\n-- Add Second Period to Subscription Types\n-- Created: 2026-02-07\n-- Description: Adds support for bundle subscription types with 2 periods\n--              Stores second period data as JSONB for flexibility\n-- =====================================================\n\nSET search_path TO public","-- Add second_period column to subscription_types table\nALTER TABLE subscription_types \nADD COLUMN IF NOT EXISTS second_period JSONB DEFAULT NULL","-- Add comment for second_period column\nCOMMENT ON COLUMN subscription_types.second_period IS 'Second period data for bundle subscriptions. Contains: duration, duration_unit, price, currency'","-- Create index for second_period queries (if needed for filtering)\nCREATE INDEX IF NOT EXISTS idx_subscription_types_has_second_period \nON subscription_types((second_period IS NOT NULL)) \nWHERE second_period IS NOT NULL","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_second_period_to_subscription_types
20260208000000	{"-- =====================================================\n-- Add Cardio and Interval Training to Budgets\n-- Created: 2026-02-08\n-- Description: Add JSONB columns for cardio_training and interval_training to budgets table\n-- =====================================================\n\n-- Add cardio_training column\nALTER TABLE budgets \nADD COLUMN IF NOT EXISTS cardio_training JSONB DEFAULT NULL","-- Add interval_training column\nALTER TABLE budgets \nADD COLUMN IF NOT EXISTS interval_training JSONB DEFAULT NULL","-- Add GIN indexes for JSONB columns for better query performance\nCREATE INDEX IF NOT EXISTS idx_budgets_cardio_training ON budgets USING GIN (cardio_training)","CREATE INDEX IF NOT EXISTS idx_budgets_interval_training ON budgets USING GIN (interval_training)","-- Add comments\nCOMMENT ON COLUMN budgets.cardio_training IS 'JSONB array of cardio training workouts: [{ id?: string, name: string, type: string, duration_minutes: number, workouts_per_week: number, notes: string }]'","COMMENT ON COLUMN budgets.interval_training IS 'JSONB array of interval training workouts: [{ id?: string, name: string, type: string, duration_minutes: number, workouts_per_week: number, notes: string }]'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_cardio_interval_training_to_budgets
20260209000000	{"-- =====================================================\n-- Saved Action Plans Migration\n-- Created: 2026-02-09\n-- Description: Store snapshots of action plans (budgets) for viewing historical versions\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS saved_action_plans (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL,\n    \n    -- Snapshot data - stores complete copy of the action plan at time of save\n    name TEXT NOT NULL,\n    description TEXT,\n    saved_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Full snapshot of all budget data\n    snapshot JSONB NOT NULL DEFAULT '{}'::jsonb,\n    -- Structure includes:\n    -- - nutrition_template_id, nutrition_targets\n    -- - workout_template_id, workout_template (full data)\n    -- - supplements\n    -- - cardio_training\n    -- - interval_training\n    -- - steps_goal, steps_instructions\n    -- - eating_order, eating_rules\n    -- - nutrition_template (full data if linked)\n    \n    -- Optional metadata\n    notes TEXT -- User notes about this saved version\n)","-- Indexes\nCREATE INDEX IF NOT EXISTS idx_saved_action_plans_user_id ON saved_action_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_saved_action_plans_budget_id ON saved_action_plans(budget_id)","CREATE INDEX IF NOT EXISTS idx_saved_action_plans_saved_at ON saved_action_plans(saved_at DESC)","-- Enable RLS\nALTER TABLE saved_action_plans ENABLE ROW LEVEL SECURITY","-- Policies\n\n-- Users can view their own saved action plans\nCREATE POLICY \\"Users can view own saved action plans\\"\n    ON saved_action_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Users can insert their own saved action plans\nCREATE POLICY \\"Users can insert own saved action plans\\"\n    ON saved_action_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Users can update their own saved action plans\nCREATE POLICY \\"Users can update own saved action plans\\"\n    ON saved_action_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Users can delete their own saved action plans\nCREATE POLICY \\"Users can delete own saved action plans\\"\n    ON saved_action_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Admins have full access\nCREATE POLICY \\"Admins have full access to saved action plans\\"\n    ON saved_action_plans\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role IN ('admin', 'user')\n        )\n    )","-- Comments\nCOMMENT ON TABLE saved_action_plans IS 'Saved snapshots of action plans (budgets) for historical viewing'","COMMENT ON COLUMN saved_action_plans.snapshot IS 'Complete snapshot of budget data including all templates and related data'","COMMENT ON COLUMN saved_action_plans.budget_id IS 'Reference to the original budget (may be null if budget was deleted)'"}	create_saved_action_plans
20260210000000	{"-- =====================================================\n-- Add lead_id to saved_action_plans Migration\n-- Created: 2026-02-10\n-- Description: Add lead_id column to saved_action_plans to scope saved plans per lead\n-- =====================================================\n\n-- Add lead_id column to saved_action_plans\nALTER TABLE saved_action_plans \n  ADD COLUMN IF NOT EXISTS lead_id UUID REFERENCES leads(id) ON DELETE CASCADE","-- Create index for lead_id\nCREATE INDEX IF NOT EXISTS idx_saved_action_plans_lead_id ON saved_action_plans(lead_id)","-- Update RLS policies to allow filtering by lead_id\n-- The existing policies already check user_id, so we keep them\n-- Users can still view their own saved action plans, but now filtered by lead_id when provided\n\n-- Comments\nCOMMENT ON COLUMN saved_action_plans.lead_id IS 'Reference to the lead this action plan belongs to. Each lead has its own saved action plans.'"}	add_lead_id_to_saved_action_plans
20260211000000	{"-- =====================================================\n-- Update Budgets View Name Migration\n-- Created: 2026-02-11\n-- Description: Update saved view names from \\"כל התקציבים\\" to \\"כל תכניות הפעולה\\" for budgets resource\n-- =====================================================\n\n-- Update all saved views for budgets resource that have the old name\nUPDATE saved_views\nSET view_name = 'כל תכניות הפעולה'\nWHERE resource_key = 'budgets'\n  AND view_name = 'כל התקציבים'","-- Comments\nCOMMENT ON TABLE saved_views IS 'User-defined saved views/filters for different resources. Updated budget view names from \\"כל התקציבים\\" to \\"כל תכניות הפעולה\\".'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	update_budgets_view_name
20260212000000	{"-- Migration: Add Automation Info to WhatsApp Flow Templates\n-- Description: Adds name and status fields to store ALL automation information and text in the database\n-- Created: 2026-02-12\n-- This migration ensures ALL automation data and text is stored in DB:\n--   - flow_key (unique identifier)\n--   - name (Hebrew description/label)\n--   - status (configuration status)\n--   - template_content (full message text with HTML formatting)\n--   - buttons (JSONB with all button text, actions, and action configs including reply messages, URLs, etc.)\n--   - media (JSONB with media type and URL)\n\n-- Add name column to store the Hebrew description/label of the automation\n-- This is the editable name shown in the automation list (e.g., \\"תחילת מסע לקוח ותיאום פגישה\\")\nALTER TABLE public.whatsapp_flow_templates\nADD COLUMN IF NOT EXISTS name TEXT","-- Add status column to track automation configuration status (e.g., 'מוגדר', 'לא מוגדר')\nALTER TABLE public.whatsapp_flow_templates\nADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'לא מוגדר'","-- Add description column for additional descriptive text about the automation\nALTER TABLE public.whatsapp_flow_templates\nADD COLUMN IF NOT EXISTS description TEXT","-- Ensure template_content column can store rich text (HTML) - it's already TEXT, but add comment\n-- This stores ALL the message text including HTML formatting, placeholders, and any text content\nCOMMENT ON COLUMN public.whatsapp_flow_templates.template_content IS 'Full message template text with HTML formatting from rich text editor. Contains ALL text content including placeholders like {{name}}, {{phone}}, {{email}}, {{password}}, {{login_url}}, {{city}}, {{gender}}, {{payment_link}}, {{status}}, {{lead_id}}, etc. This is the complete message that will be sent.'","-- Ensure buttons JSONB column stores ALL button text and configurations\n-- Buttons structure: [{\\"id\\": \\"string\\", \\"text\\": \\"button text\\", \\"action\\": \\"reply|flow|url|none\\", \\"actionConfig\\": {\\"replyMessage\\": \\"...\\", \\"url\\": \\"...\\", \\"flowKey\\": \\"...\\"}}]\n-- This stores ALL button-related text: button labels, reply messages, URLs, flow keys, etc.\nCOMMENT ON COLUMN public.whatsapp_flow_templates.buttons IS 'Array of interactive buttons storing ALL button text: [{\\"id\\": \\"string\\", \\"text\\": \\"button label text (up to 25 chars)\\", \\"action\\": \\"reply|flow|url|none\\", \\"actionConfig\\": {\\"replyMessage\\": \\"auto reply message text\\", \\"url\\": \\"https://...\\", \\"flowKey\\": \\"...\\"}}]. Stores ALL button-related text including button labels, reply messages, URLs, flow keys, and any other button configuration text.'","-- Add comments for all text fields to document that ALL text is stored\nCOMMENT ON COLUMN public.whatsapp_flow_templates.name IS 'Hebrew name/description of the automation (e.g., \\"תחילת מסע לקוח ותיאום פגישה\\"). This is the editable label shown in the automation list. Stores the display name of the automation.'","COMMENT ON COLUMN public.whatsapp_flow_templates.description IS 'Optional additional descriptive text about the automation. Can contain any explanatory text about what the automation does.'","COMMENT ON COLUMN public.whatsapp_flow_templates.status IS 'Status of automation configuration (e.g., \\"מוגדר\\" for configured, \\"לא מוגדר\\" for not configured, \\"מושעה\\" for suspended).'","COMMENT ON COLUMN public.whatsapp_flow_templates.flow_key IS 'Unique identifier for the automation flow (e.g., customer_journey_start, intro_questionnaire, budget, payment_request, trainee_user_credentials, weekly_review).'","COMMENT ON COLUMN public.whatsapp_flow_templates.media IS 'Media attachment information stored as JSONB: {\\"type\\": \\"image|video|gif\\", \\"url\\": \\"...\\"}. Stores media-related text/URLs if applicable.'","-- Summary comment on the table to document that ALL automation text is stored\nCOMMENT ON TABLE public.whatsapp_flow_templates IS 'Stores ALL automation information and ALL text content: flow_key (identifier), name (display name), description (optional description), status (configuration status), template_content (full message text with HTML), buttons (all button text and configs), media (media URLs). Every piece of text in the automation is persisted in this table.'","-- Create index for faster lookups by status\nCREATE INDEX IF NOT EXISTS idx_whatsapp_flow_templates_status \nON public.whatsapp_flow_templates(user_id, status)","-- Create index for faster lookups by name\nCREATE INDEX IF NOT EXISTS idx_whatsapp_flow_templates_name \nON public.whatsapp_flow_templates(user_id, name)","-- Update existing templates to set status based on whether they have content\n-- If template_content is not empty, set status to 'מוגדר', otherwise 'לא מוגדר'\nUPDATE public.whatsapp_flow_templates\nSET status = CASE \n  WHEN template_content IS NOT NULL AND TRIM(template_content) != '' THEN 'מוגדר'\n  ELSE 'לא מוגדר'\nEND\nWHERE status IS NULL OR status = 'לא מוגדר'","-- Set default names for known flow keys if they don't have names yet\n-- This seeds the database with default automation names\nUPDATE public.whatsapp_flow_templates\nSET name = CASE flow_key\n  WHEN 'customer_journey_start' THEN 'תחילת מסע לקוח ותיאום פגישה'\n  WHEN 'intro_questionnaire' THEN 'אוטומטי שליחת שאלון הכרות לאחר קביעת שיחה'\n  WHEN 'budget' THEN 'שליחת תכנית פעולה'\n  WHEN 'payment_request' THEN 'בקשת תשלום'\n  WHEN 'trainee_user_credentials' THEN 'שליחת פרטי משתמש'\n  WHEN 'weekly_review' THEN 'סיכום שבועי ויעדים'\n  ELSE name\nEND\nWHERE name IS NULL OR name = ''","-- Add constraint to ensure status is one of the valid values\nDO $$\nBEGIN\n    -- Drop constraint if it exists (in case of re-running migration)\n    IF EXISTS (\n        SELECT 1 FROM pg_constraint \n        WHERE conname = 'check_whatsapp_template_status' \n        AND conrelid = 'public.whatsapp_flow_templates'::regclass\n    ) THEN\n        ALTER TABLE public.whatsapp_flow_templates DROP CONSTRAINT check_whatsapp_template_status;\n    END IF;\n    \n    -- Add the constraint\n    ALTER TABLE public.whatsapp_flow_templates\n    ADD CONSTRAINT check_whatsapp_template_status \n    CHECK (status IN ('מוגדר', 'לא מוגדר', 'מושעה'));\nEXCEPTION\n    WHEN others THEN\n        -- If constraint creation fails, log but don't fail the migration\n        RAISE NOTICE 'Could not add check_whatsapp_template_status constraint: %', SQLERRM;\nEND $$","-- Create a function to automatically update status when template_content changes\nCREATE OR REPLACE FUNCTION update_whatsapp_template_status()\nRETURNS TRIGGER AS $$\nBEGIN\n  -- Update status based on template_content\n  IF NEW.template_content IS NOT NULL AND TRIM(NEW.template_content) != '' THEN\n    NEW.status = 'מוגדר';\n  ELSE\n    NEW.status = 'לא מוגדר';\n  END IF;\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger to automatically update status when template_content is updated\nDROP TRIGGER IF EXISTS trigger_update_whatsapp_template_status ON public.whatsapp_flow_templates","CREATE TRIGGER trigger_update_whatsapp_template_status\n  BEFORE INSERT OR UPDATE OF template_content ON public.whatsapp_flow_templates\n  FOR EACH ROW\n  EXECUTE FUNCTION update_whatsapp_template_status()","-- Add updated_at trigger if it doesn't exist (for consistency)\n-- This ensures updated_at is always updated when any field changes\nCREATE OR REPLACE FUNCTION update_whatsapp_flow_templates_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Ensure the trigger exists\nDROP TRIGGER IF EXISTS update_whatsapp_flow_templates_updated_at ON public.whatsapp_flow_templates","CREATE TRIGGER update_whatsapp_flow_templates_updated_at\n  BEFORE UPDATE ON public.whatsapp_flow_templates\n  FOR EACH ROW\n  EXECUTE FUNCTION update_whatsapp_flow_templates_updated_at()"}	add_automation_info_to_whatsapp_templates
20260213000000	{"-- Migration: Fix Numeric Field Overflow in daily_check_ins\n-- Created: 2026-02-13\n-- Description: Changes INTEGER fields to BIGINT and increases NUMERIC precision\n--              to prevent overflow errors when entering large numbers\n\nSET search_path TO public","-- Change INTEGER fields to BIGINT to support larger values\n-- This prevents overflow for fields like steps (can be 50,000+), \n-- circumference values, calories, protein, etc.\n\n-- Update steps_actual if it exists (it was created in the original table as INTEGER)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_schema = 'public'\n    AND table_name = 'daily_check_ins' \n    AND column_name = 'steps_actual'\n    AND data_type = 'integer'\n  ) THEN\n    ALTER TABLE daily_check_ins\n      ALTER COLUMN steps_actual TYPE BIGINT;\n  END IF;\nEND $$","-- Update all INTEGER fields that were added in expand_daily_check_ins migration\n-- Use DO block to safely alter columns only if they exist\nDO $$\nBEGIN\n  -- Change INTEGER fields to BIGINT\n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'belly_circumference' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN belly_circumference TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'waist_circumference' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN waist_circumference TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'thigh_circumference' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN thigh_circumference TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'arm_circumference' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN arm_circumference TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'neck_circumference' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN neck_circumference TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'exercises_count' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN exercises_count TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'cardio_amount' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN cardio_amount TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'intervals_count' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN intervals_count TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'calories_daily' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN calories_daily TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'protein_daily' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN protein_daily TYPE BIGINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'fiber_daily' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN fiber_daily TYPE BIGINT;\n  END IF;\n  \n  -- Increase NUMERIC precision for weight (allow up to 9999.99 kg for edge cases)\n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'weight') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN weight TYPE NUMERIC(10,2);\n  END IF;\n  \n  -- Increase NUMERIC precision for water_amount (allow up to 9999.99 liters)\n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'water_amount') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN water_amount TYPE NUMERIC(10,2);\n  END IF;\n  \n  -- Increase NUMERIC precision for sleep_hours (allow up to 999.99 hours for edge cases)\n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'sleep_hours') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN sleep_hours TYPE NUMERIC(6,2);\n  END IF;\n  \n  -- Keep stress_level, hunger_level, and energy_level as SMALLINT for efficiency\n  -- (range -32,768 to 32,767, more than enough for 1-10)\n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'stress_level' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN stress_level TYPE SMALLINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'hunger_level' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN hunger_level TYPE SMALLINT;\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'daily_check_ins' AND column_name = 'energy_level' AND data_type = 'integer') THEN\n    ALTER TABLE daily_check_ins ALTER COLUMN energy_level TYPE SMALLINT;\n  END IF;\nEND $$","-- Update comments to reflect the changes\nCOMMENT ON COLUMN daily_check_ins.weight IS 'Weight measurement in kg (משקל). Supports up to 9999.99 kg'","COMMENT ON COLUMN daily_check_ins.belly_circumference IS 'Belly circumference in cm (היקף בטן). Supports large values'","COMMENT ON COLUMN daily_check_ins.waist_circumference IS 'Waist circumference in cm (היקף מותן). Supports large values'","COMMENT ON COLUMN daily_check_ins.thigh_circumference IS 'Thigh circumference in cm (היקף ירכיים). Supports large values'","COMMENT ON COLUMN daily_check_ins.arm_circumference IS 'Arm circumference in cm (היקף יד). Supports large values'","COMMENT ON COLUMN daily_check_ins.neck_circumference IS 'Neck circumference in cm (היקף צוואר). Supports large values'","COMMENT ON COLUMN daily_check_ins.exercises_count IS 'Number of exercises completed (כמה תרגילים עשית). Supports large values'","COMMENT ON COLUMN daily_check_ins.cardio_amount IS 'Cardio duration in minutes (כמה אירובי עשית). Supports large values'","COMMENT ON COLUMN daily_check_ins.intervals_count IS 'Number of interval training sessions (כמה אינטרוולים). Supports large values'","COMMENT ON COLUMN daily_check_ins.calories_daily IS 'Daily calorie intake (קלוריות יומי). Supports large values'","COMMENT ON COLUMN daily_check_ins.protein_daily IS 'Daily protein intake in grams (חלבון יומי). Supports large values'","COMMENT ON COLUMN daily_check_ins.fiber_daily IS 'Daily fiber intake in grams (סיבים יומי). Supports large values'","COMMENT ON COLUMN daily_check_ins.water_amount IS 'Water consumed in liters (כמה מים שתית). Supports up to 9999.99 liters'","COMMENT ON COLUMN daily_check_ins.sleep_hours IS 'Hours of sleep (כמה שעות ישנת). Supports up to 999.99 hours'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_daily_check_ins_numeric_overflow
20260214000000	{"-- Migration: Update Budget Automation Message\n-- Description: Updates the budget WhatsApp automation message to the new simplified format\n-- Created: 2026-02-14\n-- This migration must be the LAST one in the list for migration up to work correctly\n\n-- Update all existing budget automation templates to use the new message format\n-- Old format: \\"שלום אנדרי שצוקין, התקציב שלך מוכן! 📋 שם התקציב: {{budget_name}} לצפייה בתקציב המלא: {{budget_link}} בברכה, צוות DietNeta\\"\n-- New format: \\"שלום אנדרי שצוקין, התקציב שלך מוכן בפורטל! 📋 בברכה, צוות DietNeta\\"\n-- This updates all budget templates that contain the old format with budget_name and budget_link placeholders\nUPDATE public.whatsapp_flow_templates\nSET \n  template_content = 'שלום אנדרי שצוקין, התקציב שלך מוכן בפורטל! 📋 בברכה, צוות DietNeta',\n  updated_at = NOW()\nWHERE \n  flow_key = 'budget'\n  AND (\n    template_content LIKE '%{{budget_name}}%'\n    OR template_content LIKE '%{{budget_link}}%'\n    OR template_content LIKE '%שם התקציב:%'\n    OR template_content LIKE '%לצפייה בתקציב המלא:%'\n  )","-- Add comment\nCOMMENT ON COLUMN public.whatsapp_flow_templates.template_content IS 'Full message template text with HTML formatting from rich text editor. Contains ALL text content including placeholders like {{name}}, {{phone}}, {{email}}, {{password}}, {{login_url}}, {{city}}, {{gender}}, {{payment_link}}, {{status}}, {{lead_id}}, etc. This is the complete message that will be sent.'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	update_budget_automation_message
20260215000000	{"-- =====================================================\n-- Fix Budget History to Log All Fields\n-- Created: 2026-02-15\n-- Description: \n-- 1. Update log_budget_changes() to include ALL budget fields including cardio_training and interval_training\n-- 2. Ensure lead_id is properly set when logging budget changes\n-- 3. Make sure every field change in the action plan is logged\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION log_budget_changes()\nRETURNS TRIGGER AS $$\nDECLARE\n    changes_json JSONB;\n    user_id UUID;\n    lead_id_val UUID;\nBEGIN\n    user_id := auth.uid();\n    \n    -- Get lead_id from the most recent active budget assignment\n    -- This ensures we track which lead's action plan was changed\n    SELECT lead_id INTO lead_id_val\n    FROM budget_assignments\n    WHERE budget_id = NEW.id\n      AND is_active = TRUE\n    ORDER BY assigned_at DESC\n    LIMIT 1;\n    \n    IF (TG_OP = 'UPDATE') THEN\n        -- Check ALL fields that can be changed in an action plan\n        -- We ignore: updated_at, created_at, created_by, id\n        IF (OLD.name IS DISTINCT FROM NEW.name OR\n            OLD.description IS DISTINCT FROM NEW.description OR\n            OLD.nutrition_template_id IS DISTINCT FROM NEW.nutrition_template_id OR\n            OLD.nutrition_targets IS DISTINCT FROM NEW.nutrition_targets OR\n            OLD.steps_goal IS DISTINCT FROM NEW.steps_goal OR\n            OLD.steps_instructions IS DISTINCT FROM NEW.steps_instructions OR\n            OLD.workout_template_id IS DISTINCT FROM NEW.workout_template_id OR\n            OLD.supplement_template_id IS DISTINCT FROM NEW.supplement_template_id OR\n            OLD.supplements IS DISTINCT FROM NEW.supplements OR\n            OLD.eating_order IS DISTINCT FROM NEW.eating_order OR\n            OLD.eating_rules IS DISTINCT FROM NEW.eating_rules OR\n            OLD.cardio_training IS DISTINCT FROM NEW.cardio_training OR\n            OLD.interval_training IS DISTINCT FROM NEW.interval_training OR\n            OLD.is_public IS DISTINCT FROM NEW.is_public) THEN\n            \n            changes_json := jsonb_build_object(\n                'old', to_jsonb(OLD),\n                'new', to_jsonb(NEW)\n            );\n            \n            INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n            VALUES (NEW.id, lead_id_val, NOW(), user_id, 'update', changes_json, to_jsonb(NEW));\n        END IF;\n        \n        RETURN NEW;\n    ELSIF (TG_OP = 'INSERT') THEN\n        -- For new budgets, try to get lead_id if it exists\n        -- (though typically new budgets won't have assignments yet)\n        INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n        VALUES (NEW.id, lead_id_val, NOW(), user_id, 'create', '{}'::jsonb, to_jsonb(NEW));\n        RETURN NEW;\n    END IF;\n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Ensure trigger exists and is active\nDROP TRIGGER IF EXISTS log_budget_changes_trigger ON budgets","CREATE TRIGGER log_budget_changes_trigger\n    AFTER INSERT OR UPDATE ON budgets\n    FOR EACH ROW\n    EXECUTE FUNCTION log_budget_changes()","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_budget_history_log_all_fields
20260227000000	{"-- =====================================================\n-- Fix Budget History Logging - Ensure All Fields Are Logged\n-- Created: 2026-02-27\n-- Description: \n-- 1. Recreate log_budget_changes() function to ensure ALL budget fields are tracked\n-- 2. Ensure trigger is properly set up and firing\n-- 3. Make sure lead_id is captured correctly\n-- 4. Log ALL changes including: name, description, nutrition, workouts, steps, supplements, cardio, intervals, eating rules\n-- =====================================================\n\n-- Drop and recreate the function to ensure it's up to date\nDROP FUNCTION IF EXISTS log_budget_changes() CASCADE","CREATE OR REPLACE FUNCTION log_budget_changes()\nRETURNS TRIGGER AS $$\nDECLARE\n    changes_json JSONB;\n    user_id UUID;\n    lead_id_val UUID;\nBEGIN\n    -- Get current user ID\n    user_id := auth.uid();\n    \n    -- Get lead_id from the most recent active budget assignment\n    -- This ensures we track which lead's action plan was changed\n    SELECT lead_id INTO lead_id_val\n    FROM budget_assignments\n    WHERE budget_id = NEW.id\n      AND is_active = TRUE\n    ORDER BY assigned_at DESC\n    LIMIT 1;\n    \n    IF (TG_OP = 'UPDATE') THEN\n        -- Check ALL fields that can be changed in an action plan\n        -- We ignore: updated_at, created_at, created_by, id\n        -- We check EVERY field that can be modified in the action plan\n        IF (OLD.name IS DISTINCT FROM NEW.name OR\n            OLD.description IS DISTINCT FROM NEW.description OR\n            OLD.nutrition_template_id IS DISTINCT FROM NEW.nutrition_template_id OR\n            OLD.nutrition_targets IS DISTINCT FROM NEW.nutrition_targets OR\n            OLD.steps_goal IS DISTINCT FROM NEW.steps_goal OR\n            OLD.steps_instructions IS DISTINCT FROM NEW.steps_instructions OR\n            OLD.workout_template_id IS DISTINCT FROM NEW.workout_template_id OR\n            OLD.supplement_template_id IS DISTINCT FROM NEW.supplement_template_id OR\n            OLD.supplements IS DISTINCT FROM NEW.supplements OR\n            OLD.eating_order IS DISTINCT FROM NEW.eating_order OR\n            OLD.eating_rules IS DISTINCT FROM NEW.eating_rules OR\n            OLD.cardio_training IS DISTINCT FROM NEW.cardio_training OR\n            OLD.interval_training IS DISTINCT FROM NEW.interval_training OR\n            OLD.is_public IS DISTINCT FROM NEW.is_public) THEN\n            \n            -- Build changes object with old and new values\n            changes_json := jsonb_build_object(\n                'old', to_jsonb(OLD),\n                'new', to_jsonb(NEW)\n            );\n            \n            -- Insert into budget_history\n            INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n            VALUES (NEW.id, lead_id_val, NOW(), user_id, 'update', changes_json, to_jsonb(NEW));\n        END IF;\n        \n        RETURN NEW;\n    ELSIF (TG_OP = 'INSERT') THEN\n        -- For new budgets, try to get lead_id if it exists\n        -- (though typically new budgets won't have assignments yet)\n        INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n        VALUES (NEW.id, lead_id_val, NOW(), user_id, 'create', '{}'::jsonb, to_jsonb(NEW));\n        RETURN NEW;\n    END IF;\n    \n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Drop existing trigger if it exists\nDROP TRIGGER IF EXISTS log_budget_changes_trigger ON budgets","-- Create the trigger\nCREATE TRIGGER log_budget_changes_trigger\n    AFTER INSERT OR UPDATE ON budgets\n    FOR EACH ROW\n    EXECUTE FUNCTION log_budget_changes()","-- Grant necessary permissions\nGRANT EXECUTE ON FUNCTION log_budget_changes() TO authenticated","GRANT EXECUTE ON FUNCTION log_budget_changes() TO service_role","-- Ensure RLS allows the trigger function to insert\n-- The function uses SECURITY DEFINER, but we need to make sure it can insert\n-- Drop existing INSERT policy if it exists and create a new one\nDROP POLICY IF EXISTS \\"Allow trigger to insert budget history\\" ON budget_history","CREATE POLICY \\"Allow trigger to insert budget history\\"\n    ON budget_history FOR INSERT\n    WITH CHECK (true)","-- Allow all inserts (the function will handle security)\n\n-- Also ensure the function owner can insert\nALTER FUNCTION log_budget_changes() OWNER TO postgres","-- =====================================================\n-- Verify trigger exists\n-- =====================================================\nDO $$\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM pg_trigger \n        WHERE tgname = 'log_budget_changes_trigger' \n        AND tgrelid = 'budgets'::regclass\n    ) THEN\n        RAISE EXCEPTION 'Trigger log_budget_changes_trigger was not created successfully';\n    END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_budget_history_logging_all_fields
20260228000000	{"-- =====================================================\n-- Add Supplement and Steps Plan History Triggers\n-- Created: 2026-02-28\n-- Description: Log supplement_plans and steps_plans changes to budget_history\n--              (same pattern as nutrition_plans and workout_plans) so all plan\n--              changes appear in the budget history list.\n-- =====================================================\n\n-- Function to log supplement plan changes\nCREATE OR REPLACE FUNCTION log_supplement_plan_changes()\nRETURNS TRIGGER AS $$\nDECLARE\n    changes_json JSONB;\n    user_id UUID;\n    lead_id_val UUID;\n    budget_id_val UUID;\nBEGIN\n    user_id := auth.uid();\n    lead_id_val := COALESCE(NEW.lead_id, OLD.lead_id);\n    budget_id_val := COALESCE(NEW.budget_id, OLD.budget_id);\n\n    -- Only log if linked to a budget\n    IF budget_id_val IS NULL THEN\n        RETURN NULL;\n    END IF;\n\n    IF (TG_OP = 'UPDATE') THEN\n        -- Check if relevant fields changed\n        IF (OLD.start_date IS DISTINCT FROM NEW.start_date OR\n            OLD.end_date IS DISTINCT FROM NEW.end_date OR\n            OLD.description IS DISTINCT FROM NEW.description OR\n            OLD.supplements IS DISTINCT FROM NEW.supplements OR\n            OLD.is_active IS DISTINCT FROM NEW.is_active) THEN\n\n            changes_json := jsonb_build_object(\n                'old', to_jsonb(OLD),\n                'new', to_jsonb(NEW),\n                'entity', 'supplement_plan'\n            );\n\n            INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n            VALUES (budget_id_val, lead_id_val, NOW(), user_id, 'supplement_update', changes_json, to_jsonb(NEW));\n        END IF;\n\n        RETURN NEW;\n    ELSIF (TG_OP = 'INSERT') THEN\n        changes_json := jsonb_build_object(\n            'entity', 'supplement_plan'\n        );\n        INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n        VALUES (budget_id_val, lead_id_val, NOW(), user_id, 'supplement_create', changes_json, to_jsonb(NEW));\n        RETURN NEW;\n    END IF;\n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Function to log steps plan changes\nCREATE OR REPLACE FUNCTION log_steps_plan_changes()\nRETURNS TRIGGER AS $$\nDECLARE\n    changes_json JSONB;\n    user_id UUID;\n    lead_id_val UUID;\n    budget_id_val UUID;\nBEGIN\n    user_id := auth.uid();\n    lead_id_val := COALESCE(NEW.lead_id, OLD.lead_id);\n    budget_id_val := COALESCE(NEW.budget_id, OLD.budget_id);\n\n    -- Only log if linked to a budget\n    IF budget_id_val IS NULL THEN\n        RETURN NULL;\n    END IF;\n\n    IF (TG_OP = 'UPDATE') THEN\n        -- Check if relevant fields changed\n        IF (OLD.start_date IS DISTINCT FROM NEW.start_date OR\n            OLD.end_date IS DISTINCT FROM NEW.end_date OR\n            OLD.description IS DISTINCT FROM NEW.description OR\n            OLD.steps_goal IS DISTINCT FROM NEW.steps_goal OR\n            OLD.steps_instructions IS DISTINCT FROM NEW.steps_instructions OR\n            OLD.is_active IS DISTINCT FROM NEW.is_active) THEN\n\n            changes_json := jsonb_build_object(\n                'old', to_jsonb(OLD),\n                'new', to_jsonb(NEW),\n                'entity', 'steps_plan'\n            );\n\n            INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n            VALUES (budget_id_val, lead_id_val, NOW(), user_id, 'steps_update', changes_json, to_jsonb(NEW));\n        END IF;\n\n        RETURN NEW;\n    ELSIF (TG_OP = 'INSERT') THEN\n        changes_json := jsonb_build_object(\n            'entity', 'steps_plan'\n        );\n        INSERT INTO budget_history (budget_id, lead_id, changed_at, changed_by, change_type, changes, snapshot)\n        VALUES (budget_id_val, lead_id_val, NOW(), user_id, 'steps_create', changes_json, to_jsonb(NEW));\n        RETURN NEW;\n    END IF;\n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Triggers on supplement_plans\nDROP TRIGGER IF EXISTS log_supplement_plan_changes_trigger ON supplement_plans","CREATE TRIGGER log_supplement_plan_changes_trigger\n    AFTER INSERT OR UPDATE ON supplement_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION log_supplement_plan_changes()","-- Triggers on steps_plans\nDROP TRIGGER IF EXISTS log_steps_plan_changes_trigger ON steps_plans","CREATE TRIGGER log_steps_plan_changes_trigger\n    AFTER INSERT OR UPDATE ON steps_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION log_steps_plan_changes()"}	add_supplement_and_steps_plan_history_triggers
20260228000002	{"-- =====================================================\n-- Comprehensive Fix for Storage RLS Policies (All Client Assets)\n-- Created: 2026-01-28\n-- Description: Updates RLS policies for ALL folders in client-assets bucket\n--              to allow managers/admins to upload and manage files.\n--              This migration is added to the end of the list to ensure it works.\n-- =====================================================\n\n-- Only update policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Drop ALL fragmented manager policies to avoid conflicts and ensure clean state\n    DROP POLICY IF EXISTS \\"Managers can upload progress photos\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view all progress photos\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete progress photos\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can upload client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view all client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete all client files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can upload blood tests\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view all blood tests\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete all blood tests\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can upload workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can upload template files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view template files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete template files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can upload all client assets\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view all client assets\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can update all client assets\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete all client assets\\" ON storage.objects;\n\n    -- 1. COMPREHENSIVE MANAGER INSERT POLICY\n    -- Allows managers/admins to upload to ANY folder in client-assets\n    CREATE POLICY \\"Managers can upload all client assets\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      EXISTS (\n        SELECT 1 FROM public.profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- 2. COMPREHENSIVE MANAGER SELECT POLICY\n    -- Allows managers/admins to view ALL files in client-assets\n    CREATE POLICY \\"Managers can view all client assets\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      EXISTS (\n        SELECT 1 FROM public.profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- 3. COMPREHENSIVE MANAGER UPDATE POLICY\n    -- Allows managers/admins to update ALL files in client-assets\n    CREATE POLICY \\"Managers can update all client assets\\"\n    ON storage.objects\n    FOR UPDATE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      EXISTS (\n        SELECT 1 FROM public.profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- 4. COMPREHENSIVE MANAGER DELETE POLICY\n    -- Allows managers/admins to delete ALL files in client-assets\n    CREATE POLICY \\"Managers can delete all client assets\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      EXISTS (\n        SELECT 1 FROM public.profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    RAISE NOTICE 'Comprehensive Storage RLS policies for managers updated successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy update.';\n  END IF;\nEND $$"}	comprehensive_storage_rls_fix
\.


--
-- Name: refresh_tokens_id_seq; Type: SEQUENCE SET; Schema: auth; Owner: supabase_auth_admin
--

SELECT pg_catalog.setval('"auth"."refresh_tokens_id_seq"', 255, true);


--
-- PostgreSQL database dump complete
--

-- \unrestrict rtDnOtghYQfEwRXYa7OMtUJuJBRzfJuV82Gh3JqOM3BLqPYb0lvbhYisdo9xrK4

RESET ALL;
