SET session_replication_role = replica;

--
-- PostgreSQL database dump
--

-- \restrict H9HfRx4cfeQVKtBgpiwsVV8dPP3Gh8IFErKB8sSD9y2KOzCK9aTPR0cDJgah1iK

-- Dumped from database version 17.6
-- Dumped by pg_dump version 17.6

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Data for Name: audit_log_entries; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."audit_log_entries" ("instance_id", "id", "payload", "created_at", "ip_address") FROM stdin;
00000000-0000-0000-0000-000000000000	fc81d2d7-1296-4c7a-af82-8daf34709e85	{"action":"login","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2026-01-14 17:10:30.098695+00	
00000000-0000-0000-0000-000000000000	28a8745e-3a3d-4433-8b63-f370c6e7dd60	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-14 18:08:52.403477+00	
00000000-0000-0000-0000-000000000000	6ba7a9df-bd43-4be8-a8e7-e66bc7bf736d	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-14 18:08:52.405021+00	
00000000-0000-0000-0000-000000000000	464b965f-593e-41ab-9b06-bbe01a139cb1	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-14 19:08:23.601981+00	
00000000-0000-0000-0000-000000000000	d3f229b8-f02b-4dd7-8299-dc3c3845881c	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-14 19:08:23.604489+00	
00000000-0000-0000-0000-000000000000	99671a43-3bd4-4dab-9fed-a3ac7732306f	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-15 03:30:13.841395+00	
00000000-0000-0000-0000-000000000000	14899374-b626-458e-9864-0b3c4be550d0	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-15 03:30:13.843525+00	
00000000-0000-0000-0000-000000000000	a43157ca-96e9-460a-ae26-6f1793b9cbdf	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-15 16:16:15.28992+00	
00000000-0000-0000-0000-000000000000	b69b6a31-04fe-40e0-839e-498b1d1b34d6	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-15 16:16:15.291876+00	
00000000-0000-0000-0000-000000000000	cfdd789e-1576-4112-a393-572802c1bdd8	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-15 17:14:27.485617+00	
00000000-0000-0000-0000-000000000000	9eb448e3-8d48-4d11-84b9-b2ba1e4b03f0	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-15 17:14:27.487626+00	
00000000-0000-0000-0000-000000000000	c99c3b52-d63a-4dae-a1b0-abcc2be21a64	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 07:07:40.088563+00	
00000000-0000-0000-0000-000000000000	505f9f55-ba2b-49a7-8396-14afd069d42c	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 07:07:40.090784+00	
00000000-0000-0000-0000-000000000000	e9c19d16-4eea-48f6-87c2-678cba6ed240	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 09:49:16.410452+00	
00000000-0000-0000-0000-000000000000	355ba9ee-2711-4506-9bb4-46a73d546c45	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 09:49:16.41854+00	
00000000-0000-0000-0000-000000000000	a036e736-2e5f-484f-9d8e-b47920b03611	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 11:14:21.384451+00	
00000000-0000-0000-0000-000000000000	e1358bb4-4d78-4140-b945-e032757dedd3	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 11:14:21.391175+00	
00000000-0000-0000-0000-000000000000	74d71d08-0bf2-441c-b946-c262e69d5498	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 12:12:44.368294+00	
00000000-0000-0000-0000-000000000000	c665209d-62fa-41e9-8210-c1044d02c042	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 12:12:44.370262+00	
00000000-0000-0000-0000-000000000000	abf57c8f-1147-478a-8f98-934e4b80b4a3	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 13:10:58.892221+00	
00000000-0000-0000-0000-000000000000	5b41243f-cd3f-4caf-9030-4dd608cb7b00	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 13:10:58.893558+00	
00000000-0000-0000-0000-000000000000	0123382c-a1cd-4946-bdf1-653838676885	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 17:09:22.498598+00	
00000000-0000-0000-0000-000000000000	21715545-e759-4b6e-9276-d022ee5a17a7	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-16 17:09:22.515638+00	
00000000-0000-0000-0000-000000000000	c84faeb9-43ec-4fca-8bad-82d041b21dc9	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 09:33:12.569138+00	
00000000-0000-0000-0000-000000000000	aeaee4a7-503c-4642-8ff3-eb5887548672	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 09:33:12.57282+00	
00000000-0000-0000-0000-000000000000	9da00d1e-f6f3-4374-bebb-098c5ceb41c7	{"action":"login","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"account","traits":{"provider":"email"}}	2026-01-17 09:33:15.187825+00	
00000000-0000-0000-0000-000000000000	eb02ae76-d176-4565-a5bb-150e24c6b765	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 10:36:35.247627+00	
00000000-0000-0000-0000-000000000000	cfafe051-434a-4441-b8f1-8b3bb98f0ae1	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 10:36:35.251052+00	
00000000-0000-0000-0000-000000000000	baf2f9cc-e0c5-49d1-91df-dfb1fb887da8	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 11:42:20.984705+00	
00000000-0000-0000-0000-000000000000	a502c21a-2be8-44ec-83ed-bc163e93577c	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 11:42:20.987842+00	
00000000-0000-0000-0000-000000000000	1cf515f2-a3db-4c0c-8459-9598c3a18bfb	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 12:40:33.982583+00	
00000000-0000-0000-0000-000000000000	083a8dcf-3237-44fe-a556-b9e7f9de6d46	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 12:40:33.984079+00	
00000000-0000-0000-0000-000000000000	8f31b21b-e016-44b4-b325-6fd9c3dbd41f	{"action":"user_signedup","actor_id":"00000000-0000-0000-0000-000000000000","actor_username":"service_role","actor_via_sso":false,"log_type":"team","traits":{"provider":"email","user_email":"andreyshokin1@gmail.com","user_id":"9fb4cbfe-736d-40f7-832e-aa1d60ae7741","user_phone":""}}	2026-01-17 13:34:35.729389+00	
00000000-0000-0000-0000-000000000000	09ec47f5-a434-4511-b2ae-8082fb8daa13	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 13:38:38.707065+00	
00000000-0000-0000-0000-000000000000	c8b8604c-87ac-4d67-aad2-5f435691f363	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 13:38:38.709367+00	
00000000-0000-0000-0000-000000000000	f415f38e-22e3-4ecd-9f5e-e12d6ae61be7	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 14:37:19.739406+00	
00000000-0000-0000-0000-000000000000	463274b5-45c4-4e9c-8ac9-2822f0b2913b	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 14:37:19.740913+00	
00000000-0000-0000-0000-000000000000	6ee47c4e-f09c-4b03-babb-b87843e6a737	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 15:36:13.838964+00	
00000000-0000-0000-0000-000000000000	8d14a926-5aba-4686-a05d-61d3a59af82c	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 15:36:13.840155+00	
00000000-0000-0000-0000-000000000000	e80d0a05-c067-4e69-a389-0a5f0bf2ef7d	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 16:35:08.013912+00	
00000000-0000-0000-0000-000000000000	dfe83ca0-461a-4423-bcb6-770cf022736a	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 16:35:08.015443+00	
00000000-0000-0000-0000-000000000000	9c358d18-40d9-4575-8a59-f8772f5f21df	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 17:34:17.785909+00	
00000000-0000-0000-0000-000000000000	cf80ea73-7bc8-4354-9a62-43f423db456d	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 17:34:17.787074+00	
00000000-0000-0000-0000-000000000000	7cf0e924-e8b7-4a0d-a0c1-25408aba7efd	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 18:33:11.83375+00	
00000000-0000-0000-0000-000000000000	4dd290ce-ec53-478d-97e9-78379df33a5f	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 18:33:11.835348+00	
00000000-0000-0000-0000-000000000000	2019465d-c6cb-4d34-ae74-746a09e21887	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 19:32:05.846725+00	
00000000-0000-0000-0000-000000000000	301b40dc-416e-4cae-b6f4-9c23c93050e9	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 19:32:05.848171+00	
00000000-0000-0000-0000-000000000000	9dcace3f-c812-4157-a12e-dd607333ae6f	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 20:30:59.914278+00	
00000000-0000-0000-0000-000000000000	79811742-07f4-4d77-b8aa-a9a5cd42fb77	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 20:30:59.915927+00	
00000000-0000-0000-0000-000000000000	85aedaa0-a327-4678-8c9d-80dc9f04b1dc	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 21:29:54.02075+00	
00000000-0000-0000-0000-000000000000	9f595ca6-609a-4f93-93be-edda12851f47	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 21:29:54.022379+00	
00000000-0000-0000-0000-000000000000	06678d95-97ed-4b31-b2fc-786309c856b5	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 22:28:48.095551+00	
00000000-0000-0000-0000-000000000000	435cc784-6c1b-4271-8140-bbadb32e1c80	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 22:28:48.097053+00	
00000000-0000-0000-0000-000000000000	23400637-faf0-4d95-b5cb-8be323220ac8	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 23:27:42.253849+00	
00000000-0000-0000-0000-000000000000	b047792c-068b-4414-a908-9adada6e6470	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-17 23:27:42.255283+00	
00000000-0000-0000-0000-000000000000	1454356b-9f53-4bec-ae45-5dc1f15ec541	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 00:26:36.293838+00	
00000000-0000-0000-0000-000000000000	8d48037d-8518-4e28-9e1a-76090b36c3d7	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 00:26:36.295266+00	
00000000-0000-0000-0000-000000000000	d1de6b82-99cf-4111-9cf5-d7de696f4c1a	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 01:25:30.488389+00	
00000000-0000-0000-0000-000000000000	3711906f-787b-4178-bdc1-fa6cfa0a887a	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 01:25:30.489659+00	
00000000-0000-0000-0000-000000000000	495f2324-6d8a-43e1-a469-a4683b036f29	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 02:24:24.389803+00	
00000000-0000-0000-0000-000000000000	01cc6cce-319b-4a85-b055-c8b5d58eaeeb	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 02:24:24.391128+00	
00000000-0000-0000-0000-000000000000	e9e660bf-9646-4e00-ba0a-9f4698fba4ce	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 03:23:18.473109+00	
00000000-0000-0000-0000-000000000000	2b7a8175-5f97-4ca0-b2d9-6a4aca6a906e	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 03:23:18.474627+00	
00000000-0000-0000-0000-000000000000	a0476f01-ca7f-4da4-b410-85ee0e3f69f8	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 04:22:12.67639+00	
00000000-0000-0000-0000-000000000000	31c587e6-5917-4b62-b803-ee7f82145328	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 04:22:12.678026+00	
00000000-0000-0000-0000-000000000000	480d02bf-c8ad-4fde-8b89-2cf614f87942	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 05:21:06.709844+00	
00000000-0000-0000-0000-000000000000	aeb9c11b-fec4-4c48-be47-175c3dbe5568	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 05:21:06.711343+00	
00000000-0000-0000-0000-000000000000	5b9b6042-c00e-4848-9637-26d6174eca78	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 06:19:31.899054+00	
00000000-0000-0000-0000-000000000000	4a7fdf16-ddc5-41f9-94c7-de5b6c007e71	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 06:19:31.902341+00	
00000000-0000-0000-0000-000000000000	20ae79cf-86c1-4d99-bb50-77b765a135ef	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 07:17:43.59003+00	
00000000-0000-0000-0000-000000000000	c4ec89d9-9c59-4baf-b0c4-0a228342232c	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 07:17:43.591732+00	
00000000-0000-0000-0000-000000000000	67a8a028-a890-4a79-85ef-814c662a697f	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 08:15:57.517087+00	
00000000-0000-0000-0000-000000000000	5bfba14c-36fe-4b1e-9dc8-8093fcbe3f69	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 08:15:57.518719+00	
00000000-0000-0000-0000-000000000000	167a5171-f18a-4ea0-8f84-bd8ca2527510	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 09:14:27.160511+00	
00000000-0000-0000-0000-000000000000	33304d54-3cb8-4d7a-aacc-a1fea7c79df7	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 09:14:27.162535+00	
00000000-0000-0000-0000-000000000000	70bf2f50-8033-42a1-9883-a831eb3e4d2a	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 10:13:03.233496+00	
00000000-0000-0000-0000-000000000000	882e5819-d187-48dd-9dd2-d11bce63ff48	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 10:13:03.234808+00	
00000000-0000-0000-0000-000000000000	cee9fd8b-f7ec-4434-97ca-56c0ce9a542e	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 11:11:19.518098+00	
00000000-0000-0000-0000-000000000000	80d7ecb4-3f36-4964-ab2e-78c2df7b3b7d	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 11:11:19.519943+00	
00000000-0000-0000-0000-000000000000	dfb78b9a-2e4d-419f-b1dd-ea169ff7dd2f	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 12:09:33.070662+00	
00000000-0000-0000-0000-000000000000	a8f2828d-0f89-46c8-b682-edee7015dcd7	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 12:09:33.072114+00	
00000000-0000-0000-0000-000000000000	a0255446-c2d7-4393-9bf8-7795e13e76b0	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 13:07:47.83694+00	
00000000-0000-0000-0000-000000000000	01b7bb5e-8f2b-4f1d-b3f3-979f963780ec	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 13:07:47.839378+00	
00000000-0000-0000-0000-000000000000	3247e94a-7bef-406d-a6ee-c3d09cf3c78f	{"action":"user_signedup","actor_id":"00000000-0000-0000-0000-000000000000","actor_username":"service_role","actor_via_sso":false,"log_type":"team","traits":{"provider":"email","user_email":"andreyshokin11@gmail.com","user_id":"f8f9384c-064d-4fbf-8e8f-feec2ceaa023","user_phone":""}}	2026-01-18 14:00:20.600708+00	
00000000-0000-0000-0000-000000000000	17532726-78c8-4c8b-9714-4cf1cdb04973	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 14:06:27.492389+00	
00000000-0000-0000-0000-000000000000	1fadf27e-5fec-4703-b869-4e09cccea0e5	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 14:06:27.494975+00	
00000000-0000-0000-0000-000000000000	cd7f138d-d284-4934-80d6-0c099cedc10a	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 15:22:29.881821+00	
00000000-0000-0000-0000-000000000000	8589daad-2226-4ad0-b59f-f60e9b27652b	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 15:22:29.89547+00	
00000000-0000-0000-0000-000000000000	f93011c3-23a5-4832-8e2e-475143117626	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 16:21:13.070543+00	
00000000-0000-0000-0000-000000000000	de644509-0880-4b17-84ad-a6eb6f4d6021	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 16:21:13.071801+00	
00000000-0000-0000-0000-000000000000	450a4ea2-5e40-4981-a4f7-cf2d9e2e364e	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 17:19:57.944535+00	
00000000-0000-0000-0000-000000000000	d38627fe-5289-4f45-adf0-7b2b0b1dd999	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 17:19:57.94599+00	
00000000-0000-0000-0000-000000000000	c04d0957-39b0-4e7c-bb5a-1f8ef4200751	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 18:23:24.430469+00	
00000000-0000-0000-0000-000000000000	a970ba57-5b8f-4d9c-93bd-c05ad5a94904	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 18:23:24.431905+00	
00000000-0000-0000-0000-000000000000	540b1f75-3014-4a7d-801b-9d13e71eec44	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 19:25:20.465791+00	
00000000-0000-0000-0000-000000000000	7be33618-cdc5-4f6e-a96b-990c8d066f24	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-18 19:25:20.470449+00	
00000000-0000-0000-0000-000000000000	9c939c77-081a-4555-9286-820299c2ed04	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 07:44:25.473661+00	
00000000-0000-0000-0000-000000000000	af4e89dd-5f9d-441e-9d06-96ca17711ac5	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 07:44:25.482136+00	
00000000-0000-0000-0000-000000000000	4f03eae0-dc8b-459c-adc3-3a35c0f08371	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 08:54:35.857501+00	
00000000-0000-0000-0000-000000000000	6faccbee-e0ea-4adf-b560-847f340d24d5	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 08:54:35.864505+00	
00000000-0000-0000-0000-000000000000	18cfcd36-e63f-41de-8c18-589b5b38560d	{"action":"user_signedup","actor_id":"00000000-0000-0000-0000-000000000000","actor_username":"service_role","actor_via_sso":false,"log_type":"team","traits":{"provider":"email","user_email":"andreyshokin111@gmail.com","user_id":"ef249977-5333-4eb6-9abd-7045506dc1d3","user_phone":""}}	2026-01-19 09:30:15.653856+00	
00000000-0000-0000-0000-000000000000	a7dcb6dd-8463-40ab-a253-6b601b225952	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 09:52:41.885458+00	
00000000-0000-0000-0000-000000000000	ae33f64b-578c-495d-820e-bf21bb9cc037	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 09:52:41.886831+00	
00000000-0000-0000-0000-000000000000	f0b4b920-0160-4a41-9201-83933dec2213	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 10:51:04.841041+00	
00000000-0000-0000-0000-000000000000	125e01e2-f661-41ce-8fef-39d76780f3fb	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 10:51:04.842845+00	
00000000-0000-0000-0000-000000000000	ec450d81-02ca-4079-89ee-9ec097e1676b	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 11:49:11.543773+00	
00000000-0000-0000-0000-000000000000	cfe34d89-161c-4279-892a-dcf678e12868	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 11:49:11.545443+00	
00000000-0000-0000-0000-000000000000	339cd1f3-5c84-4f58-b0e1-125948e00cc3	{"action":"user_signedup","actor_id":"00000000-0000-0000-0000-000000000000","actor_username":"service_role","actor_via_sso":false,"log_type":"team","traits":{"provider":"email","user_email":"andreyshokin123@gmail.com","user_id":"cc059884-a44e-403a-8caa-002100d76c4b","user_phone":""}}	2026-01-19 12:45:16.631811+00	
00000000-0000-0000-0000-000000000000	a424fbd6-a537-4a78-9008-38b10d36e494	{"action":"token_refreshed","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 12:47:13.0638+00	
00000000-0000-0000-0000-000000000000	47b25a1d-161c-47b6-96db-263d6580bd17	{"action":"token_revoked","actor_id":"a918e7d3-b8e2-4b73-847c-fd0fa04d5432","actor_name":"מנהל מערכת","actor_username":"manager@dietneta.com","actor_via_sso":false,"log_type":"token"}	2026-01-19 12:47:13.065342+00	
00000000-0000-0000-0000-000000000000	f5f6144c-f13f-416b-8bb2-d79d81b48704	{"action":"user_signedup","actor_id":"00000000-0000-0000-0000-000000000000","actor_username":"service_role","actor_via_sso":false,"log_type":"team","traits":{"provider":"email","user_email":"andreyshokin16@gmail.com","user_id":"87a54cc2-6bc5-4d2e-96d8-fe43821b9ebc","user_phone":""}}	2026-01-19 12:47:53.000381+00	
\.


--
-- Data for Name: flow_state; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."flow_state" ("id", "user_id", "auth_code", "code_challenge_method", "code_challenge", "provider_type", "provider_access_token", "provider_refresh_token", "created_at", "updated_at", "authentication_method", "auth_code_issued_at") FROM stdin;
\.


--
-- Data for Name: users; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."users" ("instance_id", "id", "aud", "role", "email", "encrypted_password", "email_confirmed_at", "invited_at", "confirmation_token", "confirmation_sent_at", "recovery_token", "recovery_sent_at", "email_change_token_new", "email_change", "email_change_sent_at", "last_sign_in_at", "raw_app_meta_data", "raw_user_meta_data", "is_super_admin", "created_at", "updated_at", "phone", "phone_confirmed_at", "phone_change", "phone_change_token", "phone_change_sent_at", "email_change_token_current", "email_change_confirm_status", "banned_until", "reauthentication_token", "reauthentication_sent_at", "is_sso_user", "deleted_at", "is_anonymous") FROM stdin;
00000000-0000-0000-0000-000000000000	01c6e076-772c-442e-b5ab-bb71ff151aad	authenticated	authenticated	client@dietneta.com	$2a$06$AWWsHcC6UUa1wx3s0/5f8.v1xHtAo9TiIEeePpjwjPgDWcIINEIxy	2026-01-14 17:10:04.420516+00	\N		\N		2026-01-14 17:10:04.420516+00			\N	2026-01-14 17:10:04.420516+00	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "full_name": "לקוח בדיקה"}	\N	2026-01-14 17:10:04.420516+00	2026-01-14 17:10:04.420516+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	9fb4cbfe-736d-40f7-832e-aa1d60ae7741	authenticated	authenticated	andreyshokin1@gmail.com	$2a$10$jz.B4SwgY2w1x38HMzDYQu9JxPw3S1aswUrFkBAcG3ZAmejxibXj2	2026-01-17 13:34:35.732047+00	\N		\N		\N			\N	\N	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "email_verified": true}	\N	2026-01-17 13:34:35.723015+00	2026-01-17 13:34:35.733158+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	87a54cc2-6bc5-4d2e-96d8-fe43821b9ebc	authenticated	authenticated	andreyshokin16@gmail.com	$2a$10$hZnCrnciyq2LnD4tFRYIHe2cPDpvh0jLAgqWn8Icsynp3iyPYrZJu	2026-01-19 12:47:53.004503+00	\N		\N		\N			\N	\N	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "email_verified": true}	\N	2026-01-19 12:47:52.992524+00	2026-01-19 12:47:53.007815+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	ef249977-5333-4eb6-9abd-7045506dc1d3	authenticated	authenticated	andreyshokin111@gmail.com	$2a$10$pbIchPo7/woMMkWq9pdgUuFa1zcffIn1uN9E6/UDGx56Vzts5LCPC	2026-01-19 09:30:15.656327+00	\N		\N		\N			\N	\N	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "email_verified": true}	\N	2026-01-19 09:30:15.645239+00	2026-01-19 09:30:15.657426+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	f8f9384c-064d-4fbf-8e8f-feec2ceaa023	authenticated	authenticated	andreyshokin11@gmail.com	$2a$10$bcvONm/O3Wxq6.O9OrioE.5PP0.U1dbKLLfPsaOoi25baTHI2IMfy	2026-01-18 14:00:20.603766+00	\N		\N		\N			\N	\N	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "email_verified": true}	\N	2026-01-18 14:00:20.592271+00	2026-01-18 14:00:20.605102+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	cc059884-a44e-403a-8caa-002100d76c4b	authenticated	authenticated	andreyshokin123@gmail.com	$2a$10$2.1axqJMx4QKnGmbgVk7.uf9VdsBYx8YA7I7R1fus8VGpii2psQYO	2026-01-19 12:45:16.63544+00	\N		\N		\N			\N	\N	{"provider": "email", "providers": ["email"]}	{"role": "trainee", "email_verified": true}	\N	2026-01-19 12:45:16.624595+00	2026-01-19 12:45:16.636546+00	\N	\N			\N		0	\N		\N	f	\N	f
00000000-0000-0000-0000-000000000000	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	authenticated	authenticated	manager@dietneta.com	$2a$06$oQN65jpPC1MhKcKvlTbLV.axRjAs6W5tPXmLNB5NsK0jlB6WiUrmW	2026-01-14 17:10:04.420516+00	\N		\N		2026-01-14 17:10:04.420516+00			\N	2026-01-17 09:33:15.190032+00	{"provider": "email", "providers": ["email"]}	{"role": "admin", "full_name": "מנהל מערכת"}	\N	2026-01-14 17:10:04.420516+00	2026-01-19 12:47:13.07126+00	\N	\N			\N		0	\N		\N	f	\N	f
\.


--
-- Data for Name: identities; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."identities" ("provider_id", "user_id", "identity_data", "provider", "last_sign_in_at", "created_at", "updated_at", "id") FROM stdin;
9fb4cbfe-736d-40f7-832e-aa1d60ae7741	9fb4cbfe-736d-40f7-832e-aa1d60ae7741	{"sub": "9fb4cbfe-736d-40f7-832e-aa1d60ae7741", "email": "andreyshokin1@gmail.com", "email_verified": false, "phone_verified": false}	email	2026-01-17 13:34:35.727617+00	2026-01-17 13:34:35.727662+00	2026-01-17 13:34:35.727662+00	26b6aaf7-4bfc-48bf-a5d5-af9781694d36
f8f9384c-064d-4fbf-8e8f-feec2ceaa023	f8f9384c-064d-4fbf-8e8f-feec2ceaa023	{"sub": "f8f9384c-064d-4fbf-8e8f-feec2ceaa023", "email": "andreyshokin11@gmail.com", "email_verified": false, "phone_verified": false}	email	2026-01-18 14:00:20.597975+00	2026-01-18 14:00:20.598021+00	2026-01-18 14:00:20.598021+00	1ad3a015-9379-403b-a2dc-301178db0048
ef249977-5333-4eb6-9abd-7045506dc1d3	ef249977-5333-4eb6-9abd-7045506dc1d3	{"sub": "ef249977-5333-4eb6-9abd-7045506dc1d3", "email": "andreyshokin111@gmail.com", "email_verified": false, "phone_verified": false}	email	2026-01-19 09:30:15.65143+00	2026-01-19 09:30:15.651476+00	2026-01-19 09:30:15.651476+00	1f6362cf-62bd-40e0-a9c2-7e51a96e2640
cc059884-a44e-403a-8caa-002100d76c4b	cc059884-a44e-403a-8caa-002100d76c4b	{"sub": "cc059884-a44e-403a-8caa-002100d76c4b", "email": "andreyshokin123@gmail.com", "email_verified": false, "phone_verified": false}	email	2026-01-19 12:45:16.629448+00	2026-01-19 12:45:16.629494+00	2026-01-19 12:45:16.629494+00	7cb8f11c-f78c-44d0-a186-de09e89494fc
87a54cc2-6bc5-4d2e-96d8-fe43821b9ebc	87a54cc2-6bc5-4d2e-96d8-fe43821b9ebc	{"sub": "87a54cc2-6bc5-4d2e-96d8-fe43821b9ebc", "email": "andreyshokin16@gmail.com", "email_verified": false, "phone_verified": false}	email	2026-01-19 12:47:52.998396+00	2026-01-19 12:47:52.998477+00	2026-01-19 12:47:52.998477+00	5bd9795b-3206-416b-acc0-bfb16d787765
\.


--
-- Data for Name: instances; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."instances" ("id", "uuid", "raw_base_config", "created_at", "updated_at") FROM stdin;
\.


--
-- Data for Name: oauth_clients; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."oauth_clients" ("id", "client_secret_hash", "registration_type", "redirect_uris", "grant_types", "client_name", "client_uri", "logo_uri", "created_at", "updated_at", "deleted_at", "client_type") FROM stdin;
\.


--
-- Data for Name: sessions; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."sessions" ("id", "user_id", "created_at", "updated_at", "factor_id", "aal", "not_after", "refreshed_at", "user_agent", "ip", "tag", "oauth_client_id", "refresh_token_hmac_key", "refresh_token_counter", "scopes") FROM stdin;
14611d74-abf4-4781-bef6-97885f92f15e	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	2026-01-14 17:10:30.101673+00	2026-01-17 09:33:12.580338+00	\N	aal1	\N	2026-01-17 09:33:12.580259	Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36	192.168.65.1	\N	\N	\N	\N	\N
86f55f92-4a8b-4df7-86d3-bc489d5e9865	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	2026-01-17 09:33:15.19016+00	2026-01-19 12:47:13.073661+00	\N	aal1	\N	2026-01-19 12:47:13.073583	Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36	172.18.0.1	\N	\N	\N	\N	\N
\.


--
-- Data for Name: mfa_amr_claims; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."mfa_amr_claims" ("session_id", "created_at", "updated_at", "authentication_method", "id") FROM stdin;
14611d74-abf4-4781-bef6-97885f92f15e	2026-01-14 17:10:30.108298+00	2026-01-14 17:10:30.108298+00	password	056410fe-3f34-4dbb-9e16-c5f1117e1549
86f55f92-4a8b-4df7-86d3-bc489d5e9865	2026-01-17 09:33:15.196784+00	2026-01-17 09:33:15.196784+00	password	4b0d2b75-19e3-416e-bd20-15cca45488c6
\.


--
-- Data for Name: mfa_factors; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."mfa_factors" ("id", "user_id", "friendly_name", "factor_type", "status", "created_at", "updated_at", "secret", "phone", "last_challenged_at", "web_authn_credential", "web_authn_aaguid", "last_webauthn_challenge_data") FROM stdin;
\.


--
-- Data for Name: mfa_challenges; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."mfa_challenges" ("id", "factor_id", "created_at", "verified_at", "ip_address", "otp_code", "web_authn_session_data") FROM stdin;
\.


--
-- Data for Name: oauth_authorizations; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."oauth_authorizations" ("id", "authorization_id", "client_id", "user_id", "redirect_uri", "scope", "state", "resource", "code_challenge", "code_challenge_method", "response_type", "status", "authorization_code", "created_at", "expires_at", "approved_at", "nonce") FROM stdin;
\.


--
-- Data for Name: oauth_client_states; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."oauth_client_states" ("id", "provider_type", "code_verifier", "created_at") FROM stdin;
\.


--
-- Data for Name: oauth_consents; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."oauth_consents" ("id", "user_id", "client_id", "scopes", "granted_at", "revoked_at") FROM stdin;
\.


--
-- Data for Name: one_time_tokens; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."one_time_tokens" ("id", "user_id", "token_type", "token_hash", "relates_to", "created_at", "updated_at") FROM stdin;
\.


--
-- Data for Name: refresh_tokens; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."refresh_tokens" ("instance_id", "id", "token", "user_id", "revoked", "created_at", "updated_at", "parent", "session_id") FROM stdin;
00000000-0000-0000-0000-000000000000	1	o6rp6wfwmg4t	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-14 17:10:30.105028+00	2026-01-14 18:08:52.40643+00	\N	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	2	ll5as677kjjg	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-14 18:08:52.407564+00	2026-01-14 19:08:23.606499+00	o6rp6wfwmg4t	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	3	cplftoquklyq	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-14 19:08:23.608548+00	2026-01-15 03:30:13.844972+00	ll5as677kjjg	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	4	akipphrl6fhm	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-15 03:30:13.846661+00	2026-01-15 16:16:15.293563+00	cplftoquklyq	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	5	rxrxeeezpzch	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-15 16:16:15.294787+00	2026-01-15 17:14:27.489803+00	akipphrl6fhm	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	6	is6faoiq6kos	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-15 17:14:27.491412+00	2026-01-16 07:07:40.092766+00	rxrxeeezpzch	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	7	vpdkbg6ppkby	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-16 07:07:40.094505+00	2026-01-16 09:49:16.42325+00	is6faoiq6kos	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	8	tq2ynx7j7kk6	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-16 09:49:16.425484+00	2026-01-16 11:14:21.392858+00	vpdkbg6ppkby	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	9	ymwdxu7s3s5q	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-16 11:14:21.394776+00	2026-01-16 12:12:44.372766+00	tq2ynx7j7kk6	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	10	anm46b6t62at	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-16 12:12:44.373956+00	2026-01-16 13:10:58.894647+00	ymwdxu7s3s5q	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	11	qgzljmnh5brm	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-16 13:10:58.89566+00	2026-01-16 17:09:22.518068+00	anm46b6t62at	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	12	qlpnglgripmt	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-16 17:09:22.521534+00	2026-01-17 09:33:12.574295+00	qgzljmnh5brm	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	13	geczl3uyxitc	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	f	2026-01-17 09:33:12.575931+00	2026-01-17 09:33:12.575931+00	qlpnglgripmt	14611d74-abf4-4781-bef6-97885f92f15e
00000000-0000-0000-0000-000000000000	14	ij6pq3c4iith	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 09:33:15.193661+00	2026-01-17 10:36:35.253131+00	\N	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	15	xz3h5u26pkmj	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 10:36:35.255039+00	2026-01-17 11:42:20.989358+00	ij6pq3c4iith	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	16	arwciie4hwml	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 11:42:20.99059+00	2026-01-17 12:40:33.985473+00	xz3h5u26pkmj	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	17	tadkvuevqddc	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 12:40:33.98664+00	2026-01-17 13:38:38.710864+00	arwciie4hwml	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	18	6srerwfxghas	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 13:38:38.712769+00	2026-01-17 14:37:19.742285+00	tadkvuevqddc	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	19	gpwtqls4eqfp	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 14:37:19.743853+00	2026-01-17 15:36:13.84125+00	6srerwfxghas	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	20	xlsi4t5ozvz5	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 15:36:13.842258+00	2026-01-17 16:35:08.016407+00	gpwtqls4eqfp	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	21	fekvlhnt4w65	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 16:35:08.017455+00	2026-01-17 17:34:17.788088+00	xlsi4t5ozvz5	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	22	6nvbwavlijwg	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 17:34:17.789034+00	2026-01-17 18:33:11.836357+00	fekvlhnt4w65	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	23	d265zxhdvmip	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 18:33:11.83759+00	2026-01-17 19:32:05.849513+00	6nvbwavlijwg	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	24	h7z2nwetr2g3	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 19:32:05.850764+00	2026-01-17 20:30:59.91732+00	d265zxhdvmip	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	25	lf5f2f5gkfor	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 20:30:59.91831+00	2026-01-17 21:29:54.023465+00	h7z2nwetr2g3	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	26	4r3iagls3huu	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 21:29:54.024528+00	2026-01-17 22:28:48.098022+00	lf5f2f5gkfor	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	27	q7zppbbwv57k	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 22:28:48.09908+00	2026-01-17 23:27:42.256424+00	4r3iagls3huu	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	28	sop7cwbcbzvq	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-17 23:27:42.257474+00	2026-01-18 00:26:36.296303+00	q7zppbbwv57k	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	29	uhifwuh5zgke	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 00:26:36.297335+00	2026-01-18 01:25:30.490999+00	sop7cwbcbzvq	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	30	abzpth7uq5gs	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 01:25:30.491934+00	2026-01-18 02:24:24.392159+00	uhifwuh5zgke	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	31	xomjwldh2mfa	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 02:24:24.393274+00	2026-01-18 03:23:18.475911+00	abzpth7uq5gs	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	32	kdvmjpmupbhu	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 03:23:18.476888+00	2026-01-18 04:22:12.678873+00	xomjwldh2mfa	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	33	s3ut6z3erkc4	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 04:22:12.680414+00	2026-01-18 05:21:06.712916+00	kdvmjpmupbhu	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	34	ksubcwg2tppk	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 05:21:06.713971+00	2026-01-18 06:19:31.905546+00	s3ut6z3erkc4	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	35	tp6v2eutafns	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 06:19:31.907809+00	2026-01-18 07:17:43.592896+00	ksubcwg2tppk	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	36	x3umw4mvm4ep	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 07:17:43.594206+00	2026-01-18 08:15:57.52083+00	tp6v2eutafns	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	37	6hytq5xqlwcm	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 08:15:57.522143+00	2026-01-18 09:14:27.164696+00	x3umw4mvm4ep	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	38	mrujwlni7s5c	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 09:14:27.166173+00	2026-01-18 10:13:03.235929+00	6hytq5xqlwcm	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	39	qmxyfqkcs2dc	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 10:13:03.236833+00	2026-01-18 11:11:19.521388+00	mrujwlni7s5c	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	40	upmrj2kuevlo	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 11:11:19.522895+00	2026-01-18 12:09:33.073346+00	qmxyfqkcs2dc	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	41	vnpjlkoyvm27	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 12:09:33.0744+00	2026-01-18 13:07:47.840935+00	upmrj2kuevlo	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	42	zpbbs2mof5ii	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 13:07:47.843968+00	2026-01-18 14:06:27.496788+00	vnpjlkoyvm27	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	43	aozljnmynq54	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 14:06:27.498304+00	2026-01-18 15:22:29.902444+00	zpbbs2mof5ii	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	44	o5kjf6lnwxuf	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 15:22:29.908691+00	2026-01-18 16:21:13.073118+00	aozljnmynq54	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	45	zgwvjtd44fmp	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 16:21:13.074019+00	2026-01-18 17:19:57.947122+00	o5kjf6lnwxuf	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	46	lrqoc2vpk27i	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 17:19:57.948124+00	2026-01-18 18:23:24.433011+00	zgwvjtd44fmp	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	47	fq3h24nyvxdn	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 18:23:24.433919+00	2026-01-18 19:25:20.472524+00	lrqoc2vpk27i	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	48	3b2x57ezbrv4	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-18 19:25:20.478121+00	2026-01-19 07:44:25.483128+00	fq3h24nyvxdn	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	49	soszc7ja3wst	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-19 07:44:25.485937+00	2026-01-19 08:54:35.867214+00	3b2x57ezbrv4	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	50	ksxx33tfvc6w	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-19 08:54:35.870512+00	2026-01-19 09:52:41.888805+00	soszc7ja3wst	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	51	bbxwcvkga6e3	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-19 09:52:41.890211+00	2026-01-19 10:51:04.844189+00	ksxx33tfvc6w	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	52	auyz4q42blmv	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-19 10:51:04.845204+00	2026-01-19 11:49:11.546578+00	bbxwcvkga6e3	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	53	janmn7dndxn4	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	2026-01-19 11:49:11.547701+00	2026-01-19 12:47:13.067102+00	auyz4q42blmv	86f55f92-4a8b-4df7-86d3-bc489d5e9865
00000000-0000-0000-0000-000000000000	54	hzxsvzjobuyt	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	f	2026-01-19 12:47:13.069076+00	2026-01-19 12:47:13.069076+00	janmn7dndxn4	86f55f92-4a8b-4df7-86d3-bc489d5e9865
\.


--
-- Data for Name: sso_providers; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."sso_providers" ("id", "resource_id", "created_at", "updated_at", "disabled") FROM stdin;
\.


--
-- Data for Name: saml_providers; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."saml_providers" ("id", "sso_provider_id", "entity_id", "metadata_xml", "metadata_url", "attribute_mapping", "created_at", "updated_at", "name_id_format") FROM stdin;
\.


--
-- Data for Name: saml_relay_states; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."saml_relay_states" ("id", "sso_provider_id", "request_id", "for_email", "redirect_to", "created_at", "updated_at", "flow_state_id") FROM stdin;
\.


--
-- Data for Name: sso_domains; Type: TABLE DATA; Schema: auth; Owner: supabase_auth_admin
--

COPY "auth"."sso_domains" ("id", "sso_provider_id", "domain", "created_at", "updated_at") FROM stdin;
\.


--
-- Data for Name: customers; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."customers" ("id", "full_name", "phone", "email", "created_at", "updated_at", "daily_protocol", "workout_history", "steps_history", "avatar_url", "total_spent", "membership_tier", "user_id") FROM stdin;
4624153d-742f-4302-b9d5-97cf0a28361f	לקוח בדיקה	0501234567	client@dietneta.com	2026-01-14 17:10:04.420516+00	2026-01-14 17:10:04.420516+00	{}	[]	[]	\N	0.00	New	01c6e076-772c-442e-b5ab-bb71ff151aad
db970bcc-da78-496f-a5ef-3280956477f6	אנדרי שצוקין	972526861485	\N	2026-01-19 12:39:46.105879+00	2026-01-19 12:45:16.647247+00	{}	[]	[]	\N	0.00	New	cc059884-a44e-403a-8caa-002100d76c4b
9001bc53-b7a0-4663-b08b-a6bde9776164	אנדרי שצוקין	972526861486	\N	2026-01-19 12:47:37.972468+00	2026-01-19 12:47:53.019942+00	{}	[]	[]	\N	0.00	New	87a54cc2-6bc5-4d2e-96d8-fe43821b9ebc
\.


--
-- Data for Name: profiles; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."profiles" ("id", "email", "full_name", "role", "created_at", "updated_at", "is_active") FROM stdin;
01c6e076-772c-442e-b5ab-bb71ff151aad	client@dietneta.com	לקוח בדיקה	trainee	2026-01-14 17:10:04.420516+00	2026-01-14 17:10:04.420516+00	t
a918e7d3-b8e2-4b73-847c-fd0fa04d5432	manager@dietneta.com	מנהל מערכת	admin	2026-01-14 17:10:04.420516+00	2026-01-14 17:10:04.514108+00	t
9fb4cbfe-736d-40f7-832e-aa1d60ae7741	andreyshokin1@gmail.com		trainee	2026-01-17 13:34:35.722603+00	2026-01-17 13:34:35.722603+00	t
f8f9384c-064d-4fbf-8e8f-feec2ceaa023	andreyshokin11@gmail.com		trainee	2026-01-18 14:00:20.591683+00	2026-01-18 14:00:20.591683+00	t
ef249977-5333-4eb6-9abd-7045506dc1d3	andreyshokin111@gmail.com		trainee	2026-01-19 09:30:15.644854+00	2026-01-19 09:30:15.644854+00	t
cc059884-a44e-403a-8caa-002100d76c4b	andreyshokin123@gmail.com		trainee	2026-01-19 12:45:16.624201+00	2026-01-19 12:45:16.624201+00	t
87a54cc2-6bc5-4d2e-96d8-fe43821b9ebc	andreyshokin16@gmail.com		trainee	2026-01-19 12:47:52.992016+00	2026-01-19 12:47:52.992016+00	t
\.


--
-- Data for Name: leads; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."leads" ("id", "created_at", "updated_at", "assigned_to", "city", "birth_date", "gender", "status_main", "status_sub", "height", "weight", "bmi", "join_date", "subscription_data", "daily_protocol", "workout_history", "steps_history", "source", "fitness_goal", "activity_level", "preferred_time", "notes", "customer_id", "nutrition_history", "supplements_history", "age", "period") FROM stdin;
14cc1a2a-a286-4fe2-8867-695a2d631c8b	2026-01-14 17:10:04.420516+00	2026-01-14 17:10:04.420516+00	\N	\N	\N	\N	בטיפול	\N	175.00	75.00	24.49	\N	{}	{}	[]	[]	\N	ירידה במשקל	בינוני	\N	\N	4624153d-742f-4302-b9d5-97cf0a28361f	[]	[]	\N	\N
c9639786-0e31-4335-9129-a59b93bbd2cd	2026-01-19 12:39:46.116849+00	2026-01-19 12:39:46.116849+00	\N	\N	\N	female	\N	\N	\N	\N	\N	\N	{}	{}	[]	[]	\N	\N	\N	\N	\N	db970bcc-da78-496f-a5ef-3280956477f6	[]	[]	\N	\N
526b8367-86a8-4718-904f-6aee15c0fef9	2026-01-19 12:47:37.987445+00	2026-01-19 12:47:37.987445+00	\N	\N	\N	female	\N	\N	\N	\N	\N	\N	{}	{}	[]	[]	\N	\N	\N	\N	\N	9001bc53-b7a0-4663-b08b-a6bde9776164	[]	[]	\N	\N
\.


--
-- Data for Name: blood_tests; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."blood_tests" ("id", "lead_id", "file_url", "file_name", "upload_date", "created_at", "updated_at", "uploaded_by") FROM stdin;
\.


--
-- Data for Name: nutrition_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."nutrition_templates" ("id", "name", "description", "targets", "is_public", "created_at", "updated_at", "created_by", "manual_fields", "activity_entries", "manual_override") FROM stdin;
233a14b5-c28e-4d4e-afa0-7b8512d771ca	חיטוב	\N	{"fat": 70, "carbs": 140, "fiber": 32, "protein": 43, "calories": 12}	f	2026-01-18 12:00:17.728759+00	2026-01-19 12:50:25.111707+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	{"steps": null, "workouts": null, "supplements": null}	[{"id": "1", "mets": 3.5, "activityType": "הליכה איטית/יוגה/פילאטיס", "minutesPerWeek": 0}, {"id": "2", "mets": 5.5, "activityType": "אימון משקולות כבד", "minutesPerWeek": 0}, {"id": "3", "mets": 6, "activityType": "סטודיו/פונקציונלי/איר", "minutesPerWeek": 0}, {"id": "4", "mets": 7.5, "activityType": "ריצה קלה/ג'וגינג", "minutesPerWeek": 0}, {"id": "5", "mets": 10, "activityType": "ריצה מהירה/שחייה מהירה/ספינינג", "minutesPerWeek": 0}]	{"fat": false, "carbs": false, "fiber": false, "protein": true, "calories": true}
104bca26-6687-4569-b7c6-824bf195b2d5	חיטוב	\N	{"fat": 70, "carbs": 140, "fiber": 32, "protein": 140, "calories": 14}	f	2026-01-18 11:59:39.296191+00	2026-01-18 11:59:56.535641+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	{"steps": null, "workouts": null, "supplements": null}	[{"id": "1", "mets": 3.5, "activityType": "הליכה איטית/יוגה/פילאטיס", "minutesPerWeek": 0}, {"id": "2", "mets": 5.5, "activityType": "אימון משקולות כבד", "minutesPerWeek": 0}, {"id": "3", "mets": 6, "activityType": "סטודיו/פונקציונלי/איר", "minutesPerWeek": 0}, {"id": "4", "mets": 7.5, "activityType": "ריצה קלה/ג'וגינג", "minutesPerWeek": 0}, {"id": "5", "mets": 10, "activityType": "ריצה מהירה/שחייה מהירה/ספינינג", "minutesPerWeek": 0}]	{"fat": false, "carbs": false, "fiber": false, "protein": false, "calories": true}
\.


--
-- Data for Name: workout_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."workout_templates" ("id", "name", "description", "goal_tags", "routine_data", "is_public", "created_at", "updated_at", "created_by") FROM stdin;
5b88e2c1-7941-46ad-892a-364bfee3df16	חיטוב	\N	{}	{"weeklyWorkout": {"days": {"friday": {"day": "friday", "isActive": false, "exercises": []}, "monday": {"day": "monday", "isActive": false, "exercises": []}, "sunday": {"day": "sunday", "isActive": true, "exercises": [{"id": "1768734862754-0.22822698763905214", "name": "דדליפט", "reps": 10, "sets": 3, "image_url": "http://127.0.0.1:54321/storage/v1/object/sign/client-assets/workout-exercises/1768734862754-0.22822698763905214/images/1768734862754-0.22822698763905214-1768734875169.png?token=eyJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzLzE3Njg3MzQ4NjI3NTQtMC4yMjgyMjY5ODc2MzkwNTIxNC9pbWFnZXMvMTc2ODczNDg2Mjc1NC0wLjIyODIyNjk4NzYzOTA1MjE0LTE3Njg3MzQ4NzUxNjkucG5nIiwiaWF0IjoxNzY4NzM0ODc1LCJleHAiOjE4MDAyNzA4NzV9._RV9dkJFlKMI7cXLobVckWOPhBk4oqt--A47puBHtK0"}, {"id": "1768734864250-0.8748341684715508", "name": "חתירה", "reps": 10, "sets": 3}, {"id": "1768734868405-0.11639213204689502", "name": "פולאובר", "reps": 10, "sets": 3}]}, "tuesday": {"day": "tuesday", "isActive": false, "exercises": []}, "saturday": {"day": "saturday", "isActive": false, "exercises": []}, "thursday": {"day": "thursday", "isActive": true, "exercises": [{"id": "1768734880393-0.48635765851838886", "name": "דדליפט", "reps": 10, "sets": 3, "image_url": "http://127.0.0.1:54321/storage/v1/object/sign/client-assets/workout-exercises/1768734862754-0.22822698763905214/images/1768734862754-0.22822698763905214-1768734875169.png?token=eyJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzLzE3Njg3MzQ4NjI3NTQtMC4yMjgyMjY5ODc2MzkwNTIxNC9pbWFnZXMvMTc2ODczNDg2Mjc1NC0wLjIyODIyNjk4NzYzOTA1MjE0LTE3Njg3MzQ4NzUxNjkucG5nIiwiaWF0IjoxNzY4NzM0ODc1LCJleHAiOjE4MDAyNzA4NzV9._RV9dkJFlKMI7cXLobVckWOPhBk4oqt--A47puBHtK0"}, {"id": "1768734880393-0.5269333010930521", "name": "חתירה", "reps": 10, "sets": 3, "video_url": "https://www.youtube.com/watch?v=A_zY_lmPQDw&list=RDKzC9uEic4EE&index=3"}, {"id": "1768734880393-0.3626619161584793", "name": "פולאובר", "reps": 10, "sets": 3}]}, "wednesday": {"day": "wednesday", "isActive": false, "exercises": []}}, "startDate": "2026-01-18", "stepsGoal": 0, "description": "חיטוב", "generalGoals": ""}}	f	2026-01-18 11:16:25.884217+00	2026-01-18 11:16:25.884217+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
\.


--
-- Data for Name: budgets; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."budgets" ("id", "name", "description", "nutrition_template_id", "nutrition_targets", "steps_goal", "steps_instructions", "workout_template_id", "supplements", "eating_order", "eating_rules", "is_public", "created_at", "updated_at", "created_by") FROM stdin;
46d1d746-d3ab-4730-ae75-6eb828d22266	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:27:50.086074+00	2026-01-19 10:27:52.305199+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
a4098c6c-a56f-476f-83bb-7c092016568d	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:27:58.603642+00	2026-01-19 10:27:58.603642+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
b46c79fa-adc4-4ae3-af86-3f9130654d9a	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:28:02.559479+00	2026-01-19 10:28:02.559479+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
b67f61a4-d671-425b-8e95-749f53773603	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-18 11:56:02.027434+00	2026-01-18 12:00:35.888895+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
85553796-5bc7-4a74-a521-1182837e7566	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-18 12:00:59.241684+00	2026-01-18 12:01:10.13692+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
a1c427da-176d-44e8-b58a-62ba8c144055	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-18 12:05:18.86749+00	2026-01-18 12:05:21.865232+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
c489abbf-8987-42b9-acf2-0bdd9a268767	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 09:51:12.407197+00	2026-01-19 09:51:12.407197+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
bcdeb46f-e899-4803-bdc4-e9d65bca052d	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-18 12:28:39.538092+00	2026-01-19 10:17:50.99738+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
64fa998e-0051-48f2-8d40-756cac2e3100	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:17:53.192992+00	2026-01-19 10:17:55.032495+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
9c5bf5ce-69d5-42db-b9cf-b94dc3afe829	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:18:07.071621+00	2026-01-19 10:27:48.251166+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
0c45ab47-0507-4e97-87fe-2d37b978f9e1	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:28:05.747913+00	2026-01-19 10:28:05.747913+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
560591b7-eaac-45bd-9645-eed8047a57bf	חיטוב	\N	\N	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	\N	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:28:29.605759+00	2026-01-19 10:29:06.243135+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
b0614651-bb02-4f0b-90bb-2e2d20f2fbf1	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:32:29.712193+00	2026-01-19 10:32:35.113325+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
bfe11b1b-1d97-4b45-8013-3d5c311b9f92	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:32:45.612574+00	2026-01-19 10:32:45.612574+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
7cb5d959-19c8-44b9-98e6-1df374647d99	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:32:53.460307+00	2026-01-19 10:32:53.460307+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
971e3b07-ff45-4d7b-8eb4-c689c1545aa5	חיטוב	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "MG", "dosage": "2", "timing": "1"}]	\N	\N	f	2026-01-19 10:32:56.503362+00	2026-01-19 10:41:29.253675+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
27906a15-0d90-4a4b-9902-26849a819f79	אנדרי	\N	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	5000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "1", "dosage": "1", "timing": "1"}]	\N	\N	f	2026-01-19 12:40:03.357722+00	2026-01-19 12:40:34.687444+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
a582f66e-e23c-4be1-8986-b8bbee0d0d22	בדיקה 1	123	233a14b5-c28e-4d4e-afa0-7b8512d771ca	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	7000	\N	5b88e2c1-7941-46ad-892a-364bfee3df16	[{"name": "mg", "dosage": "1", "timing": "night"}]	\N	\N	f	2026-01-19 11:47:27.88658+00	2026-01-19 12:39:04.896027+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
\.


--
-- Data for Name: budget_assignments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."budget_assignments" ("id", "budget_id", "lead_id", "customer_id", "assigned_at", "assigned_by", "is_active", "notes", "created_at", "updated_at") FROM stdin;
05f5e925-d46e-4dec-9dc7-d472b79fffab	a582f66e-e23c-4be1-8986-b8bbee0d0d22	c9639786-0e31-4335-9129-a59b93bbd2cd	\N	2026-01-19 12:44:46.351067+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	t	\N	2026-01-19 12:44:46.351067+00	2026-01-19 12:44:46.351067+00
\.


--
-- Data for Name: check_in_field_configurations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."check_in_field_configurations" ("id", "customer_id", "configuration", "created_at", "updated_at", "created_by") FROM stdin;
3fd0c6d6-ebb8-43a9-8ab9-3811294af8e5	\N	{"fields": {"weight": {"unit": "ק״ג", "label": "משקל", "order": 0, "section": "body", "visible": false}, "fiberDaily": {"unit": "גרם", "label": "סיבים יומי", "order": 2, "section": "nutrition", "visible": true}, "sleepHours": {"unit": "שעות", "label": "כמה שעות ישנת", "order": 3, "section": "wellness", "visible": true}, "energyLevel": {"unit": "1-10", "label": "רמת האנרגיה שלך", "order": 2, "section": "wellness", "visible": true}, "hungerLevel": {"unit": "1-10", "label": "רמת הרעב שלך", "order": 1, "section": "wellness", "visible": true}, "stepsActual": {"unit": "צעדים", "label": "מס' צעדים יומי", "order": 0, "section": "activity", "visible": true}, "stressLevel": {"unit": "1-10", "label": "רמת הלחץ היומי", "order": 0, "section": "wellness", "visible": true}, "waterAmount": {"unit": "ליטר", "label": "כמה מים שתית", "order": 3, "section": "nutrition", "visible": true}, "cardioAmount": {"unit": "דקות", "label": "כמה אירובי עשית", "order": 2, "section": "activity", "visible": true}, "proteinDaily": {"unit": "גרם", "label": "חלבון יומי", "order": 1, "section": "nutrition", "visible": true}, "caloriesDaily": {"unit": "קק״ל", "label": "קלוריות יומי", "order": 0, "section": "nutrition", "visible": true}, "exercisesCount": {"unit": "תרגילים", "label": "כמה תרגילים עשית", "order": 1, "section": "activity", "visible": true}, "intervalsCount": {"unit": "אינטרוולים", "label": "כמה אינטרוולים", "order": 3, "section": "activity", "visible": true}, "armCircumference": {"unit": "ס״מ", "label": "היקף יד", "order": 4, "section": "body", "visible": true}, "neckCircumference": {"unit": "ס״מ", "label": "היקף צוואר", "order": 5, "section": "body", "visible": true}, "bellyCircumference": {"unit": "ס״מ", "label": "היקף בטן", "order": 1, "section": "body", "visible": true}, "thighCircumference": {"unit": "ס״מ", "label": "היקף ירכיים", "order": 3, "section": "body", "visible": true}, "waistCircumference": {"unit": "ס״מ", "label": "היקף מותן", "order": 2, "section": "body", "visible": true}}, "sections": {"body": {"label": "מדדי גוף", "visible": true}, "activity": {"label": "פעילות", "visible": true}, "wellness": {"label": "בריאות", "visible": true}, "nutrition": {"label": "תזונה", "visible": true}}}	2026-01-18 06:19:37.112449+00	2026-01-18 06:19:37.095+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
ce56b565-054f-441a-a428-03a979617afd	\N	{"fields": {"weight": {"unit": "ק״ג", "label": "משקל", "order": 0, "section": "body", "visible": true}, "fiberDaily": {"unit": "גרם", "label": "סיבים יומי", "order": 2, "section": "nutrition", "visible": true}, "sleepHours": {"unit": "שעות", "label": "כמה שעות ישנת", "order": 3, "section": "wellness", "visible": true}, "energyLevel": {"unit": "1-10", "label": "רמת האנרגיה שלך", "order": 2, "section": "wellness", "visible": true}, "hungerLevel": {"unit": "1-10", "label": "רמת הרעב שלך", "order": 1, "section": "wellness", "visible": true}, "stepsActual": {"unit": "צעדים", "label": "מס' צעדים יומי", "order": 0, "section": "activity", "visible": true}, "stressLevel": {"unit": "1-10", "label": "רמת הלחץ היומי", "order": 0, "section": "wellness", "visible": true}, "waterAmount": {"unit": "ליטר", "label": "כמה מים שתית", "order": 3, "section": "nutrition", "visible": true}, "cardioAmount": {"unit": "דקות", "label": "כמה אירובי עשית", "order": 2, "section": "activity", "visible": true}, "proteinDaily": {"unit": "גרם", "label": "חלבון יומי", "order": 1, "section": "nutrition", "visible": true}, "caloriesDaily": {"unit": "קק״ל", "label": "קלוריות יומי", "order": 0, "section": "nutrition", "visible": true}, "exercisesCount": {"unit": "תרגילים", "label": "כמה תרגילים עשית", "order": 1, "section": "activity", "visible": true}, "intervalsCount": {"unit": "אינטרוולים", "label": "כמה אינטרוולים", "order": 3, "section": "activity", "visible": true}, "armCircumference": {"unit": "ס״מ", "label": "היקף יד", "order": 4, "section": "body", "visible": true}, "neckCircumference": {"unit": "ס״מ", "label": "היקף צוואר", "order": 5, "section": "body", "visible": true}, "bellyCircumference": {"unit": "ס״מ", "label": "היקף בטן", "order": 1, "section": "body", "visible": true}, "thighCircumference": {"unit": "ס״מ", "label": "היקף ירכיים", "order": 3, "section": "body", "visible": true}, "waistCircumference": {"unit": "ס״מ", "label": "היקף מותן", "order": 2, "section": "body", "visible": true}}, "sections": {"body": {"label": "מדדי גוף", "visible": true}, "activity": {"label": "פעילות", "visible": true}, "wellness": {"label": "בריאות", "visible": true}, "nutrition": {"label": "תזונה", "visible": true}}}	2026-01-18 06:27:43.102238+00	2026-01-18 06:27:43.097+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
\.


--
-- Data for Name: customer_notes; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."customer_notes" ("id", "customer_id", "content", "created_at", "updated_at", "created_by", "lead_id", "attachment_url") FROM stdin;
\.


--
-- Data for Name: daily_check_ins; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."daily_check_ins" ("id", "customer_id", "lead_id", "check_in_date", "workout_completed", "steps_goal_met", "steps_actual", "nutrition_goal_met", "supplements_taken", "notes", "created_at", "updated_at", "created_by", "weight", "belly_circumference", "waist_circumference", "thigh_circumference", "arm_circumference", "neck_circumference", "exercises_count", "cardio_amount", "intervals_count", "calories_daily", "protein_daily", "fiber_daily", "water_amount", "stress_level", "hunger_level", "energy_level", "sleep_hours") FROM stdin;
091247b7-5275-4649-b8bb-a986ca95ee46	4624153d-742f-4302-b9d5-97cf0a28361f	14cc1a2a-a286-4fe2-8867-695a2d631c8b	2026-01-14	f	f	\N	f	[]	\N	2026-01-14 18:18:38.322444+00	2026-01-14 18:18:55.829147+00	\N	123.00	12	123	123	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N
b4934ca3-a374-4cb8-95ba-cc93ab099b33	4624153d-742f-4302-b9d5-97cf0a28361f	14cc1a2a-a286-4fe2-8867-695a2d631c8b	2026-01-13	f	f	\N	f	[]	\N	2026-01-14 18:18:38.322444+00	2026-01-14 18:18:55.829147+00	\N	123.00	123	123	123	123	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N
3021573a-6e1d-4575-a842-82e8d16d96aa	4624153d-742f-4302-b9d5-97cf0a28361f	14cc1a2a-a286-4fe2-8867-695a2d631c8b	2026-01-10	f	f	\N	f	[]	\N	2026-01-14 18:18:55.829147+00	2026-01-14 18:18:55.829147+00	\N	\N	123	\N	123	123	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N
2d6a9da9-b0c0-4198-ad8d-71c97ef204ec	4624153d-742f-4302-b9d5-97cf0a28361f	14cc1a2a-a286-4fe2-8867-695a2d631c8b	2026-01-08	f	f	\N	f	[]	\N	2026-01-14 18:18:55.829147+00	2026-01-14 18:18:55.829147+00	\N	\N	\N	\N	\N	\N	\N	231	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N
02b2b0db-dd8d-4d54-b139-f599dd504ae4	4624153d-742f-4302-b9d5-97cf0a28361f	14cc1a2a-a286-4fe2-8867-695a2d631c8b	2026-01-07	f	f	\N	f	[]	\N	2026-01-14 18:18:55.829147+00	2026-01-14 18:18:55.829147+00	\N	\N	123	\N	123	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N
d3b19f4e-1722-4a9b-956e-2d527f1521e3	4624153d-742f-4302-b9d5-97cf0a28361f	14cc1a2a-a286-4fe2-8867-695a2d631c8b	2026-01-05	f	f	123	f	[]	\N	2026-01-14 18:18:55.829147+00	2026-01-14 18:18:55.829147+00	\N	\N	\N	\N	\N	\N	1233	123	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N
0307879a-056c-41fb-b17b-46289b9e4313	4624153d-742f-4302-b9d5-97cf0a28361f	14cc1a2a-a286-4fe2-8867-695a2d631c8b	2026-01-03	f	f	\N	f	[]	\N	2026-01-14 18:18:55.829147+00	2026-01-14 18:18:55.829147+00	\N	\N	123	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N	\N
\.


--
-- Data for Name: fillout_submissions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."fillout_submissions" ("id", "fillout_submission_id", "fillout_form_id", "submission_type", "submission_data", "lead_id", "customer_id", "created_at", "updated_at", "created_by") FROM stdin;
a2aff37f-a8d1-4a9f-a165-23e0e49ce2fd	221ef6e6-2b6f-450a-b86e-7a1868f6d61e	jHNYYKDSGpus	שאלון התאמה	{"_formId": "jHNYYKDSGpus", "lead_id": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd", "formName": "שאלון התאמה", "_formName": "שאלון התאמה", "_submissionTime": "2026-01-21T10:30:00Z", "questions[0]_id": "q1", "questions[0]_name": "lead_id", "questions[0]_type": "ShortAnswer", "_rawWebhookPayload": {"formId": "jHNYYKDSGpus", "eventId": "evt_123456789", "lead_id": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd", "formName": "שאלון התאמה", "eventType": "formSubmission", "questions": [{"id": "q1", "name": "lead_id", "type": "ShortAnswer", "value": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd"}], "submissionId": "221ef6e6-2b6f-450a-b86e-7a1868f6d61e", "submissionTime": "2026-01-21T10:30:00Z"}, "questions[0]_value": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd"}	\N	\N	2026-01-18 13:22:20.102117+00	2026-01-19 12:04:33.741093+00	\N
00a378e4-85f8-4e96-aff7-95e807c35b27	meeting-test-1234567890	veY7bX8Uajus	budget_meeting	{"_formId": "veY7bX8Uajus", "lead_id": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd", "Form_name": "פגישת הכרות", "_formName": "פגישת הכרות", "eventEndTime": "2026-01-21T15:00:00.000Z", "meeting_type": "פגישת הכרות", "eventStartTime": "2026-01-21T14:00:00.000Z", "event_end_time": "2026-01-21T15:00:00.000Z", "_submissionTime": "2026-01-19T09:54:02.223Z", "event_start_time": "2026-01-21T14:00:00.000Z", "סוג פגישה": "פגישת הכרות", "_rawWebhookPayload": {"formId": "veY7bX8Uajus", "lead_id": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd", "Form_name": "פגישת הכרות", "submission_id": "meeting-test-1234567890", "event_end_time": "2026-01-21T15:00:00.000Z", "event_start_time": "2026-01-21T14:00:00.000Z"}, "פגישת הכרות": "תיאום תקציב"}	\N	\N	2026-01-19 09:46:24.567307+00	2026-01-19 12:04:33.741093+00	\N
adb2d123-4163-4ae5-aa93-48740d1a9804	test-submission-1234567890	23ggw4DEs7us	Test Form	{"name": "Test User", "phone": "972501234567", "_formId": "23ggw4DEs7us", "formName": "Test Form", "_formName": "Test Form", "_submissionTime": "2026-01-21T12:00:00.000Z", "questions[0]_id": "name", "questions[1]_id": "phone", "questions[0]_name": "name", "questions[0]_type": "ShortAnswer", "questions[1]_name": "phone", "questions[1]_type": "PhoneNumber", "_rawWebhookPayload": {"formId": "23ggw4DEs7us", "formName": "Test Form", "eventType": "formSubmission", "questions": [{"id": "name", "name": "name", "type": "ShortAnswer", "value": "Test User"}, {"id": "phone", "name": "phone", "type": "PhoneNumber", "value": "972501234567"}], "submissionId": "test-submission-1234567890", "lastUpdatedAt": "2026-01-21T12:00:00.000Z", "urlParameters": [{"name": "lead_id", "value": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd"}], "submissionTime": "2026-01-21T12:00:00.000Z"}, "questions[0]_value": "Test User", "questions[1]_value": "972501234567"}	\N	\N	2026-01-19 09:27:00.432499+00	2026-01-19 12:04:33.741093+00	\N
\.


--
-- Data for Name: green_api_settings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."green_api_settings" ("id", "id_instance", "api_token_instance", "created_at", "updated_at", "created_by", "updated_by") FROM stdin;
\.


--
-- Data for Name: internal_knowledge_base; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."internal_knowledge_base" ("id", "title", "description", "video_url", "tags", "duration", "additional_info", "created_at", "updated_at", "created_by") FROM stdin;
\.


--
-- Data for Name: user_invitations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."user_invitations" ("id", "email", "user_id", "customer_id", "lead_id", "token_hash", "token_salt", "status", "invited_by", "invited_at", "expires_at", "accepted_at", "created_at", "updated_at") FROM stdin;
\.


--
-- Data for Name: invitation_audit_log; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."invitation_audit_log" ("id", "invitation_id", "action", "performed_by", "ip_address", "user_agent", "metadata", "created_at") FROM stdin;
\.


--
-- Data for Name: meetings; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."meetings" ("id", "lead_id", "customer_id", "fillout_submission_id", "meeting_data", "created_at", "updated_at", "created_by") FROM stdin;
43952044-6701-4126-9465-ba1c61a2f174	\N	\N	meeting-test-1234567890	{"_formId": "veY7bX8Uajus", "lead_id": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd", "Form_name": "פגישת הכרות", "_formName": "פגישת הכרות", "eventEndTime": "2026-01-21T15:00:00.000Z", "meeting_type": "פגישת הכרות", "eventStartTime": "2026-01-21T14:00:00.000Z", "event_end_time": "2026-01-21T15:00:00.000Z", "_submissionTime": "2026-01-19T09:54:02.223Z", "event_start_time": "2026-01-21T14:00:00.000Z", "סוג פגישה": "פגישת הכרות", "_rawWebhookPayload": {"formId": "veY7bX8Uajus", "lead_id": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd", "Form_name": "פגישת הכרות", "submission_id": "meeting-test-1234567890", "event_end_time": "2026-01-21T15:00:00.000Z", "event_start_time": "2026-01-21T14:00:00.000Z"}, "פגישת הכרות": "תיאום תקציב"}	2026-01-19 09:46:24.577527+00	2026-01-19 12:04:33.741093+00	\N
17b98e75-ad70-4072-afe9-f85311737958	\N	\N	221ef6e6-2b6f-450a-b86e-7a1868f6d61e	{"_formId": "n5VwsjFk5ous", "lead_id": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd", "formName": "פגישת הכרות", "_formName": "פגישת הכרות", "event_end_time": "2026-01-21T10:30:00Z", "_submissionTime": "2026-01-21T10:30:00Z", "questions[0]_id": "q1", "event_start_time": "2026-01-21T10:30:00Z", "questions[0]_name": "lead_id", "questions[0]_type": "ShortAnswer", "סוג פגישה": "פגישת הכרות", "_rawWebhookPayload": {"formId": "n5VwsjFk5ous", "eventId": "evt_123456789", "formName": "פגישת הכרות", "eventType": "formSubmission", "questions": [{"id": "q1", "name": "lead_id", "type": "ShortAnswer", "value": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd"}], "submissionId": "221ef6e6-2b6f-450a-b86e-7a1868f6d61e", "event_end_time": "2026-01-21T10:30:00Z", "submissionTime": "2026-01-21T10:30:00Z", "event_start_time": "2026-01-21T10:30:00Z"}, "questions[0]_value": "7725cb2e-4ba1-4ac1-875d-654db8f35fbd", "פגישת הכרות": "פגישת הכרות"}	2026-01-18 13:22:20.114154+00	2026-01-19 12:04:33.741093+00	\N
\.


--
-- Data for Name: notifications; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."notifications" ("id", "user_id", "customer_id", "lead_id", "type", "title", "message", "action_url", "is_read", "created_at", "read_at", "metadata") FROM stdin;
\.


--
-- Data for Name: nutrition_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."nutrition_plans" ("id", "user_id", "lead_id", "template_id", "start_date", "description", "targets", "created_at", "updated_at", "created_by", "customer_id", "budget_id", "is_active", "deleted_at") FROM stdin;
d9e9da07-2919-4721-982b-eb98e39bbca6	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	c9639786-0e31-4335-9129-a59b93bbd2cd	233a14b5-c28e-4d4e-afa0-7b8512d771ca	2026-01-19	תוכנית תזונה מתקציב: בדיקה 1	{"fat": 70, "carbs": 140, "protein": 140, "calories": 12, "fiber_min": 32, "water_min": 2.5}	2026-01-19 12:44:46.452647+00	2026-01-19 12:44:46.452647+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	db970bcc-da78-496f-a5ef-3280956477f6	a582f66e-e23c-4be1-8986-b8bbee0d0d22	t	\N
\.


--
-- Data for Name: payments; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."payments" ("id", "customer_id", "lead_id", "product_name", "amount", "currency", "status", "stripe_payment_id", "transaction_id", "receipt_url", "notes", "created_at", "updated_at", "created_by") FROM stdin;
\.


--
-- Data for Name: saved_views; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."saved_views" ("id", "resource_key", "view_name", "filter_config", "is_default", "created_by", "created_at", "updated_at", "icon_name") FROM stdin;
05657f10-3586-4320-8826-33a42f55688c	nutrition_templates	כל תבניות התזונה	{"searchQuery": "", "selectedDate": null, "columnVisibility": {"name": true, "tags": false, "actions": true, "createdDate": true, "description": true, "connectedLeads": false}}	t	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	2026-01-14 17:10:31.041622+00	2026-01-14 17:10:31.041622+00	\N
97e75f44-0ae8-45e4-9d5e-1f0f8e1e9f2a	leads	כל הלידים	{"searchQuery": "", "selectedAge": null, "selectedDate": null, "selectedHeight": null, "selectedSource": null, "selectedStatus": null, "selectedWeight": null, "columnVisibility": {"id": true, "age": true, "name": true, "email": true, "notes": true, "phone": true, "height": true, "source": true, "status": true, "weight": true, "birthDate": true, "createdDate": true, "fitnessGoal": true, "activityLevel": true, "preferredTime": true}, "selectedFitnessGoal": null, "selectedActivityLevel": null, "selectedPreferredTime": null}	t	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	2026-01-14 17:10:31.050199+00	2026-01-14 17:10:31.050199+00	\N
c8c71831-4294-4b09-aa93-2d233fb6dffd	budgets	כל התקציבים	{"searchQuery": "", "selectedDate": null, "columnVisibility": {"name": true, "actions": true, "steps_goal": true, "createdDate": true, "description": true, "supplements": false, "eating_order": false, "eating_rules": false, "workout_template": true, "nutrition_targets": false, "nutrition_template": true, "steps_instructions": false}}	t	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	2026-01-14 17:10:31.052383+00	2026-01-14 17:10:31.052383+00	\N
31a32bfc-6b21-45b7-8106-690d5b3f202f	customers	כל הלקוחות	{"searchQuery": "", "selectedDate": null}	t	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	2026-01-14 17:10:31.125721+00	2026-01-14 17:10:31.125721+00	\N
4cd632fc-f898-4bdd-8f81-7f1ab2aa9765	meetings	כל הפגישות	{"searchQuery": "", "selectedDate": null, "columnVisibility": {"phone": true, "status": true, "created_at": true, "meeting_date": true, "meeting_time": true, "customer_name": true}}	t	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	2026-01-14 17:10:31.167857+00	2026-01-14 17:10:31.167857+00	\N
12b6b6e9-08f4-456a-bfcb-0e312285fb86	templates	כל התכניות	{"searchQuery": "", "selectedDate": null, "selectedTags": [], "columnVisibility": {"name": true, "tags": true, "actions": true, "createdDate": true, "description": true, "connectedLeads": true}, "selectedHasLeads": "all"}	t	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	2026-01-14 17:10:31.182293+00	2026-01-14 17:10:31.182293+00	\N
09406e9b-356c-4a9c-81e0-31e76fb0cd65	payments	כל התשלומים	{"searchQuery": "", "selectedDate": null}	t	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	2026-01-18 10:00:53.535578+00	2026-01-18 10:00:53.535578+00	\N
\.


--
-- Data for Name: steps_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."steps_plans" ("id", "user_id", "lead_id", "customer_id", "budget_id", "template_id", "start_date", "end_date", "description", "steps_goal", "steps_instructions", "is_active", "created_at", "updated_at", "created_by") FROM stdin;
2e78ce09-eb04-4544-89de-93c7bba7b6c3	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	a582f66e-e23c-4be1-8986-b8bbee0d0d22	\N	2026-01-19	\N	תוכנית צעדים מתקציב: בדיקה 1	7000	\N	t	2026-01-19 12:39:05.268364+00	2026-01-19 12:39:41.789139+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
79b474cd-78f8-4cfc-939c-481b4fbbca6c	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	\N	\N	2026-01-15	\N	תוכנית צעדים מתקציב: אנדרי	5000	\N	t	2026-01-15 16:21:50.518078+00	2026-01-18 10:57:39.439373+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
08c97bd0-eff6-4ed8-a235-2e4eadbb541d	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	b67f61a4-d671-425b-8e95-749f53773603	\N	2026-01-18	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	f	2026-01-18 12:00:36.186557+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
ba5f0b65-9dd2-40fa-b621-da9270a2f96a	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	85553796-5bc7-4a74-a521-1182837e7566	\N	2026-01-18	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	f	2026-01-18 12:01:10.388454+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
7a24befd-4694-44d7-9483-026030cf7a9b	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	a1c427da-176d-44e8-b58a-62ba8c144055	\N	2026-01-18	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	f	2026-01-18 13:39:02.962642+00	2026-01-19 12:04:23.164402+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
73036625-eb0f-43c1-bb09-a96710c50a19	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	bcdeb46f-e899-4803-bdc4-e9d65bca052d	\N	2026-01-19	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	f	2026-01-19 10:17:51.530717+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
bb916d4d-f738-4097-8dbb-0fa024927052	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	64fa998e-0051-48f2-8d40-756cac2e3100	\N	2026-01-19	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	f	2026-01-19 10:17:55.310176+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
72fd61c6-4d71-4283-b9a1-a29e2b4a91ed	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	c9639786-0e31-4335-9129-a59b93bbd2cd	db970bcc-da78-496f-a5ef-3280956477f6	a582f66e-e23c-4be1-8986-b8bbee0d0d22	\N	2026-01-19	\N	תוכנית צעדים מתקציב: בדיקה 1	7000	\N	t	2026-01-19 12:44:46.494686+00	2026-01-19 12:44:46.494686+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
0a871b79-0d9e-44ca-b932-cb557ff4d6f7	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	9c5bf5ce-69d5-42db-b9cf-b94dc3afe829	\N	2026-01-19	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	f	2026-01-19 10:27:48.780675+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
1da5ed5d-af95-45eb-9ad2-96fe0c48748e	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	46d1d746-d3ab-4730-ae75-6eb828d22266	\N	2026-01-19	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	f	2026-01-19 10:27:52.862544+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
aeeebf48-ae2c-40b0-b870-fdd488f3fb7e	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	560591b7-eaac-45bd-9645-eed8047a57bf	\N	2026-01-19	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	f	2026-01-19 10:29:06.811224+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
6e69643f-960e-414f-a3a0-df4aba85821c	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	b0614651-bb02-4f0b-90bb-2e2d20f2fbf1	\N	2026-01-19	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	f	2026-01-19 10:32:35.691767+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
5f60fa7a-6d1a-4528-ad7a-11e7342e845e	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	971e3b07-ff45-4d7b-8eb4-c689c1545aa5	\N	2026-01-19	\N	תוכנית צעדים מתקציב: חיטוב	5000	\N	t	2026-01-19 10:41:29.685846+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
0dd14b28-c130-4494-8fd4-b1d9d6de7254	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	a582f66e-e23c-4be1-8986-b8bbee0d0d22	\N	2026-01-19	\N	תוכנית צעדים מתקציב: בדיקה 1	7000	\N	t	2026-01-19 12:11:22.689624+00	2026-01-19 12:14:03.876206+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
\.


--
-- Data for Name: subscription_types; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."subscription_types" ("id", "name", "duration", "price", "created_at", "updated_at", "created_by", "currency", "duration_unit") FROM stdin;
e801ad20-a0a1-4901-8bf4-04fc7109abfd	אנדרי	1	231.00	2026-01-15 17:14:28.77304+00	2026-01-15 17:14:28.77304+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	ILS	months
532a3cca-0735-49ed-b4fa-09110f2c2afc	אנדרי	1	123.00	2026-01-16 12:57:39.952796+00	2026-01-16 12:57:39.952796+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	USD	months
9fcd3b75-bc6a-4176-857d-0356d2fcbfb5	nbuh	5	120.00	2026-01-18 07:50:09.540164+00	2026-01-18 07:50:13.88411+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	USD	months
9fe70ef7-ccfa-41c8-a74d-39bb4a6c9365	1	1	120.00	2026-01-18 07:51:25.330438+00	2026-01-18 07:51:25.330438+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	ILS	months
\.


--
-- Data for Name: supplement_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."supplement_plans" ("id", "user_id", "lead_id", "customer_id", "budget_id", "template_id", "start_date", "end_date", "description", "supplements", "is_active", "created_at", "updated_at", "created_by") FROM stdin;
7c1efe49-bc98-453e-9871-522248c68b84	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	c9639786-0e31-4335-9129-a59b93bbd2cd	db970bcc-da78-496f-a5ef-3280956477f6	a582f66e-e23c-4be1-8986-b8bbee0d0d22	\N	2026-01-19	\N	תוכנית תוספים מתקציב: בדיקה 1	[{"name": "mg", "dosage": "1", "timing": "night"}]	t	2026-01-19 12:44:46.533016+00	2026-01-19 12:44:46.533016+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
cafe3823-e4c9-480e-8130-95683f033752	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	b67f61a4-d671-425b-8e95-749f53773603	\N	2026-01-18	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	f	2026-01-18 12:00:36.219915+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
3eea57fc-4568-4e7e-bccd-99bd1ac4f1bf	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	85553796-5bc7-4a74-a521-1182837e7566	\N	2026-01-18	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	f	2026-01-18 12:01:10.42334+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
475ee762-cbe8-4a39-a260-2b040d0baae8	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	a1c427da-176d-44e8-b58a-62ba8c144055	\N	2026-01-18	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	f	2026-01-18 13:39:03.001491+00	2026-01-19 12:04:23.164402+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
f6f74480-30ac-4bef-ac52-b6163fa3ec22	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	bcdeb46f-e899-4803-bdc4-e9d65bca052d	\N	2026-01-19	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	f	2026-01-19 10:17:51.579158+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
f9b0822f-fa19-4793-9490-16d901bb2811	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	64fa998e-0051-48f2-8d40-756cac2e3100	\N	2026-01-19	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	f	2026-01-19 10:17:55.341628+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
2ee27691-1f06-4a0f-87cc-3542c7a641d3	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	9c5bf5ce-69d5-42db-b9cf-b94dc3afe829	\N	2026-01-19	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	f	2026-01-19 10:27:48.816674+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
14245e05-e93b-444c-b857-9d958fc135ff	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	46d1d746-d3ab-4730-ae75-6eb828d22266	\N	2026-01-19	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	f	2026-01-19 10:27:52.893278+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
04b291f4-6799-43c0-bca5-96e4f28490e4	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	560591b7-eaac-45bd-9645-eed8047a57bf	\N	2026-01-19	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	f	2026-01-19 10:29:06.8525+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
983ba4ef-268a-4b17-ae13-9ce3ecc6698a	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	b0614651-bb02-4f0b-90bb-2e2d20f2fbf1	\N	2026-01-19	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	f	2026-01-19 10:32:35.728003+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
93cfa05f-a129-4f8c-ab03-edc20b6a0600	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	971e3b07-ff45-4d7b-8eb4-c689c1545aa5	\N	2026-01-19	\N	תוכנית תוספים מתקציב: חיטוב	[{"name": "MG", "dosage": "2", "timing": "1"}]	t	2026-01-19 10:41:29.721336+00	2026-01-19 12:04:33.741093+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
34bf1534-b81e-4dc1-8af5-69d42a911122	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	a582f66e-e23c-4be1-8986-b8bbee0d0d22	\N	2026-01-19	\N	תוכנית תוספים מתקציב: בדיקה 1	[{"name": "mg", "dosage": "1", "timing": "night"}]	t	2026-01-19 12:39:05.312106+00	2026-01-19 12:39:41.789139+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
8d6f9311-8709-4ffe-8f28-da63f33ed1bf	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	\N	\N	a582f66e-e23c-4be1-8986-b8bbee0d0d22	\N	2026-01-19	\N	תוכנית תוספים מתקציב: בדיקה 1	[{"name": "mg", "dosage": "1", "timing": "night"}]	t	2026-01-19 12:11:22.720886+00	2026-01-19 12:14:03.876206+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432
\.


--
-- Data for Name: user_interface_preferences; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."user_interface_preferences" ("id", "user_id", "interface_key", "icon_name", "created_at", "updated_at") FROM stdin;
\.


--
-- Data for Name: weekly_reviews; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."weekly_reviews" ("id", "lead_id", "customer_id", "week_start_date", "week_end_date", "target_calories", "target_protein", "target_carbs", "target_fat", "target_fiber", "target_steps", "actual_calories_avg", "actual_protein_avg", "actual_carbs_avg", "actual_fat_avg", "actual_fiber_avg", "actual_calories_weekly_avg", "weekly_avg_weight", "waist_measurement", "trainer_summary", "action_plan", "updated_steps_goal", "updated_calories_target", "created_at", "updated_at", "created_by") FROM stdin;
\.


--
-- Data for Name: whatsapp_flow_templates; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."whatsapp_flow_templates" ("id", "user_id", "flow_key", "template_content", "created_at", "updated_at", "buttons", "media") FROM stdin;
329ab4b4-13c5-4bd2-9cbf-2f5d2f32c75d	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	intro_questionnaire	<p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">איזה כיף שקבענו שיחה! 🙌</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> מחכה כבר להכיר אותך ולשמוע ממך באופן אישי.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">כדי שנוכל לנצל את הזמן בצורה הכי מדויקת </span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> אשמח שתמלאי את השאלון הזה מראש.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">זה יעזור לי להבין מי את, איפה את נמצאת, ומה את באמת צריכה </span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> כדי שאוכל להקשיב, לשאול את השאלות הנכונות ולוודא שהליווי האישי אכן מתאים עבורך</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">📄 הנה הקישור לשאלון:</span></p><p>https://dietneta.fillout.com/1on1premiumform?lead_id={{lead_id}}</p>	2026-01-14 18:28:10.120503+00	2026-01-18 14:14:05.870151+00	[]	\N
47e7c12b-3c42-4d6a-946e-441208393e8b	ef249977-5333-4eb6-9abd-7045506dc1d3	weekly_review	📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}}\n\n🎯 יעדים:\nקלוריות: {{target_calories}} קק"ל\nחלבון: {{target_protein}} גרם\nסיבים: {{target_fiber}} גרם\nצעדים: {{target_steps}}\n\n📈 בפועל (ממוצע):\nקלוריות: {{actual_calories}} קק"ל\nמשקל ממוצע: {{actual_weight}} ק"ג	2026-01-19 11:35:11.684565+00	2026-01-19 11:35:11.684565+00	[]	\N
4cb0844c-001d-474c-a82d-4414358bdaa1	f8f9384c-064d-4fbf-8e8f-feec2ceaa023	weekly_review	📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}}\n\n🎯 יעדים:\nקלוריות: {{target_calories}} קק"ל\nחלבון: {{target_protein}} גרם\nסיבים: {{target_fiber}} גרם\nצעדים: {{target_steps}}\n\n📈 בפועל (ממוצע):\nקלוריות: {{actual_calories}} קק"ל\nמשקל ממוצע: {{actual_weight}} ק"ג	2026-01-19 11:35:11.684565+00	2026-01-19 11:35:11.684565+00	[]	\N
8b11a365-27c5-455a-ae5e-d2e4099f1c45	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	1	<p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">התחלת התהליך + כניסה לפורטל + הנחיות מעשיות</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">עכשיו אנחנו מתחילות - מוכנה לזה? 💥</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">עכשיו מתחיל החלק המעשי ואני צריכה אותך איתי, לגמרי.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">📌 השלב הבא:</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> היכנסי לפורטל התכנים (האתר שלי) וצפי בסרטון ההנחיות ל-3 הימים הראשונים.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">תמצאי שם גם:</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> ✅ הסברים ברורים מה עושים כל יום</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> ✅ הנחיות לתיעוד יומן אכילה</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> ✅ מדריך להורדת אפליקציית המעקב הקלורי</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> ✅ והכי חשוב - איך מכניסים מאכלים נכון כדי שתיעדי בצורה מדויקת</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">בסיום כל יום - שלחי לי בוואטסאפ צילומי מסך של יומן האכילה שלך.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> כל ההסברים מה בדיוק לשלוח נמצאים גם הם בפורטל.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">🗓️ חשוב שיהיו לנו לפחות 3 ימי אכילה מלאים</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> עדיף גיוון - יום בבית, יום בעבודה, אולי סופ"ש - כדי שנקבל תמונה כמה שיותר מייצגת של הרגלי האכילה שלך.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">💬 אחרי שהשלמת את שלושת הימים האלה, ניפגש לשיחת זום, ובה תקבלי ממני את התקציב התזונתי הראשוני שלך + הנחיות מדויקות להמשך.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">ברגע שאת מרגישה מוכנה ויש לך 3 ימים מלאים</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> הנה הלינק לתיאום השיחה שלנו אחרי ימי המעקב:</span></p><p>https://dietneta.fillout.com/t/veY7bX8Uajus?lead_id={{lead_id}}</p>	2026-01-14 18:28:33.592361+00	2026-01-18 09:02:50.584217+00	[]	\N
f26c32d8-aab6-4fc7-b4a1-63a291382579	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	123	<p>123</p>	2026-01-17 12:48:29.846573+00	2026-01-19 11:42:24.889813+00	[]	\N
377e0124-b389-4ab4-ae1b-076067a55745	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	trainee_user_credentials	<p>שלום {{name}}, חשבון המשתמש שלך נוצר בהצלחה! פרטי הכניסה: 📧 אימייל: {{email}} 🔑 סיסמה: {{password}} ניתן להתחבר בכתובת: {{login_url}} בברכה, צוות DietNeta</p>	2026-01-18 06:02:30.742216+00	2026-01-18 06:07:15.376025+00	[]	\N
ac4758e5-bcb4-414f-a24a-104794fd53c8	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	payment_request	<p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">אני שמחה שהחלטת להצטרף ואני ממש מתרגשת לקראת התהליך שלך</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">בשלב הראשון, כדי לשריין את מקומך בתהליך, הנה הלינק לתשלום המאובטח:</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> 🔗 </span><span style="color: rgb(15, 23, 42);">{{payment_link}} </span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">💡 מדובר בתשלום חודשי מתחדש ל-3 חודשים.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> בסיום התקופה זה יעבור אוטומטית למסלול חודשי גמיש במחיר נמוך יותר, וניתן לבטל בכל שלב לאחר ה 3 חודשים הראשונים עם הודעה מראש לפני תחילת חודש חדש.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">ברגע שהתשלום נקלט תישלח אלייך הודעה נוספת עם שאלון פתיחה + הנחיות להמשך.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">מחכה לצאת איתך לדרך 🙌</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> כל שאלה אני פה תמיד.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">נטע</span></p>	2026-01-18 06:02:30.643814+00	2026-01-18 06:02:30.643814+00	[]	\N
d4004bf9-17ad-4e35-831f-7e1bb22a8ce6	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	1234	<p>123</p>	2026-01-18 06:12:14.433509+00	2026-01-18 06:12:14.433509+00	[]	\N
cebd9e1e-10a3-4382-bdef-2fcb57d7276a	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	customer_journey_start	<p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">היי, תודה שפנית והתעניינת בתהליך הליווי האישי 🙏</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> אני מלווה נשים שמוכנות לקחת צעד משמעותי בדרך שלהן – תהליך עמוק, אישי, שמותאם בדיוק למי שאת ולמה שאת צריכה עכשיו.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">כדי להבין אם זה אכן הדבר המדויק עבורך - אני מזמינה אותך לתאם איתי שיחת היכרות.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));"> בשיחה נדבר בגובה העיניים, אכיר אותך לעומק, אספר איך הליווי מתנהל, ונוכל לבדוק יחד אם זה באמת תפור למידות שלך.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">חשוב לי לציין שהתהליך פתוח רק למספר מוגבל של נשים בכל שלב – אז אם את מרגישה שזה מדבר אלייך, כדאי לתפוס מקום לשיחה כשהיומן עדיין פתוח.</span></p><p><span style="color: rgba(255,255,255,var(--O42jJQ,1));">💬 לתיאום השיחה, לחצי כאן ובחרי זמן שנוח לך:</span></p><p>https://dietneta.fillout.com/-open-meeting?lead_id={{lead_id}}</p><p>למילוי טופס פרטים:</p><p>https://dietneta.fillout.com/priorcall?lead_id={{lead_id}}</p>	2026-01-14 18:25:47.300495+00	2026-01-18 07:05:43.213748+00	[]	\N
907d25ef-967c-49be-8fc7-42df33a6055a	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	budget	<p>שלום {{name}}, התקציב שלך מוכן! 📋 שם התקציב: {{budget_name}} לצפייה בתקציב המלא: {{budget_link}} בברכה, צוות DietNeta</p>	2026-01-18 14:18:17.735802+00	2026-01-19 11:25:39.15736+00	[]	\N
b725e43c-f4f2-4035-bae2-c83b6d004064	01c6e076-772c-442e-b5ab-bb71ff151aad	weekly_review	📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}}\n\n🎯 יעדים:\nקלוריות: {{target_calories}} קק"ל\nחלבון: {{target_protein}} גרם\nסיבים: {{target_fiber}} גרם\nצעדים: {{target_steps}}\n\n📈 בפועל (ממוצע):\nקלוריות: {{actual_calories}} קק"ל\nמשקל ממוצע: {{actual_weight}} ק"ג	2026-01-19 11:35:11.684565+00	2026-01-19 11:35:11.684565+00	[]	\N
6018ff9b-e7c3-47ef-8e7f-32275af34b29	9fb4cbfe-736d-40f7-832e-aa1d60ae7741	weekly_review	📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}}\n\n🎯 יעדים:\nקלוריות: {{target_calories}} קק"ל\nחלבון: {{target_protein}} גרם\nסיבים: {{target_fiber}} גרם\nצעדים: {{target_steps}}\n\n📈 בפועל (ממוצע):\nקלוריות: {{actual_calories}} קק"ל\nמשקל ממוצע: {{actual_weight}} ק"ג	2026-01-19 11:35:11.684565+00	2026-01-19 11:35:11.684565+00	[]	\N
fc751c4c-c565-4087-b954-3b7f4b33815a	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	weekly_review	<p>📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}} 🎯 יעדים: קלוריות: {{target_calories}} קק"ל חלבון: {{target_protein}} גרם סיבים: {{target_fiber}} גרם צעדים: {{target_steps}} 📈 בפועל (ממוצע): קלוריות: {{actual_calories}} קק"ל משקל ממוצע: {{actual_weight}} ק"ג</p>	2026-01-18 09:02:57.553111+00	2026-01-19 11:35:19.059028+00	[]	\N
\.


--
-- Data for Name: workout_plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY "public"."workout_plans" ("id", "user_id", "lead_id", "start_date", "description", "strength", "cardio", "intervals", "custom_attributes", "created_at", "updated_at", "created_by", "template_id", "is_active", "deleted_at", "customer_id", "budget_id") FROM stdin;
b1a850ba-cb4a-4ae8-ad11-5488daebf1f4	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	c9639786-0e31-4335-9129-a59b93bbd2cd	2026-01-19	תוכנית אימונים מתקציב: בדיקה 1	0	0	0	{"data": {"weeklyWorkout": {"days": {"friday": {"day": "friday", "isActive": false, "exercises": []}, "monday": {"day": "monday", "isActive": false, "exercises": []}, "sunday": {"day": "sunday", "isActive": true, "exercises": [{"id": "1768734862754-0.22822698763905214", "name": "דדליפט", "reps": 10, "sets": 3, "image_url": "http://127.0.0.1:54321/storage/v1/object/sign/client-assets/workout-exercises/1768734862754-0.22822698763905214/images/1768734862754-0.22822698763905214-1768734875169.png?token=eyJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzLzE3Njg3MzQ4NjI3NTQtMC4yMjgyMjY5ODc2MzkwNTIxNC9pbWFnZXMvMTc2ODczNDg2Mjc1NC0wLjIyODIyNjk4NzYzOTA1MjE0LTE3Njg3MzQ4NzUxNjkucG5nIiwiaWF0IjoxNzY4NzM0ODc1LCJleHAiOjE4MDAyNzA4NzV9._RV9dkJFlKMI7cXLobVckWOPhBk4oqt--A47puBHtK0"}, {"id": "1768734864250-0.8748341684715508", "name": "חתירה", "reps": 10, "sets": 3}, {"id": "1768734868405-0.11639213204689502", "name": "פולאובר", "reps": 10, "sets": 3}]}, "tuesday": {"day": "tuesday", "isActive": false, "exercises": []}, "saturday": {"day": "saturday", "isActive": false, "exercises": []}, "thursday": {"day": "thursday", "isActive": true, "exercises": [{"id": "1768734880393-0.48635765851838886", "name": "דדליפט", "reps": 10, "sets": 3, "image_url": "http://127.0.0.1:54321/storage/v1/object/sign/client-assets/workout-exercises/1768734862754-0.22822698763905214/images/1768734862754-0.22822698763905214-1768734875169.png?token=eyJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJjbGllbnQtYXNzZXRzL3dvcmtvdXQtZXhlcmNpc2VzLzE3Njg3MzQ4NjI3NTQtMC4yMjgyMjY5ODc2MzkwNTIxNC9pbWFnZXMvMTc2ODczNDg2Mjc1NC0wLjIyODIyNjk4NzYzOTA1MjE0LTE3Njg3MzQ4NzUxNjkucG5nIiwiaWF0IjoxNzY4NzM0ODc1LCJleHAiOjE4MDAyNzA4NzV9._RV9dkJFlKMI7cXLobVckWOPhBk4oqt--A47puBHtK0"}, {"id": "1768734880393-0.5269333010930521", "name": "חתירה", "reps": 10, "sets": 3, "video_url": "https://www.youtube.com/watch?v=A_zY_lmPQDw&list=RDKzC9uEic4EE&index=3"}, {"id": "1768734880393-0.3626619161584793", "name": "פולאובר", "reps": 10, "sets": 3}]}, "wednesday": {"day": "wednesday", "isActive": false, "exercises": []}}, "startDate": "2026-01-18", "stepsGoal": 0, "description": "חיטוב", "generalGoals": ""}}, "schema": []}	2026-01-19 12:44:46.418134+00	2026-01-19 12:44:46.418134+00	a918e7d3-b8e2-4b73-847c-fd0fa04d5432	5b88e2c1-7941-46ad-892a-364bfee3df16	t	\N	db970bcc-da78-496f-a5ef-3280956477f6	a582f66e-e23c-4be1-8986-b8bbee0d0d22
\.


--
-- Data for Name: schema_migrations; Type: TABLE DATA; Schema: supabase_migrations; Owner: postgres
--

COPY "supabase_migrations"."schema_migrations" ("version", "statements", "name") FROM stdin;
20240001	{"-- =====================================================\n-- Initial Schema Migration for Diet Neta CRM\n-- Created: 2024-01-01\n-- Description: Production-ready schema with RLS, JSONB flexibility, and auto-triggers\n-- =====================================================\n\n-- =====================================================\n-- 1. EXTENSIONS\n-- =====================================================\n\n-- Enable UUID generation\nCREATE EXTENSION IF NOT EXISTS \\"uuid-ossp\\"","-- =====================================================\n-- 2. UTILITY FUNCTIONS\n-- =====================================================\n\n-- Generic function to automatically update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = NOW();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- =====================================================\n-- 3. TABLE: profiles\n-- =====================================================\n\n-- Profiles table links to auth.users and manages user roles\nCREATE TABLE IF NOT EXISTS profiles (\n    id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,\n    email TEXT NOT NULL,\n    full_name TEXT,\n    role TEXT NOT NULL DEFAULT 'user' CHECK (role IN ('admin', 'user')),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL\n)","-- Index for faster role lookups\nCREATE INDEX IF NOT EXISTS idx_profiles_role ON profiles(role)","CREATE INDEX IF NOT EXISTS idx_profiles_email ON profiles(email)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_profiles_updated_at\n    BEFORE UPDATE ON profiles\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- Function to automatically create profile when user signs up\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER AS $$\nBEGIN\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (\n        NEW.id,\n        NEW.email,\n        COALESCE(NEW.raw_user_meta_data->>'full_name', ''),\n        COALESCE(NEW.raw_user_meta_data->>'role', 'user')\n    );\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Trigger to call handle_new_user when a new user is created in auth.users\nCREATE TRIGGER on_auth_user_created\n    AFTER INSERT ON auth.users\n    FOR EACH ROW\n    EXECUTE FUNCTION public.handle_new_user()","-- =====================================================\n-- 4. TABLE: leads (The Central Entity)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS leads (\n    -- Meta Data\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    assigned_to UUID REFERENCES profiles(id) ON DELETE SET NULL,\n    \n    -- Personal Info\n    full_name TEXT NOT NULL,\n    phone TEXT UNIQUE NOT NULL,\n    email TEXT,\n    city TEXT,\n    birth_date DATE,\n    gender TEXT CHECK (gender IN ('male', 'female', 'other')) DEFAULT NULL,\n    \n    -- Status Management\n    status_main TEXT,\n    status_sub TEXT,\n    \n    -- Physical Metrics\n    height DECIMAL(5, 2), -- in cm\n    weight DECIMAL(5, 2), -- in kg\n    bmi DECIMAL(4, 2), -- calculated or stored\n    \n    -- Business/Subscription\n    join_date TIMESTAMP WITH TIME ZONE,\n    subscription_data JSONB DEFAULT '{}'::jsonb,\n    \n    -- Dynamic Data Columns (JSONB for flexibility)\n    daily_protocol JSONB DEFAULT '{}'::jsonb,\n    -- Structure: { \\"stepsGoal\\": 8000, \\"workoutGoal\\": 3, \\"supplements\\": [\\"Omega 3\\", \\"Magnesium\\"] }\n    \n    workout_history JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ \\"name\\": \\"Plan A\\", \\"startDate\\": \\"2024-01-01\\", \\"validUntil\\": \\"2024-04-01\\", \n    --              \\"duration\\": \\"3 months\\", \\"description\\": \\"...\\", \n    --              \\"strengthCount\\": 3, \\"cardioCount\\": 1, \\"intervalsCount\\": 1 }]\n    \n    steps_history JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ \\"weekNumber\\": 1, \\"startDate\\": \\"2024-01-01\\", \\"endDate\\": \\"2024-01-07\\", \\"target\\": 7000 }]\n    \n    -- Additional fields from the application\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_leads_assigned_to ON leads(assigned_to)","CREATE INDEX IF NOT EXISTS idx_leads_status_main ON leads(status_main)","CREATE INDEX IF NOT EXISTS idx_leads_status_sub ON leads(status_sub)","CREATE INDEX IF NOT EXISTS idx_leads_phone ON leads(phone)","CREATE INDEX IF NOT EXISTS idx_leads_email ON leads(email)","CREATE INDEX IF NOT EXISTS idx_leads_created_at ON leads(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_leads_join_date ON leads(join_date)","-- GIN indexes for JSONB columns (enables fast queries on JSONB data)\nCREATE INDEX IF NOT EXISTS idx_leads_daily_protocol ON leads USING GIN (daily_protocol)","CREATE INDEX IF NOT EXISTS idx_leads_workout_history ON leads USING GIN (workout_history)","CREATE INDEX IF NOT EXISTS idx_leads_steps_history ON leads USING GIN (steps_history)","CREATE INDEX IF NOT EXISTS idx_leads_subscription_data ON leads USING GIN (subscription_data)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_leads_updated_at\n    BEFORE UPDATE ON leads\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- 5. ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on profiles table\nALTER TABLE profiles ENABLE ROW LEVEL SECURITY","-- Enable RLS on leads table\nALTER TABLE leads ENABLE ROW LEVEL SECURITY","-- =====================================================\n-- 6. RLS POLICIES: profiles\n-- =====================================================\n\n-- Policy: Users can read their own profile\nCREATE POLICY \\"Users can read own profile\\"\n    ON profiles FOR SELECT\n    USING (auth.uid() = id)","-- Policy: Users can update their own profile\nCREATE POLICY \\"Users can update own profile\\"\n    ON profiles FOR UPDATE\n    USING (auth.uid() = id)\n    WITH CHECK (auth.uid() = id)","-- Policy: Admins have full access to profiles\nCREATE POLICY \\"Admins have full access to profiles\\"\n    ON profiles FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- 7. RLS POLICIES: leads\n-- =====================================================\n\n-- Policy: Authenticated users can read all leads (adjust based on business logic)\nCREATE POLICY \\"Authenticated users can read leads\\"\n    ON leads FOR SELECT\n    USING (auth.role() = 'authenticated')","-- Policy: Authenticated users can insert leads\nCREATE POLICY \\"Authenticated users can insert leads\\"\n    ON leads FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","-- Policy: Users can update leads assigned to them\nCREATE POLICY \\"Users can update assigned leads\\"\n    ON leads FOR UPDATE\n    USING (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Admins have full access to leads\nCREATE POLICY \\"Admins have full access to leads\\"\n    ON leads FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Users can delete leads (only admins or assigned users)\nCREATE POLICY \\"Users can delete assigned leads\\"\n    ON leads FOR DELETE\n    USING (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- 8. HELPER FUNCTIONS (Optional but useful)\n-- =====================================================\n\n-- Function to calculate BMI (can be used in triggers or application layer)\nCREATE OR REPLACE FUNCTION calculate_bmi(height_cm DECIMAL, weight_kg DECIMAL)\nRETURNS DECIMAL AS $$\nBEGIN\n    IF height_cm IS NULL OR weight_kg IS NULL OR height_cm <= 0 OR weight_kg <= 0 THEN\n        RETURN NULL;\n    END IF;\n    -- BMI = weight (kg) / (height (m))^2\n    RETURN ROUND((weight_kg / POWER(height_cm / 100.0, 2))::DECIMAL, 2);\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE","-- Optional: Trigger to auto-calculate BMI when height or weight changes\nCREATE OR REPLACE FUNCTION update_lead_bmi()\nRETURNS TRIGGER AS $$\nBEGIN\n    IF NEW.height IS NOT NULL AND NEW.weight IS NOT NULL THEN\n        NEW.bmi = calculate_bmi(NEW.height, NEW.weight);\n    END IF;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","CREATE TRIGGER calculate_bmi_trigger\n    BEFORE INSERT OR UPDATE OF height, weight ON leads\n    FOR EACH ROW\n    EXECUTE FUNCTION update_lead_bmi()","-- =====================================================\n-- 9. COMMENTS (Documentation)\n-- =====================================================\n\nCOMMENT ON TABLE profiles IS 'User profiles linked to auth.users, manages roles and user metadata'","COMMENT ON TABLE leads IS 'Central entity for CRM leads/trainees with flexible JSONB columns for dynamic data'","COMMENT ON COLUMN leads.daily_protocol IS 'JSONB: { \\"stepsGoal\\": number, \\"workoutGoal\\": number, \\"supplements\\": string[] }'","COMMENT ON COLUMN leads.workout_history IS 'JSONB: Array of workout program objects with dates, splits, and descriptions'","COMMENT ON COLUMN leads.steps_history IS 'JSONB: Array of step tracking objects with week numbers, dates, and targets'","COMMENT ON COLUMN leads.subscription_data IS 'JSONB: Flexible subscription information including pricing and package details'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	initial_schema
20240102000000	{"-- =====================================================\n-- Ensure Leads Table Exists\n-- Created: 2024-01-02\n-- Description: This migration ensures the leads table exists\n--              and is properly accessible in the public schema\n-- =====================================================\n\n-- Ensure we're working in the public schema\nSET search_path TO public","-- Drop table if it exists (only if you want to recreate it)\n-- Uncomment the next line if you need to recreate the table\n-- DROP TABLE IF EXISTS leads CASCADE;\n\n-- Create the leads table if it doesn't exist\nCREATE TABLE IF NOT EXISTS public.leads (\n    -- Meta Data\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    assigned_to UUID REFERENCES public.profiles(id) ON DELETE SET NULL,\n    \n    -- Personal Info\n    full_name TEXT NOT NULL,\n    phone TEXT UNIQUE NOT NULL,\n    email TEXT,\n    city TEXT,\n    birth_date DATE,\n    gender TEXT CHECK (gender IN ('male', 'female', 'other')) DEFAULT NULL,\n    \n    -- Status Management\n    status_main TEXT,\n    status_sub TEXT,\n    \n    -- Physical Metrics\n    height DECIMAL(5, 2), -- in cm\n    weight DECIMAL(5, 2), -- in kg\n    bmi DECIMAL(4, 2), -- calculated or stored\n    \n    -- Business/Subscription\n    join_date TIMESTAMP WITH TIME ZONE,\n    subscription_data JSONB DEFAULT '{}'::jsonb,\n    \n    -- Dynamic Data Columns (JSONB for flexibility)\n    daily_protocol JSONB DEFAULT '{}'::jsonb,\n    workout_history JSONB DEFAULT '[]'::jsonb,\n    steps_history JSONB DEFAULT '[]'::jsonb,\n    \n    -- Additional fields from the application\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT\n)","-- Ensure the table is in the public schema\nALTER TABLE IF EXISTS public.leads SET SCHEMA public","-- Grant necessary permissions\nGRANT ALL ON public.leads TO authenticated","GRANT ALL ON public.leads TO anon","GRANT ALL ON public.leads TO service_role","-- Create indexes if they don't exist\nCREATE INDEX IF NOT EXISTS idx_leads_assigned_to ON public.leads(assigned_to)","CREATE INDEX IF NOT EXISTS idx_leads_status_main ON public.leads(status_main)","CREATE INDEX IF NOT EXISTS idx_leads_status_sub ON public.leads(status_sub)","CREATE INDEX IF NOT EXISTS idx_leads_phone ON public.leads(phone)","CREATE INDEX IF NOT EXISTS idx_leads_email ON public.leads(email)","CREATE INDEX IF NOT EXISTS idx_leads_created_at ON public.leads(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_leads_join_date ON public.leads(join_date)","-- GIN indexes for JSONB columns\nCREATE INDEX IF NOT EXISTS idx_leads_daily_protocol ON public.leads USING GIN (daily_protocol)","CREATE INDEX IF NOT EXISTS idx_leads_workout_history ON public.leads USING GIN (workout_history)","CREATE INDEX IF NOT EXISTS idx_leads_steps_history ON public.leads USING GIN (steps_history)","CREATE INDEX IF NOT EXISTS idx_leads_subscription_data ON public.leads USING GIN (subscription_data)","-- Ensure the update_updated_at_column function exists\nCREATE OR REPLACE FUNCTION public.update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = NOW();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger for auto-updating updated_at\nDROP TRIGGER IF EXISTS update_leads_updated_at ON public.leads","CREATE TRIGGER update_leads_updated_at\n    BEFORE UPDATE ON public.leads\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Ensure BMI calculation function exists\nCREATE OR REPLACE FUNCTION public.calculate_bmi(height_cm DECIMAL, weight_kg DECIMAL)\nRETURNS DECIMAL AS $$\nBEGIN\n    IF height_cm IS NULL OR weight_kg IS NULL OR height_cm <= 0 OR weight_kg <= 0 THEN\n        RETURN NULL;\n    END IF;\n    RETURN ROUND((weight_kg / POWER(height_cm / 100.0, 2))::DECIMAL, 2);\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE","-- Create trigger for auto-calculating BMI\nDROP TRIGGER IF EXISTS calculate_bmi_trigger ON public.leads","CREATE OR REPLACE FUNCTION public.update_lead_bmi()\nRETURNS TRIGGER AS $$\nBEGIN\n    IF NEW.height IS NOT NULL AND NEW.weight IS NOT NULL THEN\n        NEW.bmi = public.calculate_bmi(NEW.height, NEW.weight);\n    END IF;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","CREATE TRIGGER calculate_bmi_trigger\n    BEFORE INSERT OR UPDATE OF height, weight ON public.leads\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_lead_bmi()","-- Enable RLS\nALTER TABLE public.leads ENABLE ROW LEVEL SECURITY","-- Drop existing policies if they exist (to avoid conflicts)\nDROP POLICY IF EXISTS \\"Authenticated users can read leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Authenticated users can insert leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Users can update assigned leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Admins have full access to leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Users can delete assigned leads\\" ON public.leads","-- Recreate RLS policies\nCREATE POLICY \\"Authenticated users can read leads\\"\n    ON public.leads FOR SELECT\n    USING (auth.role() = 'authenticated')","CREATE POLICY \\"Authenticated users can insert leads\\"\n    ON public.leads FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","CREATE POLICY \\"Users can update assigned leads\\"\n    ON public.leads FOR UPDATE\n    USING (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","CREATE POLICY \\"Admins have full access to leads\\"\n    ON public.leads FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","CREATE POLICY \\"Users can delete assigned leads\\"\n    ON public.leads FOR DELETE\n    USING (\n        assigned_to = auth.uid() OR\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Add comment for documentation\nCOMMENT ON TABLE public.leads IS 'Central entity for CRM leads/trainees with flexible JSONB columns for dynamic data'"}	ensure_leads_table
20240102000001	{"-- =====================================================\n-- Fix RLS Infinite Recursion Issue\n-- Created: 2024-01-02\n-- Description: Fixes the infinite recursion in profiles RLS policies\n-- =====================================================\n\n-- Drop the problematic admin policy on profiles that causes recursion\nDROP POLICY IF EXISTS \\"Admins have full access to profiles\\" ON public.profiles","-- Create a security definer function to check admin role (bypasses RLS)\nCREATE OR REPLACE FUNCTION public.is_admin(user_id UUID)\nRETURNS BOOLEAN AS $$\nBEGIN\n    RETURN EXISTS (\n        SELECT 1 FROM public.profiles\n        WHERE id = user_id AND role = 'admin'\n    );\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Recreate the admin policy using the function (avoids recursion)\nCREATE POLICY \\"Admins have full access to profiles\\"\n    ON public.profiles FOR ALL\n    USING (public.is_admin(auth.uid()))\n    WITH CHECK (public.is_admin(auth.uid()))","-- Also fix the leads policies to use the function\nDROP POLICY IF EXISTS \\"Users can update assigned leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Admins have full access to leads\\" ON public.leads","DROP POLICY IF EXISTS \\"Users can delete assigned leads\\" ON public.leads","-- Recreate leads policies using the function\nCREATE POLICY \\"Users can update assigned leads\\"\n    ON public.leads FOR UPDATE\n    USING (\n        assigned_to = auth.uid() OR\n        public.is_admin(auth.uid())\n    )\n    WITH CHECK (\n        assigned_to = auth.uid() OR\n        public.is_admin(auth.uid())\n    )","CREATE POLICY \\"Admins have full access to leads\\"\n    ON public.leads FOR ALL\n    USING (public.is_admin(auth.uid()))\n    WITH CHECK (public.is_admin(auth.uid()))","CREATE POLICY \\"Users can delete assigned leads\\"\n    ON public.leads FOR DELETE\n    USING (\n        assigned_to = auth.uid() OR\n        public.is_admin(auth.uid())\n    )","-- For local development, also allow anonymous access to insert leads\n-- (Remove this in production or adjust based on your needs)\nDROP POLICY IF EXISTS \\"Allow anonymous insert leads\\" ON public.leads","CREATE POLICY \\"Allow anonymous insert leads\\"\n    ON public.leads FOR INSERT\n    TO anon\n    WITH CHECK (true)","DROP POLICY IF EXISTS \\"Allow anonymous read leads\\" ON public.leads","CREATE POLICY \\"Allow anonymous read leads\\"\n    ON public.leads FOR SELECT\n    TO anon\n    USING (true)"}	fix_rls_recursion
20240102000002	{"-- =====================================================\n-- Workout Plans Migration\n-- Created: 2024-01-02\n-- Description: User workout plans with dynamic custom attributes\n-- =====================================================\n\n-- =====================================================\n-- TABLE: workout_plans\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS workout_plans (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    description TEXT,\n    \n    -- Metric columns\n    strength INTEGER DEFAULT 0,\n    cardio INTEGER DEFAULT 0,\n    intervals INTEGER DEFAULT 0,\n    \n    -- Dynamic custom attributes (JSONB)\n    -- Structure: { \\"schema\\": [{ \\"fieldName\\": \\"string\\", \\"fieldType\\": \\"text|number|date|boolean\\" }], \\"data\\": { \\"fieldName\\": \\"value\\" } }\n    custom_attributes JSONB DEFAULT '{\\"schema\\": [], \\"data\\": {}}'::jsonb,\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_workout_plans_user_id ON workout_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_workout_plans_lead_id ON workout_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_workout_plans_start_date ON workout_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_workout_plans_created_at ON workout_plans(created_at DESC)","-- GIN index for JSONB column (enables fast queries on JSONB data)\nCREATE INDEX IF NOT EXISTS idx_workout_plans_custom_attributes ON workout_plans USING GIN (custom_attributes)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_workout_plans_updated_at\n    BEFORE UPDATE ON workout_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on workout_plans table\nALTER TABLE workout_plans ENABLE ROW LEVEL SECURITY","-- Policy: Users can read their own workout plans\nCREATE POLICY \\"Users can read own workout plans\\"\n    ON workout_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own workout plans\nCREATE POLICY \\"Users can insert own workout plans\\"\n    ON workout_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own workout plans\nCREATE POLICY \\"Users can update own workout plans\\"\n    ON workout_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own workout plans\nCREATE POLICY \\"Users can delete own workout plans\\"\n    ON workout_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to workout plans\nCREATE POLICY \\"Admins have full access to workout plans\\"\n    ON workout_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )"}	workout_plans
20240102000003	{"-- =====================================================\n-- Remove Weight and RPE from Workout Plans\n-- Created: 2024-01-02\n-- Description: Clean up JSONB data to remove weight and rpe fields from exercises\n-- =====================================================\n\n-- Update existing workout plans to remove weight and rpe from exercises in JSONB\n-- This function processes each workout plan and removes weight/rpe from all exercises\nDO $$\nDECLARE\n    plan_record RECORD;\n    updated_days JSONB;\n    day_key TEXT;\n    day_data JSONB;\n    updated_exercises JSONB;\n    exercise JSONB;\nBEGIN\n    FOR plan_record IN \n        SELECT id, custom_attributes \n        FROM workout_plans \n        WHERE custom_attributes->'data'->'weeklyWorkout'->'days' IS NOT NULL\n    LOOP\n        updated_days := '{}'::JSONB;\n        \n        -- Process each day\n        FOR day_key, day_data IN \n            SELECT * FROM jsonb_each(plan_record.custom_attributes->'data'->'weeklyWorkout'->'days')\n        LOOP\n            -- Process exercises in this day - remove weight and rpe fields\n            updated_exercises := (\n                SELECT jsonb_agg(exercise - 'weight' - 'rpe')\n                FROM jsonb_array_elements(day_data->'exercises') AS exercise\n            );\n            \n            -- Update day with cleaned exercises\n            day_data := jsonb_set(day_data, '{exercises}', COALESCE(updated_exercises, '[]'::JSONB));\n            updated_days := updated_days || jsonb_build_object(day_key, day_data);\n        END LOOP;\n        \n        -- Update the workout plan\n        UPDATE workout_plans\n        SET custom_attributes = jsonb_set(\n            plan_record.custom_attributes,\n            '{data,weeklyWorkout,days}',\n            updated_days\n        )\n        WHERE id = plan_record.id;\n    END LOOP;\nEND $$","-- Note: Since weight and rpe are stored in JSONB (not as table columns),\n-- we only need to clean the JSONB data. No columns need to be dropped from the table."}	remove_weight_rpe_from_workout_plans
20240102000004	{"-- =====================================================\n-- Saved Views Migration\n-- Created: 2024-01-02\n-- Description: Table for storing user-defined saved views/filters for resources\n-- =====================================================\n\n-- =====================================================\n-- TABLE: saved_views\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS saved_views (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    resource_key TEXT NOT NULL CHECK (resource_key IN ('leads', 'workouts', 'customers')),\n    view_name TEXT NOT NULL,\n    filter_config JSONB NOT NULL DEFAULT '{}'::JSONB,\n    is_default BOOLEAN NOT NULL DEFAULT FALSE,\n    created_by UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Ensure unique view names per resource per user\n    CONSTRAINT unique_view_name_per_resource_user \n        UNIQUE (resource_key, created_by, view_name)\n)","-- Indexes for faster queries\nCREATE INDEX IF NOT EXISTS idx_saved_views_resource_key ON saved_views(resource_key)","CREATE INDEX IF NOT EXISTS idx_saved_views_created_by ON saved_views(created_by)","CREATE INDEX IF NOT EXISTS idx_saved_views_resource_user ON saved_views(resource_key, created_by)","CREATE INDEX IF NOT EXISTS idx_saved_views_default ON saved_views(resource_key, created_by, is_default) WHERE is_default = TRUE","-- Unique partial index to ensure only one default view per resource per user\nCREATE UNIQUE INDEX IF NOT EXISTS idx_saved_views_unique_default \n    ON saved_views(resource_key, created_by) \n    WHERE is_default = TRUE","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_saved_views_updated_at\n    BEFORE UPDATE ON saved_views\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS)\n-- =====================================================\n\n-- Enable RLS\nALTER TABLE saved_views ENABLE ROW LEVEL SECURITY","-- Policy: Users can view their own saved views\nCREATE POLICY \\"Users can view their own saved views\\"\n    ON saved_views\n    FOR SELECT\n    USING (auth.uid() = created_by)","-- Policy: Users can insert their own saved views\nCREATE POLICY \\"Users can insert their own saved views\\"\n    ON saved_views\n    FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own saved views\nCREATE POLICY \\"Users can update their own saved views\\"\n    ON saved_views\n    FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own saved views\nCREATE POLICY \\"Users can delete their own saved views\\"\n    ON saved_views\n    FOR DELETE\n    USING (auth.uid() = created_by)","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE saved_views IS 'User-defined saved views/filters for different resources (leads, workouts, etc.)'","COMMENT ON COLUMN saved_views.resource_key IS 'The resource type this view applies to (e.g., \\"leads\\", \\"workouts\\")'","COMMENT ON COLUMN saved_views.view_name IS 'User-friendly name for the saved view'","COMMENT ON COLUMN saved_views.filter_config IS 'JSONB object storing the complete filter/sort state for this view'","COMMENT ON COLUMN saved_views.is_default IS 'Whether this is the default view for the resource (only one default per resource per user)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	saved_views
20240102000005	{"-- =====================================================\n-- Workout Templates Migration\n-- Created: 2024-01-02\n-- Description: Reusable workout templates that can be imported by users\n-- =====================================================\n\n-- =====================================================\n-- TABLE: workout_templates\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS workout_templates (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    name TEXT NOT NULL,\n    description TEXT,\n    goal_tags TEXT[] DEFAULT '{}',\n    routine_data JSONB NOT NULL DEFAULT '{}'::jsonb,\n    is_public BOOLEAN NOT NULL DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_workout_templates_created_by ON workout_templates(created_by)","CREATE INDEX IF NOT EXISTS idx_workout_templates_is_public ON workout_templates(is_public)","CREATE INDEX IF NOT EXISTS idx_workout_templates_goal_tags ON workout_templates USING GIN (goal_tags)","CREATE INDEX IF NOT EXISTS idx_workout_templates_routine_data ON workout_templates USING GIN (routine_data)","CREATE INDEX IF NOT EXISTS idx_workout_templates_created_at ON workout_templates(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_workout_templates_updated_at\n    BEFORE UPDATE ON workout_templates\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on workout_templates table\nALTER TABLE workout_templates ENABLE ROW LEVEL SECURITY","-- Policy: Users can view public templates or their own templates\nCREATE POLICY \\"Users can view public or own templates\\"\n    ON workout_templates FOR SELECT\n    USING (\n        is_public = TRUE OR \n        created_by = auth.uid()\n    )","-- Policy: Users can insert their own templates\nCREATE POLICY \\"Users can insert own templates\\"\n    ON workout_templates FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own templates\nCREATE POLICY \\"Users can update own templates\\"\n    ON workout_templates FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own templates\nCREATE POLICY \\"Users can delete own templates\\"\n    ON workout_templates FOR DELETE\n    USING (auth.uid() = created_by)","-- Policy: Admins have full access to templates\nCREATE POLICY \\"Admins have full access to templates\\"\n    ON workout_templates FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE workout_templates IS 'Reusable workout templates that can be imported by users to create workout plans'","COMMENT ON COLUMN workout_templates.name IS 'Template name'","COMMENT ON COLUMN workout_templates.description IS 'Template description'","COMMENT ON COLUMN workout_templates.goal_tags IS 'Array of goal tags (e.g., [\\"חיטוב\\", \\"כוח\\", \\"סיבולת\\"])'","COMMENT ON COLUMN workout_templates.routine_data IS 'JSONB containing the workout routine data (matches workout_plans.custom_attributes.data.weeklyWorkout schema)'","COMMENT ON COLUMN workout_templates.is_public IS 'Whether the template is publicly visible to all users'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	workout_templates
20240102000006	{"-- =====================================================\n-- Add 'templates' to saved_views resource_key constraint\n-- Created: 2024-01-02\n-- Description: Allow saved views for workout templates\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'templates'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_templates_to_saved_views
20260120000000	{"-- =====================================================\n-- Placeholder Migration\n-- Created: 2026-01-20\n-- Description: Placeholder migration to match remote database state\n--              This migration exists on remote but was not in local directory\n-- =====================================================\n\n-- This is a placeholder migration file.\n-- The remote database has this migration applied, but the file was missing locally.\n-- No changes needed - this file exists only to maintain migration history consistency."}	placeholder
20240102000007	{"-- =====================================================\n-- Add template_id to workout_plans\n-- Created: 2024-01-02\n-- Description: Track which template a workout plan was created from (reference only, snapshot pattern maintained)\n-- =====================================================\n\n-- Add template_id column (nullable, just for reference)\nALTER TABLE workout_plans\nADD COLUMN IF NOT EXISTS template_id UUID REFERENCES workout_templates(id) ON DELETE SET NULL","-- Create index for performance\nCREATE INDEX IF NOT EXISTS idx_workout_plans_template_id ON workout_plans(template_id)","-- Note: This is a reference only. The actual routine_data is stored in workout_plans.custom_attributes\n-- When a template is changed, existing workout_plans remain independent (snapshot pattern)"}	add_template_id_to_workout_plans
20240102000008	{"-- =====================================================\n-- Nutrition Templates Migration\n-- Created: 2024-01-02\n-- Description: Reusable nutrition templates for macro-nutrient planning and calculation\n-- =====================================================\n\n-- =====================================================\n-- TABLE: nutrition_templates\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS nutrition_templates (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    name TEXT NOT NULL,\n    description TEXT,\n    targets JSONB NOT NULL DEFAULT '{}'::jsonb,\n    -- Structure: { calories: number, protein: number, carbs: number, fat: number, fiber: number }\n    is_public BOOLEAN NOT NULL DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_nutrition_templates_created_by ON nutrition_templates(created_by)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_is_public ON nutrition_templates(is_public)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_targets ON nutrition_templates USING GIN (targets)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_created_at ON nutrition_templates(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_nutrition_templates_updated_at\n    BEFORE UPDATE ON nutrition_templates\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on nutrition_templates table\nALTER TABLE nutrition_templates ENABLE ROW LEVEL SECURITY","-- Policy: Users can view public templates or their own templates\nCREATE POLICY \\"Users can view public or own nutrition templates\\"\n    ON nutrition_templates FOR SELECT\n    USING (\n        is_public = TRUE OR \n        created_by = auth.uid()\n    )","-- Policy: Users can insert their own templates\nCREATE POLICY \\"Users can insert own nutrition templates\\"\n    ON nutrition_templates FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own templates\nCREATE POLICY \\"Users can update own nutrition templates\\"\n    ON nutrition_templates FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own templates\nCREATE POLICY \\"Users can delete own nutrition templates\\"\n    ON nutrition_templates FOR DELETE\n    USING (auth.uid() = created_by)","-- Policy: Admins have full access to templates\nCREATE POLICY \\"Admins have full access to nutrition templates\\"\n    ON nutrition_templates FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE nutrition_templates IS 'Reusable nutrition templates for macro-nutrient planning and calculation'","COMMENT ON COLUMN nutrition_templates.name IS 'Template name'","COMMENT ON COLUMN nutrition_templates.description IS 'Template description'","COMMENT ON COLUMN nutrition_templates.targets IS 'JSONB containing macro targets: { calories: number, protein: number, carbs: number, fat: number, fiber: number }'","COMMENT ON COLUMN nutrition_templates.is_public IS 'Whether the template is publicly visible to all users'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	nutrition_templates
20240102000009	{"-- =====================================================\n-- Nutrition Plans Migration\n-- Created: 2024-01-02\n-- Description: User nutrition plans linked to leads (snapshot pattern - independent from templates)\n-- =====================================================\n\n-- =====================================================\n-- TABLE: nutrition_plans\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS nutrition_plans (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    template_id UUID REFERENCES nutrition_templates(id) ON DELETE SET NULL,\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    description TEXT,\n    \n    -- Nutrition targets (snapshot - independent from template)\n    -- Structure: { calories: number, protein: number, carbs: number, fat: number, fiber: number }\n    targets JSONB NOT NULL DEFAULT '{}'::jsonb,\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_nutrition_plans_user_id ON nutrition_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_lead_id ON nutrition_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_template_id ON nutrition_plans(template_id)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_start_date ON nutrition_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_created_at ON nutrition_plans(created_at DESC)","-- GIN index for JSONB column (enables fast queries on JSONB data)\nCREATE INDEX IF NOT EXISTS idx_nutrition_plans_targets ON nutrition_plans USING GIN (targets)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_nutrition_plans_updated_at\n    BEFORE UPDATE ON nutrition_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on nutrition_plans table\nALTER TABLE nutrition_plans ENABLE ROW LEVEL SECURITY","-- Policy: Users can read their own nutrition plans\nCREATE POLICY \\"Users can read own nutrition plans\\"\n    ON nutrition_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own nutrition plans\nCREATE POLICY \\"Users can insert own nutrition plans\\"\n    ON nutrition_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own nutrition plans\nCREATE POLICY \\"Users can update own nutrition plans\\"\n    ON nutrition_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own nutrition plans\nCREATE POLICY \\"Users can delete own nutrition plans\\"\n    ON nutrition_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to nutrition plans\nCREATE POLICY \\"Admins have full access to nutrition plans\\"\n    ON nutrition_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE nutrition_plans IS 'User nutrition plans linked to leads (snapshot pattern - independent from templates)'","COMMENT ON COLUMN nutrition_plans.lead_id IS 'Reference to the lead this plan is assigned to'","COMMENT ON COLUMN nutrition_plans.template_id IS 'Reference to the template this plan was created from (for tracking only, changes to template do not affect this plan)'","COMMENT ON COLUMN nutrition_plans.targets IS 'JSONB containing macro targets: { calories: number, protein: number, carbs: number, fat: number, fiber: number } - This is a snapshot, independent from the template'","COMMENT ON COLUMN nutrition_plans.start_date IS 'Date when the nutrition plan starts'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	nutrition_plans
20240102000010	{"-- =====================================================\n-- Add 'nutrition_templates' to saved_views resource_key constraint\n-- Created: 2024-01-02\n-- Description: Allow saved views for nutrition templates\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'nutrition_templates'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_nutrition_templates_to_saved_views
20240102000011	{"-- =====================================================\n-- Add history tracking to workout_plans\n-- Created: 2024-01-02\n-- Description: Add is_active and deleted_at fields to track workout plan history\n-- =====================================================\n\n-- Add is_active and deleted_at columns\nALTER TABLE workout_plans\n  ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true NOT NULL,\n  ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMP WITH TIME ZONE","-- Create index for active plans\nCREATE INDEX IF NOT EXISTS idx_workout_plans_is_active ON workout_plans(is_active) WHERE is_active = true","CREATE INDEX IF NOT EXISTS idx_workout_plans_deleted_at ON workout_plans(deleted_at) WHERE deleted_at IS NOT NULL","-- Update existing plans to be active\nUPDATE workout_plans SET is_active = true WHERE is_active IS NULL","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_workout_plan_history
20240102000012	{"-- =====================================================\n-- Normalize Database: Separate Customers from Leads\n-- Created: 2024-01-02\n-- Description: Create customers table and normalize leads table\n--              Decouple Identity (Customer) from Opportunity (Lead)\n--              Unique identifier: phone number\n-- =====================================================\n\n-- =====================================================\n-- STEP A: Create customers table\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS public.customers (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    full_name TEXT NOT NULL,\n    phone TEXT NOT NULL UNIQUE,\n    email TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL\n)","-- Create indexes for customers\nCREATE INDEX IF NOT EXISTS idx_customers_phone ON public.customers(phone)","CREATE INDEX IF NOT EXISTS idx_customers_email ON public.customers(email)","CREATE INDEX IF NOT EXISTS idx_customers_created_at ON public.customers(created_at DESC)","-- Create trigger for auto-updating updated_at\nCREATE TRIGGER update_customers_updated_at\n    BEFORE UPDATE ON public.customers\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS on customers table\nALTER TABLE public.customers ENABLE ROW LEVEL SECURITY","-- RLS Policies for customers\nDROP POLICY IF EXISTS \\"Authenticated users can read customers\\" ON public.customers","DROP POLICY IF EXISTS \\"Authenticated users can insert customers\\" ON public.customers","DROP POLICY IF EXISTS \\"Authenticated users can update customers\\" ON public.customers","DROP POLICY IF EXISTS \\"Admins have full access to customers\\" ON public.customers","CREATE POLICY \\"Authenticated users can read customers\\"\n    ON public.customers FOR SELECT\n    USING (auth.role() = 'authenticated')","CREATE POLICY \\"Authenticated users can insert customers\\"\n    ON public.customers FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","CREATE POLICY \\"Authenticated users can update customers\\"\n    ON public.customers FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","CREATE POLICY \\"Admins have full access to customers\\"\n    ON public.customers FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- STEP B: Data Migration (Backfill Script)\n-- =====================================================\n-- Since we're resetting the DB, this step is not needed\n-- But we'll include it for completeness in case of future migrations\n\n-- This would migrate existing data if needed:\n-- INSERT INTO public.customers (full_name, phone, email, created_at, updated_at)\n-- SELECT DISTINCT ON (phone)\n--     full_name,\n--     phone,\n--     email,\n--     MIN(created_at) as created_at,\n--     NOW() as updated_at\n-- FROM public.leads\n-- WHERE phone IS NOT NULL\n-- GROUP BY phone, full_name, email\n-- ON CONFLICT (phone) DO NOTHING;\n\n-- =====================================================\n-- STEP C: Update leads table\n-- =====================================================\n\n-- Add customer_id column\nALTER TABLE public.leads\n    ADD COLUMN IF NOT EXISTS customer_id UUID REFERENCES public.customers(id) ON DELETE CASCADE","-- Create index for customer_id\nCREATE INDEX IF NOT EXISTS idx_leads_customer_id ON public.leads(customer_id)","-- Link existing data (if any exists)\n-- UPDATE public.leads l\n-- SET customer_id = c.id\n-- FROM public.customers c\n-- WHERE l.phone = c.phone;\n\n-- Make customer_id NOT NULL (since we're resetting, we can set it immediately)\nALTER TABLE public.leads ALTER COLUMN customer_id SET NOT NULL","-- Remove old columns (since we're resetting, we can drop them immediately)\nALTER TABLE public.leads\n    DROP COLUMN IF EXISTS full_name,\n    DROP COLUMN IF EXISTS phone,\n    DROP COLUMN IF EXISTS email","-- Drop old indexes that are no longer needed\nDROP INDEX IF EXISTS public.idx_leads_phone","DROP INDEX IF EXISTS public.idx_leads_email","-- Add comment for documentation\nCOMMENT ON TABLE public.customers IS 'Customer identity table - unique by phone number'","COMMENT ON COLUMN public.customers.phone IS 'Unique identifier for customer identity'","COMMENT ON TABLE public.leads IS 'Lead/Opportunity table - linked to customers via customer_id'","COMMENT ON COLUMN public.leads.customer_id IS 'Foreign key to customers table - one customer can have many leads'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	normalize_customers_leads
20260120000001	{"-- =====================================================\n-- Add age column alongside birth_date\n-- Created: 2026-01-16\n-- Description: Adds age column to leads table while keeping birth_date\n--              Age can be manually entered, independent of birth_date\n-- =====================================================\n\nSET search_path TO public","-- Step 1: Add age column to leads table (keep birth_date)\nALTER TABLE public.leads \nADD COLUMN IF NOT EXISTS age INTEGER","-- Step 2: Create index for age column\nCREATE INDEX IF NOT EXISTS idx_leads_age ON public.leads(age) WHERE age IS NOT NULL","-- Step 3: Drop and recreate the view to include both birth_date and age\nDROP VIEW IF EXISTS public.v_leads_with_customer CASCADE","CREATE VIEW public.v_leads_with_customer AS\nSELECT \n    l.id,\n    l.created_at,\n    l.updated_at,\n    l.assigned_to,\n    l.customer_id,\n    l.city,\n    l.birth_date,\n    l.age,\n    l.gender,\n    l.status_main,\n    l.status_sub,\n    l.height,\n    l.weight,\n    l.bmi,\n    l.join_date,\n    l.subscription_data,\n    l.daily_protocol,\n    l.workout_history,\n    l.steps_history,\n    l.source,\n    l.fitness_goal,\n    l.activity_level,\n    l.preferred_time,\n    l.notes,\n    -- Customer data (joined)\n    c.full_name as customer_name,\n    c.phone as customer_phone,\n    c.email as customer_email,\n    -- Calculated fields (PostgreSQL does the math)\n    TO_CHAR(l.created_at, 'YYYY-MM-DD') as created_date_formatted,\n    TO_CHAR(l.birth_date, 'YYYY-MM-DD') as birth_date_formatted,\n    -- Extract JSONB fields (PostgreSQL parses JSON)\n    (l.daily_protocol->>'stepsGoal')::INTEGER as daily_steps_goal,\n    (l.daily_protocol->>'workoutGoal')::INTEGER as weekly_workouts_goal,\n    (l.daily_protocol->>'supplements')::JSONB as daily_supplements,\n    (l.subscription_data->>'months')::INTEGER as subscription_months,\n    (l.subscription_data->>'initialPrice')::DECIMAL as subscription_initial_price,\n    (l.subscription_data->>'renewalPrice')::DECIMAL as subscription_renewal_price\nFROM public.leads l\nLEFT JOIN public.customers c ON l.customer_id = c.id","-- Step 7: Update get_filtered_leads function to use age instead of birth_date\nCREATE OR REPLACE FUNCTION public.get_filtered_leads(\n    p_limit_count INTEGER DEFAULT 100,\n    p_offset_count INTEGER DEFAULT 0,\n    p_search_query TEXT DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_date TEXT DEFAULT NULL\n)\nRETURNS TABLE (\n    id UUID,\n    created_at TIMESTAMP WITH TIME ZONE,\n    updated_at TIMESTAMP WITH TIME ZONE,\n    assigned_to UUID,\n    customer_id UUID,\n    city TEXT,\n    birth_date DATE,\n    age INTEGER,\n    gender TEXT,\n    status_main TEXT,\n    status_sub TEXT,\n    height DECIMAL,\n    weight DECIMAL,\n    bmi DECIMAL,\n    join_date TIMESTAMP WITH TIME ZONE,\n    subscription_data JSONB,\n    daily_protocol JSONB,\n    workout_history JSONB,\n    steps_history JSONB,\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT,\n    customer_name TEXT,\n    customer_phone TEXT,\n    customer_email TEXT,\n    created_date_formatted TEXT,\n    birth_date_formatted TEXT,\n    daily_steps_goal INTEGER,\n    weekly_workouts_goal INTEGER,\n    daily_supplements JSONB,\n    subscription_months INTEGER,\n    subscription_initial_price DECIMAL,\n    subscription_renewal_price DECIMAL\n)\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nBEGIN\n    RETURN QUERY\n    SELECT \n        v.id,\n        v.created_at,\n        v.updated_at,\n        v.assigned_to,\n        v.customer_id,\n        v.city,\n        v.birth_date,\n        v.age,\n        v.gender,\n        v.status_main,\n        v.status_sub,\n        v.height,\n        v.weight,\n        v.bmi,\n        v.join_date,\n        v.subscription_data,\n        v.daily_protocol,\n        v.workout_history,\n        v.steps_history,\n        v.source,\n        v.fitness_goal,\n        v.activity_level,\n        v.preferred_time,\n        v.notes,\n        v.customer_name,\n        v.customer_phone,\n        v.customer_email,\n        v.created_date_formatted,\n        v.birth_date_formatted,\n        v.daily_steps_goal,\n        v.weekly_workouts_goal,\n        v.daily_supplements,\n        v.subscription_months,\n        v.subscription_initial_price,\n        v.subscription_renewal_price\n    FROM public.v_leads_with_customer v\n    WHERE \n        -- Search query (name, phone, email)\n        (p_search_query IS NULL OR \n         v.customer_name ILIKE '%' || p_search_query || '%' OR\n         v.customer_phone ILIKE '%' || p_search_query || '%' OR\n         v.customer_email ILIKE '%' || p_search_query || '%')\n        -- Status filter\n        AND (p_status_main IS NULL OR v.status_main = p_status_main)\n        AND (p_status_sub IS NULL OR v.status_sub = p_status_sub)\n        -- Source filter\n        AND (p_source IS NULL OR v.source = p_source)\n        -- Fitness goal filter\n        AND (p_fitness_goal IS NULL OR v.fitness_goal = p_fitness_goal)\n        -- Activity level filter\n        AND (p_activity_level IS NULL OR v.activity_level = p_activity_level)\n        -- Preferred time filter\n        AND (p_preferred_time IS NULL OR v.preferred_time = p_preferred_time)\n        -- Age filter (now using age column directly)\n        AND (p_age IS NULL OR v.age::TEXT = p_age)\n        -- Height filter\n        AND (p_height IS NULL OR v.height::TEXT = p_height)\n        -- Weight filter\n        AND (p_weight IS NULL OR v.weight::TEXT = p_weight)\n        -- Date filter (created_at date)\n        AND (p_date IS NULL OR v.created_date_formatted = p_date)\n    ORDER BY v.created_at DESC\n    LIMIT p_limit_count\n    OFFSET p_offset_count;\nEND;\n$$","-- Step 8: Update get_lead_filter_options function to use age column\nCREATE OR REPLACE FUNCTION public.get_lead_filter_options()\nRETURNS JSONB\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    result JSONB;\nBEGIN\n    SELECT jsonb_build_object(\n        'statuses', ARRAY(SELECT DISTINCT status_main FROM public.leads WHERE status_main IS NOT NULL ORDER BY status_main)::TEXT[],\n        'sources', ARRAY(SELECT DISTINCT source FROM public.leads WHERE source IS NOT NULL ORDER BY source)::TEXT[],\n        'fitness_goals', ARRAY(SELECT DISTINCT fitness_goal FROM public.leads WHERE fitness_goal IS NOT NULL ORDER BY fitness_goal)::TEXT[],\n        'activity_levels', ARRAY(SELECT DISTINCT activity_level FROM public.leads WHERE activity_level IS NOT NULL ORDER BY activity_level)::TEXT[],\n        'preferred_times', ARRAY(SELECT DISTINCT preferred_time FROM public.leads WHERE preferred_time IS NOT NULL ORDER BY preferred_time)::TEXT[],\n        'ages', ARRAY(SELECT DISTINCT age::TEXT \n                      FROM public.leads \n                      WHERE age IS NOT NULL \n                      ORDER BY age)::TEXT[],\n        'heights', ARRAY(SELECT DISTINCT height::TEXT \n                         FROM public.leads \n                         WHERE height IS NOT NULL \n                         ORDER BY height)::TEXT[],\n        'weights', ARRAY(SELECT DISTINCT weight::TEXT \n                         FROM public.leads \n                         WHERE weight IS NOT NULL \n                         ORDER BY weight)::TEXT[]\n    ) INTO result;\n    \n    RETURN result;\nEND;\n$$","-- Step 9: Update comments\nCOMMENT ON COLUMN public.leads.age IS 'Age in years. Can be manually entered, independent of birth_date.'","COMMENT ON COLUMN public.leads.birth_date IS 'Birth date. Can be entered manually, independent of age.'","COMMENT ON VIEW public.v_leads_with_customer IS 'Pre-joined view of leads with customer data and calculated fields. Includes both birth_date and age columns.'","COMMENT ON FUNCTION public.get_filtered_leads(INTEGER, INTEGER, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) IS 'RPC function for complex lead filtering. All filtering happens in PostgreSQL. Includes both birth_date and age columns.'","COMMENT ON FUNCTION public.get_lead_filter_options() IS 'Returns distinct filter values for dropdowns. Uses age column directly.'"}	replace_birth_date_with_age
20240102000013	{"-- =====================================================\n-- Add 'customers' to saved_views resource_key constraint\n-- Created: 2024-01-02\n-- Description: Allow saved views for customers\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'customers'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_customers_to_saved_views
20240102000014	{"-- =====================================================\n-- Service Data Relocation: Move Coaching Data from Leads to Customers\n-- Created: 2024-01-02\n-- Description: Relocate ownership of coaching data (Workouts, Nutrition, Steps, Measurements)\n--              from Lead entity to Customer entity\n-- Philosophy: Lead = Sales/CRM, Customer = Service/Coaching\n-- =====================================================\n\n-- =====================================================\n-- STEP A: Add customer_id to service tables\n-- =====================================================\n\n-- Add customer_id to workout_plans\nALTER TABLE workout_plans\n    ADD COLUMN IF NOT EXISTS customer_id UUID REFERENCES customers(id) ON DELETE CASCADE","-- Add customer_id to nutrition_plans\nALTER TABLE nutrition_plans\n    ADD COLUMN IF NOT EXISTS customer_id UUID REFERENCES customers(id) ON DELETE CASCADE","-- Create indexes for customer_id\nCREATE INDEX IF NOT EXISTS idx_workout_plans_customer_id ON workout_plans(customer_id)","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_customer_id ON nutrition_plans(customer_id)","-- =====================================================\n-- STEP B: Migrate existing data (populate customer_id from lead_id)\n-- =====================================================\n\n-- Migrate workout_plans: Set customer_id based on lead_id -> customer_id relationship\nUPDATE workout_plans wp\nSET customer_id = l.customer_id\nFROM leads l\nWHERE wp.lead_id = l.id\n  AND wp.customer_id IS NULL\n  AND l.customer_id IS NOT NULL","-- Migrate nutrition_plans: Set customer_id based on lead_id -> customer_id relationship\nUPDATE nutrition_plans np\nSET customer_id = l.customer_id\nFROM leads l\nWHERE np.lead_id = l.id\n  AND np.customer_id IS NULL\n  AND l.customer_id IS NOT NULL","-- Handle orphaned records: Delete workout_plans that can't be linked to a customer\n-- (These are orphaned records with invalid lead_id references or NULL lead_id)\n-- First, try to find customer_id through any remaining valid lead relationships\nUPDATE workout_plans wp\nSET customer_id = l.customer_id\nFROM leads l\nWHERE wp.lead_id = l.id\n  AND wp.customer_id IS NULL\n  AND l.customer_id IS NOT NULL","-- Now delete any remaining orphaned records that still have NULL customer_id\nDELETE FROM workout_plans\nWHERE customer_id IS NULL","-- Handle orphaned records: Delete nutrition_plans that can't be linked to a customer\n-- First, try to find customer_id through any remaining valid lead relationships\nUPDATE nutrition_plans np\nSET customer_id = l.customer_id\nFROM leads l\nWHERE np.lead_id = l.id\n  AND np.customer_id IS NULL\n  AND l.customer_id IS NOT NULL","-- Now delete any remaining orphaned records that still have NULL customer_id\nDELETE FROM nutrition_plans\nWHERE customer_id IS NULL","-- =====================================================\n-- STEP C: Add coaching data columns to customers table\n-- =====================================================\n\n-- Add coaching data JSONB columns to customers\nALTER TABLE customers\n    ADD COLUMN IF NOT EXISTS daily_protocol JSONB DEFAULT '{}'::jsonb,\n    ADD COLUMN IF NOT EXISTS workout_history JSONB DEFAULT '[]'::jsonb,\n    ADD COLUMN IF NOT EXISTS steps_history JSONB DEFAULT '[]'::jsonb","-- Create GIN indexes for JSONB columns\nCREATE INDEX IF NOT EXISTS idx_customers_daily_protocol ON customers USING GIN (daily_protocol)","CREATE INDEX IF NOT EXISTS idx_customers_workout_history ON customers USING GIN (workout_history)","CREATE INDEX IF NOT EXISTS idx_customers_steps_history ON customers USING GIN (steps_history)","-- =====================================================\n-- STEP D: Migrate coaching data from leads to customers\n-- =====================================================\n\n-- Migrate daily_protocol, workout_history, steps_history from leads to customers\n-- Aggregate data per customer (in case of multiple leads per customer)\n-- Note: Since we're resetting the DB, this migration step is mainly for documentation\n-- In a production migration, you would aggregate data from all leads per customer\nUPDATE customers c\nSET \n    daily_protocol = COALESCE(\n        (SELECT daily_protocol FROM leads WHERE customer_id = c.id AND daily_protocol IS NOT NULL AND daily_protocol != '{}'::jsonb ORDER BY created_at DESC LIMIT 1),\n        '{}'::jsonb\n    ),\n    workout_history = COALESCE(\n        (\n            SELECT jsonb_agg(DISTINCT elem)\n            FROM leads l, jsonb_array_elements(l.workout_history) elem\n            WHERE l.customer_id = c.id \n              AND l.workout_history IS NOT NULL \n              AND l.workout_history != '[]'::jsonb\n        ),\n        '[]'::jsonb\n    ),\n    steps_history = COALESCE(\n        (\n            SELECT jsonb_agg(DISTINCT elem)\n            FROM leads l, jsonb_array_elements(l.steps_history) elem\n            WHERE l.customer_id = c.id \n              AND l.steps_history IS NOT NULL \n              AND l.steps_history != '[]'::jsonb\n        ),\n        '[]'::jsonb\n    )\nWHERE EXISTS (SELECT 1 FROM leads WHERE customer_id = c.id)","-- =====================================================\n-- STEP E: Make customer_id NOT NULL and deprecate lead_id\n-- =====================================================\n\n-- Verify all records have customer_id before setting NOT NULL\n-- (This should pass after orphaned records are deleted in Step B)\nDO $$\nBEGIN\n    -- Check for any remaining NULL customer_id values\n    IF EXISTS (SELECT 1 FROM workout_plans WHERE customer_id IS NULL) THEN\n        RAISE EXCEPTION 'Cannot set NOT NULL: workout_plans still contains NULL customer_id values. Please check orphaned records.';\n    END IF;\n    \n    IF EXISTS (SELECT 1 FROM nutrition_plans WHERE customer_id IS NULL) THEN\n        RAISE EXCEPTION 'Cannot set NOT NULL: nutrition_plans still contains NULL customer_id values. Please check orphaned records.';\n    END IF;\nEND $$","-- For workout_plans: Make customer_id required for new records (keep lead_id nullable for backward compatibility)\n-- Note: We keep lead_id for now but it's deprecated - new records should use customer_id\nALTER TABLE workout_plans\n    ALTER COLUMN customer_id SET NOT NULL","-- For nutrition_plans: Make customer_id required for new records\nALTER TABLE nutrition_plans\n    ALTER COLUMN customer_id SET NOT NULL","-- Drop the foreign key constraint on lead_id (we'll keep the column but remove the constraint)\n-- This allows us to keep historical data but prevents new relationships\nALTER TABLE workout_plans\n    DROP CONSTRAINT IF EXISTS workout_plans_lead_id_fkey","ALTER TABLE nutrition_plans\n    DROP CONSTRAINT IF EXISTS nutrition_plans_lead_id_fkey","-- Add comments to mark lead_id as deprecated\nCOMMENT ON COLUMN workout_plans.lead_id IS 'DEPRECATED: Use customer_id instead. This column is kept for historical data only.'","COMMENT ON COLUMN nutrition_plans.lead_id IS 'DEPRECATED: Use customer_id instead. This column is kept for historical data only.'","-- =====================================================\n-- STEP F: Update RLS policies to use customer_id\n-- =====================================================\n\n-- Note: RLS policies will need to be updated in application logic\n-- The policies currently check user_id, which is still valid\n-- We add customer-based policies for admin access\n\n-- Policy: Admins can read all workout plans by customer\nDROP POLICY IF EXISTS \\"Admins can read workout plans by customer\\" ON workout_plans","CREATE POLICY \\"Admins can read workout plans by customer\\"\n    ON workout_plans FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Admins can read all nutrition plans by customer\nDROP POLICY IF EXISTS \\"Admins can read nutrition plans by customer\\" ON nutrition_plans","CREATE POLICY \\"Admins can read nutrition plans by customer\\"\n    ON nutrition_plans FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- STEP G: Add comments for documentation\n-- =====================================================\n\nCOMMENT ON COLUMN customers.daily_protocol IS 'JSONB: { \\"stepsGoal\\": number, \\"workoutGoal\\": number, \\"supplements\\": string[] } - Coaching protocol data'","COMMENT ON COLUMN customers.workout_history IS 'JSONB: Array of workout program objects with dates, splits, and descriptions - Historical coaching data'","COMMENT ON COLUMN customers.steps_history IS 'JSONB: Array of step tracking objects with week numbers, dates, and targets - Historical coaching data'","COMMENT ON COLUMN workout_plans.customer_id IS 'Reference to the customer this workout plan belongs to (coaching data)'","COMMENT ON COLUMN nutrition_plans.customer_id IS 'Reference to the customer this nutrition plan belongs to (coaching data)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	relocate_service_data_to_customers
20240102000015	{"-- =====================================================\n-- Performance Optimization: Shift Left Strategy\n-- Created: 2024-01-02\n-- Description: Move filtering, calculations, and aggregations to PostgreSQL\n--              Replace client-side JS logic with database functions\n-- Philosophy: Database does the heavy lifting, frontend stays light\n-- =====================================================\n\n-- =====================================================\n-- STEP 1: Create Optimized Indexes (Strategic, not over-indexing)\n-- =====================================================\n\n-- Indexes for filtering columns (most common filters)\nCREATE INDEX IF NOT EXISTS idx_leads_status_main ON public.leads(status_main) WHERE status_main IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_status_sub ON public.leads(status_sub) WHERE status_sub IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_source ON public.leads(source) WHERE source IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_fitness_goal ON public.leads(fitness_goal) WHERE fitness_goal IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_activity_level ON public.leads(activity_level) WHERE activity_level IS NOT NULL","CREATE INDEX IF NOT EXISTS idx_leads_preferred_time ON public.leads(preferred_time) WHERE preferred_time IS NOT NULL","-- Note: Removed idx_leads_created_at_date - DATE() is not IMMUTABLE\n-- Use existing idx_leads_created_at index for date filtering instead\n\n-- Composite index for common filter combinations\nCREATE INDEX IF NOT EXISTS idx_leads_status_source ON public.leads(status_main, source) WHERE status_main IS NOT NULL AND source IS NOT NULL","-- Index for customer_id (already exists, but ensure it's there)\nCREATE INDEX IF NOT EXISTS idx_leads_customer_id ON public.leads(customer_id)","-- Index for birth_date (for age calculations)\nCREATE INDEX IF NOT EXISTS idx_leads_birth_date ON public.leads(birth_date) WHERE birth_date IS NOT NULL","-- Note: Removed idx_leads_created_at_date index\n-- DATE() function is not IMMUTABLE, so it can't be used in index expressions\n-- The existing idx_leads_created_at index on created_at (DESC) is sufficient for date filtering\n\n-- =====================================================\n-- STEP 2: Create View for Leads with Customer Data (Pre-joined)\n-- =====================================================\n\nCREATE OR REPLACE VIEW public.v_leads_with_customer AS\nSELECT \n    l.id,\n    l.created_at,\n    l.updated_at,\n    l.assigned_to,\n    l.customer_id,\n    l.city,\n    l.birth_date,\n    l.gender,\n    l.status_main,\n    l.status_sub,\n    l.height,\n    l.weight,\n    l.bmi,\n    l.join_date,\n    l.subscription_data,\n    l.daily_protocol,\n    l.workout_history,\n    l.steps_history,\n    l.source,\n    l.fitness_goal,\n    l.activity_level,\n    l.preferred_time,\n    l.notes,\n    -- Customer data (joined)\n    c.full_name as customer_name,\n    c.phone as customer_phone,\n    c.email as customer_email,\n    -- Calculated fields (PostgreSQL does the math)\n    EXTRACT(YEAR FROM AGE(l.birth_date))::INTEGER as age,\n    TO_CHAR(l.created_at, 'YYYY-MM-DD') as created_date_formatted,\n    TO_CHAR(l.birth_date, 'YYYY-MM-DD') as birth_date_formatted,\n    -- Extract JSONB fields (PostgreSQL parses JSON)\n    (l.daily_protocol->>'stepsGoal')::INTEGER as daily_steps_goal,\n    (l.daily_protocol->>'workoutGoal')::INTEGER as weekly_workouts,\n    -- Extract supplements array from JSONB (handle both array and null)\n    CASE \n        WHEN l.daily_protocol->'supplements' IS NULL THEN ARRAY[]::TEXT[]\n        WHEN jsonb_typeof(l.daily_protocol->'supplements') = 'array' \n        THEN ARRAY(SELECT jsonb_array_elements_text(l.daily_protocol->'supplements'))\n        ELSE ARRAY[]::TEXT[]\n    END as daily_supplements,\n    -- Extract subscription data\n    (l.subscription_data->>'months')::INTEGER as subscription_months,\n    (l.subscription_data->>'initialPrice')::DECIMAL as subscription_initial_price,\n    (l.subscription_data->>'renewalPrice')::DECIMAL as subscription_renewal_price\nFROM public.leads l\nINNER JOIN public.customers c ON l.customer_id = c.id","-- Grant access to authenticated users\nGRANT SELECT ON public.v_leads_with_customer TO authenticated","-- =====================================================\n-- STEP 3: Create RPC Function for Filtered Leads (Complex Filtering)\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.get_filtered_leads(\n    p_search_query TEXT DEFAULT NULL,\n    p_created_date DATE DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_limit_count INTEGER DEFAULT 1000,\n    p_offset_count INTEGER DEFAULT 0\n)\nRETURNS TABLE (\n    id UUID,\n    created_at TIMESTAMP WITH TIME ZONE,\n    updated_at TIMESTAMP WITH TIME ZONE,\n    customer_id UUID,\n    customer_name TEXT,\n    customer_phone TEXT,\n    customer_email TEXT,\n    status_main TEXT,\n    status_sub TEXT,\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT,\n    age INTEGER,\n    birth_date DATE,\n    birth_date_formatted TEXT,\n    created_date_formatted TEXT,\n    height DECIMAL,\n    weight DECIMAL,\n    daily_steps_goal INTEGER,\n    weekly_workouts INTEGER,\n    daily_supplements TEXT[],\n    subscription_months INTEGER,\n    subscription_initial_price DECIMAL,\n    subscription_renewal_price DECIMAL\n) \nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nBEGIN\n    RETURN QUERY\n    SELECT \n        v.id,\n        v.created_at,\n        v.updated_at,\n        v.customer_id,\n        v.customer_name,\n        v.customer_phone,\n        v.customer_email,\n        v.status_main,\n        v.status_sub,\n        v.source,\n        v.fitness_goal,\n        v.activity_level,\n        v.preferred_time,\n        v.notes,\n        v.age,\n        v.birth_date,\n        v.birth_date_formatted,\n        v.created_date_formatted,\n        v.height,\n        v.weight,\n        v.daily_steps_goal,\n        v.weekly_workouts,\n        v.daily_supplements,\n        v.subscription_months,\n        v.subscription_initial_price,\n        v.subscription_renewal_price\n    FROM public.v_leads_with_customer v\n    WHERE \n        -- Search query (PostgreSQL text search - fast with indexes)\n        (p_search_query IS NULL OR \n         v.customer_name ILIKE '%' || p_search_query || '%' OR\n         v.customer_email ILIKE '%' || p_search_query || '%' OR\n         v.customer_phone LIKE '%' || p_search_query || '%' OR\n         v.fitness_goal ILIKE '%' || p_search_query || '%' OR\n         v.notes ILIKE '%' || p_search_query || '%')\n        -- Date filter (PostgreSQL date comparison)\n        AND (p_created_date IS NULL OR DATE(v.created_at) = p_created_date)\n        -- Status filters (uses indexes)\n        AND (p_status_main IS NULL OR v.status_main = p_status_main)\n        AND (p_status_sub IS NULL OR v.status_sub = p_status_sub)\n        -- Age filter (calculated in PostgreSQL)\n        AND (p_age IS NULL OR v.age::TEXT = p_age)\n        -- Height filter\n        AND (p_height IS NULL OR v.height::TEXT = p_height)\n        -- Weight filter\n        AND (p_weight IS NULL OR v.weight::TEXT = p_weight)\n        -- Fitness goal filter (uses index)\n        AND (p_fitness_goal IS NULL OR v.fitness_goal = p_fitness_goal)\n        -- Activity level filter (uses index)\n        AND (p_activity_level IS NULL OR v.activity_level = p_activity_level)\n        -- Preferred time filter (uses index)\n        AND (p_preferred_time IS NULL OR v.preferred_time = p_preferred_time)\n        -- Source filter (uses index)\n        AND (p_source IS NULL OR v.source = p_source)\n    ORDER BY v.created_at DESC\n    LIMIT p_limit_count\n    OFFSET p_offset_count;\nEND;\n$$","-- Grant execute permission to authenticated users\nGRANT EXECUTE ON FUNCTION public.get_filtered_leads TO authenticated","-- =====================================================\n-- STEP 4: Create Helper Function for Age Calculation (Reusable)\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.calculate_age_from_birth_date(birth_date DATE)\nRETURNS INTEGER\nLANGUAGE plpgsql\nIMMUTABLE\nAS $$\nBEGIN\n    IF birth_date IS NULL THEN\n        RETURN 0;\n    END IF;\n    RETURN EXTRACT(YEAR FROM AGE(birth_date))::INTEGER;\nEND;\n$$","-- =====================================================\n-- STEP 5: Create Function to Get Unique Filter Values (For Dropdowns)\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.get_lead_filter_options()\nRETURNS JSONB\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    result JSONB;\nBEGIN\n    SELECT jsonb_build_object(\n        'statuses', ARRAY(SELECT DISTINCT status_main FROM public.leads WHERE status_main IS NOT NULL ORDER BY status_main)::TEXT[],\n        'sources', ARRAY(SELECT DISTINCT source FROM public.leads WHERE source IS NOT NULL ORDER BY source)::TEXT[],\n        'fitness_goals', ARRAY(SELECT DISTINCT fitness_goal FROM public.leads WHERE fitness_goal IS NOT NULL ORDER BY fitness_goal)::TEXT[],\n        'activity_levels', ARRAY(SELECT DISTINCT activity_level FROM public.leads WHERE activity_level IS NOT NULL ORDER BY activity_level)::TEXT[],\n        'preferred_times', ARRAY(SELECT DISTINCT preferred_time FROM public.leads WHERE preferred_time IS NOT NULL ORDER BY preferred_time)::TEXT[],\n        'ages', ARRAY(SELECT DISTINCT EXTRACT(YEAR FROM AGE(birth_date))::TEXT \n                      FROM public.leads \n                      WHERE birth_date IS NOT NULL \n                      ORDER BY EXTRACT(YEAR FROM AGE(birth_date)))::TEXT[],\n        'heights', ARRAY(SELECT DISTINCT height::TEXT \n                         FROM public.leads \n                         WHERE height IS NOT NULL \n                         ORDER BY height)::TEXT[],\n        'weights', ARRAY(SELECT DISTINCT weight::TEXT \n                         FROM public.leads \n                         WHERE weight IS NOT NULL \n                         ORDER BY weight)::TEXT[]\n    ) INTO result;\n    \n    RETURN result;\nEND;\n$$","-- Grant execute permission\nGRANT EXECUTE ON FUNCTION public.get_lead_filter_options TO authenticated","-- =====================================================\n-- STEP 6: Comments for Documentation\n-- =====================================================\n\nCOMMENT ON VIEW public.v_leads_with_customer IS 'Pre-joined view of leads with customer data and calculated fields. Use this for read operations to avoid client-side joins.'","COMMENT ON FUNCTION public.get_filtered_leads IS 'RPC function for complex lead filtering. All filtering happens in PostgreSQL. Returns pre-calculated fields (age, formatted dates, JSONB extracts).'","COMMENT ON FUNCTION public.calculate_age_from_birth_date IS 'Immutable function to calculate age from birth date. Can be used in queries and views.'","COMMENT ON FUNCTION public.get_lead_filter_options IS 'Returns distinct filter values for dropdowns. Calculated once in PostgreSQL instead of client-side.'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	optimize_leads_queries
20240102000016	{"-- =====================================================\n-- Add Profile Fields to Customers Table\n-- Created: 2024-01-02\n-- Description: Add fields for Rich Profile Hero view\n--              - total_spent: Calculated from leads subscription_data\n--              - membership_tier: Derived from total_spent\n--              - avatar_url: URL for customer avatar image\n-- =====================================================\n\n-- Add new columns to customers table\nALTER TABLE public.customers\n  ADD COLUMN IF NOT EXISTS avatar_url TEXT,\n  ADD COLUMN IF NOT EXISTS total_spent NUMERIC(10, 2) DEFAULT 0,\n  ADD COLUMN IF NOT EXISTS membership_tier TEXT DEFAULT 'New' CHECK (membership_tier IN ('New', 'Standard', 'Premium', 'VIP'))","-- Create index for membership_tier for faster filtering\nCREATE INDEX IF NOT EXISTS idx_customers_membership_tier ON public.customers(membership_tier)","-- Add comments for documentation\nCOMMENT ON COLUMN public.customers.avatar_url IS 'URL to customer avatar/profile image'","COMMENT ON COLUMN public.customers.total_spent IS 'Total amount spent across all leads (calculated field)'","COMMENT ON COLUMN public.customers.membership_tier IS 'Customer membership tier based on total_spent: New (<500), Standard (500-1999), Premium (2000-4999), VIP (5000+)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_profile_fields_to_customers
20240102000017	{"-- =====================================================\n-- Add Nutrition and Supplements History to Leads Table\n-- Created: 2024-01-02\n-- Description: Add nutrition_history and supplements_history JSONB columns\n--              to store historical nutrition plans and supplements plans\n-- =====================================================\n\n-- Add nutrition_history column to leads table\nALTER TABLE public.leads\n  ADD COLUMN IF NOT EXISTS nutrition_history JSONB DEFAULT '[]'::jsonb","-- Add supplements_history column to leads table\nALTER TABLE public.leads\n  ADD COLUMN IF NOT EXISTS supplements_history JSONB DEFAULT '[]'::jsonb","-- Create GIN indexes for efficient JSONB queries\nCREATE INDEX IF NOT EXISTS idx_leads_nutrition_history ON public.leads USING GIN (nutrition_history)","CREATE INDEX IF NOT EXISTS idx_leads_supplements_history ON public.leads USING GIN (supplements_history)","-- Add comments for documentation\nCOMMENT ON COLUMN public.leads.nutrition_history IS 'Array of historical nutrition plans for this lead'","COMMENT ON COLUMN public.leads.supplements_history IS 'Array of historical supplements plans for this lead'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_nutrition_supplements_history_to_leads
20240102000018	{"-- Migration: Add customer_notes table for unified customer notes system\n-- Created: 2024-01-02\n-- Description: Customer-centric notes that are unified across all leads belonging to the same customer\n\nCREATE TABLE IF NOT EXISTS customer_notes (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  customer_id UUID NOT NULL REFERENCES customers(id) ON DELETE CASCADE,\n  content TEXT NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id)\n)","-- Create indexes for performance\nCREATE INDEX IF NOT EXISTS idx_customer_notes_customer_id ON customer_notes(customer_id)","CREATE INDEX IF NOT EXISTS idx_customer_notes_created_at ON customer_notes(created_at DESC)","-- Enable RLS\nALTER TABLE customer_notes ENABLE ROW LEVEL SECURITY","-- RLS Policies: Allow authenticated users to manage notes\n-- Adjust these policies based on your specific requirements\n\nCREATE POLICY \\"Users can view customer notes\\" ON customer_notes\n  FOR SELECT\n  USING (auth.role() = 'authenticated')","CREATE POLICY \\"Users can insert customer notes\\" ON customer_notes\n  FOR INSERT\n  WITH CHECK (auth.role() = 'authenticated')","CREATE POLICY \\"Users can update customer notes\\" ON customer_notes\n  FOR UPDATE\n  USING (auth.role() = 'authenticated')","CREATE POLICY \\"Users can delete customer notes\\" ON customer_notes\n  FOR DELETE\n  USING (auth.role() = 'authenticated')","-- Function to automatically update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_customer_notes_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Trigger to automatically update updated_at\nCREATE TRIGGER customer_notes_updated_at\n  BEFORE UPDATE ON customer_notes\n  FOR EACH ROW\n  EXECUTE FUNCTION update_customer_notes_updated_at()"}	add_customer_notes
20240102000019	{"-- Migration: Add icon_name column to saved_views table\n-- This allows users to customize the icon for each saved view\n\n-- Add icon_name column (nullable, defaults to NULL for existing rows)\nALTER TABLE saved_views \nADD COLUMN IF NOT EXISTS icon_name TEXT","-- Add comment to explain the column\nCOMMENT ON COLUMN saved_views.icon_name IS 'Name of the Lucide icon component to use for this view (e.g., \\"Users\\", \\"Dumbbell\\", \\"Flame\\"). If NULL, uses default icon for the resource_key.'"}	add_icon_name_to_saved_views
20240102000020	{"-- Migration: Add user_interface_preferences table for storing custom interface icons\n-- This allows users to customize icons for main interface items (e.g., \\"ניהול לידים\\", \\"ניהול לקוחות\\")\n\nCREATE TABLE IF NOT EXISTS user_interface_preferences (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    interface_key TEXT NOT NULL, -- e.g., 'leads', 'customers', 'templates', etc.\n    icon_name TEXT NOT NULL, -- e.g., 'Users', 'Dumbbell', 'LayoutDashboard', etc.\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Ensure one preference per interface per user\n    CONSTRAINT unique_user_interface_preference \n        UNIQUE (user_id, interface_key)\n)","-- Index for faster queries\nCREATE INDEX IF NOT EXISTS idx_user_interface_preferences_user_id \n    ON user_interface_preferences(user_id)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_user_interface_preferences_updated_at\n    BEFORE UPDATE ON user_interface_preferences\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- Enable RLS\nALTER TABLE user_interface_preferences ENABLE ROW LEVEL SECURITY","-- Policy: Users can view their own preferences\nCREATE POLICY \\"Users can view their own interface preferences\\"\n    ON user_interface_preferences\n    FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own preferences\nCREATE POLICY \\"Users can insert their own interface preferences\\"\n    ON user_interface_preferences\n    FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own preferences\nCREATE POLICY \\"Users can update their own interface preferences\\"\n    ON user_interface_preferences\n    FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own preferences\nCREATE POLICY \\"Users can delete their own interface preferences\\"\n    ON user_interface_preferences\n    FOR DELETE\n    USING (auth.uid() = user_id)","-- Comments\nCOMMENT ON TABLE user_interface_preferences IS 'User preferences for customizing interface icons'","COMMENT ON COLUMN user_interface_preferences.interface_key IS 'The interface identifier (e.g., \\"leads\\", \\"customers\\", \\"templates\\")'","COMMENT ON COLUMN user_interface_preferences.icon_name IS 'The Lucide icon name (e.g., \\"Users\\", \\"Dumbbell\\", \\"LayoutDashboard\\")'"}	add_user_interface_preferences
20240102000021	{"-- Migration: Allow authenticated users to update leads\n-- This ensures that any authenticated user can update leads they can read\n-- Required for the inline editing functionality to work properly\n\n-- Note: We keep the existing admin policy which uses is_admin() function\n-- This new policy allows any authenticated user to update leads\n\n-- Create new policy that allows authenticated users to update leads\n-- Since we already have a SELECT policy allowing authenticated users to read leads,\n-- we should allow them to update leads as well for the CRM functionality\n-- The admin policy (created in 20240102000001) will still apply for admins\nCREATE POLICY \\"Authenticated users can update leads\\"\n    ON public.leads FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","COMMENT ON POLICY \\"Authenticated users can update leads\\" ON public.leads IS \n    'Allows all authenticated users to update leads for CRM functionality'"}	allow_authenticated_users_update_leads
20240102000022	{"-- Migration: Add lead_id column to customer_notes table\n-- Created: 2024-01-02\n-- Description: Allow notes to be associated with specific leads/inquiries\n\nALTER TABLE customer_notes \nADD COLUMN IF NOT EXISTS lead_id UUID REFERENCES leads(id) ON DELETE SET NULL","-- Create index for performance\nCREATE INDEX IF NOT EXISTS idx_customer_notes_lead_id ON customer_notes(lead_id)","-- Add comment\nCOMMENT ON COLUMN customer_notes.lead_id IS 'Optional reference to a specific lead/inquiry. NULL means the note applies to all inquiries for the customer.'"}	add_lead_id_to_customer_notes
20240102000023	{"-- Migration: Add Client Portal Support\n-- Created: 2024-01-02\n-- Description: Enable client/trainee role, link customers to auth users, and create daily check-ins\n\n-- =====================================================\n-- 1. UPDATE profiles.role to include 'trainee'\n-- =====================================================\n\n-- Drop the existing CHECK constraint\nALTER TABLE profiles DROP CONSTRAINT IF EXISTS profiles_role_check","-- Add new CHECK constraint with 'trainee' role\nALTER TABLE profiles \nADD CONSTRAINT profiles_role_check \nCHECK (role IN ('admin', 'user', 'trainee'))","-- Update comment\nCOMMENT ON COLUMN profiles.role IS 'User role: admin (coach/admin), user (coach), trainee (client/trainee)'","-- =====================================================\n-- 2. ADD user_id to customers table\n-- =====================================================\n\n-- Add user_id column to customers (nullable, as existing customers may not have user accounts yet)\nALTER TABLE customers \nADD COLUMN IF NOT EXISTS user_id UUID REFERENCES auth.users(id) ON DELETE SET NULL","-- Create index for faster lookups\nCREATE INDEX IF NOT EXISTS idx_customers_user_id ON customers(user_id)","-- Add unique constraint to ensure one user can only be linked to one customer\nCREATE UNIQUE INDEX IF NOT EXISTS idx_customers_user_id_unique ON customers(user_id) \nWHERE user_id IS NOT NULL","-- Add comment\nCOMMENT ON COLUMN customers.user_id IS 'Link to auth.users - allows clients to log in and access their portal'","-- =====================================================\n-- 3. CREATE daily_check_ins table\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS daily_check_ins (\n  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  customer_id UUID NOT NULL REFERENCES customers(id) ON DELETE CASCADE,\n  lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n  check_in_date DATE NOT NULL DEFAULT CURRENT_DATE,\n  \n  -- Check-in statuses\n  workout_completed BOOLEAN DEFAULT false,\n  steps_goal_met BOOLEAN DEFAULT false,\n  steps_actual INTEGER, -- Actual steps taken (optional)\n  nutrition_goal_met BOOLEAN DEFAULT false,\n  supplements_taken JSONB DEFAULT '[]'::jsonb, -- Array of supplement names taken\n  \n  -- Additional notes\n  notes TEXT,\n  \n  -- Metadata\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n  \n  -- Ensure one check-in per customer per day\n  UNIQUE(customer_id, check_in_date)\n)","-- Create indexes for performance\nCREATE INDEX IF NOT EXISTS idx_daily_check_ins_customer_id ON daily_check_ins(customer_id)","CREATE INDEX IF NOT EXISTS idx_daily_check_ins_lead_id ON daily_check_ins(lead_id)","CREATE INDEX IF NOT EXISTS idx_daily_check_ins_date ON daily_check_ins(check_in_date DESC)","CREATE INDEX IF NOT EXISTS idx_daily_check_ins_customer_date ON daily_check_ins(customer_id, check_in_date DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_daily_check_ins_updated_at\n  BEFORE UPDATE ON daily_check_ins\n  FOR EACH ROW\n  EXECUTE FUNCTION update_updated_at_column()","-- Add comments\nCOMMENT ON TABLE daily_check_ins IS 'Daily check-in records for client compliance tracking'","COMMENT ON COLUMN daily_check_ins.workout_completed IS 'Whether the client completed their workout for the day'","COMMENT ON COLUMN daily_check_ins.steps_goal_met IS 'Whether the client met their daily steps goal'","COMMENT ON COLUMN daily_check_ins.steps_actual IS 'Actual number of steps taken (optional, for detailed tracking)'","COMMENT ON COLUMN daily_check_ins.nutrition_goal_met IS 'Whether the client met their nutrition/macro goals'","COMMENT ON COLUMN daily_check_ins.supplements_taken IS 'JSONB array of supplement names that were taken'","-- =====================================================\n-- 4. ENABLE RLS ON daily_check_ins\n-- =====================================================\n\nALTER TABLE daily_check_ins ENABLE ROW LEVEL SECURITY","-- Policy: Trainees can view their own check-ins\nCREATE POLICY \\"Trainees can view own check-ins\\"\n  ON daily_check_ins FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = daily_check_ins.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- Policy: Trainees can insert their own check-ins\nCREATE POLICY \\"Trainees can insert own check-ins\\"\n  ON daily_check_ins FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = daily_check_ins.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- Policy: Trainees can update their own check-ins\nCREATE POLICY \\"Trainees can update own check-ins\\"\n  ON daily_check_ins FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = daily_check_ins.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = daily_check_ins.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- Policy: Coaches/admins can view all check-ins\nCREATE POLICY \\"Coaches can view all check-ins\\"\n  ON daily_check_ins FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE id = auth.uid() \n      AND role IN ('admin', 'user')\n    )\n  )","-- Policy: Coaches/admins can insert check-ins for any customer\nCREATE POLICY \\"Coaches can insert check-ins\\"\n  ON daily_check_ins FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE id = auth.uid() \n      AND role IN ('admin', 'user')\n    )\n  )","-- Policy: Coaches/admins can update check-ins for any customer\nCREATE POLICY \\"Coaches can update check-ins\\"\n  ON daily_check_ins FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE id = auth.uid() \n      AND role IN ('admin', 'user')\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE id = auth.uid() \n      AND role IN ('admin', 'user')\n    )\n  )","-- =====================================================\n-- 5. UPDATE RLS POLICIES FOR customers\n-- =====================================================\n\n-- Policy: Trainees can view their own customer record\nCREATE POLICY \\"Trainees can view own customer\\"\n  ON customers FOR SELECT\n  USING (user_id = auth.uid())","-- Policy: Trainees can update their own customer record (for profile editing)\nCREATE POLICY \\"Trainees can update own customer\\"\n  ON customers FOR UPDATE\n  USING (user_id = auth.uid())\n  WITH CHECK (user_id = auth.uid())","-- =====================================================\n-- 6. UPDATE RLS POLICIES FOR leads (for trainee access)\n-- =====================================================\n\n-- Policy: Trainees can view leads associated with their customer_id\nCREATE POLICY \\"Trainees can view own leads\\"\n  ON leads FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = leads.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- Policy: Trainees can update their own leads (for weight, height, etc.)\nCREATE POLICY \\"Trainees can update own leads\\"\n  ON leads FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = leads.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = leads.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_client_portal_support
20240102000024	{"-- Migration: Fix Trainee User Role\n-- Created: 2024-01-02\n-- Description: \n--   1. Update existing trainee user's role from 'user' to 'trainee' in the profiles table\n--   2. Create profile with correct role if user exists in auth.users but not in profiles\n--   3. Update handle_new_user function to automatically set role='trainee' for trainee@test.com\n\n-- =====================================================\n-- 1. UPDATE handle_new_user to auto-set trainee role\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.handle_new_user()\nRETURNS TRIGGER AS $$\nBEGIN\n    -- Auto-set role to 'trainee' for trainee@test.com\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (\n        NEW.id,\n        NEW.email,\n        COALESCE(NEW.raw_user_meta_data->>'full_name', ''),\n        CASE \n            WHEN NEW.email = 'trainee@test.com' THEN 'trainee'\n            ELSE COALESCE(NEW.raw_user_meta_data->>'role', 'user')\n        END\n    );\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- =====================================================\n-- 2. UPDATE/CREATE trainee@test.com role to 'trainee'\n-- =====================================================\n\nDO $$\nDECLARE\n  v_user_id UUID;\n  v_role TEXT;\n  v_updated_count INTEGER;\nBEGIN\n  -- Find the user in auth.users\n  SELECT id INTO v_user_id\n  FROM auth.users\n  WHERE email = 'trainee@test.com';\n  \n  IF v_user_id IS NULL THEN\n    RAISE NOTICE '⚠️ User trainee@test.com not found in auth.users - will be set to trainee when user is created';\n    RETURN;\n  END IF;\n  \n  -- Check if profile exists\n  SELECT role INTO v_role\n  FROM profiles\n  WHERE id = v_user_id;\n  \n  IF v_role IS NULL THEN\n    -- Profile doesn't exist, create it with 'trainee' role\n    INSERT INTO profiles (id, email, role, full_name)\n    VALUES (v_user_id, 'trainee@test.com', 'trainee', 'Test Trainee')\n    ON CONFLICT (id) DO UPDATE\n      SET role = 'trainee',\n          email = EXCLUDED.email;\n    \n    RAISE NOTICE '✅ Created profile for trainee@test.com with role: trainee';\n  ELSIF v_role != 'trainee' THEN\n    -- Profile exists but has wrong role, update it\n    UPDATE profiles \n    SET role = 'trainee' \n    WHERE id = v_user_id;\n    \n    GET DIAGNOSTICS v_updated_count = ROW_COUNT;\n    \n    IF v_updated_count > 0 THEN\n      RAISE NOTICE '✅ Updated trainee@test.com role from % to: trainee', v_role;\n    END IF;\n  ELSE\n    -- Profile already has correct role\n    RAISE NOTICE '✅ User trainee@test.com already has role: trainee';\n  END IF;\nEND $$"}	fix_trainee_user_role
20240102000025	{"-- Migration: Create Test Users (Manager & Client)\n-- Created: 2024-01-02\n-- Description: Creates two test users:\n--   1. Manager user (coach/admin) - sees full dashboard\n--   2. Client user (trainee) - sees only their client portal\n-- IMPORTANT: This must be the LAST migration to run\n\n-- =====================================================\n-- CREATE TEST USERS\n-- =====================================================\n\nDO $$\nDECLARE\n  v_manager_user_id UUID;\n  v_client_user_id UUID;\n  v_client_customer_id UUID;\n  v_client_lead_id UUID;\nBEGIN\n  -- =====================================================\n  -- 1. CREATE MANAGER USER (coach/admin)\n  -- =====================================================\n  \n  -- Check if manager user already exists\n  SELECT id INTO v_manager_user_id\n  FROM auth.users\n  WHERE email = 'manager@dietneta.com';\n  \n  -- Create auth user for manager (only if doesn't exist)\n  IF v_manager_user_id IS NULL THEN\n    INSERT INTO auth.users (\n      instance_id,\n      id,\n      aud,\n      role,\n      email,\n      encrypted_password,\n      email_confirmed_at,\n      recovery_sent_at,\n      last_sign_in_at,\n      raw_app_meta_data,\n      raw_user_meta_data,\n      created_at,\n      updated_at,\n      confirmation_token,\n      email_change,\n      email_change_token_new,\n      recovery_token\n    ) VALUES (\n      '00000000-0000-0000-0000-000000000000',\n      gen_random_uuid(),\n      'authenticated',\n      'authenticated',\n      'manager@dietneta.com',\n      crypt('Manager123!', gen_salt('bf')),\n      NOW(),\n      NOW(),\n      NOW(),\n      '{\\"provider\\": \\"email\\", \\"providers\\": [\\"email\\"]}',\n      '{\\"full_name\\": \\"מנהל מערכת\\", \\"role\\": \\"admin\\"}',\n      NOW(),\n      NOW(),\n      '',\n      '',\n      '',\n      ''\n    )\n    RETURNING id INTO v_manager_user_id;\n  END IF;\n  \n  -- Create profile for manager (if user exists)\n  IF v_manager_user_id IS NOT NULL THEN\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (v_manager_user_id, 'manager@dietneta.com', 'מנהל מערכת', 'admin')\n    ON CONFLICT (id) DO UPDATE\n      SET role = 'admin',\n          email = 'manager@dietneta.com',\n          full_name = 'מנהל מערכת';\n    \n    RAISE NOTICE '✅ Manager user created/updated: manager@dietneta.com (ID: %)', v_manager_user_id;\n  ELSE\n    -- User already exists, get the ID\n    SELECT id INTO v_manager_user_id\n    FROM auth.users\n    WHERE email = 'manager@dietneta.com';\n    \n    -- Update profile to ensure correct role\n    UPDATE public.profiles\n    SET role = 'admin',\n        email = 'manager@dietneta.com',\n        full_name = 'מנהל מערכת'\n    WHERE id = v_manager_user_id;\n    \n    RAISE NOTICE '✅ Manager user already exists, profile updated: manager@dietneta.com (ID: %)', v_manager_user_id;\n  END IF;\n  \n  -- =====================================================\n  -- 2. CREATE CLIENT USER (trainee)\n  -- =====================================================\n  \n  -- Check if client user already exists\n  SELECT id INTO v_client_user_id\n  FROM auth.users\n  WHERE email = 'client@dietneta.com';\n  \n  -- Create auth user for client (only if doesn't exist)\n  IF v_client_user_id IS NULL THEN\n    INSERT INTO auth.users (\n      instance_id,\n      id,\n      aud,\n      role,\n      email,\n      encrypted_password,\n      email_confirmed_at,\n      recovery_sent_at,\n      last_sign_in_at,\n      raw_app_meta_data,\n      raw_user_meta_data,\n      created_at,\n      updated_at,\n      confirmation_token,\n      email_change,\n      email_change_token_new,\n      recovery_token\n    ) VALUES (\n      '00000000-0000-0000-0000-000000000000',\n      gen_random_uuid(),\n      'authenticated',\n      'authenticated',\n      'client@dietneta.com',\n      crypt('Client123!', gen_salt('bf')),\n      NOW(),\n      NOW(),\n      NOW(),\n      '{\\"provider\\": \\"email\\", \\"providers\\": [\\"email\\"]}',\n      '{\\"full_name\\": \\"לקוח בדיקה\\", \\"role\\": \\"trainee\\"}',\n      NOW(),\n      NOW(),\n      '',\n      '',\n      '',\n      ''\n    )\n    RETURNING id INTO v_client_user_id;\n  END IF;\n  \n  -- Create profile for client (if user exists)\n  IF v_client_user_id IS NOT NULL THEN\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (v_client_user_id, 'client@dietneta.com', 'לקוח בדיקה', 'trainee')\n    ON CONFLICT (id) DO UPDATE\n      SET role = 'trainee',\n          email = 'client@dietneta.com',\n          full_name = 'לקוח בדיקה';\n    \n    RAISE NOTICE '✅ Client user created/updated: client@dietneta.com (ID: %)', v_client_user_id;\n  ELSE\n    -- User already exists, get the ID\n    SELECT id INTO v_client_user_id\n    FROM auth.users\n    WHERE email = 'client@dietneta.com';\n    \n    -- Update profile to ensure correct role\n    UPDATE public.profiles\n    SET role = 'trainee',\n        email = 'client@dietneta.com',\n        full_name = 'לקוח בדיקה'\n    WHERE id = v_client_user_id;\n    \n    RAISE NOTICE '✅ Client user already exists, profile updated: client@dietneta.com (ID: %)', v_client_user_id;\n  END IF;\n  \n  -- =====================================================\n  -- 3. CREATE CUSTOMER RECORD FOR CLIENT\n  -- =====================================================\n  \n  IF v_client_user_id IS NOT NULL THEN\n    -- Create customer record linked to client user\n    -- Use upsert approach since we can't rely on ON CONFLICT with partial unique index\n    INSERT INTO customers (full_name, phone, email, user_id)\n    VALUES (\n      'לקוח בדיקה',\n      '0501234567',\n      'client@dietneta.com',\n      v_client_user_id\n    )\n    ON CONFLICT (phone) DO UPDATE\n      SET user_id = EXCLUDED.user_id,\n          full_name = EXCLUDED.full_name,\n          email = EXCLUDED.email\n    RETURNING id INTO v_client_customer_id;\n    \n    -- If customer already existed with different user_id, update it\n    IF v_client_customer_id IS NULL THEN\n      UPDATE customers\n      SET user_id = v_client_user_id,\n          full_name = 'לקוח בדיקה',\n          email = 'client@dietneta.com'\n      WHERE phone = '0501234567'\n      RETURNING id INTO v_client_customer_id;\n    END IF;\n    \n    RAISE NOTICE '✅ Customer record created/updated for client (ID: %)', v_client_customer_id;\n    \n    -- =====================================================\n    -- 4. CREATE LEAD RECORD FOR CLIENT\n    -- =====================================================\n    \n    -- Create a lead record for the client (only if doesn't exist)\n    -- Note: After normalization, leads table no longer has full_name, phone, email columns\n    -- Those are in the customers table, linked via customer_id\n    INSERT INTO leads (\n      customer_id,\n      status_main,\n      fitness_goal,\n      height,\n      weight,\n      activity_level\n    )\n    SELECT \n      v_client_customer_id,\n      'בטיפול',\n      'ירידה במשקל',\n      175.0,\n      75.0,\n      'בינוני'\n    WHERE NOT EXISTS (\n      SELECT 1 FROM leads \n      WHERE customer_id = v_client_customer_id \n    )\n    RETURNING id INTO v_client_lead_id;\n    \n    RAISE NOTICE '✅ Lead record created/updated for client (ID: %)', v_client_lead_id;\n  END IF;\n  \n  RAISE NOTICE '';\n  RAISE NOTICE '========================================';\n  RAISE NOTICE '✅ TEST USERS CREATED SUCCESSFULLY';\n  RAISE NOTICE '========================================';\n  RAISE NOTICE '';\n  RAISE NOTICE '📧 MANAGER USER:';\n  RAISE NOTICE '   Email: manager@dietneta.com';\n  RAISE NOTICE '   Password: Manager123!';\n  RAISE NOTICE '   Role: admin (sees full dashboard)';\n  RAISE NOTICE '';\n  RAISE NOTICE '📧 CLIENT USER:';\n  RAISE NOTICE '   Email: client@dietneta.com';\n  RAISE NOTICE '   Password: Client123!';\n  RAISE NOTICE '   Role: trainee (sees only client portal)';\n  RAISE NOTICE '';\n  RAISE NOTICE '========================================';\n  \nEXCEPTION\n  WHEN OTHERS THEN\n    RAISE WARNING 'Error creating test users: %', SQLERRM;\n    -- Don't fail the migration if users already exist\nEND $$"}	create_test_users
20240102000026	{"-- Migration: Add Trainee Access to Workout and Nutrition Plans\n-- Created: 2024-01-02\n-- Description: Allow trainees to access their workout and nutrition plans via customer_id\n\n-- =====================================================\n-- 1. UPDATE RLS POLICIES FOR workout_plans (for trainee access)\n-- =====================================================\n\n-- Policy: Trainees can view workout plans associated with their customer_id\nCREATE POLICY \\"Trainees can view own workout plans\\"\n  ON workout_plans FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = workout_plans.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- =====================================================\n-- 2. UPDATE RLS POLICIES FOR nutrition_plans (for trainee access)\n-- =====================================================\n\n-- Policy: Trainees can view nutrition plans associated with their customer_id\nCREATE POLICY \\"Trainees can view own nutrition plans\\"\n  ON nutrition_plans FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM customers\n      WHERE customers.id = nutrition_plans.customer_id\n      AND customers.user_id = auth.uid()\n    )\n  )","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_trainee_access_to_plans
20240102000027	{"-- Migration: Secure User Invitations System\n-- Created: 2024-01-02\n-- Description: Implements secure invitation system for trainee user creation without passwords\n\n-- =====================================================\n-- 1. CREATE user_invitations TABLE\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS public.user_invitations (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    \n    -- User identification\n    email TEXT NOT NULL,\n    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,\n    customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    \n    -- Secure token (hashed at rest)\n    token_hash TEXT NOT NULL UNIQUE, -- SHA-256 hash of the invitation token\n    token_salt TEXT NOT NULL, -- Random salt for token hashing\n    \n    -- Invitation metadata\n    status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'sent', 'accepted', 'expired', 'revoked')),\n    invited_by UUID REFERENCES auth.users(id) ON DELETE SET NULL, -- Admin/manager who created the invitation\n    invited_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL, -- Configurable expiration (default 7 days)\n    accepted_at TIMESTAMP WITH TIME ZONE,\n    \n    -- Audit fields\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Constraints\n    CONSTRAINT user_invitations_email_user_id_check CHECK (\n        (email IS NOT NULL) OR (user_id IS NOT NULL)\n    )\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_user_invitations_email ON public.user_invitations(email)","CREATE INDEX IF NOT EXISTS idx_user_invitations_user_id ON public.user_invitations(user_id)","CREATE INDEX IF NOT EXISTS idx_user_invitations_customer_id ON public.user_invitations(customer_id)","CREATE INDEX IF NOT EXISTS idx_user_invitations_token_hash ON public.user_invitations(token_hash)","CREATE INDEX IF NOT EXISTS idx_user_invitations_status ON public.user_invitations(status)","CREATE INDEX IF NOT EXISTS idx_user_invitations_expires_at ON public.user_invitations(expires_at)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_user_invitations_updated_at\n    BEFORE UPDATE ON public.user_invitations\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- 2. CREATE invitation_audit_log TABLE (for security audit)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS public.invitation_audit_log (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    invitation_id UUID REFERENCES user_invitations(id) ON DELETE CASCADE,\n    action TEXT NOT NULL CHECK (action IN ('created', 'sent', 'resent', 'accepted', 'expired', 'revoked', 'viewed')),\n    performed_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    ip_address INET,\n    user_agent TEXT,\n    metadata JSONB DEFAULT '{}'::jsonb,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL\n)","CREATE INDEX IF NOT EXISTS idx_invitation_audit_log_invitation_id ON public.invitation_audit_log(invitation_id)","CREATE INDEX IF NOT EXISTS idx_invitation_audit_log_performed_by ON public.invitation_audit_log(performed_by)","CREATE INDEX IF NOT EXISTS idx_invitation_audit_log_created_at ON public.invitation_audit_log(created_at DESC)","-- =====================================================\n-- 3. ENABLE RLS\n-- =====================================================\n\nALTER TABLE public.user_invitations ENABLE ROW LEVEL SECURITY","ALTER TABLE public.invitation_audit_log ENABLE ROW LEVEL SECURITY","-- =====================================================\n-- 4. RLS POLICIES FOR user_invitations\n-- =====================================================\n\n-- Policy: Admins/managers can view all invitations\nCREATE POLICY \\"Admins can view all invitations\\"\n    ON public.user_invitations FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Admins/managers can create invitations\nCREATE POLICY \\"Admins can create invitations\\"\n    ON public.user_invitations FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Admins/managers can update invitations (for resend, revoke)\nCREATE POLICY \\"Admins can update invitations\\"\n    ON public.user_invitations FOR UPDATE\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Users can view their own invitation (by email match)\n-- Use profiles table instead of auth.users to avoid permission issues\nCREATE POLICY \\"Users can view own invitation\\"\n    ON public.user_invitations FOR SELECT\n    USING (\n        email = (SELECT email FROM profiles WHERE id = auth.uid())\n        OR user_id = auth.uid()\n    )","-- =====================================================\n-- 5. RLS POLICIES FOR invitation_audit_log\n-- =====================================================\n\n-- Policy: Admins can view all audit logs\nCREATE POLICY \\"Admins can view audit logs\\"\n    ON public.invitation_audit_log FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: System can insert audit logs (via service role or admin)\nCREATE POLICY \\"System can insert audit logs\\"\n    ON public.invitation_audit_log FOR INSERT\n    WITH CHECK (true)","-- Will be restricted by RLS on user_invitations\n\n-- =====================================================\n-- 6. HELPER FUNCTION: Generate secure invitation token\n-- =====================================================\n\n-- This function generates a cryptographically secure token\n-- The actual token is generated client-side and hashed before storage\nCREATE OR REPLACE FUNCTION public.generate_invitation_token()\nRETURNS TEXT AS $$\nDECLARE\n    token TEXT;\nBEGIN\n    -- Generate a secure random token (32 bytes = 64 hex characters)\n    -- This is just a placeholder - actual token generation happens in application code\n    -- using crypto.randomBytes or similar\n    token := encode(gen_random_bytes(32), 'hex');\n    RETURN token;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- =====================================================\n-- 7. HELPER FUNCTION: Hash token for storage\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.hash_invitation_token(token TEXT, salt TEXT)\nRETURNS TEXT AS $$\nBEGIN\n    -- Use SHA-256 for token hashing\n    -- In production, consider using bcrypt or argon2\n    RETURN encode(digest(salt || token, 'sha256'), 'hex');\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE","-- =====================================================\n-- 8. HELPER FUNCTION: Verify invitation token\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.verify_invitation_token(\n    p_token_hash TEXT,\n    p_token TEXT,\n    p_salt TEXT\n)\nRETURNS BOOLEAN AS $$\nBEGIN\n    -- Verify token by hashing and comparing\n    RETURN p_token_hash = public.hash_invitation_token(p_token, p_salt);\nEND;\n$$ LANGUAGE plpgsql IMMUTABLE","-- =====================================================\n-- 9. HELPER FUNCTION: Check if invitation is valid\n-- =====================================================\n\nCREATE OR REPLACE FUNCTION public.is_invitation_valid(p_invitation_id UUID)\nRETURNS BOOLEAN AS $$\nDECLARE\n    v_status TEXT;\n    v_expires_at TIMESTAMP WITH TIME ZONE;\nBEGIN\n    SELECT status, expires_at INTO v_status, v_expires_at\n    FROM public.user_invitations\n    WHERE id = p_invitation_id;\n    \n    IF NOT FOUND THEN\n        RETURN FALSE;\n    END IF;\n    \n    -- Check if expired or revoked\n    IF v_status IN ('expired', 'revoked', 'accepted') THEN\n        RETURN FALSE;\n    END IF;\n    \n    -- Check expiration\n    IF v_expires_at < NOW() THEN\n        -- Auto-update status to expired\n        UPDATE public.user_invitations\n        SET status = 'expired', updated_at = NOW()\n        WHERE id = p_invitation_id;\n        RETURN FALSE;\n    END IF;\n    \n    RETURN TRUE;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- =====================================================\n-- 10. COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE public.user_invitations IS 'Secure invitation system for trainee user creation without passwords'","COMMENT ON COLUMN public.user_invitations.token_hash IS 'SHA-256 hash of the invitation token (never store plaintext)'","COMMENT ON COLUMN public.user_invitations.token_salt IS 'Random salt used for token hashing'","COMMENT ON COLUMN public.user_invitations.status IS 'Invitation status: pending, sent, accepted, expired, revoked'","COMMENT ON COLUMN public.user_invitations.expires_at IS 'Token expiration timestamp (default 7 days from creation)'","COMMENT ON TABLE public.invitation_audit_log IS 'Audit log for all invitation-related actions for security compliance'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	secure_user_invitations
20240102000028	{"-- Migration: Fix RLS Policies for user_invitations\n-- Created: 2024-01-02\n-- Description: Fixes RLS policies that were trying to access auth.users directly\n\n-- Drop all existing policies to recreate them properly\nDROP POLICY IF EXISTS \\"Users can view own invitation\\" ON public.user_invitations","DROP POLICY IF EXISTS \\"Admins can view all invitations\\" ON public.user_invitations","DROP POLICY IF EXISTS \\"Admins can create invitations\\" ON public.user_invitations","DROP POLICY IF EXISTS \\"Admins can update invitations\\" ON public.user_invitations","-- Create a helper function to check if user is admin/manager\n-- This avoids repeated subqueries in policies\nCREATE OR REPLACE FUNCTION public.is_admin_or_manager()\nRETURNS BOOLEAN AS $$\nBEGIN\n    RETURN EXISTS (\n        SELECT 1 FROM profiles\n        WHERE id = auth.uid() \n        AND role IN ('admin', 'user')\n    );\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER STABLE","-- Policy: Admins/managers can view all invitations\nCREATE POLICY \\"Admins can view all invitations\\"\n    ON public.user_invitations FOR SELECT\n    USING (public.is_admin_or_manager())","-- Policy: Users can view their own invitation (by user_id or email from profile)\nCREATE POLICY \\"Users can view own invitation\\"\n    ON public.user_invitations FOR SELECT\n    USING (\n        user_id = auth.uid()\n        OR (\n            email = (SELECT email FROM profiles WHERE id = auth.uid())\n        )\n    )","-- Policy: Admins/managers can create invitations\nCREATE POLICY \\"Admins can create invitations\\"\n    ON public.user_invitations FOR INSERT\n    WITH CHECK (public.is_admin_or_manager())","-- Policy: Admins/managers can update invitations (for resend, revoke)\nCREATE POLICY \\"Admins can update invitations\\"\n    ON public.user_invitations FOR UPDATE\n    USING (public.is_admin_or_manager())\n    WITH CHECK (public.is_admin_or_manager())"}	fix_invitation_rls
20240102000029	{"-- Migration: Fix Manager User Password\n-- Created: 2024-01-02\n-- Description: Properly creates/resets manager user password using Supabase Auth\n\n-- This migration uses a function to properly set the password\n-- Note: Direct password updates in auth.users don't work with Supabase Auth\n-- This migration will be handled by a script instead\n\n-- For now, we'll just ensure the profile is correct\n-- The password should be reset using the admin API or script\n\nDO $$\nDECLARE\n  v_manager_user_id UUID;\nBEGIN\n  -- Find manager user\n  SELECT id INTO v_manager_user_id\n  FROM auth.users\n  WHERE email = 'manager@dietneta.com'\n  LIMIT 1;\n  \n  -- Ensure profile exists and is correct\n  IF v_manager_user_id IS NOT NULL THEN\n    INSERT INTO public.profiles (id, email, full_name, role)\n    VALUES (v_manager_user_id, 'manager@dietneta.com', 'מנהל מערכת', 'admin')\n    ON CONFLICT (id) DO UPDATE\n      SET role = 'admin',\n          email = 'manager@dietneta.com',\n          full_name = 'מנהל מערכת';\n    \n    RAISE NOTICE '✅ Manager profile updated: manager@dietneta.com (ID: %)', v_manager_user_id;\n    RAISE NOTICE '⚠️  Password reset required. Run: node scripts/reset_manager_password.js';\n  ELSE\n    RAISE NOTICE '⚠️  Manager user not found. Please create using Supabase Auth signUp or admin API.';\n  END IF;\nEND $$"}	fix_manager_user_password
20240102000030	{"-- Migration: Add WhatsApp Flow Templates Table\n-- Description: Stores message templates for WhatsApp automation flows\n-- Created: 2024-01-02\n\n-- Create whatsapp_flow_templates table\nCREATE TABLE IF NOT EXISTS public.whatsapp_flow_templates (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  flow_key TEXT NOT NULL, -- e.g., 'customer_journey_start', 'intro_questionnaire'\n  template_content TEXT NOT NULL DEFAULT '', -- The message template with placeholders\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  \n  -- Ensure one template per flow per user\n  UNIQUE(user_id, flow_key)\n)","-- Add RLS policies\nALTER TABLE public.whatsapp_flow_templates ENABLE ROW LEVEL SECURITY","-- Policy: Users can view their own templates\nCREATE POLICY \\"Users can view own templates\\"\n  ON public.whatsapp_flow_templates\n  FOR SELECT\n  USING (auth.uid() = user_id)","-- Policy: Users can insert their own templates\nCREATE POLICY \\"Users can insert own templates\\"\n  ON public.whatsapp_flow_templates\n  FOR INSERT\n  WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own templates\nCREATE POLICY \\"Users can update own templates\\"\n  ON public.whatsapp_flow_templates\n  FOR UPDATE\n  USING (auth.uid() = user_id)\n  WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own templates\nCREATE POLICY \\"Users can delete own templates\\"\n  ON public.whatsapp_flow_templates\n  FOR DELETE\n  USING (auth.uid() = user_id)","-- Create index for faster lookups\nCREATE INDEX IF NOT EXISTS idx_whatsapp_flow_templates_user_flow \n  ON public.whatsapp_flow_templates(user_id, flow_key)","-- Create function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_whatsapp_flow_templates_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger to automatically update updated_at\nCREATE TRIGGER update_whatsapp_flow_templates_updated_at\n  BEFORE UPDATE ON public.whatsapp_flow_templates\n  FOR EACH ROW\n  EXECUTE FUNCTION update_whatsapp_flow_templates_updated_at()","-- Add comments\nCOMMENT ON TABLE public.whatsapp_flow_templates IS 'Stores WhatsApp message templates for automation flows'","COMMENT ON COLUMN public.whatsapp_flow_templates.flow_key IS 'Unique identifier for the flow (e.g., customer_journey_start, intro_questionnaire)'","COMMENT ON COLUMN public.whatsapp_flow_templates.template_content IS 'Message template with placeholders like {{name}}, {{phone}}, etc.'"}	add_whatsapp_flow_templates
20240102000031	{"-- Migration: Add buttons support to WhatsApp Flow Templates\n-- Description: Adds JSONB column to store interactive buttons for WhatsApp messages\n-- Created: 2024-01-02\n-- Migration number: 20240102000031 (must be last in sequence)\n\n-- Add buttons column to store interactive buttons array\nALTER TABLE public.whatsapp_flow_templates\nADD COLUMN IF NOT EXISTS buttons JSONB DEFAULT '[]'::jsonb","-- Add comment\nCOMMENT ON COLUMN public.whatsapp_flow_templates.buttons IS 'Array of interactive buttons: [{\\"id\\": \\"1\\", \\"text\\": \\"Button Text\\"}]'","-- Ensure any existing data complies with max 3 buttons rule before adding constraint\n-- This is safe because the column was just added, so there should be no existing data\n-- But we do this defensively in case the migration is run multiple times\nUPDATE public.whatsapp_flow_templates\nSET buttons = '[]'::jsonb\nWHERE buttons IS NULL \n   OR (jsonb_typeof(buttons) = 'array' AND jsonb_array_length(COALESCE(buttons, '[]'::jsonb)) > 3)","-- Add constraint to ensure buttons array has max 3 items (idempotent)\n-- Use DO block to safely handle constraint creation/dropping\nDO $$\nBEGIN\n    -- Drop constraint if it exists (in case of re-running migration)\n    IF EXISTS (\n        SELECT 1 FROM pg_constraint \n        WHERE conname = 'check_buttons_max_count' \n        AND conrelid = 'public.whatsapp_flow_templates'::regclass\n    ) THEN\n        ALTER TABLE public.whatsapp_flow_templates DROP CONSTRAINT check_buttons_max_count;\n    END IF;\n    \n    -- Add the constraint\n    ALTER TABLE public.whatsapp_flow_templates\n    ADD CONSTRAINT check_buttons_max_count \n    CHECK (jsonb_array_length(COALESCE(buttons, '[]'::jsonb)) <= 3);\nEXCEPTION\n    WHEN others THEN\n        -- If constraint creation fails, log but don't fail the migration\n        RAISE NOTICE 'Could not add check_buttons_max_count constraint: %', SQLERRM;\nEND $$"}	add_buttons_to_whatsapp_templates
20251228093611	{"-- Migration: Add Green API Settings Table\n-- Description: Stores Green API credentials in PostgreSQL instead of using Edge Functions\n-- Created: 2025-12-28\n-- Migration number: 20251228093611 (must be last in sequence)\n\n-- Create settings table for Green API credentials\nCREATE TABLE IF NOT EXISTS public.green_api_settings (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    id_instance TEXT NOT NULL,\n    api_token_instance TEXT NOT NULL,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    updated_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Enable RLS\nALTER TABLE public.green_api_settings ENABLE ROW LEVEL SECURITY","-- Policy: Authenticated users can read Green API settings (needed to send messages)\nCREATE POLICY \\"Authenticated users can read Green API settings\\"\n    ON public.green_api_settings FOR SELECT\n    USING (auth.uid() IS NOT NULL)","-- Policy: Only admins can insert Green API settings\nCREATE POLICY \\"Admins can insert Green API settings\\"\n    ON public.green_api_settings FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Only admins can update Green API settings\nCREATE POLICY \\"Admins can update Green API settings\\"\n    ON public.green_api_settings FOR UPDATE\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Only admins can delete Green API settings\nCREATE POLICY \\"Admins can delete Green API settings\\"\n    ON public.green_api_settings FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Trigger to auto-update updated_at and updated_by\nCREATE TRIGGER update_green_api_settings_updated_at\n    BEFORE UPDATE ON public.green_api_settings\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- Function to set created_by and updated_by on insert\nCREATE OR REPLACE FUNCTION set_green_api_settings_user()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.created_by = COALESCE(NEW.created_by, auth.uid());\n    NEW.updated_by = auth.uid();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Trigger to set user fields\nCREATE TRIGGER set_green_api_settings_user_trigger\n    BEFORE INSERT OR UPDATE ON public.green_api_settings\n    FOR EACH ROW\n    EXECUTE FUNCTION set_green_api_settings_user()","-- Add comments\nCOMMENT ON TABLE public.green_api_settings IS 'Stores Green API credentials for WhatsApp messaging'","COMMENT ON COLUMN public.green_api_settings.id_instance IS 'Green API instance ID'","COMMENT ON COLUMN public.green_api_settings.api_token_instance IS 'Green API token instance'"}	add_green_api_settings
20251228120000	{"-- Migration: Expand daily_check_ins table with comprehensive metrics\n-- This adds 19 new fields for luxury daily check-in tracking\n\n-- Physical measurements (6 fields)\nALTER TABLE daily_check_ins\n  ADD COLUMN IF NOT EXISTS weight NUMERIC(5,2), -- Weight in kg\n  ADD COLUMN IF NOT EXISTS belly_circumference INTEGER, -- היקף בטן in cm\n  ADD COLUMN IF NOT EXISTS waist_circumference INTEGER, -- היקף מותן in cm\n  ADD COLUMN IF NOT EXISTS thigh_circumference INTEGER, -- היקף ירכיים in cm\n  ADD COLUMN IF NOT EXISTS arm_circumference INTEGER, -- היקף יד in cm\n  ADD COLUMN IF NOT EXISTS neck_circumference INTEGER, -- היקף צוואר in cm\n  -- Activity metrics (3 new fields, steps_actual already exists)\n  ADD COLUMN IF NOT EXISTS exercises_count INTEGER, -- כמה תרגילים עשית\n  ADD COLUMN IF NOT EXISTS cardio_amount INTEGER, -- כמה אירובי עשית (minutes)\n  ADD COLUMN IF NOT EXISTS intervals_count INTEGER, -- כמה אינטרוולים\n  -- Nutrition and Hydration (4 fields)\n  ADD COLUMN IF NOT EXISTS calories_daily INTEGER, -- קלוריות יומי\n  ADD COLUMN IF NOT EXISTS protein_daily INTEGER, -- חלבון יומי in grams\n  ADD COLUMN IF NOT EXISTS fiber_daily INTEGER, -- סיבים יומי in grams\n  ADD COLUMN IF NOT EXISTS water_amount NUMERIC(5,2), -- כמה מים שתית in liters\n  -- Well-being scales 1-10 (3 fields)\n  ADD COLUMN IF NOT EXISTS stress_level INTEGER, -- רמת הלחץ היומי\n  ADD COLUMN IF NOT EXISTS hunger_level INTEGER, -- רמת הרעב שלך\n  ADD COLUMN IF NOT EXISTS energy_level INTEGER, -- רמת האנרגיה שלך\n  -- Rest (1 field)\n  ADD COLUMN IF NOT EXISTS sleep_hours NUMERIC(4,2)","-- כמה שעות ישנת\n\n-- Add CHECK constraints for well-being scales (must be done separately after columns exist)\nDO $$\nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_constraint WHERE conname = 'daily_check_ins_stress_level_check'\n  ) THEN\n    ALTER TABLE daily_check_ins\n      ADD CONSTRAINT daily_check_ins_stress_level_check \n        CHECK (stress_level IS NULL OR (stress_level >= 1 AND stress_level <= 10));\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_constraint WHERE conname = 'daily_check_ins_hunger_level_check'\n  ) THEN\n    ALTER TABLE daily_check_ins\n      ADD CONSTRAINT daily_check_ins_hunger_level_check \n        CHECK (hunger_level IS NULL OR (hunger_level >= 1 AND hunger_level <= 10));\n  END IF;\n\n  IF NOT EXISTS (\n    SELECT 1 FROM pg_constraint WHERE conname = 'daily_check_ins_energy_level_check'\n  ) THEN\n    ALTER TABLE daily_check_ins\n      ADD CONSTRAINT daily_check_ins_energy_level_check \n        CHECK (energy_level IS NULL OR (energy_level >= 1 AND energy_level <= 10));\n  END IF;\nEND $$","-- Add comments for documentation\nCOMMENT ON COLUMN daily_check_ins.weight IS 'Weight measurement in kg (משקל)'","COMMENT ON COLUMN daily_check_ins.belly_circumference IS 'Belly circumference in cm (היקף בטן)'","COMMENT ON COLUMN daily_check_ins.waist_circumference IS 'Waist circumference in cm (היקף מותן)'","COMMENT ON COLUMN daily_check_ins.thigh_circumference IS 'Thigh circumference in cm (היקף ירכיים)'","COMMENT ON COLUMN daily_check_ins.arm_circumference IS 'Arm circumference in cm (היקף יד)'","COMMENT ON COLUMN daily_check_ins.neck_circumference IS 'Neck circumference in cm (היקף צוואר)'","COMMENT ON COLUMN daily_check_ins.exercises_count IS 'Number of exercises completed (כמה תרגילים עשית)'","COMMENT ON COLUMN daily_check_ins.cardio_amount IS 'Cardio duration in minutes (כמה אירובי עשית)'","COMMENT ON COLUMN daily_check_ins.intervals_count IS 'Number of interval training sessions (כמה אינטרוולים)'","COMMENT ON COLUMN daily_check_ins.calories_daily IS 'Daily calorie intake (קלוריות יומי)'","COMMENT ON COLUMN daily_check_ins.protein_daily IS 'Daily protein intake in grams (חלבון יומי)'","COMMENT ON COLUMN daily_check_ins.fiber_daily IS 'Daily fiber intake in grams (סיבים יומי)'","COMMENT ON COLUMN daily_check_ins.water_amount IS 'Water consumed in liters (כמה מים שתית)'","COMMENT ON COLUMN daily_check_ins.stress_level IS 'Daily stress level 1-10 (רמת הלחץ היומי)'","COMMENT ON COLUMN daily_check_ins.hunger_level IS 'Hunger level 1-10 (רמת הרעב שלך)'","COMMENT ON COLUMN daily_check_ins.energy_level IS 'Energy level 1-10 (רמת האנרגיה שלך)'","COMMENT ON COLUMN daily_check_ins.sleep_hours IS 'Hours of sleep (כמה שעות ישנת)'"}	expand_daily_check_ins
20251229000000	{"-- =====================================================\n-- Budgets (Taktziv) Migration\n-- Created: 2024-12-29\n-- Description: Master budget templates that aggregate nutrition, workout, steps, and supplements\n-- =====================================================\n\n-- =====================================================\n-- TABLE: budgets (Budget Templates)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS budgets (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name TEXT NOT NULL,\n    description TEXT,\n    \n    -- Nutrition Master (can link to nutrition_template or have custom values)\n    nutrition_template_id UUID REFERENCES nutrition_templates(id) ON DELETE SET NULL,\n    nutrition_targets JSONB DEFAULT '{}'::jsonb,\n    -- Structure: { calories: number, protein: number, carbs: number, fat: number, fiber_min: number, water_min: number }\n    \n    -- Steps Module\n    steps_goal INTEGER DEFAULT 0,\n    steps_instructions TEXT,\n    \n    -- Workout Link\n    workout_template_id UUID REFERENCES workout_templates(id) ON DELETE SET NULL,\n    \n    -- Supplements Module (JSONB array)\n    supplements JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ name: string, dosage: string, timing: string }]\n    \n    -- Guidelines\n    eating_order TEXT, -- e.g., \\"Vegetables -> Protein -> Carbs\\"\n    eating_rules TEXT, -- e.g., \\"Don't eat carbs alone\\"\n    \n    -- Metadata\n    is_public BOOLEAN NOT NULL DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_budgets_created_by ON budgets(created_by)","CREATE INDEX IF NOT EXISTS idx_budgets_is_public ON budgets(is_public)","CREATE INDEX IF NOT EXISTS idx_budgets_nutrition_template_id ON budgets(nutrition_template_id)","CREATE INDEX IF NOT EXISTS idx_budgets_workout_template_id ON budgets(workout_template_id)","CREATE INDEX IF NOT EXISTS idx_budgets_nutrition_targets ON budgets USING GIN (nutrition_targets)","CREATE INDEX IF NOT EXISTS idx_budgets_supplements ON budgets USING GIN (supplements)","CREATE INDEX IF NOT EXISTS idx_budgets_created_at ON budgets(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_budgets_updated_at\n    BEFORE UPDATE ON budgets\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- TABLE: budget_assignments (Active Client Budgets)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS budget_assignments (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    budget_id UUID NOT NULL REFERENCES budgets(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE CASCADE,\n    customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n    \n    -- Assignment metadata\n    assigned_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    assigned_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    is_active BOOLEAN NOT NULL DEFAULT TRUE,\n    \n    -- Notes specific to this assignment\n    notes TEXT,\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_budget_assignments_budget_id ON budget_assignments(budget_id)","CREATE INDEX IF NOT EXISTS idx_budget_assignments_lead_id ON budget_assignments(lead_id)","CREATE INDEX IF NOT EXISTS idx_budget_assignments_customer_id ON budget_assignments(customer_id)","CREATE INDEX IF NOT EXISTS idx_budget_assignments_is_active ON budget_assignments(is_active)","CREATE INDEX IF NOT EXISTS idx_budget_assignments_assigned_at ON budget_assignments(assigned_at DESC)","-- Unique constraint: One active budget per lead/customer\nCREATE UNIQUE INDEX IF NOT EXISTS idx_budget_assignments_unique_active_lead \n    ON budget_assignments(lead_id) \n    WHERE is_active = TRUE AND lead_id IS NOT NULL","CREATE UNIQUE INDEX IF NOT EXISTS idx_budget_assignments_unique_active_customer \n    ON budget_assignments(customer_id) \n    WHERE is_active = TRUE AND customer_id IS NOT NULL","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_budget_assignments_updated_at\n    BEFORE UPDATE ON budget_assignments\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on budgets table\nALTER TABLE budgets ENABLE ROW LEVEL SECURITY","-- Policy: Users can view public budgets or their own budgets\nCREATE POLICY \\"Users can view public or own budgets\\"\n    ON budgets FOR SELECT\n    USING (\n        is_public = TRUE OR \n        created_by = auth.uid()\n    )","-- Policy: Users can insert their own budgets\nCREATE POLICY \\"Users can insert own budgets\\"\n    ON budgets FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own budgets\nCREATE POLICY \\"Users can update own budgets\\"\n    ON budgets FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own budgets\nCREATE POLICY \\"Users can delete own budgets\\"\n    ON budgets FOR DELETE\n    USING (auth.uid() = created_by)","-- Policy: Admins have full access to budgets\nCREATE POLICY \\"Admins have full access to budgets\\"\n    ON budgets FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Enable RLS on budget_assignments table\nALTER TABLE budget_assignments ENABLE ROW LEVEL SECURITY","-- Policy: Users can view assignments for their own leads/customers or if they created the budget\nCREATE POLICY \\"Users can view relevant budget assignments\\"\n    ON budget_assignments FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND (budgets.created_by = auth.uid() OR budgets.is_public = TRUE)\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Users can insert assignments if they own the budget\nCREATE POLICY \\"Users can insert budget assignments for own budgets\\"\n    ON budget_assignments FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND budgets.created_by = auth.uid()\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Users can update assignments if they own the budget\nCREATE POLICY \\"Users can update budget assignments for own budgets\\"\n    ON budget_assignments FOR UPDATE\n    USING (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND budgets.created_by = auth.uid()\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND budgets.created_by = auth.uid()\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- Policy: Users can delete assignments if they own the budget\nCREATE POLICY \\"Users can delete budget assignments for own budgets\\"\n    ON budget_assignments FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM budgets\n            WHERE budgets.id = budget_assignments.budget_id\n            AND budgets.created_by = auth.uid()\n        )\n        OR\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE budgets IS 'Master budget templates that aggregate nutrition, workout, steps, and supplements'","COMMENT ON COLUMN budgets.nutrition_targets IS 'JSONB containing macro targets: { calories: number, protein: number, carbs: number, fat: number, fiber_min: number, water_min: number }'","COMMENT ON COLUMN budgets.supplements IS 'JSONB array of supplements: [{ name: string, dosage: string, timing: string }]'","COMMENT ON TABLE budget_assignments IS 'Active budget assignments to leads/customers'","COMMENT ON COLUMN budget_assignments.is_active IS 'Only one active budget per lead/customer at a time'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_budgets
20251229000001	{"-- =====================================================\n-- Add 'budgets' to saved_views resource_key constraint\n-- Created: 2025-12-29\n-- Description: Allow saved views for budgets (Taktziv)\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'budgets'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_budgets_to_saved_views
20251230000000	{"-- Migration: Add check-in field configurations table\n-- Allows admins to customize which fields and sections are visible in client check-in forms\n\n-- Create check_in_field_configurations table\nCREATE TABLE IF NOT EXISTS check_in_field_configurations (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n  -- If customer_id is NULL, this is a global/default configuration\n  configuration JSONB NOT NULL DEFAULT '{}'::jsonb,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id),\n  \n  -- Ensure only one configuration per customer (or one global)\n  CONSTRAINT check_in_field_configurations_customer_unique UNIQUE (customer_id)\n)","-- Add index for faster lookups\nCREATE INDEX IF NOT EXISTS idx_check_in_field_configurations_customer_id \n  ON check_in_field_configurations(customer_id)","-- Add index for global configurations\nCREATE INDEX IF NOT EXISTS idx_check_in_field_configurations_global \n  ON check_in_field_configurations((customer_id IS NULL))","-- Enable RLS\nALTER TABLE check_in_field_configurations ENABLE ROW LEVEL SECURITY","-- RLS Policies\n-- Admins can read/write all configurations\nCREATE POLICY \\"Admins can manage all check-in field configurations\\"\n  ON check_in_field_configurations\n  FOR ALL\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'manager')\n    )\n  )","-- Clients can read their own configuration\nCREATE POLICY \\"Clients can read their check-in field configuration\\"\n  ON check_in_field_configurations\n  FOR SELECT\n  USING (\n    customer_id IN (\n      SELECT id FROM customers\n      WHERE user_id = auth.uid()\n    )\n    OR customer_id IS NULL -- Also allow reading global/default config\n  )","-- Function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_check_in_field_configurations_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Trigger to automatically update updated_at\nCREATE TRIGGER update_check_in_field_configurations_updated_at\n  BEFORE UPDATE ON check_in_field_configurations\n  FOR EACH ROW\n  EXECUTE FUNCTION update_check_in_field_configurations_updated_at()","-- Add comments\nCOMMENT ON TABLE check_in_field_configurations IS 'Stores configuration for check-in field visibility and labels per customer or globally'","COMMENT ON COLUMN check_in_field_configurations.customer_id IS 'Customer ID for customer-specific config, NULL for global/default config'","COMMENT ON COLUMN check_in_field_configurations.configuration IS 'JSONB object containing field visibility, labels, and section visibility settings'","-- Example configuration structure:\n-- {\n--   \\"sections\\": {\n--     \\"body\\": { \\"visible\\": true, \\"label\\": \\"מדדי גוף\\" },\n--     \\"activity\\": { \\"visible\\": true, \\"label\\": \\"פעילות\\" },\n--     \\"nutrition\\": { \\"visible\\": true, \\"label\\": \\"תזונה\\" },\n--     \\"wellness\\": { \\"visible\\": true, \\"label\\": \\"בריאות\\" }\n--   },\n--   \\"fields\\": {\n--     \\"weight\\": { \\"visible\\": true, \\"label\\": \\"משקל\\", \\"section\\": \\"body\\" },\n--     \\"bellyCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף בטן\\", \\"section\\": \\"body\\" },\n--     \\"waistCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף מותן\\", \\"section\\": \\"body\\" },\n--     \\"thighCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף ירכיים\\", \\"section\\": \\"body\\" },\n--     \\"armCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף יד\\", \\"section\\": \\"body\\" },\n--     \\"neckCircumference\\": { \\"visible\\": true, \\"label\\": \\"היקף צוואר\\", \\"section\\": \\"body\\" },\n--     \\"stepsActual\\": { \\"visible\\": true, \\"label\\": \\"מס' צעדים יומי\\", \\"section\\": \\"activity\\" },\n--     \\"exercisesCount\\": { \\"visible\\": true, \\"label\\": \\"כמה תרגילים עשית\\", \\"section\\": \\"activity\\" },\n--     \\"cardioAmount\\": { \\"visible\\": true, \\"label\\": \\"כמה אירובי עשית\\", \\"section\\": \\"activity\\" },\n--     \\"intervalsCount\\": { \\"visible\\": true, \\"label\\": \\"כמה אינטרוולים\\", \\"section\\": \\"activity\\" },\n--     \\"caloriesDaily\\": { \\"visible\\": true, \\"label\\": \\"קלוריות יומי\\", \\"section\\": \\"nutrition\\" },\n--     \\"proteinDaily\\": { \\"visible\\": true, \\"label\\": \\"חלבון יומי\\", \\"section\\": \\"nutrition\\" },\n--     \\"fiberDaily\\": { \\"visible\\": true, \\"label\\": \\"סיבים יומי\\", \\"section\\": \\"nutrition\\" },\n--     \\"waterAmount\\": { \\"visible\\": true, \\"label\\": \\"כמה מים שתית\\", \\"section\\": \\"nutrition\\" },\n--     \\"stressLevel\\": { \\"visible\\": true, \\"label\\": \\"רמת הלחץ היומי\\", \\"section\\": \\"wellness\\" },\n--     \\"hungerLevel\\": { \\"visible\\": true, \\"label\\": \\"רמת הרעב שלך\\", \\"section\\": \\"wellness\\" },\n--     \\"energyLevel\\": { \\"visible\\": true, \\"label\\": \\"רמת האנרגיה שלך\\", \\"section\\": \\"wellness\\" },\n--     \\"sleepHours\\": { \\"visible\\": true, \\"label\\": \\"כמה שעות ישנת\\", \\"section\\": \\"wellness\\" }\n--   }\n-- }"}	add_check_in_field_configurations
20251231000000	{"-- =====================================================\n-- Add Budget Links to Plans Migration\n-- Created: 2024-12-31\n-- Description: Links workout_plans, nutrition_plans, and supplement_plans to budgets\n-- =====================================================\n\n-- =====================================================\n-- Add budget_id to workout_plans\n-- =====================================================\n\nALTER TABLE workout_plans \nADD COLUMN IF NOT EXISTS budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL","CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_id ON workout_plans(budget_id)","-- =====================================================\n-- Add budget_id to nutrition_plans\n-- =====================================================\n\nALTER TABLE nutrition_plans \nADD COLUMN IF NOT EXISTS budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_id ON nutrition_plans(budget_id)","-- =====================================================\n-- Create supplement_plans table\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS supplement_plans (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    customer_id UUID REFERENCES customers(id) ON DELETE SET NULL,\n    budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL,\n    template_id UUID, -- For future use if supplement templates are created\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    end_date DATE,\n    description TEXT,\n    \n    -- Supplements (JSONB array)\n    supplements JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ name: string, dosage: string, timing: string }]\n    \n    -- Metadata\n    is_active BOOLEAN NOT NULL DEFAULT TRUE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_supplement_plans_user_id ON supplement_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_lead_id ON supplement_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_customer_id ON supplement_plans(customer_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_id ON supplement_plans(budget_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_start_date ON supplement_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_created_at ON supplement_plans(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_supplements ON supplement_plans USING GIN (supplements)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_supplement_plans_updated_at\n    BEFORE UPDATE ON supplement_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES for supplement_plans\n-- =====================================================\n\n-- Enable RLS on supplement_plans table\nALTER TABLE supplement_plans ENABLE ROW LEVEL SECURITY","-- Policy: Users can read their own supplement plans\nCREATE POLICY \\"Users can read own supplement plans\\"\n    ON supplement_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own supplement plans\nCREATE POLICY \\"Users can insert own supplement plans\\"\n    ON supplement_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own supplement plans\nCREATE POLICY \\"Users can update own supplement plans\\"\n    ON supplement_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own supplement plans\nCREATE POLICY \\"Users can delete own supplement plans\\"\n    ON supplement_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to supplement plans\nCREATE POLICY \\"Admins have full access to supplement plans\\"\n    ON supplement_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON COLUMN workout_plans.budget_id IS 'Reference to the budget this workout plan was created from'","COMMENT ON COLUMN nutrition_plans.budget_id IS 'Reference to the budget this nutrition plan was created from'","COMMENT ON TABLE supplement_plans IS 'Supplement plans linked to leads/customers and budgets'","COMMENT ON COLUMN supplement_plans.budget_id IS 'Reference to the budget this supplement plan was created from'","COMMENT ON COLUMN supplement_plans.supplements IS 'JSONB array of supplements: [{ name: string, dosage: string, timing: string }]'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_budget_links_to_plans
20260101000000	{"-- =====================================================\n-- Fix Budget Links to Plans and Create Supplement Plans\n-- Created: 2026-01-01\n-- Description: Ensures budget_id columns exist in workout_plans and nutrition_plans,\n--              and creates supplement_plans table if it doesn't exist\n-- =====================================================\n\n-- =====================================================\n-- Add budget_id to workout_plans (if not exists)\n-- =====================================================\n\nDO $$\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_name = 'workout_plans' \n        AND column_name = 'budget_id'\n    ) THEN\n        ALTER TABLE workout_plans \n        ADD COLUMN budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL;\n        \n        CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_id ON workout_plans(budget_id);\n        \n        COMMENT ON COLUMN workout_plans.budget_id IS 'Reference to the budget this workout plan was created from';\n    END IF;\nEND $$","-- =====================================================\n-- Add budget_id to nutrition_plans (if not exists)\n-- =====================================================\n\nDO $$\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_name = 'nutrition_plans' \n        AND column_name = 'budget_id'\n    ) THEN\n        ALTER TABLE nutrition_plans \n        ADD COLUMN budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL;\n        \n        CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_id ON nutrition_plans(budget_id);\n        \n        COMMENT ON COLUMN nutrition_plans.budget_id IS 'Reference to the budget this nutrition plan was created from';\n    END IF;\nEND $$","-- =====================================================\n-- Create supplement_plans table (if not exists)\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS supplement_plans (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    customer_id UUID REFERENCES customers(id) ON DELETE SET NULL,\n    budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL,\n    template_id UUID, -- For future use if supplement templates are created\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    end_date DATE,\n    description TEXT,\n    \n    -- Supplements (JSONB array)\n    supplements JSONB DEFAULT '[]'::jsonb,\n    -- Structure: [{ name: string, dosage: string, timing: string }]\n    \n    -- Metadata\n    is_active BOOLEAN NOT NULL DEFAULT TRUE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_supplement_plans_user_id ON supplement_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_lead_id ON supplement_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_customer_id ON supplement_plans(customer_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_id ON supplement_plans(budget_id)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_start_date ON supplement_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_created_at ON supplement_plans(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_supplement_plans_supplements ON supplement_plans USING GIN (supplements)","-- Trigger to auto-update updated_at (only if it doesn't exist)\nDO $$\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM pg_trigger \n        WHERE tgname = 'update_supplement_plans_updated_at'\n    ) THEN\n        CREATE TRIGGER update_supplement_plans_updated_at\n            BEFORE UPDATE ON supplement_plans\n            FOR EACH ROW\n            EXECUTE FUNCTION update_updated_at_column();\n    END IF;\nEND $$","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES for supplement_plans\n-- =====================================================\n\n-- Enable RLS on supplement_plans table\nALTER TABLE supplement_plans ENABLE ROW LEVEL SECURITY","-- Drop existing policies if they exist (to avoid conflicts)\nDROP POLICY IF EXISTS \\"Users can read own supplement plans\\" ON supplement_plans","DROP POLICY IF EXISTS \\"Users can insert own supplement plans\\" ON supplement_plans","DROP POLICY IF EXISTS \\"Users can update own supplement plans\\" ON supplement_plans","DROP POLICY IF EXISTS \\"Users can delete own supplement plans\\" ON supplement_plans","DROP POLICY IF EXISTS \\"Admins have full access to supplement plans\\" ON supplement_plans","-- Policy: Users can read their own supplement plans\nCREATE POLICY \\"Users can read own supplement plans\\"\n    ON supplement_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own supplement plans\nCREATE POLICY \\"Users can insert own supplement plans\\"\n    ON supplement_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own supplement plans\nCREATE POLICY \\"Users can update own supplement plans\\"\n    ON supplement_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own supplement plans\nCREATE POLICY \\"Users can delete own supplement plans\\"\n    ON supplement_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to supplement plans\nCREATE POLICY \\"Admins have full access to supplement plans\\"\n    ON supplement_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE supplement_plans IS 'Supplement plans linked to leads/customers and budgets'","COMMENT ON COLUMN supplement_plans.budget_id IS 'Reference to the budget this supplement plan was created from'","COMMENT ON COLUMN supplement_plans.supplements IS 'JSONB array of supplements: [{ name: string, dosage: string, timing: string }]'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_budget_links_and_supplement_plans
20260103000000	{"-- =====================================================\n-- Weekly Reviews Migration\n-- Created: 2026-01-03\n-- Description: Weekly strategy review module for trainer-client communication\n-- =====================================================\n\n-- =====================================================\n-- TABLE: weekly_reviews\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS weekly_reviews (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    \n    -- Links\n    lead_id UUID REFERENCES leads(id) ON DELETE CASCADE,\n    customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n    \n    -- Week identification\n    week_start_date DATE NOT NULL, -- First day of the week (typically Sunday or Monday)\n    week_end_date DATE NOT NULL,   -- Last day of the week\n    \n    -- Current Goals (from active budget/protocol at time of review)\n    target_calories INTEGER,\n    target_protein INTEGER, -- grams\n    target_carbs INTEGER,  -- grams\n    target_fat INTEGER,     -- grams\n    target_fiber INTEGER,   -- grams\n    target_steps INTEGER,\n    \n    -- Actual Averages (calculated from daily_check_ins for the week)\n    actual_calories_avg NUMERIC(10,2),\n    actual_protein_avg NUMERIC(10,2),\n    actual_carbs_avg NUMERIC(10,2),\n    actual_fat_avg NUMERIC(10,2),\n    actual_fiber_avg NUMERIC(10,2),\n    actual_calories_weekly_avg NUMERIC(10,2), -- Weekly average of daily calories\n    \n    -- Body Metrics\n    weekly_avg_weight NUMERIC(5,2), -- Average weight for the week\n    waist_measurement INTEGER,        -- Latest waist measurement from body metrics (cm)\n    \n    -- Trainer Inputs\n    trainer_summary TEXT,             -- סיכום ומסקנות (Summary & Insights)\n    action_plan TEXT,                 -- דגשים לשבוע הקרוב (Focus for next week)\n    \n    -- Protocol Updates (for next week)\n    updated_steps_goal INTEGER,       -- Updated step goal for following week\n    updated_calories_target INTEGER, -- Updated calorie target for following week\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL,\n    \n    -- Ensure one review per lead/customer per week\n    UNIQUE(lead_id, week_start_date),\n    UNIQUE(customer_id, week_start_date)\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_weekly_reviews_lead_id ON weekly_reviews(lead_id)","CREATE INDEX IF NOT EXISTS idx_weekly_reviews_customer_id ON weekly_reviews(customer_id)","CREATE INDEX IF NOT EXISTS idx_weekly_reviews_week_start ON weekly_reviews(week_start_date DESC)","CREATE INDEX IF NOT EXISTS idx_weekly_reviews_created_at ON weekly_reviews(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_weekly_reviews_updated_at\n    BEFORE UPDATE ON weekly_reviews\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\nALTER TABLE weekly_reviews ENABLE ROW LEVEL SECURITY","-- Policy: Trainees can view their own weekly reviews\nCREATE POLICY \\"Trainees can view own weekly reviews\\"\n    ON weekly_reviews FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM customers\n            WHERE customers.id = weekly_reviews.customer_id\n            AND customers.user_id = auth.uid()\n        )\n    )","-- Policy: Coaches/admins can view all weekly reviews\nCREATE POLICY \\"Coaches can view all weekly reviews\\"\n    ON weekly_reviews FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Coaches/admins can insert weekly reviews\nCREATE POLICY \\"Coaches can insert weekly reviews\\"\n    ON weekly_reviews FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Coaches/admins can update weekly reviews\nCREATE POLICY \\"Coaches can update weekly reviews\\"\n    ON weekly_reviews FOR UPDATE\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- Policy: Coaches/admins can delete weekly reviews\nCREATE POLICY \\"Coaches can delete weekly reviews\\"\n    ON weekly_reviews FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() \n            AND role IN ('admin', 'user')\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE weekly_reviews IS 'Weekly strategy reviews linking trainer insights with client check-in data'","COMMENT ON COLUMN weekly_reviews.week_start_date IS 'First day of the week being reviewed'","COMMENT ON COLUMN weekly_reviews.week_end_date IS 'Last day of the week being reviewed'","COMMENT ON COLUMN weekly_reviews.target_calories IS 'Target calories from active budget/protocol at time of review'","COMMENT ON COLUMN weekly_reviews.actual_calories_avg IS 'Average daily calories from check-ins during the week'","COMMENT ON COLUMN weekly_reviews.weekly_avg_weight IS 'Average weight for the week from daily check-ins'","COMMENT ON COLUMN weekly_reviews.waist_measurement IS 'Latest waist measurement from body metrics section'","COMMENT ON COLUMN weekly_reviews.trainer_summary IS 'Trainer summary and insights (סיכום ומסקנות)'","COMMENT ON COLUMN weekly_reviews.action_plan IS 'Action plan for next week (דגשים לשבוע הקרוב)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_weekly_reviews
20260104000000	{"-- Migration: Create Meetings Table\n-- Description: Stores meeting data from Fillout form submissions\n-- Created: 2026-01-04\n\n-- Create meetings table\nCREATE TABLE IF NOT EXISTS public.meetings (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  lead_id UUID REFERENCES public.leads(id) ON DELETE SET NULL,\n  customer_id UUID REFERENCES public.customers(id) ON DELETE SET NULL,\n  fillout_submission_id TEXT, -- ID from Fillout submission\n  meeting_data JSONB NOT NULL DEFAULT '{}'::jsonb, -- Flexible JSONB to store all form data\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Add indexes\nCREATE INDEX IF NOT EXISTS idx_meetings_lead_id ON public.meetings(lead_id)","CREATE INDEX IF NOT EXISTS idx_meetings_customer_id ON public.meetings(customer_id)","CREATE INDEX IF NOT EXISTS idx_meetings_created_at ON public.meetings(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_meetings_fillout_submission_id ON public.meetings(fillout_submission_id)","-- Add RLS policies\nALTER TABLE public.meetings ENABLE ROW LEVEL SECURITY","-- Policy: Managers can view all meetings\nCREATE POLICY \\"Managers can view all meetings\\"\n  ON public.meetings\n  FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can insert meetings\nCREATE POLICY \\"Managers can insert meetings\\"\n  ON public.meetings\n  FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can update meetings\nCREATE POLICY \\"Managers can update meetings\\"\n  ON public.meetings\n  FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can delete meetings\nCREATE POLICY \\"Managers can delete meetings\\"\n  ON public.meetings\n  FOR DELETE\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Create function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_meetings_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger to automatically update updated_at\nCREATE TRIGGER update_meetings_updated_at\n  BEFORE UPDATE ON public.meetings\n  FOR EACH ROW\n  EXECUTE FUNCTION update_meetings_updated_at()","-- Add comments\nCOMMENT ON TABLE public.meetings IS 'Stores meeting data from Fillout form submissions'","COMMENT ON COLUMN public.meetings.lead_id IS 'Link to the lead that the meeting is associated with'","COMMENT ON COLUMN public.meetings.customer_id IS 'Link to the customer that the meeting is associated with'","COMMENT ON COLUMN public.meetings.fillout_submission_id IS 'Unique identifier from Fillout submission'","COMMENT ON COLUMN public.meetings.meeting_data IS 'Flexible JSONB containing all meeting data from Fillout form'"}	create_meetings
20260104000001	{"-- =====================================================\n-- Add 'meetings' to saved_views resource_key constraint\n-- Created: 2026-01-04\n-- Description: Allow saved views for meetings (Pegishot)\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'meetings'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets', 'meetings'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_meetings_to_saved_views
20260104000002	{"-- =====================================================\n-- Fix Meetings RLS Policies\n-- Created: 2026-01-04\n-- Description: Update RLS policies to use 'admin' and 'user' roles instead of 'manager'\n-- =====================================================\n\n-- Drop existing policies\nDROP POLICY IF EXISTS \\"Managers can view all meetings\\" ON public.meetings","DROP POLICY IF EXISTS \\"Managers can insert meetings\\" ON public.meetings","DROP POLICY IF EXISTS \\"Managers can update meetings\\" ON public.meetings","DROP POLICY IF EXISTS \\"Managers can delete meetings\\" ON public.meetings","-- Policy: Admins and users (managers) can view all meetings\nCREATE POLICY \\"Admins and users can view all meetings\\"\n  ON public.meetings\n  FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )","-- Policy: Admins and users can insert meetings\nCREATE POLICY \\"Admins and users can insert meetings\\"\n  ON public.meetings\n  FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )","-- Policy: Admins and users can update meetings\nCREATE POLICY \\"Admins and users can update meetings\\"\n  ON public.meetings\n  FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )","-- Policy: Admins and users can delete meetings\nCREATE POLICY \\"Admins and users can delete meetings\\"\n  ON public.meetings\n  FOR DELETE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user')\n    )\n  )","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_meetings_rls_policies
20260104000003	{"-- Migration: Backfill Meeting Data from Fillout\n-- Description: This migration provides a function to re-sync meeting_data from Fillout API\n--              for existing meetings that only have metadata. Run this manually via Supabase SQL editor\n--              or create an Edge Function to trigger it.\n-- Created: 2026-01-04\n\n-- Note: This migration doesn't automatically backfill data.\n-- To backfill existing meetings, you need to:\n-- 1. Call the sync-fillout-meetings Edge Function which will update existing meetings\n-- 2. Or manually update meetings via the Supabase dashboard\n-- 3. Or create a one-time script to fetch from Fillout API and update meeting_data\n\n-- The sync-fillout-meetings function has been updated to properly extract all question data\n-- including the Schedule field. When you run the sync, it will update existing meetings\n-- with the full meeting_data including all form fields.\n\n-- This migration file serves as documentation that the extraction logic has been improved.\n-- No database schema changes are needed as meeting_data is already JSONB and can store any structure.\n\nCOMMENT ON COLUMN public.meetings.meeting_data IS 'Flexible JSONB containing all meeting data from Fillout form, including Schedule field for actual meeting date/time'"}	backfill_meeting_data_from_fillout
20260104000004	{"-- =====================================================\n-- Add 'check_in_settings' to saved_views resource_key constraint\n-- Created: 2026-01-04\n-- Description: Allow saved views for check-in settings\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'check_in_settings'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets', 'meetings', 'check_in_settings'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_check_in_settings_to_saved_views
20260104000005	{"-- =====================================================\n-- Add attachment_url column to customer_notes table\n-- Created: 2026-01-04\n-- Description: Allow notes to have file attachments stored in Supabase Storage\n-- =====================================================\n\n-- Add attachment_url column to store the file path in Supabase Storage\nALTER TABLE customer_notes \n  ADD COLUMN IF NOT EXISTS attachment_url TEXT","-- Create index for faster queries on notes with attachments\nCREATE INDEX IF NOT EXISTS idx_customer_notes_attachment_url \n  ON customer_notes(attachment_url) \n  WHERE attachment_url IS NOT NULL","-- Add comment for documentation\nCOMMENT ON COLUMN customer_notes.attachment_url IS 'URL/path to file attachment in Supabase Storage (client-assets bucket)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_attachment_url_to_customer_notes
20260104000006	{"-- =====================================================\n-- Create client-assets storage bucket with RLS policies\n-- Created: 2026-01-04\n-- Description: Storage bucket for progress photos and note attachments\n-- Path structure: [client_id]/progress/[file_name] and [client_id]/notes/[file_name]\n-- \n-- NOTE: Storage buckets must be created via Supabase Dashboard or CLI.\n-- This migration only sets up RLS policies for the 'client-assets' bucket.\n-- \n-- To create the bucket:\n-- 1. Via Supabase Dashboard: Go to Storage > Create Bucket > Name: \\"client-assets\\" > Public: false\n-- 2. Via CLI: Use Supabase Management API or create manually in dashboard\n-- \n-- The bucket should have:\n-- - Name: client-assets\n-- - Public: false (private, uses signed URLs)\n-- - File size limit: 10MB\n-- - Allowed MIME types: image/*, application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document\n-- \n-- IMPORTANT: Storage must be enabled in supabase/config.toml ([storage] enabled = true)\n-- and the bucket must be created before these policies will work.\n-- \n-- For local development:\n-- 1. Enable storage in supabase/config.toml: [storage] enabled = true\n-- 2. Restart Supabase: npx supabase stop && npx supabase start\n-- 3. Create the bucket via Supabase Studio (http://localhost:54323) > Storage > Create Bucket\n-- \n-- If storage is not enabled locally, this migration will fail. That's expected.\n-- The migration will work correctly in production/remote Supabase where storage is enabled.\n-- =====================================================\n\n-- Only create policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- RLS Policy: Allow trainees to upload files to their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can upload to own client folder\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can upload to own client folder\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      (\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''progress''\n        OR\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''notes''\n      )\n    )';\n\n    -- RLS Policy: Allow trainees to view files in their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can view own client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can view own client files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      (\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''progress''\n        OR\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''notes''\n      )\n    )';\n\n    -- RLS Policy: Allow trainees to delete files from their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can delete own client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can delete own client files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      (\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''progress''\n        OR\n        EXISTS (\n          SELECT 1 FROM customers\n          WHERE customers.id::text = (storage.foldername(name))[1]\n          AND customers.user_id = auth.uid()\n        ) AND\n        (storage.foldername(name))[2] = ''notes''\n      )\n    )';\n\n    -- RLS Policy: Allow managers/admins to upload files for any client\n    DROP POLICY IF EXISTS \\"Managers can upload client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can upload client files\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (\n        (storage.foldername(name))[2] = ''progress'' OR\n        (storage.foldername(name))[2] = ''notes''\n      )\n    )';\n\n    -- RLS Policy: Allow managers/admins to view all client files\n    DROP POLICY IF EXISTS \\"Managers can view all client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can view all client files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      )\n    )';\n\n    -- RLS Policy: Allow managers/admins to delete all client files\n    DROP POLICY IF EXISTS \\"Managers can delete all client files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can delete all client files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      )\n    )';\n\n    RAISE NOTICE 'Storage RLS policies created successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy creation. Enable storage in config.toml and restart Supabase to create policies.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_client_assets_storage_bucket
20260104000007	{"-- =====================================================\n-- Create Steps Plans Table Migration\n-- Created: 2026-01-04\n-- Description: Create steps_plans table similar to supplement_plans\n-- =====================================================\n\n-- =====================================================\n-- Create steps_plans table\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS steps_plans (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n    customer_id UUID REFERENCES customers(id) ON DELETE SET NULL,\n    budget_id UUID REFERENCES budgets(id) ON DELETE SET NULL,\n    template_id UUID, -- For future use if steps templates are created\n    \n    -- Standard fields\n    start_date DATE NOT NULL,\n    end_date DATE,\n    description TEXT,\n    \n    -- Steps data\n    steps_goal INTEGER NOT NULL DEFAULT 0,\n    steps_instructions TEXT,\n    \n    -- Metadata\n    is_active BOOLEAN NOT NULL DEFAULT TRUE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_steps_plans_user_id ON steps_plans(user_id)","CREATE INDEX IF NOT EXISTS idx_steps_plans_lead_id ON steps_plans(lead_id)","CREATE INDEX IF NOT EXISTS idx_steps_plans_customer_id ON steps_plans(customer_id)","CREATE INDEX IF NOT EXISTS idx_steps_plans_budget_id ON steps_plans(budget_id)","CREATE INDEX IF NOT EXISTS idx_steps_plans_start_date ON steps_plans(start_date DESC)","CREATE INDEX IF NOT EXISTS idx_steps_plans_created_at ON steps_plans(created_at DESC)","-- Trigger to auto-update updated_at\n-- Ensure the function exists first\nCREATE OR REPLACE FUNCTION public.update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = NOW();\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","CREATE TRIGGER update_steps_plans_updated_at\n    BEFORE UPDATE ON steps_plans\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES for steps_plans\n-- =====================================================\n\n-- Enable RLS on steps_plans table\nALTER TABLE steps_plans ENABLE ROW LEVEL SECURITY","-- Policy: Users can read their own steps plans\nCREATE POLICY \\"Users can read own steps plans\\"\n    ON steps_plans FOR SELECT\n    USING (auth.uid() = user_id)","-- Policy: Users can insert their own steps plans\nCREATE POLICY \\"Users can insert own steps plans\\"\n    ON steps_plans FOR INSERT\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can update their own steps plans\nCREATE POLICY \\"Users can update own steps plans\\"\n    ON steps_plans FOR UPDATE\n    USING (auth.uid() = user_id)\n    WITH CHECK (auth.uid() = user_id)","-- Policy: Users can delete their own steps plans\nCREATE POLICY \\"Users can delete own steps plans\\"\n    ON steps_plans FOR DELETE\n    USING (auth.uid() = user_id)","-- Policy: Admins have full access to steps plans\nCREATE POLICY \\"Admins have full access to steps plans\\"\n    ON steps_plans FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE steps_plans IS 'Steps plans linked to leads/customers and budgets'","COMMENT ON COLUMN steps_plans.budget_id IS 'Reference to the budget this steps plan was created from'","COMMENT ON COLUMN steps_plans.steps_goal IS 'Daily steps goal for this plan'","COMMENT ON COLUMN steps_plans.steps_instructions IS 'Instructions and guidelines for daily steps'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_steps_plans
20260104000008	{"-- =====================================================\n-- Prevent Duplicate Plans Per Budget Migration\n-- Created: 2026-01-04\n-- Description: Prevents duplicate plans (workout, nutrition, steps, supplement) \n--              for the same budget + customer/lead combination\n-- =====================================================\n\n-- =====================================================\n-- STEP 1: Clean up existing duplicates\n-- Keep only the most recent plan per budget_id + customer_id/lead_id combination\n-- =====================================================\n\n-- Clean up duplicate workout_plans (only if budget_id column exists)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY created_at DESC\n        ) as rn\n      FROM workout_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM workout_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate nutrition_plans (only if budget_id column exists)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY created_at DESC\n        ) as rn\n      FROM nutrition_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM nutrition_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate steps_plans\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY created_at DESC\n        ) as rn\n      FROM steps_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM steps_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate supplement_plans (only if budget_id column exists)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id, COALESCE(customer_id::text, ''''), COALESCE(lead_id::text, '''')\n          ORDER BY created_at DESC\n        ) as rn\n      FROM supplement_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM supplement_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- =====================================================\n-- STEP 2: Create unique partial indexes to prevent future duplicates\n-- These indexes ensure only one plan per budget + customer/lead combination\n-- =====================================================\n\n-- Unique index for workout_plans (when budget_id is set)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_workout_plans_unique_budget_customer\n    ON workout_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_workout_plans_unique_budget_lead\n    ON workout_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Unique index for nutrition_plans (when budget_id is set)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_nutrition_plans_unique_budget_customer\n    ON nutrition_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_nutrition_plans_unique_budget_lead\n    ON nutrition_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Unique index for steps_plans (when budget_id is set)\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_steps_plans_unique_budget_customer\n    ON steps_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_steps_plans_unique_budget_lead\n    ON steps_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Unique index for supplement_plans (when budget_id is set)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_supplement_plans_unique_budget_customer\n    ON supplement_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_supplement_plans_unique_budget_lead\n    ON supplement_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- =====================================================\n-- COMMENTS (only if indexes exist)\n-- =====================================================\n\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_workout_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_workout_plans_unique_budget_customer IS ''Ensures only one workout plan per budget + customer combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_workout_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_workout_plans_unique_budget_lead IS ''Ensures only one workout plan per budget + lead combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_nutrition_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_nutrition_plans_unique_budget_customer IS ''Ensures only one nutrition plan per budget + customer combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_nutrition_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_nutrition_plans_unique_budget_lead IS ''Ensures only one nutrition plan per budget + lead combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_supplement_plans_unique_budget_customer') THEN\n    EXECUTE 'COMMENT ON INDEX idx_supplement_plans_unique_budget_customer IS ''Ensures only one supplement plan per budget + customer combination''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_supplement_plans_unique_budget_lead') THEN\n    EXECUTE 'COMMENT ON INDEX idx_supplement_plans_unique_budget_lead IS ''Ensures only one supplement plan per budget + lead combination''';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	prevent_duplicate_plans_per_budget
20260104000009	{"-- =====================================================\n-- Create Payments Table\n-- Created: 2026-01-04\n-- Description: Secure payments table for tracking customer/lead payments\n--              NO sensitive data (card numbers, CVV, passwords) stored\n--              Links to both customers and leads\n-- =====================================================\n\n-- Create payments table\nCREATE TABLE IF NOT EXISTS public.payments (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    customer_id UUID NOT NULL REFERENCES public.customers(id) ON DELETE CASCADE,\n    lead_id UUID REFERENCES public.leads(id) ON DELETE SET NULL,\n    product_name TEXT NOT NULL,\n    amount NUMERIC(10, 2) NOT NULL CHECK (amount >= 0),\n    currency TEXT NOT NULL DEFAULT 'ILS',\n    status TEXT NOT NULL CHECK (status IN ('שולם', 'ממתין', 'הוחזר', 'נכשל')),\n    stripe_payment_id TEXT,\n    transaction_id TEXT,\n    receipt_url TEXT,\n    notes TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Create indexes for efficient queries\nCREATE INDEX IF NOT EXISTS idx_payments_customer_id ON public.payments(customer_id)","CREATE INDEX IF NOT EXISTS idx_payments_lead_id ON public.payments(lead_id)","CREATE INDEX IF NOT EXISTS idx_payments_created_at ON public.payments(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_payments_status ON public.payments(status)","CREATE INDEX IF NOT EXISTS idx_payments_stripe_payment_id ON public.payments(stripe_payment_id) WHERE stripe_payment_id IS NOT NULL","-- Create trigger for auto-updating updated_at\nCREATE TRIGGER update_payments_updated_at\n    BEFORE UPDATE ON public.payments\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS on payments table\nALTER TABLE public.payments ENABLE ROW LEVEL SECURITY","-- RLS Policies for payments\n-- Authenticated users can read payments for customers/leads they have access to\nDROP POLICY IF EXISTS \\"Authenticated users can read payments\\" ON public.payments","CREATE POLICY \\"Authenticated users can read payments\\"\n    ON public.payments FOR SELECT\n    USING (\n        auth.role() = 'authenticated' AND (\n            -- Users can see payments for customers they have access to\n            EXISTS (\n                SELECT 1 FROM public.customers\n                WHERE customers.id = payments.customer_id\n            )\n            OR\n            -- Admins can see all payments\n            EXISTS (\n                SELECT 1 FROM public.profiles\n                WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n            )\n        )\n    )","-- Authenticated users can insert payments\nDROP POLICY IF EXISTS \\"Authenticated users can insert payments\\" ON public.payments","CREATE POLICY \\"Authenticated users can insert payments\\"\n    ON public.payments FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","-- Authenticated users can update payments\nDROP POLICY IF EXISTS \\"Authenticated users can update payments\\" ON public.payments","CREATE POLICY \\"Authenticated users can update payments\\"\n    ON public.payments FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","-- Admins have full access to payments\nDROP POLICY IF EXISTS \\"Admins have full access to payments\\" ON public.payments","CREATE POLICY \\"Admins have full access to payments\\"\n    ON public.payments FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM public.profiles\n            WHERE profiles.id = auth.uid() AND profiles.role = 'admin'\n        )\n    )","-- Add comment to table\nCOMMENT ON TABLE public.payments IS 'Customer/lead payment records. NO sensitive payment data (card numbers, CVV, passwords) stored.'","COMMENT ON COLUMN public.payments.stripe_payment_id IS 'Stripe payment intent ID - external reference only'","COMMENT ON COLUMN public.payments.transaction_id IS 'Transaction ID for tracking purposes'","COMMENT ON COLUMN public.payments.receipt_url IS 'URL to receipt document (stored in secure storage)'","COMMENT ON COLUMN public.payments.status IS 'Payment status in Hebrew: שולם (paid), ממתין (pending), הוחזר (refunded), נכשל (failed)'"}	create_payments
20260111161628	{"-- Migration: Add Media Support to WhatsApp Flow Templates\n-- Description: Adds media column to store image, video, or GIF URLs\n-- Created: 2026-01-11\n\n-- Add media column to whatsapp_flow_templates table\n-- Media is stored as JSONB with structure: { type: 'image'|'video'|'gif', url: string }\nALTER TABLE public.whatsapp_flow_templates\nADD COLUMN IF NOT EXISTS media JSONB DEFAULT NULL","-- Add comment\nCOMMENT ON COLUMN public.whatsapp_flow_templates.media IS 'Media attachment for template (image, video, or GIF) stored as JSONB: { type: \\"image\\"|\\"video\\"|\\"gif\\", url: string }'","-- Add index for faster queries if needed\nCREATE INDEX IF NOT EXISTS idx_whatsapp_flow_templates_media \nON public.whatsapp_flow_templates USING gin(media)"}	add_media_to_whatsapp_templates
20260111162708	{"-- =====================================================\n-- Ensure client-assets storage bucket exists with templates folder policies\n-- Created: 2026-01-11\n-- Description: Ensures the client-assets bucket exists and has RLS policies for templates folder\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Ensure storage bucket exists (idempotent)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'buckets'\n  ) THEN\n    -- Insert bucket if it doesn't exist (idempotent)\n    INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)\n    VALUES (\n      'client-assets',\n      'client-assets',\n      false, -- private bucket (uses signed URLs)\n      52428800, -- 50MB file size limit (in bytes) - matches config.toml\n      ARRAY[\n        'image/jpeg',\n        'image/jpg', \n        'image/png',\n        'image/gif',\n        'image/webp',\n        'video/mp4',\n        'video/mpeg',\n        'video/quicktime',\n        'application/pdf',\n        'application/msword',\n        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n      ]::text[]\n    )\n    ON CONFLICT (id) DO UPDATE SET\n      file_size_limit = EXCLUDED.file_size_limit,\n      allowed_mime_types = EXCLUDED.allowed_mime_types;\n    \n    RAISE NOTICE 'Storage bucket \\"client-assets\\" ensured successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping bucket creation. Enable storage in config.toml and restart Supabase.';\n  END IF;\nEND $$","-- Add RLS policies for templates folder if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- RLS Policy: Allow authenticated users (managers/admins) to upload template files\n    -- Path structure: templates/{user_id}/{flow_key}/{filename}\n    DROP POLICY IF EXISTS \\"Managers can upload template files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can upload template files\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''templates''\n    )';\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to view template files\n    DROP POLICY IF EXISTS \\"Managers can view template files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can view template files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''templates''\n    )';\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to delete template files\n    DROP POLICY IF EXISTS \\"Managers can delete template files\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can delete template files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''templates''\n    )';\n\n    RAISE NOTICE 'Storage RLS policies for templates folder created successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy creation. Enable storage in config.toml and restart Supabase to create policies.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	ensure_client_assets_storage_bucket
20260112000000	{"-- =====================================================\n-- Add Storage Policies for Workout Exercises Media\n-- Created: 2026-01-12\n-- Description: Adds RLS policies to allow managers/admins to upload and manage\n--              images and videos for workout exercises in the client-assets bucket\n-- Path structure: workout-exercises/[exercise_id]/[images|videos]/[file_name]\n-- =====================================================\n\n-- Only create policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- RLS Policy: Allow managers/admins to upload workout exercise media\n    DROP POLICY IF EXISTS \\"Managers can upload workout exercise media\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can upload workout exercise media\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''workout-exercises''\n    )';\n\n    -- RLS Policy: Allow managers/admins to view workout exercise media\n    DROP POLICY IF EXISTS \\"Managers can view workout exercise media\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can view workout exercise media\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      (\n        EXISTS (\n          SELECT 1 FROM profiles\n          WHERE profiles.id = auth.uid()\n          AND profiles.role IN (''admin'', ''user'')\n        ) AND\n        (storage.foldername(name))[1] = ''workout-exercises''\n      )\n    )';\n\n    -- RLS Policy: Allow managers/admins to delete workout exercise media\n    DROP POLICY IF EXISTS \\"Managers can delete workout exercise media\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can delete workout exercise media\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[1] = ''workout-exercises''\n    )';\n\n    RAISE NOTICE 'Workout exercises storage RLS policies created successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy creation. Enable storage in config.toml and restart Supabase to create policies.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_workout_exercises_storage_policies
20260113000000	{"-- =====================================================\n-- Subscription Types (Sugei Menuyim) Migration\n-- Created: 2026-01-13\n-- Description: Master subscription type templates for leads\n-- =====================================================\n\n-- =====================================================\n-- TABLE: subscription_types\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS subscription_types (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name TEXT NOT NULL,\n    duration INTEGER NOT NULL, -- Duration in months\n    price NUMERIC(10, 2) NOT NULL, -- Price in NIS\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_subscription_types_created_by ON subscription_types(created_by)","CREATE INDEX IF NOT EXISTS idx_subscription_types_created_at ON subscription_types(created_at DESC)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_subscription_types_updated_at\n    BEFORE UPDATE ON subscription_types\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on subscription_types table\nALTER TABLE subscription_types ENABLE ROW LEVEL SECURITY","-- Policy: Users can view all subscription types\nCREATE POLICY \\"Users can view subscription types\\"\n    ON subscription_types FOR SELECT\n    USING (true)","-- Policy: Users can insert their own subscription types\nCREATE POLICY \\"Users can insert own subscription types\\"\n    ON subscription_types FOR INSERT\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can update their own subscription types\nCREATE POLICY \\"Users can update own subscription types\\"\n    ON subscription_types FOR UPDATE\n    USING (auth.uid() = created_by)\n    WITH CHECK (auth.uid() = created_by)","-- Policy: Users can delete their own subscription types\nCREATE POLICY \\"Users can delete own subscription types\\"\n    ON subscription_types FOR DELETE\n    USING (auth.uid() = created_by)","-- Policy: Admins have full access to subscription types\nCREATE POLICY \\"Admins have full access to subscription types\\"\n    ON subscription_types FOR ALL\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE id = auth.uid() AND role = 'admin'\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE subscription_types IS 'Master subscription type templates that can be used to populate lead subscription data'","COMMENT ON COLUMN subscription_types.duration IS 'Duration in months (e.g., 3, 6, 12)'","COMMENT ON COLUMN subscription_types.price IS 'Price in NIS (e.g., 299.99)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_subscription_types
20260114000000	{"-- =====================================================\n-- Blood Tests (Bedikot Dam) Migration\n-- Created: 2026-01-14\n-- Description: Blood test PDF uploads for leads\n-- =====================================================\n\n-- =====================================================\n-- TABLE: blood_tests\n-- =====================================================\n\nCREATE TABLE IF NOT EXISTS blood_tests (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    lead_id UUID NOT NULL REFERENCES leads(id) ON DELETE CASCADE,\n    file_url TEXT NOT NULL, -- Storage path in client-assets bucket\n    file_name TEXT NOT NULL, -- Original file name\n    upload_date TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    \n    -- Metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    uploaded_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_blood_tests_lead_id ON blood_tests(lead_id)","CREATE INDEX IF NOT EXISTS idx_blood_tests_upload_date ON blood_tests(upload_date DESC)","CREATE INDEX IF NOT EXISTS idx_blood_tests_uploaded_by ON blood_tests(uploaded_by)","-- Trigger to auto-update updated_at\nCREATE TRIGGER update_blood_tests_updated_at\n    BEFORE UPDATE ON blood_tests\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column()","-- =====================================================\n-- ROW LEVEL SECURITY (RLS) POLICIES\n-- =====================================================\n\n-- Enable RLS on blood_tests table\nALTER TABLE blood_tests ENABLE ROW LEVEL SECURITY","-- Policy: Users can view blood tests for leads they have access to\nCREATE POLICY \\"Users can view blood tests for accessible leads\\"\n    ON blood_tests FOR SELECT\n    USING (\n        EXISTS (\n            SELECT 1 FROM leads\n            WHERE leads.id = blood_tests.lead_id\n            AND (\n                leads.assigned_to = auth.uid()\n                OR EXISTS (\n                    SELECT 1 FROM profiles\n                    WHERE profiles.id = auth.uid()\n                    AND profiles.role IN ('admin', 'user')\n                )\n                OR EXISTS (\n                    SELECT 1 FROM customers\n                    JOIN leads ON leads.customer_id = customers.id\n                    WHERE leads.id = blood_tests.lead_id\n                    AND customers.id IN (\n                        SELECT customer_id FROM profiles\n                        WHERE profiles.id = auth.uid()\n                        AND profiles.role = 'trainee'\n                    )\n                )\n            )\n        )\n    )","-- Policy: Trainees can insert blood tests for their own customer's leads\nCREATE POLICY \\"Trainees can insert blood tests for their customer\\"\n    ON blood_tests FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM leads\n            JOIN customers ON customers.id = leads.customer_id\n            WHERE leads.id = blood_tests.lead_id\n            AND customers.id IN (\n                SELECT customer_id FROM profiles\n                WHERE profiles.id = auth.uid()\n                AND profiles.role = 'trainee'\n            )\n        )\n        AND auth.uid() = uploaded_by\n    )","-- Policy: Managers/admins can insert blood tests for any lead\nCREATE POLICY \\"Managers can insert blood tests\\"\n    ON blood_tests FOR INSERT\n    WITH CHECK (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE profiles.id = auth.uid()\n            AND profiles.role IN ('admin', 'user')\n        )\n        AND (\n            auth.uid() = uploaded_by\n            OR uploaded_by IS NULL\n        )\n    )","-- Policy: Trainees can delete their own blood tests\nCREATE POLICY \\"Trainees can delete their own blood tests\\"\n    ON blood_tests FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM leads\n            JOIN customers ON customers.id = leads.customer_id\n            WHERE leads.id = blood_tests.lead_id\n            AND customers.id IN (\n                SELECT customer_id FROM profiles\n                WHERE profiles.id = auth.uid()\n                AND profiles.role = 'trainee'\n            )\n        )\n        AND uploaded_by = auth.uid()\n    )","-- Policy: Managers/admins can delete any blood test\nCREATE POLICY \\"Managers can delete blood tests\\"\n    ON blood_tests FOR DELETE\n    USING (\n        EXISTS (\n            SELECT 1 FROM profiles\n            WHERE profiles.id = auth.uid()\n            AND profiles.role IN ('admin', 'user')\n        )\n    )","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nCOMMENT ON TABLE blood_tests IS 'Blood test PDF files uploaded by clients or managers'","COMMENT ON COLUMN blood_tests.lead_id IS 'Reference to the lead (client)'","COMMENT ON COLUMN blood_tests.file_url IS 'Storage path in client-assets bucket (e.g., customer_id/blood-tests/filename.pdf)'","COMMENT ON COLUMN blood_tests.file_name IS 'Original file name for display'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_blood_tests
20260114000001	{"-- =====================================================\n-- Add Storage Policies for Blood Tests\n-- Created: 2026-01-14\n-- Description: Add RLS policies for blood-tests folder in client-assets bucket\n-- =====================================================\n\n-- Only create policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- RLS Policy: Allow trainees to upload blood test PDFs to their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can upload blood tests to own client folder\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can upload blood tests to own client folder\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = (storage.foldername(name))[1]\n        AND customers.user_id = auth.uid()\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow trainees to view blood test PDFs in their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can view own blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can view own blood tests\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = (storage.foldername(name))[1]\n        AND customers.user_id = auth.uid()\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow trainees to delete blood test PDFs from their own client_id folder\n    DROP POLICY IF EXISTS \\"Trainees can delete own blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Trainees can delete own blood tests\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM customers\n        WHERE customers.id::text = (storage.foldername(name))[1]\n        AND customers.user_id = auth.uid()\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow managers/admins to upload blood test PDFs for any client\n    DROP POLICY IF EXISTS \\"Managers can upload blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can upload blood tests\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow managers/admins to view all blood test PDFs\n    DROP POLICY IF EXISTS \\"Managers can view all blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can view all blood tests\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    -- RLS Policy: Allow managers/admins to delete all blood test PDFs\n    DROP POLICY IF EXISTS \\"Managers can delete all blood tests\\" ON storage.objects;\n    EXECUTE '\n    CREATE POLICY \\"Managers can delete all blood tests\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = ''client-assets'' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN (''admin'', ''user'')\n      ) AND\n      (storage.foldername(name))[2] = ''blood-tests''\n    )';\n\n    RAISE NOTICE 'Blood tests storage RLS policies created successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy creation. Enable storage in config.toml and restart Supabase to create policies.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_blood_tests_storage_policies
20260121000001	{"-- =====================================================\n-- Fix workout-exercises folder storage RLS policies\n-- Created: 2026-01-21\n-- Description: Updates RLS policies for workout-exercises folder to use more reliable path matching\n--              Replaces storage.foldername(name)[1] with LIKE pattern for better reliability\n--              Path structure: workout-exercises/{exercise_id}/images/{filename} or workout-exercises/{exercise_id}/videos/{filename}\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Only update policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Drop existing policies\n    DROP POLICY IF EXISTS \\"Managers can upload workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view workout exercise media\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete workout exercise media\\" ON storage.objects;\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to upload workout exercise media\n    -- Path structure: workout-exercises/{exercise_id}/images/{filename} or workout-exercises/{exercise_id}/videos/{filename}\n    -- Using LIKE pattern for more reliable path matching\n    CREATE POLICY \\"Managers can upload workout exercise media\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      name LIKE 'workout-exercises/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to view workout exercise media\n    CREATE POLICY \\"Managers can view workout exercise media\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'workout-exercises/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to delete workout exercise media\n    CREATE POLICY \\"Managers can delete workout exercise media\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'workout-exercises/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    RAISE NOTICE 'Storage RLS policies for workout-exercises folder updated successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy update. Enable storage in config.toml and restart Supabase.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_workout_exercises_storage_rls
20260115000000	{"-- Add active flag to profiles for trainee activation control\nALTER TABLE public.profiles\n  ADD COLUMN IF NOT EXISTS is_active BOOLEAN NOT NULL DEFAULT true","COMMENT ON COLUMN public.profiles.is_active IS 'Whether the user account is active (trainee access gating)'"}	add_profiles_is_active
20260115000001	{"-- =====================================================\n-- Create Internal Knowledge Base Table\n-- Created: 2026-01-15\n-- Description: Internal knowledge base for storing video links and resources\n--              For internal usage by staff/managers (NOT customer-related)\n-- =====================================================\n\n-- Create internal_knowledge_base table\nCREATE TABLE IF NOT EXISTS public.internal_knowledge_base (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    title TEXT NOT NULL,\n    description TEXT,\n    video_url TEXT NOT NULL, -- Video link (URL only, no storage)\n    tags TEXT[] DEFAULT '{}', -- Array of tags for categorization\n    duration INTEGER, -- Duration in seconds (optional)\n    additional_info JSONB DEFAULT '{}'::jsonb, -- Flexible additional metadata\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,\n    created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Create indexes for efficient queries\nCREATE INDEX IF NOT EXISTS idx_internal_kb_created_at ON public.internal_knowledge_base(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_internal_kb_tags ON public.internal_knowledge_base USING GIN (tags)","CREATE INDEX IF NOT EXISTS idx_internal_kb_title ON public.internal_knowledge_base(title)","CREATE INDEX IF NOT EXISTS idx_internal_kb_created_by ON public.internal_knowledge_base(created_by)","-- Create trigger for auto-updating updated_at\nCREATE TRIGGER update_internal_kb_updated_at\n    BEFORE UPDATE ON public.internal_knowledge_base\n    FOR EACH ROW\n    EXECUTE FUNCTION public.update_updated_at_column()","-- Enable RLS on internal_knowledge_base table\nALTER TABLE public.internal_knowledge_base ENABLE ROW LEVEL SECURITY","-- RLS Policies for internal_knowledge_base\n-- Authenticated users (staff/managers) can read all entries\nDROP POLICY IF EXISTS \\"Authenticated users can read knowledge base\\" ON public.internal_knowledge_base","CREATE POLICY \\"Authenticated users can read knowledge base\\"\n    ON public.internal_knowledge_base FOR SELECT\n    USING (auth.role() = 'authenticated')","-- Authenticated users can insert entries\nDROP POLICY IF EXISTS \\"Authenticated users can insert knowledge base\\" ON public.internal_knowledge_base","CREATE POLICY \\"Authenticated users can insert knowledge base\\"\n    ON public.internal_knowledge_base FOR INSERT\n    WITH CHECK (auth.role() = 'authenticated')","-- Authenticated users can update entries\nDROP POLICY IF EXISTS \\"Authenticated users can update knowledge base\\" ON public.internal_knowledge_base","CREATE POLICY \\"Authenticated users can update knowledge base\\"\n    ON public.internal_knowledge_base FOR UPDATE\n    USING (auth.role() = 'authenticated')\n    WITH CHECK (auth.role() = 'authenticated')","-- Authenticated users can delete entries\nDROP POLICY IF EXISTS \\"Authenticated users can delete knowledge base\\" ON public.internal_knowledge_base","CREATE POLICY \\"Authenticated users can delete knowledge base\\"\n    ON public.internal_knowledge_base FOR DELETE\n    USING (auth.role() = 'authenticated')","-- Add comment to table\nCOMMENT ON TABLE public.internal_knowledge_base IS 'Internal knowledge base for storing video links and resources for staff/managers (NOT customer-related)'","COMMENT ON COLUMN public.internal_knowledge_base.video_url IS 'Video link URL (external link, no storage)'","COMMENT ON COLUMN public.internal_knowledge_base.tags IS 'Array of tags for categorization and filtering'","COMMENT ON COLUMN public.internal_knowledge_base.duration IS 'Duration in seconds (optional)'","COMMENT ON COLUMN public.internal_knowledge_base.additional_info IS 'Flexible JSONB field for additional metadata'"}	create_internal_knowledge_base
20260115000002	{"-- =====================================================\n-- Make video_url optional in internal_knowledge_base\n-- Created: 2026-01-15\n-- Description: Allow video_url to be NULL\n-- =====================================================\n\nALTER TABLE public.internal_knowledge_base \n  ALTER COLUMN video_url DROP NOT NULL"}	make_video_url_optional
20260120000002	{"-- =====================================================\n-- Add period boolean field to leads table\n-- Created: 2026-01-20\n-- Description: Adds period field to personal information section\n--              This is a boolean field to track menstrual period status\n-- =====================================================\n\nSET search_path TO public","-- Add period column to leads table\nALTER TABLE public.leads \nADD COLUMN IF NOT EXISTS period BOOLEAN DEFAULT NULL","-- Create index for period column\nCREATE INDEX IF NOT EXISTS idx_leads_period ON public.leads(period) WHERE period IS NOT NULL","-- Update the view to include period field\nDROP VIEW IF EXISTS public.v_leads_with_customer CASCADE","CREATE VIEW public.v_leads_with_customer AS\nSELECT \n    l.id,\n    l.created_at,\n    l.updated_at,\n    l.assigned_to,\n    l.customer_id,\n    l.city,\n    l.birth_date,\n    l.age,\n    l.gender,\n    l.period,\n    l.status_main,\n    l.status_sub,\n    l.height,\n    l.weight,\n    l.bmi,\n    l.join_date,\n    l.subscription_data,\n    l.daily_protocol,\n    l.workout_history,\n    l.steps_history,\n    l.source,\n    l.fitness_goal,\n    l.activity_level,\n    l.preferred_time,\n    l.notes,\n    -- Customer data (joined)\n    c.full_name as customer_name,\n    c.phone as customer_phone,\n    c.email as customer_email,\n    -- Calculated fields (PostgreSQL does the math)\n    TO_CHAR(l.created_at, 'YYYY-MM-DD') as created_date_formatted,\n    TO_CHAR(l.birth_date, 'YYYY-MM-DD') as birth_date_formatted,\n    -- Extract JSONB fields (PostgreSQL parses JSON)\n    (l.daily_protocol->>'stepsGoal')::INTEGER as daily_steps_goal,\n    (l.daily_protocol->>'workoutGoal')::INTEGER as weekly_workouts,\n    -- Extract supplements array from JSONB (handle both array and null)\n    CASE \n        WHEN l.daily_protocol->'supplements' IS NULL THEN ARRAY[]::TEXT[]\n        WHEN jsonb_typeof(l.daily_protocol->'supplements') = 'array' \n        THEN ARRAY(SELECT jsonb_array_elements_text(l.daily_protocol->'supplements'))\n        ELSE ARRAY[]::TEXT[]\n    END as daily_supplements,\n    (l.subscription_data->>'months')::INTEGER as subscription_months,\n    (l.subscription_data->>'initialPrice')::DECIMAL as subscription_initial_price,\n    (l.subscription_data->>'renewalPrice')::DECIMAL as subscription_renewal_price\nFROM public.leads l\nLEFT JOIN public.customers c ON l.customer_id = c.id","-- Grant permissions on the view\nGRANT SELECT ON public.v_leads_with_customer TO authenticated","GRANT SELECT ON public.v_leads_with_customer TO anon"}	add_period_field
20260120000004	{"-- Create notifications table for real-time activity tracking\n-- This table stores notifications for admin users when trainees perform actions\n\nCREATE TABLE IF NOT EXISTS notifications (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n  customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,\n  lead_id UUID REFERENCES leads(id) ON DELETE SET NULL,\n  type TEXT NOT NULL, -- e.g., 'weight_updated', 'meal_logged', 'check_in_completed', etc.\n  title TEXT NOT NULL, -- e.g., \\"עדכון משקל\\"\n  message TEXT NOT NULL, -- e.g., \\"יוסי כהן עדכן את המשקל ל-75 ק״ג\\"\n  action_url TEXT, -- URL to navigate when clicking notification (e.g., \\"/customers/{customer_id}\\")\n  is_read BOOLEAN DEFAULT FALSE,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  read_at TIMESTAMPTZ,\n  \n  -- Metadata for additional context\n  metadata JSONB DEFAULT '{}'::jsonb\n)","-- Indexes for performance\nCREATE INDEX IF NOT EXISTS idx_notifications_user_id ON notifications(user_id)","CREATE INDEX IF NOT EXISTS idx_notifications_user_read ON notifications(user_id, is_read)","CREATE INDEX IF NOT EXISTS idx_notifications_created_at ON notifications(created_at DESC)","CREATE INDEX IF NOT EXISTS idx_notifications_customer_id ON notifications(customer_id)","CREATE INDEX IF NOT EXISTS idx_notifications_lead_id ON notifications(lead_id)","-- RLS Policies\nALTER TABLE notifications ENABLE ROW LEVEL SECURITY","-- Policy: Users can only see their own notifications\nCREATE POLICY \\"Users can view their own notifications\\"\n  ON notifications\n  FOR SELECT\n  USING (auth.uid() = user_id)","-- Policy: System can create notifications for any user\n-- (This will be used by Edge Functions or service role)\nCREATE POLICY \\"Service role can create notifications\\"\n  ON notifications\n  FOR INSERT\n  WITH CHECK (true)","-- Policy: Users can update their own notifications (mark as read)\nCREATE POLICY \\"Users can update their own notifications\\"\n  ON notifications\n  FOR UPDATE\n  USING (auth.uid() = user_id)\n  WITH CHECK (auth.uid() = user_id)","-- Function to mark notification as read\nCREATE OR REPLACE FUNCTION mark_notification_read(notification_id UUID)\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nBEGIN\n  UPDATE notifications\n  SET is_read = TRUE,\n      read_at = NOW()\n  WHERE id = notification_id\n    AND user_id = auth.uid();\nEND;\n$$","-- Function to mark all notifications as read for a user\nCREATE OR REPLACE FUNCTION mark_all_notifications_read()\nRETURNS void\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nBEGIN\n  UPDATE notifications\n  SET is_read = TRUE,\n      read_at = NOW()\n  WHERE user_id = auth.uid()\n    AND is_read = FALSE;\nEND;\n$$","-- Function to get unread notification count\nCREATE OR REPLACE FUNCTION get_unread_notification_count()\nRETURNS INTEGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nAS $$\nDECLARE\n  count INTEGER;\nBEGIN\n  SELECT COUNT(*)::INTEGER\n  INTO count\n  FROM notifications\n  WHERE user_id = auth.uid()\n    AND is_read = FALSE;\n  \n  RETURN COALESCE(count, 0);\nEND;\n$$","-- Grant execute permissions\nGRANT EXECUTE ON FUNCTION mark_notification_read(UUID) TO authenticated","GRANT EXECUTE ON FUNCTION mark_all_notifications_read() TO authenticated","GRANT EXECUTE ON FUNCTION get_unread_notification_count() TO authenticated","-- Comments\nCOMMENT ON TABLE notifications IS 'Stores real-time notifications for admin users about trainee activities'","COMMENT ON COLUMN notifications.type IS 'Type of notification: weight_updated, meal_logged, check_in_completed, etc.'","COMMENT ON COLUMN notifications.action_url IS 'URL to navigate when clicking the notification'","COMMENT ON COLUMN notifications.metadata IS 'Additional context data in JSON format'"}	create_notifications
20260121000002	{"-- =====================================================\n-- Add Duration Unit to Subscription Types\n-- Created: 2026-01-21\n-- Description: Allow subscription types to specify duration in days, weeks, or months\n-- =====================================================\n\n-- Add duration_unit column with default 'months' for backward compatibility\nALTER TABLE subscription_types\nADD COLUMN IF NOT EXISTS duration_unit TEXT NOT NULL DEFAULT 'months'\nCHECK (duration_unit IN ('days', 'weeks', 'months'))","-- Update comment on duration column\nCOMMENT ON COLUMN subscription_types.duration IS 'Duration value (interpreted based on duration_unit)'","COMMENT ON COLUMN subscription_types.duration_unit IS 'Unit for duration: days, weeks, or months'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_duration_unit_to_subscription_types
20260121000006	{"-- =====================================================\n-- Add Activity Entries and Ensure Manual Fields to Nutrition Templates\n-- Created: 2026-01-21\n-- Description: Adds activity_entries column for METs calculation data\n--              Also ensures manual_fields column exists (in case previous migration wasn't run)\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Ensure manual_fields column exists (in case previous migration wasn't run)\nALTER TABLE nutrition_templates\n  ADD COLUMN IF NOT EXISTS manual_fields JSONB DEFAULT '{}'::jsonb","-- Add activity_entries column for storing METs activity data\nALTER TABLE nutrition_templates\n  ADD COLUMN IF NOT EXISTS activity_entries JSONB DEFAULT '[]'::jsonb","-- Structure: Array of { id: string, activityType: string, mets: number, minutesPerWeek: number }\n\n-- Add comments\nCOMMENT ON COLUMN nutrition_templates.manual_fields IS 'JSONB storing manual fields: { steps: number | null, workouts: text | null, supplements: text | null }'","COMMENT ON COLUMN nutrition_templates.activity_entries IS 'JSONB array storing activity entries for METs calculation: [{ id: string, activityType: string, mets: number, minutesPerWeek: number }]'","-- Create GIN index for activity_entries JSONB column (enables fast queries on JSONB data)\nCREATE INDEX IF NOT EXISTS idx_nutrition_templates_activity_entries ON nutrition_templates USING GIN (activity_entries)","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_activity_entries_to_nutrition_templates
20260120000003	{"-- =====================================================\n-- Add currency field to subscription_types table\n-- Created: 2026-01-20\n-- Description: Adds currency column to subscription types\n--              Supports ILS, USD, EUR currencies\n--              Defaults to 'ILS' for backward compatibility\n-- =====================================================\n\nSET search_path TO public","-- Add currency column to subscription_types table\nALTER TABLE public.subscription_types \nADD COLUMN IF NOT EXISTS currency TEXT DEFAULT 'ILS' NOT NULL CHECK (currency IN ('ILS', 'USD', 'EUR'))","-- Create index for currency column\nCREATE INDEX IF NOT EXISTS idx_subscription_types_currency ON public.subscription_types(currency)","-- Update comment for price column\nCOMMENT ON COLUMN public.subscription_types.price IS 'Price amount (value varies based on currency)'","COMMENT ON COLUMN public.subscription_types.currency IS 'Currency code: ILS (Israeli Shekel), USD (US Dollar), or EUR (Euro)'"}	add_currency_to_subscription_types
20260120000005	{"-- =====================================================\n-- Fix templates folder storage RLS policies\n-- Created: 2026-01-20\n-- Description: Updates RLS policies for templates folder to use more reliable path matching\n--              Replaces storage.foldername(name)[1] with starts_with() for better reliability\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Only update policies if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Drop existing policies\n    DROP POLICY IF EXISTS \\"Managers can upload template files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can view template files\\" ON storage.objects;\n    DROP POLICY IF EXISTS \\"Managers can delete template files\\" ON storage.objects;\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to upload template files\n    -- Path structure: templates/{user_id}/{flow_key}/{filename}\n    -- Using starts_with() for more reliable path matching\n    CREATE POLICY \\"Managers can upload template files\\"\n    ON storage.objects\n    FOR INSERT\n    TO authenticated\n    WITH CHECK (\n      bucket_id = 'client-assets' AND\n      name LIKE 'templates/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to view template files\n    CREATE POLICY \\"Managers can view template files\\"\n    ON storage.objects\n    FOR SELECT\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'templates/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    -- RLS Policy: Allow authenticated users (managers/admins) to delete template files\n    CREATE POLICY \\"Managers can delete template files\\"\n    ON storage.objects\n    FOR DELETE\n    TO authenticated\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'templates/%' AND\n      EXISTS (\n        SELECT 1 FROM profiles\n        WHERE profiles.id = auth.uid()\n        AND profiles.role IN ('admin', 'user')\n      )\n    );\n\n    RAISE NOTICE 'Storage RLS policies for templates folder updated successfully';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping RLS policy update. Enable storage in config.toml and restart Supabase.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_templates_storage_rls
20260121000003	{"-- =====================================================\n-- Add 'payments' to saved_views resource_key constraint\n-- Created: 2026-01-21\n-- Description: Allow saved views for payments (Tashlumim)\n-- =====================================================\n\n-- Drop the existing constraint\nALTER TABLE saved_views DROP CONSTRAINT IF EXISTS saved_views_resource_key_check","-- Add new constraint that includes 'payments'\nALTER TABLE saved_views \n  ADD CONSTRAINT saved_views_resource_key_check \n  CHECK (resource_key IN ('leads', 'workouts', 'customers', 'templates', 'nutrition_templates', 'budgets', 'meetings', 'check_in_settings', 'payments'))","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_payments_to_saved_views
20260121000007	{"-- =====================================================\n-- Fix Nutrition Templates Columns\n-- Created: 2026-01-21\n-- Description: Ensures all required columns exist in nutrition_templates table\n--              This is a comprehensive fix for any missing columns\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Ensure manual_override column exists\n-- Structure: { calories: boolean, protein: boolean, carbs: boolean, fat: boolean, fiber: boolean }\nDO $$ \nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_schema = 'public' \n        AND table_name = 'nutrition_templates' \n        AND column_name = 'manual_override'\n    ) THEN\n        ALTER TABLE nutrition_templates\n        ADD COLUMN manual_override JSONB DEFAULT '{}'::jsonb;\n        \n        COMMENT ON COLUMN nutrition_templates.manual_override IS 'JSONB tracking which macro/calorie fields have been manually overridden: { calories: boolean, protein: boolean, carbs: boolean, fat: boolean, fiber: boolean }';\n    END IF;\nEND $$","-- Ensure manual_fields column exists\n-- Structure: { steps: number | null, workouts: text | null, supplements: text | null }\nDO $$ \nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_schema = 'public' \n        AND table_name = 'nutrition_templates' \n        AND column_name = 'manual_fields'\n    ) THEN\n        ALTER TABLE nutrition_templates\n        ADD COLUMN manual_fields JSONB DEFAULT '{}'::jsonb;\n        \n        COMMENT ON COLUMN nutrition_templates.manual_fields IS 'JSONB storing manual fields: { steps: number | null, workouts: text | null, supplements: text | null }';\n    END IF;\nEND $$","-- Ensure activity_entries column exists\n-- Structure: Array of { id: string, activityType: string, mets: number, minutesPerWeek: number }\nDO $$ \nBEGIN\n    IF NOT EXISTS (\n        SELECT 1 FROM information_schema.columns \n        WHERE table_schema = 'public' \n        AND table_name = 'nutrition_templates' \n        AND column_name = 'activity_entries'\n    ) THEN\n        ALTER TABLE nutrition_templates\n        ADD COLUMN activity_entries JSONB DEFAULT '[]'::jsonb;\n        \n        COMMENT ON COLUMN nutrition_templates.activity_entries IS 'JSONB array storing activity entries for METs calculation: [{ id: string, activityType: string, mets: number, minutesPerWeek: number }]';\n    END IF;\nEND $$","-- Create GIN indexes for JSONB columns (if they don't exist)\nCREATE INDEX IF NOT EXISTS idx_nutrition_templates_manual_override ON nutrition_templates USING GIN (manual_override)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_manual_fields ON nutrition_templates USING GIN (manual_fields)","CREATE INDEX IF NOT EXISTS idx_nutrition_templates_activity_entries ON nutrition_templates USING GIN (activity_entries)","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_nutrition_templates_columns
20260121000008	{"-- =====================================================\n-- Fix Fillout Submissions RLS Policies\n-- Created: 2026-01-21\n-- Description: Fixes RLS policies to avoid \\"permission denied for table users\\" error\n--              Uses auth.jwt() instead of querying auth.users directly\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Drop existing policies\nDROP POLICY IF EXISTS \\"Managers can view all fillout submissions\\" ON public.fillout_submissions","DROP POLICY IF EXISTS \\"Managers can insert fillout submissions\\" ON public.fillout_submissions","DROP POLICY IF EXISTS \\"Managers can update fillout submissions\\" ON public.fillout_submissions","DROP POLICY IF EXISTS \\"Managers can delete fillout submissions\\" ON public.fillout_submissions","-- Policy: Managers can view all submissions\n-- Uses profiles table to check role (same pattern as other tables)\nCREATE POLICY \\"Managers can view all fillout submissions\\"\n  ON public.fillout_submissions\n  FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )","-- Policy: Managers can insert submissions\nCREATE POLICY \\"Managers can insert fillout submissions\\"\n  ON public.fillout_submissions\n  FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )","-- Policy: Managers can update submissions\nCREATE POLICY \\"Managers can update fillout submissions\\"\n  ON public.fillout_submissions\n  FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )","-- Policy: Managers can delete submissions\nCREATE POLICY \\"Managers can delete fillout submissions\\"\n  ON public.fillout_submissions\n  FOR DELETE\n  USING (\n    EXISTS (\n      SELECT 1 FROM profiles\n      WHERE profiles.id = auth.uid()\n      AND profiles.role IN ('admin', 'user', 'manager')\n    )\n    OR auth.role() = 'service_role'\n  )","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_fillout_submissions_rls
20260121000011	{"-- =====================================================\n-- Fix Duplicate Plans Per Budget Migration\n-- Created: 2026-01-21\n-- Description: Removes duplicate plans per budget and ensures only one plan per budget_id\n--              This fixes the issue where the same plan appears twice when both customer_id and lead_id are set\n-- =====================================================\n\n-- =====================================================\n-- STEP 1: Clean up existing duplicates\n-- Keep only the most recent plan per budget_id (regardless of customer_id/lead_id)\n-- =====================================================\n\n-- Clean up duplicate workout_plans - keep only one per budget_id\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id\n          ORDER BY COALESCE(start_date, created_at) DESC, created_at DESC\n        ) as rn\n      FROM workout_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM workout_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate nutrition_plans - keep only one per budget_id\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id\n          ORDER BY COALESCE(start_date, created_at) DESC, created_at DESC\n        ) as rn\n      FROM nutrition_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM nutrition_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate steps_plans - keep only one per budget_id\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id\n          ORDER BY COALESCE(start_date, created_at) DESC, created_at DESC\n        ) as rn\n      FROM steps_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM steps_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- Clean up duplicate supplement_plans - keep only one per budget_id\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE '\n    WITH ranked_plans AS (\n      SELECT \n        id,\n        ROW_NUMBER() OVER (\n          PARTITION BY budget_id\n          ORDER BY COALESCE(start_date, created_at) DESC, created_at DESC\n        ) as rn\n      FROM supplement_plans\n      WHERE budget_id IS NOT NULL\n    )\n    DELETE FROM supplement_plans\n    WHERE id IN (\n      SELECT id FROM ranked_plans WHERE rn > 1\n    )';\n  END IF;\nEND $$","-- =====================================================\n-- STEP 2: Add unique constraint to prevent future duplicates\n-- One plan per budget_id (regardless of customer_id/lead_id)\n-- =====================================================\n\n-- Drop existing indexes if they exist and create new unique constraint for workout_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    -- Drop old indexes if they exist\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget_lead';\n    \n    -- Create new unique constraint: one plan per budget_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_workout_plans_unique_budget\n    ON workout_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n  END IF;\nEND $$","-- Drop existing indexes if they exist and create new unique constraint for nutrition_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    -- Drop old indexes if they exist\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget_lead';\n    \n    -- Create new unique constraint: one plan per budget_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_nutrition_plans_unique_budget\n    ON nutrition_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n  END IF;\nEND $$","-- Drop existing indexes if they exist and create new unique constraint for steps_plans\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    -- Drop old indexes if they exist\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget_lead';\n    \n    -- Create new unique constraint: one plan per budget_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_steps_plans_unique_budget\n    ON steps_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n  END IF;\nEND $$","-- Drop existing indexes if they exist and create new unique constraint for supplement_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    -- Drop old indexes if they exist\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget_lead';\n    \n    -- Create new unique constraint: one plan per budget_id\n    EXECUTE 'CREATE UNIQUE INDEX IF NOT EXISTS idx_supplement_plans_unique_budget\n    ON supplement_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n  END IF;\nEND $$","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_workout_plans_unique_budget') THEN\n    EXECUTE 'COMMENT ON INDEX idx_workout_plans_unique_budget IS ''Ensures only one workout plan per budget_id''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_nutrition_plans_unique_budget') THEN\n    EXECUTE 'COMMENT ON INDEX idx_nutrition_plans_unique_budget IS ''Ensures only one nutrition plan per budget_id''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_steps_plans_unique_budget') THEN\n    EXECUTE 'COMMENT ON INDEX idx_steps_plans_unique_budget IS ''Ensures only one steps plan per budget_id''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_supplement_plans_unique_budget') THEN\n    EXECUTE 'COMMENT ON INDEX idx_supplement_plans_unique_budget IS ''Ensures only one supplement plan per budget_id''';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	fix_duplicate_plans_per_budget
20260120000006	{"-- =====================================================\n-- TEMPORARY: Add public access to templates folder for local development\n-- Created: 2026-01-20\n-- Description: Adds a temporary public SELECT policy for templates folder\n--              This allows GreenAPI to access media files in local development\n-- WARNING: This makes templates publicly accessible. Remove this policy after testing!\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Only add policy if storage.objects table exists\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'objects'\n  ) THEN\n    -- Add temporary public SELECT policy for templates folder\n    -- This allows anyone to view files in templates/ folder (for local dev only)\n    DROP POLICY IF EXISTS \\"TEMP: Public access to templates for local dev\\" ON storage.objects;\n    \n    CREATE POLICY \\"TEMP: Public access to templates for local dev\\"\n    ON storage.objects\n    FOR SELECT\n    TO public\n    USING (\n      bucket_id = 'client-assets' AND\n      name LIKE 'templates/%'\n    );\n\n    RAISE NOTICE 'Temporary public access policy added to templates folder';\n    RAISE NOTICE 'WARNING: This makes templates publicly accessible. Remember to remove this policy!';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping temporary policy creation.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- =====================================================\n-- To remove this policy, run:\n-- DROP POLICY IF EXISTS \\"TEMP: Public access to templates for local dev\\" ON storage.objects;"}	temp_public_templates_access
20260121000004	{"-- =====================================================\n-- Migration: Create Fillout Submissions Table\n-- Created: 2026-01-21\n-- Description: Stores all Fillout form submissions with submission type for easy categorization\n-- =====================================================\n\n-- Create fillout_submissions table\nCREATE TABLE IF NOT EXISTS public.fillout_submissions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  fillout_submission_id TEXT NOT NULL UNIQUE, -- Unique identifier from Fillout\n  fillout_form_id TEXT NOT NULL, -- Form ID from Fillout\n  submission_type TEXT, -- Type of submission (e.g., 'meeting', 'questionnaire', etc.)\n  submission_data JSONB NOT NULL DEFAULT '{}'::jsonb, -- Flexible JSONB to store all form data\n  lead_id UUID REFERENCES public.leads(id) ON DELETE SET NULL,\n  customer_id UUID REFERENCES public.customers(id) ON DELETE SET NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n  created_by UUID REFERENCES auth.users(id) ON DELETE SET NULL\n)","-- Add indexes\nCREATE INDEX IF NOT EXISTS idx_fillout_submissions_fillout_submission_id ON public.fillout_submissions(fillout_submission_id)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_fillout_form_id ON public.fillout_submissions(fillout_form_id)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_submission_type ON public.fillout_submissions(submission_type)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_lead_id ON public.fillout_submissions(lead_id)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_customer_id ON public.fillout_submissions(customer_id)","CREATE INDEX IF NOT EXISTS idx_fillout_submissions_created_at ON public.fillout_submissions(created_at DESC)","-- Add RLS policies\nALTER TABLE public.fillout_submissions ENABLE ROW LEVEL SECURITY","-- Policy: Managers can view all submissions\nCREATE POLICY \\"Managers can view all fillout submissions\\"\n  ON public.fillout_submissions\n  FOR SELECT\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can insert submissions\nCREATE POLICY \\"Managers can insert fillout submissions\\"\n  ON public.fillout_submissions\n  FOR INSERT\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can update submissions\nCREATE POLICY \\"Managers can update fillout submissions\\"\n  ON public.fillout_submissions\n  FOR UPDATE\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )\n  WITH CHECK (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Managers can delete submissions\nCREATE POLICY \\"Managers can delete fillout submissions\\"\n  ON public.fillout_submissions\n  FOR DELETE\n  USING (\n    EXISTS (\n      SELECT 1 FROM auth.users\n      WHERE auth.users.id = auth.uid()\n      AND auth.users.raw_user_meta_data->>'role' = 'manager'\n    )\n  )","-- Policy: Allow service role (edge functions) to insert/update submissions\nCREATE POLICY \\"Service role can manage fillout submissions\\"\n  ON public.fillout_submissions\n  FOR ALL\n  USING (auth.role() = 'service_role')\n  WITH CHECK (auth.role() = 'service_role')","-- Create function to update updated_at timestamp\nCREATE OR REPLACE FUNCTION update_fillout_submissions_updated_at()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql","-- Create trigger to automatically update updated_at\nCREATE TRIGGER update_fillout_submissions_updated_at\n  BEFORE UPDATE ON public.fillout_submissions\n  FOR EACH ROW\n  EXECUTE FUNCTION update_fillout_submissions_updated_at()","-- Add comments\nCOMMENT ON TABLE public.fillout_submissions IS 'Stores all Fillout form submissions with type for easy categorization'","COMMENT ON COLUMN public.fillout_submissions.fillout_submission_id IS 'Unique identifier from Fillout submission'","COMMENT ON COLUMN public.fillout_submissions.fillout_form_id IS 'Form ID from Fillout'","COMMENT ON COLUMN public.fillout_submissions.submission_type IS 'Type of submission (e.g., meeting, questionnaire) - extracted from form submission'","COMMENT ON COLUMN public.fillout_submissions.submission_data IS 'Flexible JSONB containing all form submission data'","COMMENT ON COLUMN public.fillout_submissions.lead_id IS 'Link to the lead that the submission is associated with'","COMMENT ON COLUMN public.fillout_submissions.customer_id IS 'Link to the customer that the submission is associated with'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	create_fillout_submissions
20260121000009	{"-- =====================================================\n-- Add is_active to nutrition_plans\n-- Created: 2026-01-21\n-- Description: Add is_active and deleted_at columns to nutrition_plans for consistency with workout_plans\n--              This allows tracking active vs inactive nutrition plans\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Add is_active and deleted_at columns\nALTER TABLE nutrition_plans\n  ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true NOT NULL,\n  ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMP WITH TIME ZONE","-- Create index for active plans\nCREATE INDEX IF NOT EXISTS idx_nutrition_plans_is_active ON nutrition_plans(is_active) WHERE is_active = true","CREATE INDEX IF NOT EXISTS idx_nutrition_plans_deleted_at ON nutrition_plans(deleted_at) WHERE deleted_at IS NOT NULL","-- Update existing plans to be active\nUPDATE nutrition_plans SET is_active = true WHERE is_active IS NULL","-- Add comments\nCOMMENT ON COLUMN nutrition_plans.is_active IS 'Whether this nutrition plan is currently active'","COMMENT ON COLUMN nutrition_plans.deleted_at IS 'Timestamp when this nutrition plan was deleted (soft delete)'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_is_active_to_nutrition_plans
20260121000012	{"-- =====================================================\n-- Remove Strict Budget Constraints Migration\n-- Created: 2026-01-21\n-- Description: Removes overly strict unique constraints that prevent plan creation\n--              The application already handles deduplication via delete-before-insert logic\n-- =====================================================\n\n-- =====================================================\n-- STEP 1: Drop all unique constraints on budget_id\n-- These constraints are preventing legitimate plan creation\n-- =====================================================\n\n-- Drop unique constraints for workout_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_workout_plans_unique_budget';\n  END IF;\nEND $$","-- Drop unique constraints for nutrition_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_nutrition_plans_unique_budget';\n  END IF;\nEND $$","-- Drop unique constraints for steps_plans\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_steps_plans_unique_budget';\n  END IF;\nEND $$","-- Drop unique constraints for supplement_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget_customer';\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget_lead';\n    EXECUTE 'DROP INDEX IF EXISTS idx_supplement_plans_unique_budget';\n  END IF;\nEND $$","-- =====================================================\n-- STEP 2: Create non-unique indexes for performance\n-- These help with queries but don't prevent inserts\n-- =====================================================\n\n-- Create non-unique indexes for workout_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'workout_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_id_perf\n    ON workout_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_customer_perf\n    ON workout_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_workout_plans_budget_lead_perf\n    ON workout_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Create non-unique indexes for nutrition_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'nutrition_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_id_perf\n    ON nutrition_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_customer_perf\n    ON nutrition_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_nutrition_plans_budget_lead_perf\n    ON nutrition_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Create non-unique indexes for steps_plans\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'steps_plans') THEN\n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_steps_plans_budget_id_perf\n    ON steps_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_steps_plans_budget_customer_perf\n    ON steps_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_steps_plans_budget_lead_perf\n    ON steps_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- Create non-unique indexes for supplement_plans\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = 'supplement_plans' \n    AND column_name = 'budget_id'\n  ) THEN\n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_id_perf\n    ON supplement_plans (budget_id)\n    WHERE budget_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_customer_perf\n    ON supplement_plans (budget_id, customer_id)\n    WHERE budget_id IS NOT NULL AND customer_id IS NOT NULL';\n    \n    EXECUTE 'CREATE INDEX IF NOT EXISTS idx_supplement_plans_budget_lead_perf\n    ON supplement_plans (budget_id, lead_id)\n    WHERE budget_id IS NOT NULL AND lead_id IS NOT NULL';\n  END IF;\nEND $$","-- =====================================================\n-- COMMENTS\n-- =====================================================\n\nDO $$\nBEGIN\n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_workout_plans_budget_id_perf') THEN\n    EXECUTE 'COMMENT ON INDEX idx_workout_plans_budget_id_perf IS ''Performance index for querying workout plans by budget_id''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_nutrition_plans_budget_id_perf') THEN\n    EXECUTE 'COMMENT ON INDEX idx_nutrition_plans_budget_id_perf IS ''Performance index for querying nutrition plans by budget_id''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_steps_plans_budget_id_perf') THEN\n    EXECUTE 'COMMENT ON INDEX idx_steps_plans_budget_id_perf IS ''Performance index for querying steps plans by budget_id''';\n  END IF;\n  \n  IF EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'idx_supplement_plans_budget_id_perf') THEN\n    EXECUTE 'COMMENT ON INDEX idx_supplement_plans_budget_id_perf IS ''Performance index for querying supplement plans by budget_id''';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- Note: Deduplication is now handled entirely by application logic\n-- in budgetPlanSync.ts which deletes existing plans before inserting new ones\n-- ====================================================="}	remove_strict_budget_constraints
20260121000000	{"-- =====================================================\n-- Ensure Storage Bucket is Private\n-- Created: 2026-01-21\n-- Description: Ensures the client-assets bucket is private (public = false)\n--              This migration ensures all files require signed URLs for access\n--              Only admin/worker roles can view all files, regular users can only view their own\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Ensure storage bucket is private (idempotent)\nDO $$\nBEGIN\n  IF EXISTS (\n    SELECT FROM information_schema.tables \n    WHERE table_schema = 'storage' \n    AND table_name = 'buckets'\n  ) THEN\n    -- Update bucket to ensure it's private (public = false)\n    -- This ensures all files require signed URLs for access\n    UPDATE storage.buckets\n    SET public = false\n    WHERE id = 'client-assets' AND public = true;\n    \n    -- If bucket doesn't exist, create it as private\n    INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)\n    VALUES (\n      'client-assets',\n      'client-assets',\n      false, -- private bucket (uses signed URLs)\n      52428800, -- 50MB file size limit (in bytes) - matches config.toml\n      ARRAY[\n        'image/jpeg',\n        'image/jpg', \n        'image/png',\n        'image/gif',\n        'image/webp',\n        'video/mp4',\n        'video/mpeg',\n        'video/quicktime',\n        'application/pdf',\n        'application/msword',\n        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n      ]::text[]\n    )\n    ON CONFLICT (id) DO UPDATE SET\n      public = false, -- Always ensure private\n      file_size_limit = EXCLUDED.file_size_limit,\n      allowed_mime_types = EXCLUDED.allowed_mime_types;\n    \n    RAISE NOTICE 'Storage bucket \\"client-assets\\" is now private (requires signed URLs)';\n  ELSE\n    RAISE NOTICE 'Storage schema not available. Skipping bucket update. Enable storage in config.toml and restart Supabase.';\n  END IF;\nEND $$","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	ensure_storage_bucket_is_private
20260121000005	{"-- =====================================================\n-- Migration: Add Pagination, Sorting, and Group By to Leads\n-- Created: 2026-01-21\n-- Description: Adds server-side pagination, sorting, and grouping support to get_filtered_leads RPC function\n--              Also adds separate get_filtered_leads_count function for total count\n-- =====================================================\n\n-- Step 1: Update get_filtered_leads function to support sorting and grouping\nCREATE OR REPLACE FUNCTION public.get_filtered_leads(\n    p_limit_count INTEGER DEFAULT 100,\n    p_offset_count INTEGER DEFAULT 0,\n    p_search_query TEXT DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_date TEXT DEFAULT NULL,\n    -- New parameters for sorting\n    p_sort_by TEXT DEFAULT 'created_at',\n    p_sort_order TEXT DEFAULT 'DESC',\n    -- New parameters for grouping (level 1 and level 2)\n    p_group_by_level1 TEXT DEFAULT NULL,\n    p_group_by_level2 TEXT DEFAULT NULL\n)\nRETURNS TABLE (\n    id UUID,\n    created_at TIMESTAMP WITH TIME ZONE,\n    updated_at TIMESTAMP WITH TIME ZONE,\n    assigned_to UUID,\n    customer_id UUID,\n    city TEXT,\n    birth_date DATE,\n    age INTEGER,\n    gender TEXT,\n    status_main TEXT,\n    status_sub TEXT,\n    height DECIMAL,\n    weight DECIMAL,\n    bmi DECIMAL,\n    join_date TIMESTAMP WITH TIME ZONE,\n    subscription_data JSONB,\n    daily_protocol JSONB,\n    workout_history JSONB,\n    steps_history JSONB,\n    source TEXT,\n    fitness_goal TEXT,\n    activity_level TEXT,\n    preferred_time TEXT,\n    notes TEXT,\n    customer_name TEXT,\n    customer_phone TEXT,\n    customer_email TEXT,\n    created_date_formatted TEXT,\n    birth_date_formatted TEXT,\n    daily_steps_goal INTEGER,\n    weekly_workouts INTEGER,\n    daily_supplements TEXT[],\n    subscription_months INTEGER,\n    subscription_initial_price DECIMAL,\n    subscription_renewal_price DECIMAL\n)\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    v_sort_direction TEXT;\n    v_order_by_clause TEXT;\nBEGIN\n    -- Validate sort_order (must be ASC or DESC)\n    v_sort_direction := UPPER(COALESCE(NULLIF(p_sort_order, ''), 'DESC'));\n    IF v_sort_direction NOT IN ('ASC', 'DESC') THEN\n        v_sort_direction := 'DESC';\n    END IF;\n\n    -- Build ORDER BY clause - start with grouping columns, then sorting column\n    v_order_by_clause := '';\n    \n    -- Add grouping columns to ORDER BY (for grouping in frontend, ensures groups are sorted together)\n    IF p_group_by_level1 IS NOT NULL THEN\n        v_order_by_clause := v_order_by_clause || CASE \n            WHEN p_group_by_level1 = 'status' OR p_group_by_level1 = 'status_main' THEN 'v.status_main ASC, '\n            WHEN p_group_by_level1 = 'source' THEN 'v.source ASC, '\n            WHEN p_group_by_level1 = 'fitnessGoal' OR p_group_by_level1 = 'fitness_goal' THEN 'v.fitness_goal ASC, '\n            WHEN p_group_by_level1 = 'activityLevel' OR p_group_by_level1 = 'activity_level' THEN 'v.activity_level ASC, '\n            WHEN p_group_by_level1 = 'preferredTime' OR p_group_by_level1 = 'preferred_time' THEN 'v.preferred_time ASC, '\n            WHEN p_group_by_level1 = 'name' OR p_group_by_level1 = 'customer_name' THEN 'v.customer_name ASC, '\n            WHEN p_group_by_level1 = 'age' THEN 'v.age ASC, '\n            WHEN p_group_by_level1 = 'height' THEN 'v.height ASC, '\n            WHEN p_group_by_level1 = 'weight' THEN 'v.weight ASC, '\n            ELSE ''\n        END;\n    END IF;\n    \n    IF p_group_by_level2 IS NOT NULL THEN\n        v_order_by_clause := v_order_by_clause || CASE \n            WHEN p_group_by_level2 = 'status' OR p_group_by_level2 = 'status_main' THEN 'v.status_main ASC, '\n            WHEN p_group_by_level2 = 'source' THEN 'v.source ASC, '\n            WHEN p_group_by_level2 = 'fitnessGoal' OR p_group_by_level2 = 'fitness_goal' THEN 'v.fitness_goal ASC, '\n            WHEN p_group_by_level2 = 'activityLevel' OR p_group_by_level2 = 'activity_level' THEN 'v.activity_level ASC, '\n            WHEN p_group_by_level2 = 'preferredTime' OR p_group_by_level2 = 'preferred_time' THEN 'v.preferred_time ASC, '\n            WHEN p_group_by_level2 = 'name' OR p_group_by_level2 = 'customer_name' THEN 'v.customer_name ASC, '\n            WHEN p_group_by_level2 = 'age' THEN 'v.age ASC, '\n            WHEN p_group_by_level2 = 'height' THEN 'v.height ASC, '\n            WHEN p_group_by_level2 = 'weight' THEN 'v.weight ASC, '\n            ELSE ''\n        END;\n    END IF;\n    \n    -- Add main sorting column\n    v_order_by_clause := v_order_by_clause || CASE \n        WHEN p_sort_by = 'createdDate' OR p_sort_by = 'created_date' OR p_sort_by = 'created_at' THEN 'v.created_at ' || v_sort_direction\n        WHEN p_sort_by = 'name' OR p_sort_by = 'customer_name' THEN 'v.customer_name ' || v_sort_direction\n        WHEN p_sort_by = 'status' OR p_sort_by = 'status_main' THEN 'v.status_main ' || v_sort_direction\n        WHEN p_sort_by = 'phone' OR p_sort_by = 'customer_phone' THEN 'v.customer_phone ' || v_sort_direction\n        WHEN p_sort_by = 'email' OR p_sort_by = 'customer_email' THEN 'v.customer_email ' || v_sort_direction\n        WHEN p_sort_by = 'source' THEN 'v.source ' || v_sort_direction\n        WHEN p_sort_by = 'age' THEN 'v.age ' || v_sort_direction\n        WHEN p_sort_by = 'height' THEN 'v.height ' || v_sort_direction\n        WHEN p_sort_by = 'weight' THEN 'v.weight ' || v_sort_direction\n        WHEN p_sort_by = 'fitnessGoal' OR p_sort_by = 'fitness_goal' THEN 'v.fitness_goal ' || v_sort_direction\n        WHEN p_sort_by = 'activityLevel' OR p_sort_by = 'activity_level' THEN 'v.activity_level ' || v_sort_direction\n        WHEN p_sort_by = 'preferredTime' OR p_sort_by = 'preferred_time' THEN 'v.preferred_time ' || v_sort_direction\n        WHEN p_sort_by = 'notes' THEN 'v.notes ' || v_sort_direction\n        ELSE 'v.created_at ' || v_sort_direction -- Default fallback\n    END;\n\n    -- Execute query with dynamic ORDER BY using EXECUTE (safe with validated inputs)\n    RETURN QUERY\n    EXECUTE format('\n        SELECT \n            v.id,\n            v.created_at,\n            v.updated_at,\n            v.assigned_to,\n            v.customer_id,\n            v.city,\n            v.birth_date,\n            v.age,\n            v.gender,\n            v.status_main,\n            v.status_sub,\n            v.height,\n            v.weight,\n            v.bmi,\n            v.join_date,\n            v.subscription_data,\n            v.daily_protocol,\n            v.workout_history,\n            v.steps_history,\n            v.source,\n            v.fitness_goal,\n            v.activity_level,\n            v.preferred_time,\n            v.notes,\n            v.customer_name,\n            v.customer_phone,\n            v.customer_email,\n            v.created_date_formatted,\n            v.birth_date_formatted,\n            v.daily_steps_goal,\n            v.weekly_workouts,\n            v.daily_supplements,\n            v.subscription_months,\n            v.subscription_initial_price,\n            v.subscription_renewal_price\n        FROM public.v_leads_with_customer v\n        WHERE \n            -- Search query (name, phone, email)\n            ($1 IS NULL OR \n             v.customer_name ILIKE ''%%'' || $1 || ''%%'' OR\n             v.customer_phone ILIKE ''%%'' || $1 || ''%%'' OR\n             v.customer_email ILIKE ''%%'' || $1 || ''%%'')\n            -- Status filter\n            AND ($2 IS NULL OR v.status_main = $2)\n            AND ($3 IS NULL OR v.status_sub = $3)\n            -- Source filter\n            AND ($4 IS NULL OR v.source = $4)\n            -- Fitness goal filter\n            AND ($5 IS NULL OR v.fitness_goal = $5)\n            -- Activity level filter\n            AND ($6 IS NULL OR v.activity_level = $6)\n            -- Preferred time filter\n            AND ($7 IS NULL OR v.preferred_time = $7)\n            -- Age filter\n            AND ($8 IS NULL OR v.age::TEXT = $8)\n            -- Height filter\n            AND ($9 IS NULL OR v.height::TEXT = $9)\n            -- Weight filter\n            AND ($10 IS NULL OR v.weight::TEXT = $10)\n            -- Date filter (created_at date)\n            AND ($11 IS NULL OR v.created_date_formatted = $11)\n        ORDER BY %s\n        LIMIT $12\n        OFFSET $13\n    ', v_order_by_clause)\n    USING \n        p_search_query,\n        p_status_main,\n        p_status_sub,\n        p_source,\n        p_fitness_goal,\n        p_activity_level,\n        p_preferred_time,\n        p_age,\n        p_height,\n        p_weight,\n        p_date,\n        p_limit_count,\n        p_offset_count;\nEND;\n$$","-- Step 2: Create separate count function for total leads matching filters\nCREATE OR REPLACE FUNCTION public.get_filtered_leads_count(\n    p_search_query TEXT DEFAULT NULL,\n    p_status_main TEXT DEFAULT NULL,\n    p_status_sub TEXT DEFAULT NULL,\n    p_source TEXT DEFAULT NULL,\n    p_fitness_goal TEXT DEFAULT NULL,\n    p_activity_level TEXT DEFAULT NULL,\n    p_preferred_time TEXT DEFAULT NULL,\n    p_age TEXT DEFAULT NULL,\n    p_height TEXT DEFAULT NULL,\n    p_weight TEXT DEFAULT NULL,\n    p_date TEXT DEFAULT NULL\n)\nRETURNS INTEGER\nLANGUAGE plpgsql\nSECURITY DEFINER\nSTABLE\nAS $$\nDECLARE\n    v_count INTEGER;\nBEGIN\n    SELECT COUNT(*)::INTEGER INTO v_count\n    FROM public.v_leads_with_customer v\n    WHERE \n        -- Search query (name, phone, email)\n        (p_search_query IS NULL OR \n         v.customer_name ILIKE '%' || p_search_query || '%' OR\n         v.customer_phone ILIKE '%' || p_search_query || '%' OR\n         v.customer_email ILIKE '%' || p_search_query || '%')\n        -- Status filter\n        AND (p_status_main IS NULL OR v.status_main = p_status_main)\n        AND (p_status_sub IS NULL OR v.status_sub = p_status_sub)\n        -- Source filter\n        AND (p_source IS NULL OR v.source = p_source)\n        -- Fitness goal filter\n        AND (p_fitness_goal IS NULL OR v.fitness_goal = p_fitness_goal)\n        -- Activity level filter\n        AND (p_activity_level IS NULL OR v.activity_level = p_activity_level)\n        -- Preferred time filter\n        AND (p_preferred_time IS NULL OR v.preferred_time = p_preferred_time)\n        -- Age filter\n        AND (p_age IS NULL OR v.age::TEXT = p_age)\n        -- Height filter\n        AND (p_height IS NULL OR v.height::TEXT = p_height)\n        -- Weight filter\n        AND (p_weight IS NULL OR v.weight::TEXT = p_weight)\n        -- Date filter (created_at date)\n        AND (p_date IS NULL OR v.created_date_formatted = p_date);\n\n    RETURN COALESCE(v_count, 0);\nEND;\n$$","-- Step 3: Grant execute permissions\nGRANT EXECUTE ON FUNCTION public.get_filtered_leads(INTEGER, INTEGER, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) TO authenticated","GRANT EXECUTE ON FUNCTION public.get_filtered_leads_count(TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) TO authenticated","-- Step 4: Update comments\nCOMMENT ON FUNCTION public.get_filtered_leads(INTEGER, INTEGER, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) IS 'RPC function for complex lead filtering with server-side pagination, sorting, and grouping support. All filtering happens in PostgreSQL.'","COMMENT ON FUNCTION public.get_filtered_leads_count(TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT, TEXT) IS 'Returns total count of leads matching the filter criteria. Used for pagination to calculate total pages.'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	add_pagination_sorting_groupby_to_leads
20260121000010	{"-- =====================================================\n-- Set Default Weekly Review WhatsApp Template\n-- Created: 2026-01-21\n-- Description: Sets default template for weekly_review automation\n--              This template matches the format used when sending weekly goals\n-- This migration must be the LAST one in the list for migration up to work correctly\n-- =====================================================\n\n-- Create a function to set default weekly_review template for a user\nCREATE OR REPLACE FUNCTION set_default_weekly_review_template(p_user_id UUID)\nRETURNS void AS $$\nBEGIN\n  -- Insert or update the weekly_review template for the user\n  INSERT INTO public.whatsapp_flow_templates (user_id, flow_key, template_content, buttons, media)\n  VALUES (\n    p_user_id,\n    'weekly_review',\n    '📊 סיכום שבועי - שבוע {{week_start}} - {{week_end}}\n\n🎯 יעדים:\nקלוריות: {{target_calories}} קק\\"ל\nחלבון: {{target_protein}} גרם\nסיבים: {{target_fiber}} גרם\nצעדים: {{target_steps}}\n\n📈 בפועל (ממוצע):\nקלוריות: {{actual_calories}} קק\\"ל\nמשקל ממוצע: {{actual_weight}} ק\\"ג',\n    '[]'::jsonb,\n    NULL\n  )\n  ON CONFLICT (user_id, flow_key)\n  DO UPDATE SET\n    template_content = EXCLUDED.template_content,\n    updated_at = NOW()\n  WHERE whatsapp_flow_templates.template_content = '' OR whatsapp_flow_templates.template_content IS NULL;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER","-- Set default template for all existing users (coaches/managers)\n-- This will only set templates for users who don't already have a weekly_review template\nDO $$\nDECLARE\n  user_record RECORD;\nBEGIN\n  FOR user_record IN \n    SELECT id FROM auth.users\n    WHERE id NOT IN (\n      SELECT DISTINCT user_id \n      FROM public.whatsapp_flow_templates \n      WHERE flow_key = 'weekly_review' \n      AND template_content IS NOT NULL \n      AND template_content != ''\n    )\n  LOOP\n    PERFORM set_default_weekly_review_template(user_record.id);\n  END LOOP;\nEND $$","-- Add comment\nCOMMENT ON FUNCTION set_default_weekly_review_template(UUID) IS 'Sets default weekly_review WhatsApp template for a user. Only updates if template is empty or null.'","-- =====================================================\n-- Migration Complete\n-- ====================================================="}	set_default_weekly_review_template
\.


--
-- Name: refresh_tokens_id_seq; Type: SEQUENCE SET; Schema: auth; Owner: supabase_auth_admin
--

SELECT pg_catalog.setval('"auth"."refresh_tokens_id_seq"', 54, true);


--
-- PostgreSQL database dump complete
--

-- \unrestrict H9HfRx4cfeQVKtBgpiwsVV8dPP3Gh8IFErKB8sSD9y2KOzCK9aTPR0cDJgah1iK

RESET ALL;
